!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,(function(t){return e[t]}).bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=131)}([function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";t.__esModule=!0;var i=n(83),s=i&&i.__esModule?i:{default:i};t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,s.default)(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(32)),s=u(n(102)),r=u(n(108)),a=u(n(209)),o=u(n(52));function u(e){return e&&e.__esModule?e:{default:e}}var l={userInfo:null,roomInfo:null,config:null,TafLink:null,Timer:null,TimeUtil:null,logger:null,HUYA:null,punchMgr:null,peerMgr:null,streamMgr:null,_isInit:!1,p2pPunchMode:o.default.SAME,printSubInfo:!1,init:function(){this._isInit||(this._isInit=!0,this.p2pPunchMode=this.getCfgValNum("p2pPunchMode",o.default.DIF),this.streamMgr=new a.default,this.peerMgr=new r.default,this.punchMgr=new s.default,this.punchMgr.initMgr(this.peerMgr,this.streamMgr,-1),this.printSubInfo=1===Number(i.default._printSubInfo)||1===Number(l.config.printSubInfo))},getCfgValNum:function(e,t){return this.config&&this.config.hasOwnProperty(e)?Number(this.config[e]):t}};t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n(58)),s=l(n(8)),r=l(n(74)),a=l(n(0)),o=l(n(1)),u=l(n(2));function l(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(){(0,a.default)(this,e)}return(0,o.default)(e,null,[{key:"formatByteSize",value:function(e){var t=e/1024;return t>1024?(t/=1024).toFixed(1)+"MB":t.toFixed(1)+"KB"}},{key:"isOpen",value:function(t,n,i){var s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=e.getCfgValue(t,n,i);return -1===r?s:100*Math.random()<r}},{key:"getCfgValue",value:function(t,n,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;n+="|",i="line"+i+":";for(var r=(t+="").split(","),a="",o="",u=r.length,l=0;l<u;l++){var d=r[l];-1!==d.indexOf(n)?a=d.replace(n,""):-1!==d.indexOf("all|")&&(o=d.replace("all|",""))}var h=s,c=s;return""!==a&&(h=e.getLineValue(a,i,s)),""!==o&&(c=e.getLineValue(o,i,s)),h!==s?h:c!==s?c:s}},{key:"getLineValue",value:function(t,n){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,s=t.split("_"),r=s.length,a=i,o=i,u=0;u<r;u++){var l=s[u];-1!==l.indexOf("all")?a=e.getValue(l,i):-1!==l.indexOf(n)&&(o=e.getValue(l,i))}return o!==i?o:a!==i?a:i}},{key:"getValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=t,i=e.split(":");return i.length>1&&isNaN(n=parseInt(i[1]))&&(n=t),n}},{key:"getQueryString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=(t||window.location.search.substr(1)).match(n);return null!=i?unescape(i[2]):null}},{key:"getCfgRateValue",value:function(t,n,i,s){var r=s;if(t&&t instanceof Array)for(var a=0;a<t.length;a++){var o=t[a],u=Number(o[0]),l=o[1];1!==u&&u!==Number(n)||(r=e.getRateValue(l,i,s))}return r}},{key:"getRateValue",value:function(e,t,n){for(var i=0;i<e.length;i++){var s=e[i][0],r=e[i][1];if(t>=s)return r}return n}},{key:"removeTimeout",value:function(e,t,n){var i=!0,a=!1,o=void 0;try{for(var u,l=(0,s.default)(t);!(i=(u=l.next()).done);i=!0){var d=u.value,h=(0,r.default)(d,2),c=h[0];e-h[1]>=n&&t.delete(c)}}catch(e){a=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}}},{key:"removeTimeoutByKey",value:function(e,t,n,i){var a=!0,o=!1,u=void 0;try{for(var l,d=(0,s.default)(t);!(a=(l=d.next()).done);a=!0){var h=l.value,c=(0,r.default)(h,2),f=c[0];e-c[1][f]>=i&&t.delete(f)}}catch(e){o=!0,u=e}finally{try{!a&&d.return&&d.return()}finally{if(o)throw u}}}},{key:"getLsFlag",value:function(t,n){var s=0,r=e.getLsFlagCache(),a="p_"+t;return r.hasOwnProperty(a)&&(s=+(Number(r[a])===Number(n)),delete r[a],localStorage.setItem("_lsFlag",(0,i.default)(r))),s}},{key:"setLsFlag",value:function(t,n){var s=e.getLsFlagCache();s["p_"+t]=n,localStorage.setItem("_lsFlag",(0,i.default)(s))}},{key:"getLsFlagCache",value:function(){var e={};if(localStorage.hasOwnProperty("_lsFlag")){var t=localStorage.getItem("_lsFlag");try{e=JSON.parse(t)}catch(e){u.default.logger.log("[Utils] getLsFlagCache parse error: "+e.message)}}return e}},{key:"isWupFail",value:function(){if(localStorage.hasOwnProperty("statInfo")){var e=null;try{e=JSON.parse(localStorage.statInfo)}catch(t){e=null}if(e&&e.hasOwnProperty("totalCnt")&&e.hasOwnProperty("failCnt")){var t=Number(e.totalCnt),n=Number(e.failCnt);if(t>=u.default.config.wupFailCnt)return n/t*100>u.default.config.wupFailPer}}return!1}}]),e}();d.IntMax=0x7fffffff,d.IntMin=-0x7fffffff,d.UintMax=0xffffffff,t.default=d},function(e,t){var n=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=n)},function(e,t,n){e.exports={default:n(157),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0;var i=n(73),s=i&&i.__esModule?i:{default:i};t.default=function(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"===(void 0===t?"undefined":(0,s.default)(t))||"function"==typeof t)?t:e}},function(e,t,n){"use strict";t.__esModule=!0;var i=a(n(93)),s=a(n(99)),r=a(n(73));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,r.default)(t)));e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(i.default?(0,i.default)(e,t):e.__proto__=t)}},function(e,t,n){e.exports={default:n(181),__esModule:!0}},function(e,t,n){"use strict";(function(e){var i,s,r=b(n(58)),a=b(n(40)),o=b(n(93)),u=b(n(148)),l=b(n(151)),d=b(n(154)),h=b(n(5)),c=b(n(98)),f=b(n(161)),p=b(n(164)),m=b(n(167)),_=b(n(99)),v=b(n(172)),g=b(n(100)),y=b(n(83)),S=b(n(73));function b(e){return e&&e.__esModule?e:{default:e}}s=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||(0,y.default)(e,t,{enumerable:!0,get:i})},n.r=function(e){void 0!==g.default&&v.default&&(0,y.default)(e,v.default,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t||4&t&&"object"==(void 0===e?"undefined":(0,S.default)(e))&&e&&e.__esModule)return e;var i=(0,_.default)(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,(function(t){return e[t]}).bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=151)}([function(e,t,n){t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}},function(e,t,n){t.__esModule=!0;var i,s=(i=n(152))&&i.__esModule?i:{default:i};t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,s.default)(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),s=r(n(1));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this,e),this.hasHeader=t,this.segments=[],this.data=null,this.totalLen=0,this.uri=0,this.hasHeader&&(this.pushUInt32(10),this.pushUInt32(this.uri),this.pushUInt16(200))}return(0,s.default)(e,[{key:"marshall",value:function(){if(0===this.segments.length)return null;this.data=new Uint8Array(this.totalLen);for(var e=0,t=0;t<this.segments.length;++t){var n=this.segments[t];this.data.set(n,e),e+=n.length}return this.hasHeader&&(this.replaceUInt32(0,this.totalLen),this.replaceUInt32(4,this.uri)),this.data}},{key:"setUri",value:function(e){this.uri=e}},{key:"replaceUInt32",value:function(e,t){new DataView(this.data.buffer).setUint32(e,t,!0)}},{key:"pushBool",value:function(e){this.pushUInt8(+!!e)}},{key:"pushUInt8",value:function(e){var t=new Uint8Array(1);new DataView(t.buffer).setUint8(0,e),this.segments.push(t),this.totalLen++}},{key:"pushUInt16",value:function(e){var t=new Uint8Array(2);new DataView(t.buffer).setUint16(0,e,!0),this.segments.push(t),this.totalLen+=2}},{key:"pushUInt32",value:function(e){var t=new Uint8Array(4);new DataView(t.buffer).setUint32(0,e,!0),this.segments.push(t),this.totalLen+=4}},{key:"pushUInt64",value:function(e){var t=new Uint8Array(8),n=new DataView(t.buffer);n.setUint32(0,e%0x100000000,!0),n.setUint32(4,e/0x100000000|0,!0),this.segments.push(t),this.totalLen+=8}},{key:"pushUint8Array",value:function(e){this.pushUInt16(e.length),this.segments.push(e),this.totalLen+=e.length}},{key:"pushUint8ArrayWithoutLen",value:function(e){this.segments.push(e),this.totalLen+=e.length}},{key:"pushUint8Array32",value:function(e){this.pushUInt32(e.length),this.segments.push(e),this.totalLen+=e.length}},{key:"pushUInt32Vector",value:function(e){this.pushUInt32(e.length);for(var t=0;t<e.length;t++)this.pushUInt32(e[t])}},{key:"pushUInt64Vector",value:function(e){this.pushUInt32(e.length);for(var t=0;t<e.length;t++)this.pushUInt64(e[t])}},{key:"pushUInt16Vector",value:function(e){this.pushUInt32(e.length);for(var t=0;t<e.length;t++)this.pushUInt16(e[t])}},{key:"popObjVector",value:function(e){for(var t=this.popUInt32(),n=[],i=0;i<t;i++){var s=new e;n.push(s.unmarshall(this))}return n}},{key:"pushString",value:function(e){this.pushUInt16(e.length);for(var t=new Uint8Array(e.length),n=new DataView(t.buffer),i=0;i<e.length;++i)n.setUint8(i,e.charCodeAt(i));this.segments.push(t),this.totalLen+=e.length}},{key:"pushString32",value:function(e){this.pushUInt32(e.length);for(var t=new Uint8Array(e.length),n=new DataView(t.buffer),i=0;i<e.length;++i)n.setUint8(i,e.charCodeAt(i));this.segments.push(t),this.totalLen+=e.length}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),(i=n(32))&&i.__esModule;var i,s={PAudienceGetProxyListReq:530178,PAudienceGetProxyListRsp:530434,PNotifyStreamSwitch:268034,PP2pVideoPing3:2671874,VIDEOP2P_PFlashP2PKeepAlive:3072514,VIDEOP2P_PFlashP2PKeepAliveRes:3072770,P2PGetNodesProxy3:2673410,P2PGetNodesProxyRes3:2673666,P2PSubscribeStream3:2673922,P2PRemoveSubscribe3:2674178,P2PKeepAlive:3074562,P2PKeepAliveRes:3074818,P2PNotifyNodeLeave:3075074,P2PSyncDepth:3075330,PP2PWSForward:2757378,PP2PWSForwardReject:5653506,P2PSubStream:3073026,P2PSubStreamRes:3073282,P2PSyncSubTree:3073538,P2PTest:3073794,P2PRemoveSub:3074306,P2PRemoveSubRes:3075586,P2PStreamAlive:3076354,P2POffer:0xbbee02,P2PAnswer:0xbbef02,P2PCandidate:0xbbf002,P2POfferReject:0xbbf102,P2PRequestOffer:0xbbf202,P2PVersionFailed:0xbbf302,P2PPingOverProxy:0xbbf402,P2PPunchBackReq:0xbbf502,P2PPunchBackRsp:0xbbf602,P2PAsk:0xbbf702,P2PAskRes:0xbbf802,P2PPeerRangeReq:0xbbf902,P2PPeerRangeRsp:0xbbfa02,P2PPeerRangeData:0xbbfb02,P2PPeerRangeAsk:0xbbfc02,P2PPeerRangeAskRsp:0xbbfd02,P2PSwapSubHole:0xbbfe02,P2PSeqLost:0xbbff02,PCDNNotifyUrl:0x13c7b02,PCDNStatusReport:0x13c7c02,PCDNGetUrl:0x13c7d02,PCDNSwitchUrl:0x13c7e02,PCdnP2PWSForward:53283,PCdnP2PWSForwardReject:53539,PCdnProxyPing:26147,PCdnProxyPingRes:26403,PCdnP2PStatics:26659,PCdnP2PErrStatics:26915,PCdnP2pGetNode:51235,PCdnP2pGetNodeRes:51491,PCdnP2PNodePingThroughProxy:52259,PCdnP2PNodePunchThroughProxy:52515,PCdnP2PUserRegister:52771,PCdnP2PUserRegisterRes:53027,PCdnP2pReportLog:54051,PCdnP2pGetNodeReq3:55331,PCdnP2pGetNodeRes3:55587,PCdnForceConnectVideoProxy:54563,PCDNGetProxyListReq:153635,PCDNGetProxyListRsp:153891,PCDNGetSliceStreamInfoReq:154147,PCDNGetSliceStreamInfoRsp:154403,PCDNSubscribeReq:768547,PCDNSubscribeRes:768803,PCDNCompeteSubscribeReq:769059,PCDNCompeteSubscribeRes:769315,PCDNForceSubscribeNotify:769571,PCdnP2pUserUnRegister:770083,PP2pSliceData:511779,PP2pSliceAudioData:512035,PP2pSliceVideoData:512291,PP2pSliceCommonData:514083,PP2pSliceSignalData:514595,PP2pSliceAudioDataV2:517411,PP2pSliceAudioDataV3:517667,PP2pSliceControlData:1024547,PForceConnectCdnVideoProxy3:2711042};!function e(){if(!e.done){e.done=!0;var t=[];for(var n in s){var i=s[n];t.push({uri:i,name:n})}t.forEach(function(e){s[e.uri]=e.name})}}(),t.default=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(56)),a=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.streamName="",this.codecType=0,this.cdnBrand=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new a.default(!1);return e.pushString(this.streamName),e.pushUInt16(this.codecType),e.pushUInt16(this.cdnBrand),e.marshall()}},{key:"unmarshall",value:function(e){return this.streamName=e.popString(),this.codecType=e.popUInt16(),this.cdnBrand=e.popUInt16(),this}},{key:"getDefCodecRate",value:function(){return this.codecType>=r.default.VIDEO_264_START&&this.codecType<=r.default.VIDEO_H264_END?100*(this.codecType-r.default.VIDEO_264_START):this.codecType>=r.default.VIDEO_265_START&&this.codecType<=r.default.VIDEO_H265_END?100*(this.codecType-r.default.VIDEO_265_START):128}},{key:"text",value:function(){return this.streamName+"_"+this.codecType+"_"+this.cdnBrand}},{key:"equal",value:function(e){return!!e&&this.streamName==e.streamName&&this.codecType==e.codecType&&this.cdnBrand==e.cdnBrand}},{key:"isValidID",get:function(){return this.codecType>0}},{key:"isH264",get:function(){return this.codecType>=r.default.VIDEO_264_START&&this.codecType<=r.default.VIDEO_H264_END}},{key:"isH265",get:function(){return this.codecType>=r.default.VIDEO_265_START&&this.codecType<=r.default.VIDEO_H265_END}}]),e}()},function(e,t){var n=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=n)},function(e,t,n){var i=n(49)("wks"),s=n(37),r=n(10).Symbol,a="function"==typeof r;(e.exports=function(e){return i[e]||(i[e]=a&&r[e]||(a?r:s)("Symbol."+e))}).store=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default={logger:null,Timer:null,TafLink:null,HUYA:null,userInfo:null,config:null,Browser:null,TimeUtil:null,init:function(e){this.logger=e.logger,this.Timer=e.Timer,this.TafLink=e.TafLink,this.HUYA=e.HUYA,this.userInfo=e.userInfo,this.config=e.config,this.Browser=e.Browser,this.TimeUtil=e.TimeUtil},getCfgValNum:function(e,t){return this.config&&this.config.hasOwnProperty(e)?Number(this.config[e]):t}}},function(e,t,n){var i=n(10),s=n(5),r=n(18),a=n(14),o=n(19),u=function e(t,n,u){var l,d,h,c=t&e.F,f=t&e.G,p=t&e.S,m=t&e.P,_=t&e.B,v=t&e.W,g=f?s:s[n]||(s[n]={}),y=g.prototype,S=f?i:p?i[n]:(i[n]||{}).prototype;for(l in f&&(u=n),u)(d=!c&&S&&void 0!==S[l])&&o(g,l)||(h=d?S[l]:u[l],g[l]=f&&"function"!=typeof S[l]?u[l]:_&&d?r(h,i):v&&S[l]==h?function(e){var t=function(t,n,i){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,i)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(h):m&&"function"==typeof h?r(Function.call,h):h,m&&((g.virtual||(g.virtual={}))[l]=h,t&e.R&&y&&!y[l]&&a(y,l,h)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t,n){var i=n(15),s=n(87),r=n(42),a=y.default;t.f=n(11)?y.default:function(e,t,n){if(i(e),t=r(t,!0),i(n),s)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){e.exports=!n(23)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){e.exports=function(e){return"object"==(void 0===e?"undefined":(0,S.default)(e))?null!==e:"function"==typeof e}},function(e,t,n){e.exports={default:n(155),__esModule:!0}},function(e,t,n){var i=n(9),s=n(26);e.exports=n(11)?function(e,t,n){return i.f(e,t,s(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var i=n(12);e.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){e.exports={default:n(182),__esModule:!0}},function(e,t,n){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=(void 0===n?"undefined":(0,S.default)(n)))throw TypeError(n+"must be non-object");for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var s={arraySet:function(e,t,n,i,s){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),s);else for(var r=0;r<i;r++)e[s+r]=t[n+r]},flattenChunks:function(e){var t,n,i,s,r,a;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),s=0,t=0,n=e.length;t<n;t++)r=e[t],a.set(r,s),s+=r.length;return a}},r={arraySet:function(e,t,n,i,s){for(var r=0;r<i;r++)e[s+r]=t[n+r]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,s)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,r))},t.setTyped(i)},function(e,t,n){var i=n(86);e.exports=function(e,t,n){if(i(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,s){return e.call(t,n,i,s)}}return function(){return e.apply(t,arguments)}}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var i=n(92),s=n(44);e.exports=function(e){return i(s(e))}},function(e,t,n){t.__esModule=!0;var i,s=(i=n(104))&&i.__esModule?i:{default:i};t.default=function(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"===(void 0===t?"undefined":(0,s.default)(t))||"function"==typeof t)?t:e}},function(e,t,n){t.__esModule=!0;var i=a(n(196)),s=a(n(200)),r=a(n(104));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,r.default)(t)));e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(i.default?(0,i.default)(e,t):e.__proto__=t)}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports={}},function(e,t,n){e.exports={default:n(179),__esModule:!0}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var i=n(156)(!0);n(45)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=i(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){var i=n(44);e.exports=function(e){return Object(i(e))}},function(e,t,n){t.__esModule=!0;var i=r(n(16)),s=r(n(193));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function e(t,n,r){null===t&&(t=Function.prototype);var a=(0,s.default)(t,n);if(void 0===a){var o=(0,i.default)(t);return null===o?void 0:e(o,n,r)}if("value"in a)return a.value;var u=a.get;return void 0!==u?u.call(r):void 0}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(0)),s=a(n(1)),r=a(n(7));function a(e){return e&&e.__esModule?e:{default:e}}var o=0,u=function(){function e(t){(0,i.default)(this,e),this.linkHandler=t,this.url=null,this.connected=!1,this.bytesLoaded=0,this.type="",this._id=o++}return(0,s.default)(e,[{key:"isWs",value:function(){return this.type===e.TYPE_WS}},{key:"destroy",value:function(){r.default.logger.log("ProtoLinkBase("+this._id+").destroy"),this.linkHandler=null,this.reset()}},{key:"reset",value:function(){this.url=null,this.connected=!1,this.bytesLoaded=0}},{key:"connect",value:function(e){r.default.logger.log("ProtoLinkBase("+this._id+").connect"),this.reset(),this.url=e}},{key:"onopen",value:function(){this.connected=!0,this.linkHandler&&this.linkHandler.onopen()}},{key:"onerror",value:function(e,t){this.connected=!1,this.linkHandler&&this.linkHandler.onerror(e,t)}},{key:"onclose",value:function(e){this.connected=!1,this.linkHandler&&this.linkHandler.onclose(e)}}]),e}();u.TYPE_WS="ws",u.TYPE_FETCH="fetch",u.TYPE_XHR="xhr",u.TYPE_XHRFF="xhrff",u.TYPE_WEBRTC="webrtc",t.default=u},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=h(n(16)),s=h(n(0)),r=h(n(1)),a=h(n(21)),o=h(n(22)),u=h(n(107)),l=h(n(3)),d=h(n(33));function h(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e){(0,s.default)(this,t);var n=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return n.logger=e,n.printProtocol=!!Number(localStorage._printProtocol),n}return(0,o.default)(t,e),(0,r.default)(t,[{key:"onData",value:function(e,t){var n=this.unmarshall(e,t);n&&this.trigger(e,n)}},{key:"unmarshall",value:function(e,t){var i=new d.default(t),s=l.default[e];if(!s||!s)return null;var r=i,a=null,o=n(108)("./"+s);if(!o||!o.default)return this.logger.warn("%c[x] Unmatched protocol "+(e>>8)+" "+s,"color:red;background:#FFF0F0"),null;if(a=o.default){if(void 0===(r=new a).unmarshall)return this.logger.error("[x]"+s+".unmarshall undefined!"),null;r.unmarshall(i)}return this.printProtocol&&!f[s]&&this.logger.debug("%c<<<<< "+s,"color:#0000E3;font-weight:900",r),r}}]),t}(u.default),f={PCdnProxyPing:1,PCdnProxyPingRes:1,PP2pSliceAudioData:1,PP2pSliceVideoData:1,PP2pSliceControlData:1,PCdnP2pGetNode:1,PCdnP2pGetNodeRes:1,P2POffer:1,P2PAnswer:1,P2PCandidate:1,P2POfferReject:1,P2PRequestOffer:1,PCdnP2PWSForward:1,PCdnP2PWSForwardReject:1,PCdnP2pReportLog:1,PCDNSubscribeReq:1,PCDNSubscribeRes:1,PCDNCompeteSubscribeReq:1,PCDNCompeteSubscribeRes:1,P2PPunchBackReq:1,P2PPunchBackRsp:1};t.default=c},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.streamSeqSN=0,this.streamIndex=0,this.seqStart=0,this.seqOffsets=[],this.from=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default(!0);return e.setUri(a.default.P2PSeqLost),e.pushUInt64(this.streamSeqSN),e.pushUInt8(this.streamIndex),e.pushUInt64(this.seqStart),e.pushUInt16Vector(this.seqOffsets),e.pushUInt8(this.from),e.marshall()}},{key:"unmarshall",value:function(e){this.streamSeqSN=e.popUInt64(),this.streamIndex=e.popUInt8(),this.seqStart=e.popUInt64(),this.seqOffsets=e.popUInt16Vector(),this.from=e.popUInt8()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(13)),s=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,s.default)(this,e),this.view=t,this.pos=0,this.len=0,this.uri=0,this.resCode=0,!0===n&&(this.len=this.popUInt32(),this.uri=this.popUInt32(),this.resCode=this.popUInt16())}return(0,r.default)(e,[{key:"bytesAvailable",value:function(){return this.view.byteLength-this.pos}},{key:"popBool",value:function(){return 1==this.popUInt8()}},{key:"popUInt8",value:function(){if(this.pos+1>this.view.byteLength)return 0;var e=this.view.getUint8(this.pos);return this.pos++,e}},{key:"popUInt16",value:function(){if(this.pos+2>this.view.byteLength)return 0;var e=this.view.getUint16(this.pos,!0);return this.pos+=2,e}},{key:"popUInt32",value:function(){if(this.pos+4>this.view.byteLength)return 0;var e=this.view.getUint32(this.pos,!0);return this.pos+=4,e}},{key:"popUInt64",value:function(){if(this.pos+8>this.view.byteLength)return 0;var e=this.view.getUint32(this.pos,!0);this.pos+=4;var t=this.view.getUint32(this.pos,!0);return this.pos+=4,0x100000000*t+e}},{key:"popUint8Array",value:function(){var e=this.popUInt16();if(this.pos+e>this.view.byteLength)return null;var t=new Uint8Array(this.view.buffer,this.pos,e);return this.pos+=e,t.slice()}},{key:"popUint8Array32",value:function(){var e=this.popUInt32();if(this.pos+e>this.view.byteLength)return null;var t=new Uint8Array(this.view.buffer,this.pos,e);return this.pos+=e,t.slice()}},{key:"popUInt64Vector",value:function(){var e=this.popUInt32();if(this.pos+8*e>this.view.byteLength)return null;for(var t=[],n=0;n<e;n++)t.push(this.popUInt64());return t}},{key:"popUInt32Vector",value:function(){var e=this.popUInt32();if(this.pos+4*e>this.view.byteLength)return null;for(var t=[],n=0;n<e;n++)t.push(this.popUInt32());return t}},{key:"popUInt16Vector",value:function(){var e=this.popUInt32();if(this.pos+2*e>this.view.byteLength)return null;for(var t=[],n=0;n<e;n++)t.push(this.popUInt16());return t}},{key:"popString",value:function(){var e=this.popUInt16();if(this.pos+e>this.view.byteLength)return null;for(var t=[],n=0;n<e;++n)t[n]=String.fromCharCode(this.popUInt8());return t.join("")}},{key:"popMapKey8Val32",value:function(){for(var e=this.popUInt32(),t=new i.default,n=0;n<e;n++){var s=this.popUInt8(),r=this.popUInt32();t.set(s,r)}return t}}]),e}()},function(e,t){e.exports=!0},function(e,t,n){var i=n(15),s=n(158),r=n(50),a=n(48)("IE_PROTO"),o=function(){},u=function(){var e,t=n(88)("iframe"),i=r.length;for(t.style.display="none",n(161).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;i--;)delete u.prototype[r[i]];return u()};e.exports=_.default||function(e,t){var n;return null!==e?(o.prototype=i(e),n=new o,o.prototype=null,n[a]=e):n=u(),void 0===t?n:s(n,t)}},function(e,t,n){var i=n(43),s=Math.min;e.exports=function(e){return e>0?s(i(e),0x1fffffffffffff):0}},function(e,t){var n=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},function(e,t,n){var i=n(9).f,s=n(19),r=n(6)("toStringTag");e.exports=function(e,t,n){e&&!s(e=n?e:e.prototype,r)&&i(e,r,{configurable:!0,value:t})}},function(e,t,n){n(162);for(var i=n(10),s=n(14),r=n(24),a=n(6)("toStringTag"),o="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<o.length;u++){var l=o[u],d=i[l],h=d&&d.prototype;h&&!h[a]&&s(h,a,l),r[l]=r.Array}},function(e,t,n){var i=n(18),s=n(97),r=n(98),a=n(15),o=n(36),u=n(51),l={},d={};(t=e.exports=function(e,t,n,h,c){var f,p,m,_,v=c?function(){return e}:u(e),g=i(n,h,t?2:1),y=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(r(v)){for(f=o(e.length);f>y;y++)if((_=t?g(a(p=e[y])[0],p[1]):g(e[y]))===l||_===d)return _}else for(m=v.call(e);!(p=m.next()).done;)if((_=s(m,g,p.value,t))===l||_===d)return _}).BREAK=l,t.RETURN=d},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(0)),s=a(n(1)),r=a(n(2));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.streamSeqSN=0,this.streamDelays=[],this.maxRecvSeqs=[],this.upBw=0,this.subMinBw=0,this.subNum=0,this.remainUplinkNum=0,this.cdnpip=0,this.maxSeqNumFromCdn=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default(!1);return e.pushUInt64(this.streamSeqSN),e.pushUInt16Vector(this.streamDelays),e.pushUInt64Vector(this.maxRecvSeqs),e.pushUInt32(this.upBw),e.pushUInt32(this.subMinBw),e.pushUInt16(this.subNum),e.pushUInt16(this.remainUplinkNum),e.pushUInt32(this.cdnpip),e.pushUInt32(this.maxSeqNumFromCdn),e.marshall()}},{key:"unmarshall",value:function(e){this.streamSeqSN=e.popUInt64(),this.streamDelays=e.popUInt16Vector(),this.maxRecvSeqs=e.popUInt64Vector(),this.upBw=e.popUInt32(),this.subMinBw=e.popUInt32(),this.subNum=e.popUInt16(),this.remainUplinkNum=e.popUInt16(),this.cdnpip=e.popUInt32(),this.maxSeqNumFromCdn=e.popUInt32()}}]),e}()},function(e,t,n){var i=n(12);e.exports=function(e,t){var n,s;if(!i(e))return e;if(t&&"function"==typeof(n=e.toString)&&!i(s=n.call(e))||"function"==typeof(n=e.valueOf)&&!i(s=n.call(e))||!t&&"function"==typeof(n=e.toString)&&!i(s=n.call(e)))return s;throw TypeError("Can't convert object to primitive value")}},function(e,t){var n=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e*=1)?0:(e>0?i:n)(e)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var i=n(34),s=n(8),r=n(90),a=n(14),o=n(24),u=n(157),l=n(38),d=n(93),h=n(6)("iterator"),c=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,n,p,m,_,v){u(n,t,p);var g,y,S,b=function(e){if(!c&&e in w)return w[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},P=t+" Iterator",k="values"==m,I=!1,w=e.prototype,T=w[h]||w["@@iterator"]||m&&w[m],C=T||b(m),x=m?k?b("entries"):C:void 0,R="Array"==t&&w.entries||T;if(R&&(S=d(R.call(new e)))!==Object.prototype&&S.next&&(l(S,P,!0),i||"function"==typeof S[h]||a(S,h,f)),k&&T&&"values"!==T.name&&(I=!0,C=function(){return T.call(this)}),(!i||v)&&(c||I||!w[h])&&a(w,h,C),o[t]=C,o[P]=f,m)if(g={values:k?C:b("values"),keys:_?C:b("keys"),entries:x},v)for(y in g)y in w||r(w,y,g[y]);else s(s.P+s.F*(c||I),t,g);return g}},function(e,t,n){var i=n(91),s=n(50);e.exports=m.default||function(e){return i(e,s)}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var i=n(49)("keys"),s=n(37);e.exports=function(e){return i[e]||(i[e]=s(e))}},function(e,t,n){var i=n(5),s=n(10),r=s["__core-js_shared__"]||(s["__core-js_shared__"]={});(e.exports=function(e,t){return r[e]||(r[e]=void 0!==t?t:{})})("versions",[]).push({version:i.version,mode:n(34)?"pure":"global",copyright:"\xa9 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var i=n(52),s=n(6)("iterator"),r=n(24);e.exports=n(5).getIteratorMethod=function(e){if(null!=e)return e[s]||e["@@iterator"]||r[i(e)]}},function(e,t,n){var i=n(47),s=n(6)("toStringTag"),r="Arguments"==i(function(){return arguments}());e.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),s))?n:r?i(t):"Object"==(a=i(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t,n){var i=n(37)("meta"),s=n(12),r=n(19),a=n(9).f,o=0,u=p.default||function(){return!0},l=!n(23)(function(){return u((0,f.default)({}))}),d=function(e){a(e,i,{value:{i:"O"+ ++o,w:{}}})},h=e.exports={KEY:i,NEED:!1,fastKey:function(e,t){if(!s(e))return"symbol"==(void 0===e?"undefined":(0,S.default)(e))?e:("string"==typeof e?"S":"P")+e;if(!r(e,i)){if(!u(e))return"F";if(!t)return"E";d(e)}return e[i].i},getWeak:function(e,t){if(!r(e,i)){if(!u(e))return!0;if(!t)return!1;d(e)}return e[i].w},onFreeze:function(e){return l&&h.NEED&&u(e)&&!r(e,i)&&d(e),e}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=d(n(25)),s=d(n(13)),r=d(n(0)),a=d(n(1)),o=d(n(3)),u=d(n(2)),l=d(n(55));function d(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,r.default)(this,e),this.uid=0,this.version=0,this.cdnGroupIdList=[],this.currentInfo=new l.default,this.appid=0,this.clientAppid=0,this.clientType=0,this.ip=0,this.sendTime=0,this.sdkVersion=0,this.imsi=0,this.appId=0,this.anchorStreamNam2UId=new s.default}return(0,a.default)(e,[{key:"marshall",value:function(){var e=new u.default;e.setUri(o.default.PCDNGetProxyListReq),e.pushUInt64(this.uid),e.pushUInt8(this.version),e.pushUInt32(this.cdnGroupIdList.length),this.cdnGroupIdList.forEach(function(t){e.pushUint8ArrayWithoutLen(t.marshall())}),e.pushUint8ArrayWithoutLen(this.currentInfo.marshall()),e.pushUInt8(this.appid),e.pushUInt32(this.clientAppid),e.pushUInt32(this.clientType),e.pushUInt32(this.ip),e.pushUInt32(this.sendTime),e.pushUInt32(this.sdkVersion),e.pushUInt64(this.imsi),e.pushUInt32(this.appId),e.pushUInt32(this.anchorStreamNam2UId.size);var t=!0,n=!1,s=void 0;try{for(var r,a=(0,i.default)(this.anchorStreamNam2UId.keys());!(t=(r=a.next()).done);t=!0){var l=r.value;e.pushString(l),e.pushUInt64(this.anchorStreamNam2UId.get(l))}}catch(e){n=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw s}}return e.marshall()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=l(n(13)),s=l(n(0)),r=l(n(1)),a=l(n(2)),o=l(n(4)),u=l(n(57));function l(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,s.default)(this,e),this.currentProxyInfos=new i.default}return(0,r.default)(e,[{key:"marshall",value:function(){var e=new a.default(!1);return e.pushUInt32(this.currentProxyInfos.size),this.currentProxyInfos.forEach(function(t,n){e.pushUint8ArrayWithoutLen(n.marshall()),e.pushUInt32(t.length),t.forEach(function(t){e.pushUint8ArrayWithoutLen(t.marshall())})}),e.marshall()}},{key:"unmarshall",value:function(e){this.currentProxyInfos.clear();for(var t=e.popUInt32(),n=0;n<t;n++){var i=new o.default;i.unmarshall(e);for(var s=[],r=e.popUInt32(),a=0;a<r;a++){var l=new u.default;s.push(l.unmarshall(e))}this.currentProxyInfos.set(i,s)}return this}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default={STREAM_UNKNOWN:0,AUDIO_SPEEX:0,AUDIO_AACPLUS:1,AUDIO_SILK:2,AUDIO_AAC_44100HZ_STEREO_128KBPS:35,AUDIO_AAC_44100HZ_STEREO_160KBPS:36,AUDIO_AAC_44100HZ_STEREO_192KBPS:37,AUDIO_ELD_AAC_44100HZ_STEREO:38,AUDIO_ELD_AAC_SBR_44100HZ_STEREO:39,SIGNAL_STREAM_DATA:47,SIGNAL_STREAM_COMPRESS_DATA:48,AUDIO_MP3:50,AUDIO_NELLYMOSER:54,VIDEO_264_START:401,VIDEO_H264_100K:401,VIDEO_H264_500K:405,VIDEO_H264_800K:408,VIDEO_H264_1200K:412,VIDEO_H264_1500K:415,VIDEO_H264_2000K:420,VIDEO_H264_3000K:430,VIDEO_H264_4000K:440,VIDEO_H264_6000K:460,VIDEO_H264_8000K:480,VIDEO_H264_END:480,VIDEO_265_START:503,VIDEO_H265_300K:503,VIDEO_H265_500K:505,VIDEO_H265_800K:508,VIDEO_H265_1200K:512,VIDEO_H265_1500K:515,VIDEO_H265_2000K:520,VIDEO_H265_3000K:530,VIDEO_H265_4000K:540,VIDEO_H265_6000K:560,VIDEO_H265_8000K:580,VIDEO_H265_END:580,VIDEO_H264_EX_BASE:1e3,VIDEO_H264_EX_START:1005,VIDEO_H264_EX_500K:1005,VIDEO_H264_EX_1M:1010,VIDEO_H264_EX_5M:1050,VIDEO_H264_EX_8M:1080,VIDEO_H264_EX_10M:1100,VIDEO_H264_EX_12M:1120,VIDEO_H264_EX_15M:1150,VIDEO_H264_EX_20M:1200,VIDEO_H264_EX_END:1200,VIDEO_H265_EX_BASE:4e3,VIDEO_H265_EX_START:4005,VIDEO_H265_EX_500K:4005,VIDEO_H265_EX_1M:4010,VIDEO_H265_EX_5M:4050,VIDEO_H265_EX_8M:4080,VIDEO_H265_EX_10M:4100,VIDEO_H265_EX_12M:4120,VIDEO_H265_EX_15M:4150,VIDEO_H265_EX_20M:4200,VIDEO_H265_EX_END:4200}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(13)),s=o(n(0)),r=o(n(1)),a=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,s.default)(this,e),this.ip=0,this.tcpPorts=[],this.udpPorts=[],this.videoProxyInfo=new i.default}return(0,r.default)(e,[{key:"marshall",value:function(){var e=new a.default(!1);return"number"==typeof this.ip?e.pushUInt32(this.ip):e.pushUInt32(this.ip2uint(this.ip)),e.pushUInt16Vector(this.tcpPorts),e.pushUInt16Vector(this.udpPorts),e.pushUInt32(this.videoProxyInfo.size),this.videoProxyInfo.forEach(function(t,n){e.pushUInt8(n),e.pushUInt32(t)}),e.marshall()}},{key:"unmarshall",value:function(e){this.ip=this.uint2ip(e.popUInt32()),this.tcpPorts=e.popUInt16Vector(),this.udpPorts=e.popUInt16Vector(),this.videoProxyInfo.clear();for(var t=e.popUInt32(),n=0;n<t;n++){var i=e.popUInt8(),s=e.popUInt32();this.videoProxyInfo.set(i,s)}return this}},{key:"ip2uint",value:function(e){for(var t=0,n=e.split("."),i=0;i<n.length;i++)t|=Number(n[i])<<8*i;return t<0&&(t+=0x100000000),t}},{key:"uint2ip",value:function(e){return(255&e)+"."+(e>>8&255)+"."+(e>>16&255)+"."+(e>>24&255)}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default={isWapPlatForm:function(e){return 1==localStorage._testUa||"wap"===e},smoothVal:function(e,t){return Math.floor(e=0===e?t:(7*e+t)/8)},ip2uint:function(e){for(var t=0,n=e.split("."),i=0;i<n.length;i++)t|=Number(n[i])<<8*i;return t<0&&(t+=0x100000000),t},inet_ntoa:function(e){var t,n,i,s=new DataView(new Uint8Array(4).buffer);return s.setUint32(0,e),t=s.getUint8(0),n=s.getUint8(1),i=s.getUint8(2),s.getUint8(3)+"."+i+"."+n+"."+t},isOpen:function(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=this.getCfgValue(e,t,n);return -1===s?i:100*Math.random()<s},getCfgValue:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;t+="|",n="line"+n+":";for(var s=(e+="").split(","),r="",a="",o=s.length,u=0;u<o;u++){var l=s[u];-1!==l.indexOf(t)?r=l.replace(t,""):-1!==l.indexOf("all|")&&(a=l.replace("all|",""))}var d=i,h=i;return""!==r&&(d=this.getLineValue(r,n,i)),""!==a&&(h=this.getLineValue(a,n,i)),d!==i?d:h!==i?h:i},getLineValue:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,i=e.split("_"),s=i.length,r=n,a=n,o=0;o<s;o++){var u=i[o];-1!==u.indexOf("all")?r=this.getValue(u,n):-1!==u.indexOf(t)&&(a=this.getValue(u,n))}return a!==n?a:r!==n?r:n},getValue:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=t,i=e.split(":");return i.length>1&&isNaN(n=parseInt(i[1]))&&(n=t),n}}},function(e,t,n){t.f=n(6)},function(e,t,n){var i=n(10),s=n(5),r=n(34),a=n(59),o=n(9).f;e.exports=function(e){var t=s.Symbol||(s.Symbol=r?{}:i.Symbol||{});"_"==e.charAt(0)||e in t||o(t,e,{value:a.f(e)})}},function(e,t){t.f=({}).propertyIsEnumerable},function(e,t,n){var i=n(61),s=n(26),r=n(20),a=n(42),o=n(19),u=n(87),l=c.default;t.f=n(11)?l:function(e,t){if(e=r(e),t=a(t,!0),u)try{return l(e,t)}catch(e){}if(o(e,t))return s(!i.f.call(e,t),e[t])}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=l(n(13)),s=l(n(0)),r=l(n(1)),a=l(n(3)),o=l(n(2)),u=l(n(4));function l(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,s.default)(this,e),this.appid=0,this.uid=0,this.sid=0,this.stampc=0,this.loginStamp=0,this.uplinkBw=0,this.availPeers=0,this.bPunched=!1,this.cdnLineType=0,this.mapClientProp=new i.default,this.cdnGroupId=new u.default,this.clientNetTypeAndNatType=0,this.isUsingFullSubStream=0}return(0,r.default)(e,[{key:"marshall",value:function(){var e=new o.default;return e.setUri(a.default.PCdnProxyPing),e.pushUInt32(this.appid),e.pushUInt64(this.uid),e.pushUInt64(this.sid),e.pushUInt32(this.stampc),e.pushUInt32(this.loginStamp),e.pushUInt32(this.uplinkBw),e.pushUInt16(this.availPeers),e.pushBool(this.bPunched),e.pushUInt8(this.cdnLineType),e.pushUInt32(this.mapClientProp.size),this.mapClientProp.forEach(function(t,n){e.pushUInt8(n),e.pushUInt32(t)}),e.pushUint8ArrayWithoutLen(this.cdnGroupId.marshall()),e.pushUInt8(this.clientNetTypeAndNatType),e.pushUInt8(this.isUsingFullSubStream),e.marshall()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(3)),a=u(n(2)),o=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.cdnGroupId=new o.default,this.uid=0,this.clientType=0,this.tcpId=0,this.localIps=[],this.localPort=0,this.token="",this.tokenVersion=0,this.version="",this.cdnLineType=0,this.fixedCdnStreamCount=0,this.sourceCodecRate=0,this.clearSubscribeInfo=0,this.maxCdnStreamCount=0,this.p2pVersion=0,this.appid=0,this.clientNetTypeAndNatType=0,this.localIpv6=[],this.localPortv6=0,this.desc="",this.clientUA="",this.nodeType=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new a.default;return e.setUri(r.default.PCdnP2PUserRegister),e.pushUint8ArrayWithoutLen(this.cdnGroupId.marshall()),e.pushUInt64(this.uid),e.pushUInt32(this.clientType),e.pushUInt8(this.tcpId),e.pushUInt32Vector(this.localIps),e.pushUInt16(this.localPort),e.pushString(this.token),e.pushUInt32(this.tokenVersion),e.pushString(this.version),e.pushUInt8(this.cdnLineType),e.pushUInt8(this.fixedCdnStreamCount),e.pushUInt32(this.sourceCodecRate),e.pushUInt8(this.clearSubscribeInfo),e.pushUInt8(this.maxCdnStreamCount),e.pushUInt16(this.p2pVersion),e.pushUInt32(this.appid),e.pushUInt8(this.clientNetTypeAndNatType),e.pushUInt32(this.localIpv6.length),this.localIpv6.forEach(function(t){e.pushUint8ArrayWithoutLen(t.marshall())}),e.pushUInt16(this.localPortv6),e.pushString(this.desc),e.pushString(this.clientUA),e.pushUInt32(this.nodeType),e.marshall()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(3)),a=u(n(2)),o=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.cdnGroupId=new o.default,this.uid=0,this.clientType=0,this.tcpId=0,this.cdnLineType=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new a.default;return e.setUri(r.default.PCdnP2pUserUnRegister),e.pushUint8ArrayWithoutLen(this.cdnGroupId.marshall()),e.pushUInt64(this.uid),e.pushUInt8(this.clientType),e.pushUInt8(this.tcpId),e.pushUInt8(this.cdnLineType),e.marshall()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.streamSeqSN=0,this.uid=0,this.streamIndex=0,this.mode=0,this.per=0,this.askId=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default(!0);return e.setUri(a.default.P2PPeerRangeAskRsp),e.pushUInt64(this.streamSeqSN),e.pushUInt64(this.uid),e.pushUInt8(this.streamIndex),e.pushUInt8(this.mode),e.pushUInt8(this.per),e.pushUInt64(this.askId),e.marshall()}},{key:"unmarshall",value:function(e){this.streamSeqSN=e.popUInt64(),this.uid=e.popUInt64(),this.streamIndex=e.popUInt8(),this.mode=e.popUInt8(),this.per=e.popUInt8(),this.askId=e.popUInt64()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.streamSeqSN=0,this.uid=0,this.streamIndex=0,this.mode=0,this.rangeSeqStart=0,this.rangeSeqOffsets=[]}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default(!0);e.setUri(a.default.P2PPeerRangeReq),e.pushUInt64(this.streamSeqSN),e.pushUInt64(this.uid),e.pushUInt8(this.streamIndex),e.pushUInt8(this.mode),e.pushUInt64(this.rangeSeqStart),e.pushUInt16(this.rangeSeqOffsets.length);for(var t=0;t<this.rangeSeqOffsets.length;++t)e.pushUInt8(this.rangeSeqOffsets[t]);return e.marshall()}},{key:"unmarshall",value:function(e){this.streamSeqSN=e.popUInt64(),this.uid=e.popUInt64(),this.streamIndex=e.popUInt8(),this.mode=e.popUInt8(),this.rangeSeqStart=e.popUInt64();for(var t=e.popUInt16(),n=0;n<t;++n)this.rangeSeqOffsets.push(e.popUInt8())}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.streamSeqSN=0,this.uid=0,this.streamIndex=0,this.mode=0,this.noSeqStart=0,this.noSeqOffsets=[]}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default(!0);e.setUri(a.default.P2PPeerRangeRsp),e.pushUInt64(this.streamSeqSN),e.pushUInt64(this.uid),e.pushUInt8(this.streamIndex),e.pushUInt8(this.mode),e.pushUInt64(this.noSeqStart),e.pushUInt16(this.noSeqOffsets.length);for(var t=0;t<this.noSeqOffsets.length;++t)e.pushUInt8(this.noSeqOffsets[t]);return e.marshall()}},{key:"unmarshall",value:function(e){this.streamSeqSN=e.popUInt64(),this.uid=e.popUInt64(),this.streamIndex=e.popUInt8(),this.mode=e.popUInt8(),this.noSeqStart=e.popUInt64();for(var t=e.popUInt16(),n=0;n<t;++n)this.noSeqOffsets.push(e.popUInt8())}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}o(n(4)),t.default=function(){function e(){(0,i.default)(this,e),this.streamSeqSN=0,this.uid=0,this.streamIndex=0,this.reason=0,this.cdnRtt=0,this.nodeRtt=0,this.streamDelay=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default;return e.setUri(a.default.P2PRemoveSub),e.pushUInt64(this.streamSeqSN),e.pushUInt64(this.uid),e.pushUInt8(this.streamIndex),e.pushUInt8(this.reason),e.pushUInt32(this.cdnRtt),e.pushUInt32(this.nodeRtt),e.pushUInt32(this.streamDelay),e.marshall()}},{key:"unmarshall",value:function(e){this.streamSeqSN=e.popUInt64(),this.uid=e.popUInt64(),this.streamIndex=e.popUInt8(),this.reason=e.popUInt8(),this.cdnRtt=e.popUInt32(),this.nodeRtt=e.popUInt32(),this.streamDelay=e.popUInt32()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}o(n(4)),t.default=function(){function e(){(0,i.default)(this,e),this.uid=0,this.streamSeqSN=0,this.streamIndex=0,this.cdnRtt=0,this.nodeRtt=0,this.streamDelay=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default;return e.setUri(a.default.P2PRemoveSubRes),e.pushUInt64(this.uid),e.pushUInt64(this.streamSeqSN),e.pushUInt8(this.streamIndex),e.pushUInt32(this.cdnRtt),e.pushUInt32(this.nodeRtt),e.pushUInt32(this.streamDelay),e.marshall()}},{key:"unmarshall",value:function(e){this.uid=e.popUInt64(),this.streamSeqSN=e.popUInt64(),this.streamIndex=e.popUInt8(),this.cdnRtt=e.popUInt32(),this.nodeRtt=e.popUInt32(),this.streamDelay=e.popUInt32()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.uri=0,this.uid=0,this.streamSeqSN=0,this.streamIndex=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default;return e.setUri(a.default.P2PStreamAlive),e.pushUInt64(this.uid),e.pushUInt64(this.streamSeqSN),e.pushUInt8(this.streamIndex),e.marshall()}},{key:"unmarshall",value:function(e){this.uid=e.popUInt64(),this.streamSeqSN=e.popUInt64(),this.streamIndex=e.popUInt8()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.uid=0,this.streamSeqSN=0,this.baseSubs=0,this.streamIndex=0,this.maxRecvSeq=0,this.uplinkBw=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default;return e.setUri(a.default.P2PSubStream),e.pushUInt64(this.uid),e.pushUInt64(this.streamSeqSN),e.pushUInt8(this.baseSubs),e.pushUInt8(this.streamIndex),e.pushUInt64(this.maxRecvSeq),e.pushUInt32(this.uplinkBw),e.marshall()}},{key:"unmarshall",value:function(e){this.uid=e.popUInt64(),this.streamSeqSN=e.popUInt64(),this.baseSubs=e.popUInt8(),this.streamIndex=e.popUInt8(),this.maxRecvSeq=e.popUInt64(),this.uplinkBw=e.popUInt32()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.uid=0,this.streamSeqSN=0,this.streamIndex=0,this.streamDelay=0,this.maxRecvSeq=0,this.subMinBw=0,this.ret=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default;return e.setUri(a.default.P2PSubStreamRes),e.pushUInt64(this.uid),e.pushUInt64(this.streamSeqSN),e.pushUInt8(this.streamIndex),e.pushUInt16(this.streamDelay),e.pushUInt64(this.maxRecvSeq),e.pushUInt32(this.subMinBw),e.pushUInt8(this.ret),e.marshall()}},{key:"unmarshall",value:function(e){this.uid=e.popUInt64(),this.streamSeqSN=e.popUInt64(),this.streamIndex=e.popUInt8(),this.streamDelay=e.popUInt16(),this.maxRecvSeq=e.popUInt64(),this.subMinBw=e.popUInt32(),this.ret=e.popUInt8()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.streamSeqSN=0,this.uid=0,this.streamIndex=0,this.lostSeqStart=0,this.lostSeqOffsets=[]}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default(!0);return e.setUri(a.default.P2PSwapSubHole),e.pushUInt64(this.streamSeqSN),e.pushUInt64(this.uid),e.pushUInt8(this.streamIndex),e.pushUInt64(this.lostSeqStart),e.pushUInt16Vector(this.lostSeqOffsets),e.marshall()}},{key:"unmarshall",value:function(e){this.streamSeqSN=e.popUInt64(),this.uid=e.popUInt64(),this.streamIndex=e.popUInt8(),this.lostSeqStart=e.popUInt64(),this.lostSeqOffsets=e.popUInt16Vector()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(3)),a=u(n(2)),o=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.cdnGroupId=new o.default,this.version="",this.subscriber=0,this.subStreamIndex=[],this.uplinkBw=0,this.appid=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new a.default;return e.setUri(r.default.PCDNCompeteSubscribeReq),e.pushUint8ArrayWithoutLen(this.cdnGroupId.marshall()),e.pushString(this.version),e.pushUInt64(this.subscriber),e.pushUint8Array32(this.subStreamIndex),e.pushUInt32(this.uplinkBw),e.pushUInt32(this.appid),e.marshall()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(3)),a=u(n(2)),o=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.cdnGroupId=new o.default,this.subscriber=0,this.subStreamIndex=[]}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new a.default;return e.setUri(r.default.PCDNForceSubscribeNotify),e.pushUint8ArrayWithoutLen(this.cdnGroupId.marshall()),e.pushUInt64(this.subscriber),e.pushUint8Array32(this.subStreamIndex),e.marshall()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(3)),a=u(n(2)),o=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.cdnGroupId=new o.default,this.publisher=0,this.subscriber=0,this.streamIndex=0,this.streamNum=0,this.version="",this.appid=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new a.default;return e.setUri(r.default.PCDNSubscribeReq),e.pushUint8ArrayWithoutLen(this.cdnGroupId.marshall()),e.pushUInt64(this.publisher),e.pushUInt64(this.subscriber),e.pushUInt8(this.streamIndex),e.pushUInt8(this.streamNum),e.pushString(this.version),e.pushUInt32(this.appid),e.marshall()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(0)),s=a(n(1)),r=a(n(2));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.uid=0,this.wanip=0,this.wanport=0,this.lanips=[],this.lanport=0,this.availPeers=0,this.bPunched=!1,this.uplinkBw=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default(!1);return e.pushUInt64(this.uid),e.pushUInt32(this.wanip),e.pushUInt16(this.wanport),e.pushUInt32Vector(this.lanips),e.pushUInt16(this.lanport),e.pushUInt16(this.availPeers),e.pushBool(this.bPunched),e.pushUInt32(this.uplinkBw),e.marshall()}},{key:"unmarshall",value:function(e){this.uid=e.popUInt64(),this.wanip=e.popUInt32(),this.wanport=e.popUInt16(),this.lanips=e.popUInt32Vector(),this.lanport=e.popUInt16(),this.availPeers=e.popUInt16(),this.bPunched=e.popBool(),this.uplinkBw=e.popUInt32()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(0)),s=a(n(1)),r=a(n(80));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.len=0,this.version=0,this.uid=0,this.peerNetType=0,this.wanip=new r.default,this.wanport=0,this.wanipv6=new r.default,this.wanportv6=0,this.lanips=[],this.lanport=0,this.lanportv6=0,this.availPeers=0,this.bPunched=0,this.uplinkBw=0,this.desc="",this.nodeType=0}return(0,s.default)(e,[{key:"unmarshall",value:function(e){this.len=e.popUInt16(),this.version=e.popUInt8(),this.uid=e.popUInt64(),this.peerNetType=e.popUInt8(),this.wanip.unmarshall(e),this.wanport=e.popUInt16(),this.wanipv6.unmarshall(e),this.wanportv6=e.popUInt16();for(var t=e.popUInt32(),n=0;n<t;n++){var i=new r.default;i.unmarshall(e),this.lanips.push(i)}this.lanport=e.popUInt16(),this.lanportv6=e.popUInt16(),this.availPeers=e.popUInt16(),this.bPunched=e.popBool(),this.uplinkBw=e.popUInt32(),this.version>=2&&(this.desc=e.popString()),this.version>=3&&(this.nodeType=e.popUInt32())}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(0)),s=a(n(1)),r=a(n(2));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.addrType=0,this.addr=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.ip=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default(!1);return e.pushUInt8(this.addrType),e.pushUint8ArrayWithoutLen(this.addr),e.marshall()}},{key:"unmarshall",value:function(e){this.addrType=e.popUInt8(),1===this.addrType?this.ip=e.popUInt32():2==this.addrType&&(e.popUInt32(),e.popUInt32(),e.popUInt32(),e.popUInt32())}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(3)),a=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.seq=0,this.uri=0,this.from=0,this.uid=0,this.streamSeqSN=0,this.payload=null}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new a.default;return e.setUri(r.default.PP2pSliceData),e.pushUInt64(this.seq),e.pushUInt32(this.uri),e.pushUInt8(this.from),e.pushUInt64(this.uid),e.pushUInt64(this.streamSeqSN),e.pushUint8Array(this.payload),e.marshall()}},{key:"unmarshall",value:function(e){return this.seq=e.popUInt64(),this.uri=e.popUInt32(),this.from=e.popUInt8(),this.uid=e.popUInt64(),this.streamSeqSN=e.popUInt64(),this.payload=e.popUint8Array(),this}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(0)),s=a(n(1)),r=a(n(81));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,i.default)(this,e),this.loader=t,this.u8arr=new Uint8Array(0)}return(0,s.default)(e,[{key:"destroy",value:function(){this.loader=null,this.u8arr=null}},{key:"reset",value:function(){this.u8arr=new Uint8Array(0)}},{key:"onData",value:function(e,t,n){var i=this.u8arr,s=new Uint8Array(e);0===i.length?this.u8arr=s:(this.u8arr=new Uint8Array(i.length+s.length),this.u8arr.set(i,0),this.u8arr.set(s,i.length));var r=this.onProto(this.u8arr,t,n);r>0&&(this.u8arr=this.u8arr.slice(r))}},{key:"onProto",value:function(e,t,n){for(var i=new DataView(e.buffer),s=0,a=0,o=void 0,u=void 0,l=void 0,d=void 0,h=void 0;s+10<e.byteLength;){if((a=i.getUint16(s+8,!0))<10)return this.loader.onProtoErr(a),s;if(s+a>e.byteLength)break;l=i.getUint32(s,!0),d=0x100000000*i.getUint32(s+4,!0)+l,h=i.getUint32(s+14,!0),u=e.slice(s+10,s+a),(o=new r.default).seq=d,o.uri=h,o.payload=u,o.prop=n,this.loader.onSlice(o),s+=a}return s}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=h(n(16)),s=h(n(0)),r=h(n(1)),a=h(n(21)),o=h(n(22)),u=h(n(31)),l=h(n(3)),d=h(n(208));function h(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e){(0,s.default)(this,t);var n=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return n._lastDropSeq=0,n}return(0,o.default)(t,e),(0,r.default)(t,[{key:"onSlice",value:function(e){var t=new DataView(e.payload.buffer),n=this.unmarshall(e.uri,t);if(n){if(n.seq=e.seq,localStorage.hasOwnProperty("_dropSlice")){var i=Number(localStorage._dropSlice);if(!isNaN(i)&&i>0&&e.seq>this._lastDropSeq&&e.seq%100<i)return this._lastDropSeq=e.seq,void(1==localStorage._printDropSlice&&this.logger.log("SliceProtoHandler.onSlice dropSlice seq="+e.seq+" frameId="+n.frameId))}11===e.from&&1==localStorage._printPeerRange&&this.logger.log("SliceProtoHandler.onSlice isFrom="+e.from+" seq="+e.seq),this.trigger(l.default.PP2pSliceData,new d.default(e,n))}}}]),t}(u.default)},function(e,t,n){e.exports={default:n(210),__esModule:!0}},function(e,t,n){e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){e.exports=!n(11)&&!n(23)(function(){return 7!=Object.defineProperty(n(88)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var i=n(12),s=n(10).document,r=i(s)&&i(s.createElement);e.exports=function(e){return r?s.createElement(e):{}}},function(e,t){},function(e,t,n){e.exports=n(14)},function(e,t,n){var i=n(19),s=n(20),r=n(159)(!1),a=n(48)("IE_PROTO");e.exports=function(e,t){var n,o=s(e),u=0,l=[];for(n in o)n!=a&&i(o,n)&&l.push(n);for(;t.length>u;)i(o,n=t[u++])&&(~r(l,n)||l.push(n));return l}},function(e,t,n){var i=n(47);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==i(e)?e.split(""):Object(e)}},function(e,t,n){var i=n(19),s=n(28),r=n(48)("IE_PROTO"),a=Object.prototype;e.exports=h.default||function(e){return i(e=s(e),r)?e[r]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){var i=n(14);e.exports=function(e,t,n){for(var s in t)n&&e[s]?e[s]=t[s]:i(e,s,t[s]);return e}},function(e,t){e.exports=function(e,t,n,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var i=n(15);e.exports=function(e,t,n,s){try{return s?t(i(n)[0],n[1]):t(n)}catch(t){var r=e.return;throw void 0!==r&&i(r.call(e)),t}}},function(e,t,n){var i=n(24),s=n(6)("iterator"),r=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||r[s]===e)}},function(e,t,n){var i=n(12);e.exports=function(e,t){if(!i(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,n){var i=n(47);e.exports=Array.isArray||function(e){return"Array"==i(e)}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default={XY:"xy",PPIO:"ppio",QN:"qn",TX:"tx",XD:"xd"}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=h(n(16)),s=h(n(0)),r=h(n(1)),a=h(n(21)),o=h(n(29)),u=h(n(22)),l=h(n(30)),d=h(n(7));function h(e){return e&&e.__esModule?e:{default:e}}var c=0;t.default=function(e){function t(e){(0,s.default)(this,t);var n=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return n.type=l.default.TYPE_WS,n.ws=null,n.wsId=0,n}return(0,u.default)(t,e),(0,r.default)(t,[{key:"reset",value:function(){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"reset",this).call(this),this.destroyWs()}},{key:"destroyWs",value:function(){this.ws&&(d.default.logger.log("ProtoLinkWs.destroyWs wsId="+this.wsId+" id="+this._id),this.ws.onopen=null,this.ws.onerror=null,this.ws.onmessage=null,this.ws.onclose=null,this.ws.close(),this.ws=null)}},{key:"connect",value:function(e){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"connect",this).call(this,e),this.destroyWs(),this.wsId=c++,this.ws=new WebSocket(e),this.ws.binaryType="arraybuffer",this.ws.onopen=this.onopen.bind(this),this.ws.onerror=this.onerror.bind(this),this.ws.onclose=this.onclose.bind(this),this.ws.onmessage=this.onmessage.bind(this),d.default.logger.log("ProtoLinkWs.connect wsId="+this.wsId+" id="+this._id)}},{key:"send",value:function(e){this.ws&&this.connected&&this.ws.send(e)}},{key:"onmessage",value:function(e){this.bytesLoaded+=e.data.byteLength,this.linkHandler&&this.linkHandler.onData(e.data,e)}},{key:"onclose",value:function(e){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onclose",this).call(this,e)}}]),t}(l.default)},function(e,t,n){var i=n(8),s=n(5),r=n(23);e.exports=function(e,t){var n=(s.Object||{})[e]||Object[e],a={};a[e]=t(n),i(i.S+i.F*r(function(){n(1)}),"Object",a)}},function(e,t,n){t.__esModule=!0;var i=a(n(184)),s=a(n(186)),r="function"==typeof s.default&&"symbol"==(0,S.default)(i.default)?function(e){return void 0===e?"undefined":(0,S.default)(e)}:function(e){return e&&"function"==typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":void 0===e?"undefined":(0,S.default)(e)};function a(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof s.default&&"symbol"===r(i.default)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":void 0===e?"undefined":r(e)}},function(e,t){t.f=d.default},function(e,t,n){var i=n(91),s=n(50).concat("length","prototype");t.f=l.default||function(e){return i(e,s)}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),s=r(n(1));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.listeners={}}return(0,s.default)(e,[{key:"clear",value:function(){this.listeners={}}},{key:"has",value:function(e,t,n){var i=this.listeners[e];if(!i)return!1;for(var s=0,r=i.length;s<r;s++){var a=i[s];if(a.callback==t&&a.thisObj==n)return!0}return!1}},{key:"on",value:function(e,t,n,i){if(!this.has(e,t,n)){var s=this.listeners[e]||[];s.push({priority:i||0,callback:t,thisObj:n,bindCallback:n?t.bind(n):t}),s.sort(function(e,t){return t.priority-e.priority}),this.listeners[e]=s}}},{key:"off",value:function(e,t,n){var i=this.listeners[e];if(i)for(var s=i.length-1;s>=0;s--){var r=i[s];if(r.callback==t&&r.thisObj==n)return void i.splice(s,1)}}},{key:"trigger",value:function(e,t){var n=this.listeners[e];n&&n.forEach(function(e){(0,e.bindCallback)(t)})}}]),e}()},function(e,t,n){var i={"./CdnGroupID":4,"./CdnGroupID.js":4,"./CurrentCdnProxyInfo":55,"./CurrentCdnProxyInfo.js":55,"./P2PAnswer":109,"./P2PAnswer.js":109,"./P2PAsk":110,"./P2PAsk.js":110,"./P2PAskRes":111,"./P2PAskRes.js":111,"./P2PCandidate":112,"./P2PCandidate.js":112,"./P2PKeepAlive":113,"./P2PKeepAlive.js":113,"./P2PKeepAliveRes":114,"./P2PKeepAliveRes.js":114,"./P2PKeepAliveStream":41,"./P2PKeepAliveStream.js":41,"./P2PNotifyNodeLeave":115,"./P2PNotifyNodeLeave.js":115,"./P2POffer":116,"./P2POffer.js":116,"./P2POfferReject":117,"./P2POfferReject.js":117,"./P2PPeerRangeAsk":118,"./P2PPeerRangeAsk.js":118,"./P2PPeerRangeAskRsp":66,"./P2PPeerRangeAskRsp.js":66,"./P2PPeerRangeReq":67,"./P2PPeerRangeReq.js":67,"./P2PPeerRangeRsp":68,"./P2PPeerRangeRsp.js":68,"./P2PPunchBackReq":119,"./P2PPunchBackReq.js":119,"./P2PPunchBackRsp":120,"./P2PPunchBackRsp.js":120,"./P2PRemoveSub":69,"./P2PRemoveSub.js":69,"./P2PRemoveSubRes":70,"./P2PRemoveSubRes.js":70,"./P2PRequestOffer":121,"./P2PRequestOffer.js":121,"./P2PSeqLost":32,"./P2PSeqLost.js":32,"./P2PStreamAlive":71,"./P2PStreamAlive.js":71,"./P2PSubStream":72,"./P2PSubStream.js":72,"./P2PSubStreamRes":73,"./P2PSubStreamRes.js":73,"./P2PSwapSubHole":74,"./P2PSwapSubHole.js":74,"./PCDNCompeteSubscribeReq":75,"./PCDNCompeteSubscribeReq.js":75,"./PCDNCompeteSubscribeRes":122,"./PCDNCompeteSubscribeRes.js":122,"./PCDNForceSubscribeNotify":76,"./PCDNForceSubscribeNotify.js":76,"./PCDNGetProxyListReq":54,"./PCDNGetProxyListReq.js":54,"./PCDNSubscribeReq":77,"./PCDNSubscribeReq.js":77,"./PCDNSubscribeRes":123,"./PCDNSubscribeRes.js":123,"./PCdnP2PUserRegister":64,"./PCdnP2PUserRegister.js":64,"./PCdnP2PUserRegisterRes":124,"./PCdnP2PUserRegisterRes.js":124,"./PCdnP2PWSForward":125,"./PCdnP2PWSForward.js":125,"./PCdnP2PWSForwardReject":126,"./PCdnP2PWSForwardReject.js":126,"./PCdnP2pGetNode":127,"./PCdnP2pGetNode.js":127,"./PCdnP2pGetNodeReq3":128,"./PCdnP2pGetNodeReq3.js":128,"./PCdnP2pGetNodeRes":129,"./PCdnP2pGetNodeRes.js":129,"./PCdnP2pGetNodeRes3":130,"./PCdnP2pGetNodeRes3.js":130,"./PCdnP2pUserUnRegister":65,"./PCdnP2pUserUnRegister.js":65,"./PCdnProxyPing":63,"./PCdnProxyPing.js":63,"./PCdnProxyPingRes":131,"./PCdnProxyPingRes.js":131,"./PP2pSliceAudioData":132,"./PP2pSliceAudioData.js":132,"./PP2pSliceAudioDataV2":133,"./PP2pSliceAudioDataV2.js":133,"./PP2pSliceAudioDataV3":134,"./PP2pSliceAudioDataV3.js":134,"./PP2pSliceCommonData":135,"./PP2pSliceCommonData.js":135,"./PP2pSliceControlData":136,"./PP2pSliceControlData.js":136,"./PP2pSliceData":81,"./PP2pSliceData.js":81,"./PP2pSliceSignalData":137,"./PP2pSliceSignalData.js":137,"./PP2pSliceVideoData":138,"./PP2pSliceVideoData.js":138,"./ProxyPeerIP":80,"./ProxyPeerIP.js":80,"./ProxyPeerInfo2":78,"./ProxyPeerInfo2.js":78,"./ProxyPeerInfo4":79,"./ProxyPeerInfo4.js":79,"./SlaveProxyInfo":57,"./SlaveProxyInfo.js":57,"./StreamCodecType":56,"./StreamCodecType.js":56,"./base/ProtoHandler":31,"./base/ProtoHandler.js":31,"./base/ProtoMarshall":2,"./base/ProtoMarshall.js":2,"./base/ProtoUnmarshall":33,"./base/ProtoUnmarshall.js":33,"./base/ProtoUri":3,"./base/ProtoUri.js":3,"./base/SliceHandler":82,"./base/SliceHandler.js":82,"./base/SliceProtoHandler":83,"./base/SliceProtoHandler.js":83};function s(e){return n(r(e))}function r(e){if(!n.o(i,e)){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}s.keys=function(){return(0,m.default)(i)},s.resolve=r,e.exports=s,s.id=108},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(2)),a=u(n(3)),o=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.cdnGroupId=new o.default,this.lineType=0,this.fromUid=0,this.toUid=0,this.sdp="",this.sdpType=""}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default;return e.setUri(a.default.P2PAnswer),e.pushUint8ArrayWithoutLen(this.cdnGroupId.marshall()),e.pushUInt8(this.lineType),e.pushUInt64(this.fromUid),e.pushUInt64(this.toUid),e.pushString(this.sdp),e.pushString(this.sdpType),e.marshall()}},{key:"unmarshall",value:function(e){this.cdnGroupId.unmarshall(e),this.lineType=e.popUInt8(),this.fromUid=e.popUInt64(),this.toUid=e.popUInt64(),this.sdp=e.popString(),this.sdpType=e.popString()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.fromUid=0,this.version=0,this.askType=0,this.nodeType=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default(!0);return e.setUri(a.default.P2PAsk),e.pushUInt64(this.fromUid),e.pushUInt32(this.version),e.pushUInt8(this.askType),e.pushUInt32(this.nodeType),e.marshall()}},{key:"unmarshall",value:function(e){this.fromUid=e.popUInt64(),this.version=e.popUInt32(),this.askType=e.popUInt8(),this.nodeType=e.popUInt32()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.fromUid=0,this.nodeType=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default(!0);return e.setUri(a.default.P2PAskRes),e.pushUInt64(this.fromUid),e.pushUInt32(this.nodeType),e.marshall()}},{key:"unmarshall",value:function(e){this.fromUid=e.popUInt64(),this.nodeType=e.popUInt32()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(2)),a=u(n(3)),o=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.cdnGroupId=new o.default,this.lineType=0,this.fromUid=0,this.toUid=0,this.sdpMLineIndex=0,this.sdpMid="",this.candidate=""}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default;return e.setUri(a.default.P2PCandidate),e.pushUint8ArrayWithoutLen(this.cdnGroupId.marshall()),e.pushUInt8(this.lineType),e.pushUInt64(this.fromUid),e.pushUInt64(this.toUid),e.pushUInt32(this.sdpMLineIndex),e.pushString(this.sdpMid),e.pushString(this.candidate),e.marshall()}},{key:"unmarshall",value:function(e){this.cdnGroupId.unmarshall(e),this.lineType=e.popUInt8(),this.fromUid=e.popUInt64(),this.toUid=e.popUInt64(),this.sdpMLineIndex=e.popUInt32(),this.sdpMid=e.popString(),this.candidate=e.popString()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=d(n(25)),s=d(n(13)),r=d(n(0)),a=d(n(1)),o=d(n(2)),u=d(n(3)),l=d(n(41));function d(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,r.default)(this,e),this.fromUid=0,this.curSid=0,this.timeStampc=0,this.sendCnt=0,this.streamMap=new s.default,this.netState=0}return(0,a.default)(e,[{key:"marshall",value:function(){var e=new o.default;e.setUri(u.default.P2PKeepAlive),e.pushUInt64(this.fromUid),e.pushUInt64(this.curSid),e.pushUInt32(this.timeStampc),e.pushUInt32(this.sendCnt),e.pushUInt32(this.streamMap.size);var t=!0,n=!1,s=void 0;try{for(var r,a=(0,i.default)(this.streamMap.values());!(t=(r=a.next()).done);t=!0){var l=r.value;e.pushUint8ArrayWithoutLen(l.marshall())}}catch(e){n=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw s}}return e.pushUInt32(this.netState),e.marshall()}},{key:"unmarshall",value:function(e){this.fromUid=e.popUInt64(),this.curSid=e.popUInt64(),this.timeStampc=e.popUInt32(),this.sendCnt=e.popUInt32(),this.streamMap.clear();for(var t=e.popUInt32(),n=0;n<t;n++){var i=new l.default;i.unmarshall(e),this.streamMap.set(i.streamSeqSN,i)}this.netState=e.popUInt32()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=d(n(25)),s=d(n(13)),r=d(n(0)),a=d(n(1)),o=d(n(2)),u=d(n(3)),l=d(n(41));function d(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,r.default)(this,e),this.fromUid=0,this.curSid=0,this.timeStampc=0,this.sendCnt=0,this.recvCnt=0,this.streamMap=new s.default,this.netState=0}return(0,a.default)(e,[{key:"marshall",value:function(){var e=new o.default;e.setUri(u.default.P2PKeepAliveRes),e.pushUInt64(this.fromUid),e.pushUInt64(this.curSid),e.pushUInt32(this.timeStampc),e.pushUInt32(this.sendCnt),e.pushUInt32(this.recvCnt),e.pushUInt32(this.streamMap.size);var t=!0,n=!1,s=void 0;try{for(var r,a=(0,i.default)(this.streamMap.values());!(t=(r=a.next()).done);t=!0){var l=r.value;e.pushUint8ArrayWithoutLen(l.marshall())}}catch(e){n=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw s}}return e.pushUInt32(this.netState),e.marshall()}},{key:"unmarshall",value:function(e){this.fromUid=e.popUInt64(),this.curSid=e.popUInt64(),this.timeStampc=e.popUInt32(),this.sendCnt=e.popUInt32(),this.recvCnt=e.popUInt32(),this.streamMap.clear();for(var t=e.popUInt32(),n=0;n<t;n++){var i=new l.default;i.unmarshall(e),this.streamMap.set(i.streamSeqSN,i)}this.netState=e.popUInt32()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.uid=0,this.reason=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default;return e.setUri(a.default.P2PNotifyNodeLeave),e.pushUInt64(this.uid),e.pushUInt8(this.reason),e.marshall()}},{key:"unmarshall",value:function(e){this.uid=e.popUInt64(),this.reason=e.popUInt8()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(2)),a=u(n(3)),o=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.cdnGroupId=new o.default,this.lineType=0,this.fromUid=0,this.toUid=0,this.sdp="",this.sdpType="",this.version=0,this.lowestVersion=0,this.nodeType=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default;return e.setUri(a.default.P2POffer),e.pushUint8ArrayWithoutLen(this.cdnGroupId.marshall()),e.pushUInt8(this.lineType),e.pushUInt64(this.fromUid),e.pushUInt64(this.toUid),e.pushString(this.sdp),e.pushString(this.sdpType),e.pushUInt32(this.version),e.pushUInt32(this.lowestVersion),e.pushUInt32(this.nodeType),e.marshall()}},{key:"unmarshall",value:function(e){this.cdnGroupId.unmarshall(e),this.lineType=e.popUInt8(),this.fromUid=e.popUInt64(),this.toUid=e.popUInt64(),this.sdp=e.popString(),this.sdpType=e.popString(),this.version=e.popUInt32(),this.lowestVersion=e.popUInt32(),this.nodeType=e.popUInt32()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(2)),a=u(n(3)),o=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.cdnGroupId=new o.default,this.lineType=0,this.fromUid=0,this.toUid=0,this.rejectReason=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default;return e.setUri(a.default.P2POfferReject),e.pushUint8ArrayWithoutLen(this.cdnGroupId.marshall()),e.pushUInt8(this.lineType),e.pushUInt64(this.fromUid),e.pushUInt64(this.toUid),e.pushUInt32(this.rejectReason),e.marshall()}},{key:"unmarshall",value:function(e){this.cdnGroupId.unmarshall(e),this.lineType=e.popUInt8(),this.fromUid=e.popUInt64(),this.toUid=e.popUInt64(),this.rejectReason=e.popUInt32()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.streamSeqSN=0,this.uid=0,this.streamIndex=0,this.mode=0,this.rangeSeqStart=0,this.rangeSeqOffsets=[],this.askId=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default(!0);e.setUri(a.default.P2PPeerRangeAsk),e.pushUInt64(this.streamSeqSN),e.pushUInt64(this.uid),e.pushUInt8(this.streamIndex),e.pushUInt8(this.mode),e.pushUInt64(this.rangeSeqStart),e.pushUInt16(this.rangeSeqOffsets.length);for(var t=0;t<this.rangeSeqOffsets.length;++t)e.pushUInt8(this.rangeSeqOffsets[t]);return e.pushUInt64(this.askId),e.marshall()}},{key:"unmarshall",value:function(e){this.streamSeqSN=e.popUInt64(),this.uid=e.popUInt64(),this.streamIndex=e.popUInt8(),this.mode=e.popUInt8(),this.rangeSeqStart=e.popUInt64();for(var t=e.popUInt16(),n=0;n<t;++n)this.rangeSeqOffsets.push(e.popUInt8());this.askId=e.popUInt64()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(2)),a=u(n(3)),o=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.cdnGroupId=null,this.fromUid=0,this.lineType=0,this.version=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default;return e.setUri(a.default.P2PPunchBackReq),e.pushUint8ArrayWithoutLen(this.cdnGroupId.marshall()),e.pushUInt64(this.fromUid),e.pushUInt8(this.lineType),e.pushUInt32(this.version),e.marshall()}},{key:"unmarshall",value:function(e){this.cdnGroupId||(this.cdnGroupId=new o.default),this.cdnGroupId.unmarshall(e),this.fromUid=e.popUInt64(),this.lineType=e.popUInt8(),this.version=e.popUInt32()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.fromUid=0,this.ret=0,this.nodeType=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default;return e.setUri(a.default.P2PPunchBackRsp),e.pushUInt64(this.fromUid),e.pushUInt8(this.ret),e.pushUInt32(this.nodeType),e.marshall()}},{key:"unmarshall",value:function(e){this.fromUid=e.popUInt64(),this.ret=e.popUInt8(),this.nodeType=e.popUInt32()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(2)),a=u(n(3)),o=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.cdnGroupId=new o.default,this.lineType=0,this.fromUid=0,this.toUid=0,this.version=0,this.lowestVersion=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default;return e.setUri(a.default.P2PRequestOffer),e.pushUint8ArrayWithoutLen(this.cdnGroupId.marshall()),e.pushUInt8(this.lineType),e.pushUInt64(this.fromUid),e.pushUInt64(this.toUid),e.pushUInt32(this.version),e.pushUInt32(this.lowestVersion),e.marshall()}},{key:"unmarshall",value:function(e){this.cdnGroupId.unmarshall(e),this.lineType=e.popUInt8(),this.fromUid=e.popUInt64(),this.toUid=e.popUInt64(),this.version=e.popUInt32(),this.lowestVersion=e.popUInt32()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(203)),s=o(n(0)),r=o(n(1)),a=o(n(4));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,s.default)(this,e),this.cdnGroupId=new a.default,this.subscriber=0,this.csMinBw=0,this.subStreamIndex=[],this.ret=0,this.remainP2pStreamNum=0,this.SNBw=0,this.appid=0}return(0,r.default)(e,[{key:"unmarshall",value:function(e){this.cdnGroupId.unmarshall(e),this.subscriber=e.popUInt64(),this.csMinBw=e.popUInt32(),this.subStreamIndex=(0,i.default)(e.popUint8Array32()),this.ret=e.popUInt8(),this.remainP2pStreamNum=e.popUInt32(),this.SNBw=e.popUInt32(),this.appid=e.popUInt32()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(0)),s=a(n(1)),r=a(n(4));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.cdnGroupId=new r.default,this.publisher=0,this.subscriber=0,this.streamIndex=0,this.streamNum=0,this.ret=0,this.appid=0}return(0,s.default)(e,[{key:"unmarshall",value:function(e){this.cdnGroupId.unmarshall(e),this.publisher=e.popUInt64(),this.subscriber=e.popUInt64(),this.streamIndex=e.popUInt8(),this.streamNum=e.popUInt8(),this.ret=e.popUInt8(),this.appid=e.popUInt32()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(13)),s=o(n(0)),r=o(n(1)),a=o(n(4));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,s.default)(this,e),this.cdnGroupId=new a.default,this.uid=0,this.ret=0,this.wanIp=0,this.wanPort=0,this.mapDebugStatus=new i.default,this.fixedCdnStream=[],this.maxCdnStreamCount=0,this.enableFeatures=0,this.stunProts=[],this.appid=0,this.maxRetryTimes=0}return(0,r.default)(e,[{key:"unmarshall",value:function(e){return this.cdnGroupId.unmarshall(e),this.uid=e.popUInt64(),this.ret=e.popUInt8(),this.wanIp=e.popUInt32(),this.wanPort=e.popUInt16(),this.mapDebugStatus=e.popMapKey8Val32(),this.fixedCdnStream=e.popUint8Array32(),this.maxCdnStreamCount=e.popUInt8(),this.enableFeatures=e.popUInt32(),this.stunProts=e.popUInt16Vector(),this.appid=e.popUInt32(),this.maxRetryTimes=e.popUInt16(),this}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(3)),a=u(n(2)),o=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.cdnGroupId=new o.default,this.fromUid=0,this.toUid=0,this.subUri=0,this.payload=null,this.appid=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new a.default;return e.setUri(r.default.PCdnP2PWSForward),e.pushUint8ArrayWithoutLen(this.cdnGroupId.marshall()),e.pushUInt64(this.fromUid),e.pushUInt64(this.toUid),e.pushUInt32(this.subUri),e.pushUint8Array(this.payload),e.pushUInt32(this.appid),e.marshall()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(0)),s=a(n(1)),r=a(n(4));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.cdnGroupId=new r.default,this.fromUid=0,this.toUid=0,this.subUri=0,this.resCode=0}return(0,s.default)(e,[{key:"unmarshall",value:function(e){this.cdnGroupId.unmarshall(e),this.fromUid=e.popUInt64(),this.toUid=e.popUInt64(),this.subUri=e.popUInt32(),this.resCode=e.popUInt32()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(3)),a=u(n(2)),o=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.uid=0,this.cdnGroupId=new o.default,this.appid=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new a.default;return e.setUri(r.default.PCdnP2pGetNode),e.pushUInt64(this.uid),e.pushUint8ArrayWithoutLen(this.cdnGroupId.marshall()),e.pushUInt32(this.appid),e.marshall()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(4)),a=u(n(2)),o=u(n(3));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.uid=0,this.cdnGroupId=new r.default,this.appid=0,this.requestPeerNum=0,this.requestMobilePeerNum=0}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new a.default(!0);return e.setUri(o.default.PCdnP2pGetNodeReq3),e.pushUInt64(this.uid),e.pushUint8ArrayWithoutLen(this.cdnGroupId.marshall()),e.pushUInt32(this.appid),e.pushUInt16(this.requestPeerNum),e.pushUInt16(this.requestMobilePeerNum),e.marshall()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(4)),a=o(n(78));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.cdnGroupId=new r.default,this.peerNodes=[],this.appid=0}return(0,s.default)(e,[{key:"unmarshall",value:function(e){this.cdnGroupId.unmarshall(e),this.peerNodes=[];for(var t=e.popUInt32(),n=0;n<t;n++){var i=new a.default;i.unmarshall(e),this.peerNodes.push(i)}return this.appid=e.popUInt32(),this}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(4)),a=o(n(79));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.cdnGroupId=new r.default,this.appid=0,this.peerNodes=[]}return(0,s.default)(e,[{key:"unmarshall",value:function(e){this.cdnGroupId.unmarshall(e),this.appid=e.popUInt32();for(var t=e.popUInt32(),n=0;n<t;n++){var i=new a.default;i.unmarshall(e),this.peerNodes.push(i)}}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(0)),s=a(n(1)),r=a(n(4));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.appid=0,this.stampc=0,this.stamps=0,this.proxyRtt=0,this.wanIp=0,this.wanPort=0,this.peerType=0,this.stampcSvr=0,this.mapDebugStatus=null,this.csMinBw=0,this.remainP2pStreamNum=0,this.SNBw=0,this.cdnGroupId=new r.default,this.isNeedUseFullSubStream=0}return(0,s.default)(e,[{key:"unmarshall",value:function(e){return this.appid=e.popUInt32(),this.stampc=e.popUInt32(),this.stamps=e.popUInt32(),this.proxyRtt=e.popUInt32(),this.wanIp=e.popUInt32(),this.wanPort=e.popUInt16(),this.peerType=e.popUInt8(),this.stampcSvr=e.popUInt32(),this.mapDebugStatus=e.popMapKey8Val32(),this.csMinBw=e.popUInt32(),this.remainP2pStreamNum=e.popUInt32(),this.SNBw=e.popUInt32(),this.cdnGroupId.unmarshall(e),this.isNeedUseFullSubStream=e.popUInt8(),this}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(3)),a=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.seq=0,this.checkSum=0,this.codecType=0,this.streamData=null}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new a.default;return e.setUri(r.default.PP2pSliceAudioData),e.pushUInt8(this.checkSum),e.pushUInt16(this.codecType),e.pushUint8Array(this.streamData),e.marshall()}},{key:"unmarshall",value:function(e){return this.checkSum=e.popUInt8(),this.codecType=e.popUInt16(),this.streamData=e.popUint8Array(),this}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.checkSum=0,this.codecType=0,this.seqNum=0,this.frameNum=0,this.frameId=0,this.audioHeader=null,this.streamData=null}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default;e.setUri(a.default.PP2pSliceAudioDataV2),e.pushUInt8(this.checkSum),e.pushUInt16(this.codecType),e.pushUInt16(this.seqNum),e.pushUInt16(this.frameNum),e.pushUInt32(this.frameId),e.pushUint8Array(this.audioHeader),e.pushUint8Array(this.streamData)}},{key:"unmarshall",value:function(e){this.checkSum=e.popUInt8(),this.codecType=e.popUInt16(),this.seqNum=e.popUInt16(),this.frameNum=e.popUInt16(),this.frameId=e.popUInt32(),this.audioHeader=e.popUint8Array(),this.streamData=e.popUint8Array()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.checkSum=0,this.codecType=0,this.seqNum=0,this.frameNum=0,this.frameId=0,this.audioHeader=null,this.streamData=null}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new r.default;return e.setUri(a.default.PP2pSliceAudioDataV3),e.pushUInt8(this.checkSum),e.pushUInt16(this.codecType),e.pushUInt16(this.seqNum),e.pushUInt16(this.frameNum),e.pushUInt32(this.frameId),e.pushUint8Array(this.audioHeader),e.pushUint8Array(this.streamData),e.marshall()}},{key:"unmarshall",value:function(e){this.checkSum=e.popUInt8(),this.codecType=e.popUInt16(),this.seqNum=e.popUInt16(),this.frameNum=e.popUInt16(),this.frameId=e.popUInt32(),this.audioHeader=e.popUint8Array(),this.streamData=e.popUint8Array()}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(3)),a=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.seq=0,this.srcType=0,this.checkSum=0,this.seqNum=0,this.frameNum=0,this.frameId=0,this.codecType=0,this.streamData=null}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new a.default;return e.setUri(r.default.PP2pSliceCommonData),e.pushUInt8(this.srcType),e.pushUInt8(this.checkSum),e.pushUInt16(this.seqNum),e.pushUInt16(this.frameNum),e.pushUInt32(this.frameId),e.pushUInt16(this.codecType),e.pushUint8Array(this.streamData),e.marshall()}},{key:"unmarshall",value:function(e){return this.srcType=e.popUInt8(),this.checkSum=e.popUInt8(),this.seqNum=e.popUInt16(),this.frameNum=e.popUInt16(),this.frameId=e.popUInt32(),this.codecType=e.popUInt16(),this.streamData=e.popUint8Array(),this}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(3)),a=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.seq=0,this.strData=null}return(0,s.default)(e,[{key:"marshall",value:function(){var e=new a.default;return e.setUri(r.default.PP2pSliceControlData),e.pushUint8Array(this.strData),e.marshall()}},{key:"unmarshall",value:function(e){return this.strData=e.popUint8Array(),this}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),s=r(n(1));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.seq=0,this.srcType=0,this.seqNum=0,this.frameNum=0,this.frameId=0,this.codecType=0,this.streamData=null,this.config=null}return(0,s.default)(e,[{key:"unmarshall",value:function(e){return this.srcType=e.popUInt8(),this.seqNum=e.popUInt16(),this.frameNum=e.popUInt16(),this.frameId=e.popUInt32(),this.codecType=e.popUInt16(),this.streamData=e.popUint8Array(),this.config=e.popMapKey8Val32(),this}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(13)),s=u(n(0)),r=u(n(1)),a=u(n(3)),o=u(n(2));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,s.default)(this,e),this.seq=0,this.checkSum=0,this.seqNum=0,this.frameNum=0,this.frameId=0,this.config=new i.default,this.streamData=null}return(0,r.default)(e,[{key:"marshall",value:function(){var e=new o.default;return e.setUri(a.default.PP2pSliceVideoData),e.pushUInt8(this.checkSum),e.pushUInt16(this.seqNum),e.pushUInt16(this.frameNum),e.pushUInt32(this.frameId),e.pushUInt32(this.config.size),this.config.forEach(function(t,n){e.pushUInt8(n),e.pushUInt32(t)}),e.pushUint8Array(this.streamData),e.marshall()}},{key:"unmarshall",value:function(e){this.checkSum=e.popUInt8(),this.seqNum=e.popUInt16(),this.frameNum=e.popUInt16(),this.frameId=e.popUInt32(),this.config.clear();for(var t=e.popUInt32(),n=0;n<t;n++){var i=e.popUInt8(),s=e.popUInt32();this.config.set(i,s)}return this.streamData=e.popUint8Array(),this}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default={OLD_CLIENT:0,SDK_CLIENT_V2:1,WEB_CLIENT_V2:2,P2P_NODETYPE_MAX:3}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default={INIT:1,TAF_REQ:2,TAF_SUC:3,TAF_COVER:4,TAF_LOAD:5,TAF_GATHER:6,TAF_UNKNOW:7,PULL_START:8,PULL_ERROR:9,PULL_CONNECT_TIMEOUT:10,PULL_DATA_TIMEOUT:11,PULL_SUC:12,PULL_NO_DATA:13,PULL_GATHER:14,TO_CDN:15,PULL_ONCLOSE:16,RESET:17,PULL_SEQ_SLOW:18,TAF_REPEAT_DOMAIN:19,STUN_READY:20}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default={START_OFFER:"start_offer",OFFER_ANSWER:"offer_answer",ANSWER_OPEN:"answer_open",OPEN_SEQ:"open_seq"}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default={NONE:"none",NO_STUN:"no_stun",TIMEOUT:"timeout",PEER_ERR:"wrpecnt",OFFER_ERR:"wroecnt",CONNECT_ERR:"3",RESPONSE_ERR:"wrrecnt",ANWSER_ERR:"wraecnt",CHANNEL_ERR:"wrcecnt",CHANNEL_CLOSE:"wrcccnt",XHR_ERR:"wrxecnt",XHR_404:"wrx4cnt",XHR_TIMEOUT:"wrxtcnt",DATA_SLOW:"data_slow",DATA_TIMEOUT:"data_timeout"}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default={XHR_404:404,XHR_ERR:600,XHR_TIMEOUT:601,RESPONSE_ERR:602,ANWSER_ERR:603,NO_ICE:604,NO_PUB_ICE:605,CHANNEL_ERR:606,OFFER_ERR:607,PEER_ERR:608}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default={CONNECTING:"connecting",OPEN:"open",CLOSING:"closing",CLOSED:"closed"}},function(e,t,n){e.exports=function(e,t,n,i){for(var s=65535&e,r=e>>>16&65535,a=0;0!==n;){n-=a=n>2e3?2e3:n;do r=r+(s=s+t[i++]|0)|0;while(--a);s%=65521,r%=65521}return s|r<<16}},function(e,t,n){var i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?0xedb88320^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,s){var r=s+n;e^=-1;for(var a=s;a<r;a++)e=e>>>8^i[255&(e^t[a])];return -1^e}},function(e,t,n){var i=n(17),s=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(e){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){r=!1}for(var a=new i.Buf8(256),o=0;o<256;o++)a[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;function u(e,t){if(t<65534&&(e.subarray&&r||!e.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}a[254]=a[254]=1,t.string2buf=function(e){var t,n,s,r,a,o=e.length,u=0;for(r=0;r<o;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<o&&56320==(64512&(s=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(s-56320),r++),u+=n<128?1:n<2048?2:n<65536?3:4;for(t=new i.Buf8(u),a=0,r=0;a<u;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<o&&56320==(64512&(s=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(s-56320),r++),n<128?t[a++]=n:(n<2048?t[a++]=192|n>>>6:(n<65536?t[a++]=224|n>>>12:(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63),t[a++]=128|n>>>6&63),t[a++]=128|63&n);return t},t.buf2binstring=function(e){return u(e,e.length)},t.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,s=t.length;n<s;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,i,s,r,o=t||e.length,l=Array(2*o);for(i=0,n=0;n<o;)if((s=e[n++])<128)l[i++]=s;else if((r=a[s])>4)l[i++]=65533,n+=r-1;else{for(s&=2===r?31:3===r?15:7;r>1&&n<o;)s=s<<6|63&e[n++],r--;r>1?l[i++]=65533:s<65536?l[i++]=s:(s-=65536,l[i++]=55296|s>>10&1023,l[i++]=56320|1023&s)}return u(l,i)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+a[e[n]]>t?n:t}},function(e,t,n){e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default={SIGNALLING:0,PING:1,SLICE:2}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=x(n(3)),s=x(n(33)),r=x(n(2)),a=x(n(178)),o=x(n(58)),u=x(n(101)),l=x(n(7)),d=x(n(181)),h=x(n(211)),c=x(n(140)),f=x(n(31)),p=x(n(83)),m=x(n(82)),_=x(n(212)),v=x(n(141)),g=x(n(142)),y=x(n(143)),S=x(n(217)),b=x(n(102)),P=x(n(219)),k=x(n(220)),I=x(n(144)),w=x(n(230)),T=x(n(150)),C=(x(n(107)),x(n(139)));function x(e){return e&&e.__esModule?e:{default:e}}t.default={initPrivate:function(e){l.default.init(e)},ProtoUri:i.default,ProtoMarshall:r.default,ProtoUnmarshall:s.default,ProtoHandler:f.default,SliceProtoHandler:p.default,SliceHandler:m.default,ProtoLinkFetch:_.default,ProtoLinkXhr:S.default,ProtoLinkWs:b.default,ProtoLinkXhrFF:P.default,ProtoLinkWebrtc:k.default,PcdnName:u.default,SubStreamState:c.default,ProtoLinkWebrtcCostType:v.default,ProtoLinkWebrtcFailReasons:g.default,ProtoLinkWebrtcErrorCode:y.default,ChannelState:I.default,DataType:T.default,NodeType:C.default,GetProxyList:a.default,CdnpProxy:d.default,GetPcdnProxyList:h.default,StreamProxy:w.default,requireProto:function(e){return n(108)("./"+e).default},isWapPlatForm:o.default.isWapPlatForm}},function(e,t,n){e.exports={default:n(153),__esModule:!0}},function(e,t,n){n(154);var i=n(5).Object;e.exports=function(e,t,n){return i.defineProperty(e,t,n)}},function(e,t,n){var i=n(8);i(i.S+!n(11)*i.F,"Object",{defineProperty:n(9).f})},function(e,t,n){n(89),n(27),n(39),n(164),n(171),n(174),n(176),e.exports=n(5).Map},function(e,t,n){var i=n(43),s=n(44);e.exports=function(e){return function(t,n){var r,a,o=String(s(t)),u=i(n),l=o.length;return u<0||u>=l?e?"":void 0:(r=o.charCodeAt(u))<55296||r>56319||u+1===l||(a=o.charCodeAt(u+1))<56320||a>57343?e?o.charAt(u):r:e?o.slice(u,u+2):a-56320+(r-55296<<10)+65536}}},function(e,t,n){var i=n(35),s=n(26),r=n(38),a={};n(14)(a,n(6)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=i(a,{next:s(1,n)}),r(e,t+" Iterator")}},function(e,t,n){var i=n(9),s=n(15),r=n(46);e.exports=n(11)?u.default:function(e,t){s(e);for(var n,a=r(t),o=a.length,u=0;o>u;)i.f(e,n=a[u++],t[n]);return e}},function(e,t,n){var i=n(20),s=n(36),r=n(160);e.exports=function(e){return function(t,n,a){var o,u=i(t),l=s(u.length),d=r(a,l);if(e&&n!=n){for(;l>d;)if((o=u[d++])!=o)return!0}else for(;l>d;d++)if((e||d in u)&&u[d]===n)return e||d||0;return!e&&-1}}},function(e,t,n){var i=n(43),s=Math.max,r=Math.min;e.exports=function(e,t){return(e=i(e))<0?s(e+t,0):r(e,t)}},function(e,t,n){var i=n(10).document;e.exports=i&&i.documentElement},function(e,t,n){var i=n(163),s=n(94),r=n(24),a=n(20);e.exports=n(45)(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,s(1)):s(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),r.Arguments=r.Array,i("keys"),i("values"),i("entries")},function(e,t){e.exports=function(){}},function(e,t,n){var i=n(165),s=n(99);e.exports=n(167)("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=i.getEntry(s(this,"Map"),e);return t&&t.v},set:function(e,t){return i.def(s(this,"Map"),0===e?0:e,t)}},i,!0)},function(e,t,n){var i=n(9).f,s=n(35),r=n(95),a=n(18),o=n(96),u=n(40),l=n(45),d=n(94),h=n(166),c=n(11),f=n(53).fastKey,p=n(99),m=c?"_s":"size",_=function(e,t){var n,i=f(t);if("F"!==i)return e._i[i];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,l){var d=e(function(e,i){o(e,d,t,"_i"),e._t=t,e._i=s(null),e._f=void 0,e._l=void 0,e[m]=0,null!=i&&u(i,n,e[l],e)});return r(d.prototype,{clear:function(){for(var e=p(this,t),n=e._i,i=e._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete n[i.i];e._f=e._l=void 0,e[m]=0},delete:function(e){var n=p(this,t),i=_(n,e);if(i){var s=i.n,r=i.p;delete n._i[i.i],i.r=!0,r&&(r.n=s),s&&(s.p=r),n._f==i&&(n._f=s),n._l==i&&(n._l=r),n[m]--}return!!i},forEach:function(e){p(this,t);for(var n,i=a(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(i(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!_(p(this,t),e)}}),c&&i(d.prototype,"size",{get:function(){return p(this,t)[m]}}),d},def:function(e,t,n){var i,s,r=_(e,t);return r?r.v=n:(e._l=r={i:s=f(t,!0),k:t,v:n,p:i=e._l,n:void 0,r:!1},e._f||(e._f=r),i&&(i.n=r),e[m]++,"F"!==s&&(e._i[s]=r)),e},getEntry:_,setStrong:function(e,t,n){l(e,t,function(e,n){this._t=p(e,t),this._k=n,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?d(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,d(1))},n?"entries":"values",!n,!0),h(t)}}},function(e,t,n){var i=n(10),s=n(5),r=n(9),a=n(11),o=n(6)("species");e.exports=function(e){var t="function"==typeof s[e]?s[e]:i[e];a&&t&&!t[o]&&r.f(t,o,{configurable:!0,get:function(){return this}})}},function(e,t,n){var i=n(10),s=n(8),r=n(53),a=n(23),o=n(14),u=n(95),l=n(40),d=n(96),h=n(12),c=n(38),f=n(9).f,p=n(168)(0),m=n(11);e.exports=function(e,t,n,_,v,g){var y=i[e],S=y,b=v?"set":"add",P=S&&S.prototype,k={};return m&&"function"==typeof S&&(g||P.forEach&&!a(function(){(new S).entries().next()}))?(S=t(function(t,n){d(t,S,e,"_c"),t._c=new y,null!=n&&l(n,v,t[b],t)}),p("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in P&&(!g||"clear"!=e)&&o(S.prototype,e,function(n,i){if(d(this,S,e),!t&&g&&!h(n))return"get"==e&&void 0;var s=this._c[e](0===n?0:n,i);return t?this:s})}),g||f(S.prototype,"size",{get:function(){return this._c.size}})):(u((S=_.getConstructor(t,e,v,b)).prototype,n),r.NEED=!0),c(S,e),k[e]=S,s(s.G+s.W+s.F,k),g||_.setStrong(S,e,v),S}},function(e,t,n){var i=n(18),s=n(92),r=n(28),a=n(36),o=n(169);e.exports=function(e,t){var n=1==e,u=2==e,l=3==e,d=4==e,h=6==e,c=5==e||h,f=t||o;return function(t,o,p){for(var m,_,v=r(t),g=s(v),y=i(o,p,3),S=a(g.length),b=0,P=n?f(t,S):u?f(t,0):void 0;S>b;b++)if((c||b in g)&&(_=y(m=g[b],b,v),e)){if(n)P[b]=_;else if(_)switch(e){case 3:return!0;case 5:return m;case 6:return b;case 2:P.push(m)}else if(d)return!1}return h?-1:l||d?d:P}}},function(e,t,n){var i=n(170);e.exports=function(e,t){return new(i(e))(t)}},function(e,t,n){var i=n(12),s=n(100),r=n(6)("species");e.exports=function(e){var t;return s(e)&&("function"==typeof(t=e.constructor)&&(t===Array||s(t.prototype))&&(t=void 0),i(t)&&null===(t=t[r])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){var i=n(8);i(i.P+i.R,"Map",{toJSON:n(172)("Map")})},function(e,t,n){var i=n(52),s=n(173);e.exports=function(e){return function(){if(i(this)!=e)throw TypeError(e+"#toJSON isn't generic");return s(this)}}},function(e,t,n){var i=n(40);e.exports=function(e,t){var n=[];return i(e,!1,n.push,n,t),n}},function(e,t,n){n(175)("Map")},function(e,t,n){var i=n(8);e.exports=function(e){i(i.S,e,{of:function(){for(var e=arguments.length,t=Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,n){n(177)("Map")},function(e,t,n){var i=n(8),s=n(86),r=n(18),a=n(40);e.exports=function(e){i(i.S,e,{from:function(e){var t,n,i,o,u=arguments[1];return s(this),(t=void 0!==u)&&s(u),null==e?new this:(n=[],t?(i=0,o=r(u,arguments[2],2),a(e,!1,function(e){n.push(o(e,i++))})):a(e,!1,n.push,n),new this(n))}})}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(7)),a=o(n(54));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,i.default)(this,e),this.stream=t,this._delayGetProxy=!1,this._retryTimer=0,this._sendTime=0,this.started=!1,this.startTime=0,this.reqVpTime=0,this.getVPTime=0,this._checkTafLink()}return(0,s.default)(e,[{key:"start",value:function(){this.started=!0,this.startTime=r.default.TimeUtil.now(),this.getProxy()}},{key:"stop",value:function(){this.started=!1,this.reqVpTime=0,this.getVPTime=0,this._retryTimer&&clearTimeout(this._retryTimer)}},{key:"_checkTafLink",value:function(){var e=r.default.TafLink;e.connected?this._onConnected():e.inited?e.addListener(e.WEBSOCKET_CONNECTED,this._onConnected.bind(this)):e.on(e.TAFLINK_INITED,this._onConnected.bind(this))}},{key:"_onConnected",value:function(){this._delayGetProxy&&(this._delayGetProxy=!1,this.getProxy())}},{key:"getProxy",value:function(){if(this.stream.sInfo.isCanUseCdnp)if(r.default.TafLink.connected){this._retryTimer&&(clearTimeout(this._retryTimer),this._retryTimer=0);var e=new a.default;e.uid=r.default.userInfo.uuid,e.version=1,e.sdkVersion=1,e.appId=r.default.userInfo.appId,e.appid=r.default.userInfo.appid,e.clientAppid=0,e.clientType=8,e.sendTime=.001*Date.now()|0,e.cdnGroupIdList=[this.stream.sInfo.streamId],this._sendTime=e.sendTime,this.reqVpTime=r.default.TimeUtil.now(),r.default.logger.log("GetProxyList.getProxy",this.stream.id,"reqVpTime",this.reqVpTime),r.default.TafLink.sendYY(e,this._rspProxy.bind(this),r.default.userInfo.uuid,!0,!0)}else this._delayGetProxy=!0}},{key:"_rspProxy",value:function(e){if(this.started&&e.sendTime===this._sendTime){if(this.getVPTime=r.default.TimeUtil.now(),0!==e.result){var t="UNKNOWN ERROR!";if(1===e.result?t="EGetVP_NO_RESOURCE":2===e.result&&(t="EGetVP_FUZZY_NO_MATCH"),r.default.logger.warn("Proxylink",t,e),1===e.retryType)this.stream.onNoVideo();else{var n=this;this._retryTimer=setTimeout(function(){r.default.logger.log("GetProxyList retry getProxy",n.stream.id),n.getProxy()},1e3*e.retryFreq)}}this.stream.sInfo.hasGetVp=1,this.stream.cdnpProxy.connect(e)}}}]),e}()},function(e,t,n){n(39),n(27),e.exports=n(180)},function(e,t,n){var i=n(15),s=n(51);e.exports=n(5).getIterator=function(e){var t=s(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return i(t.call(e))}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=m(n(0)),s=m(n(1)),r=m(n(7)),a=m(n(58)),o=m(n(3)),u=m(n(102)),l=m(n(63)),d=m(n(64)),h=m(n(65)),c=m(n(31)),f=m(n(139)),p=m(n(209));function m(e){return e&&e.__esModule?e:{default:e}}var _=function(){function e(t,n){(0,i.default)(this,e),this.stream=t,this.sInfo=t.sInfo,this.streamId=t.sInfo.streamId,this.bwCalc=t.bwCalc,this.stat=t.stat,this.stat.core.video_login_fail=100,this.BwStat=n,this.vps=null,this.proxys=[],this.delaySendList=[],this.pingCnt=0,this.started=!1,this.lastGetProxyTime=0,this.sslUrl="",this.wsUrl="",this.token="",this.tokenVersion=0,this.stunProxy=new p.default,this.link=new u.default(this),this.printProtocol=!!Number(localStorage._printProtocol),this.pingPkg=new l.default,this.protoHandler=new c.default,this.protoHandler.on(o.default.PCdnProxyPingRes,this.onPingRes,this),this.protoHandler.on(o.default.PCdnP2PUserRegisterRes,this.onLoginRes,this),this.protoHandler.on(o.default.PCdnForceConnectVideoProxy,this.onForceConnectVideoProxy,this)}return(0,s.default)(e,[{key:"onForceConnectVideoProxy",value:function(e){if(e.cdnGroupId.equal(this.streamId)){var t=10+10*Math.floor(Math.random()*e.reconnectTime/10);r.default.logger.log("ForceConnectVideoProxy start",this.stream.id,r.default.TimeUtil.now(),e),e.videoProxyIpInfo.length>0?r.default.Timer.once(this.onDelayConnect,this,t,e.videoProxyIpInfo):r.default.Timer.once(this.onDelayGetProxy,this,t)}}},{key:"onDelayConnect",value:function(e,t,n){r.default.logger.log("ForceConnectVideoProxy end",this.stream.id,r.default.TimeUtil.now()),this.forceConnect(n)}},{key:"forceConnect",value:function(e){var t=this.vps;this.close(),t?(this.vps=t,this.proxys=e,this.reconnect()):this.getProxy()}},{key:"onDelayGetProxy",value:function(e,t){r.default.logger.log("ForceConnectVideoProxy end",this.stream.id,r.default.TimeUtil.now()),this.getProxy()}},{key:"close",value:function(){this.started&&(r.default.logger.log("CdnpProxy.close",this.stream.id),this.logout(),this.stat.core.video_login_fail=100,this.link.reset(),this.proxys=[],this.delaySendList=[],this.pingCnt=0,this.lastGetProxyTime=0,this.sslUrl="",this.wsUrl="",this.token="",this.tokenVersion=0,this.started=!1)}},{key:"logout",value:function(){var e=new h.default;e.cdnGroupId=this.streamId,e.uid=r.default.userInfo.uuid,e.clientType=1,e.tcpId=0,e.cdnLineType=this.sInfo.lineType,this.send(e)}},{key:"connect",value:function(e){this.vps=e,this.sslUrl=e.sslUrl||"",this.tokenVersion=e.tokenVersion;var t=null;e.allocatedStreams.forEach((function(e){t||(t=e.videoProxyInfos.slice()),this.token=e.token}).bind(this)),t&&0!==t.length?(this.proxys=t,this.started=!0,this.pingCnt=0,this.reconnect()):r.default.logger.warn("CdnpProxy.connect NO STREAM!",this.stream.id)}},{key:"reconnect",value:function(){if(this.started)if(this.proxys&&0!==this.proxys.length){this.sInfo.isLogin=0;var e=this.proxys.shift();localStorage._testCdnpIp&&(e.ip=localStorage._testCdnpIp),r.default.logger.log("CdnpProxy.cndpInfo.cdnpIp ",e.ip),this.sInfo&&this.sInfo.pInfo&&this.sInfo.pInfo.configCdnp&&(e.ip=this.sInfo.pInfo.configCdnp),this.sInfo.cdnpIpStr=e.ip,this.sInfo.cdnpIpInt=a.default.ip2uint(e.ip),this.parseCdnpProcessId(e),this.isWss(e)?this.connectWss(e):this.connectWs(e)}else this.getProxy()}},{key:"parseCdnpProcessId",value:function(e){e.videoProxyInfo.has(9)&&e.videoProxyInfo.has(10)&&(this.stat.core.cdp_id=e.videoProxyInfo.get(9).toString(16)+e.videoProxyInfo.get(10).toString(16),r.default.logger.log("CdnpProxy.parseCdnpProcessId id="+this.sInfo.cdnpProcessId))}},{key:"isWss",value:function(e){return""!==this.sslUrl&&e.videoProxyInfo.has(8)&&e.videoProxyInfo.get(8)>0}},{key:"getProxy",value:function(){if(this.started){var e=r.default.TimeUtil.now();e-this.lastGetProxyTime<5e3||(r.default.logger.log("CdnpProxy.getProxy",this.stream.id,"lastGetProxyTime",this.lastGetProxyTime,"now",e),this.close(),this.lastGetProxyTime=e,this.stream.getProxyList.getProxy())}}},{key:"connectWs",value:function(e){var t=Math.floor(Math.random()*e.tcpPorts.length),n=t;if(465===e.tcpPorts[t]&&(++t>=e.tcpPorts.length&&(t=0),t===n))return r.default.logger.warn("CdnpProxy.connectWs has no correct ports",this.stream.id),void this.reconnect();this.sInfo.cdnpPort=e.tcpPorts[t],localStorage._testCdnpPort&&(this.sInfo.cdnpPort=Number(localStorage._testCdnpPort)),this.stat.core.cdnp_connect_ip=this.sInfo.cdnpIpStr+":"+this.sInfo.cdnpPort,this.wsUrl="ws://"+e.ip+":"+this.sInfo.cdnpPort,r.default.logger.log("%cCdnpProxy connectWs "+this.wsUrl,v("#0000E3"),this.stream.id),localStorage._setWssUrl?this.link.connect(localStorage._setWssUrl):this.link.connect(this.wsUrl)}},{key:"connectWss",value:function(e){var t=e.videoProxyInfo.get(8),n=[t>>16,65535&t],i=Math.floor(Math.random()*n.length);this.sInfo.cdnpPort=n[i],r.default.logger.log("CdnpProxy.cndpInfo.cdnpPort ",n[i]),this.sInfo&&this.sInfo.pInfo&&this.sInfo.pInfo.configCdnpPort&&(this.sInfo.cdnpPort=this.sInfo.pInfo.configCdnpPort),localStorage._testCdnpPort&&(this.sInfo.cdnpPort=Number(localStorage._testCdnpPort)),this.stat.core.cdnp_connect_ip=this.sInfo.cdnpIpStr+":"+this.sInfo.cdnpPort,r.default.logger.log("CdnpProxy.cndpInfo ",this.stat.core.cdnp_connect_ip),this.wsUrl="wss://"+this.sInfo.cdnpIpInt+this.sslUrl+":"+this.sInfo.cdnpPort,r.default.logger.log("%cCdnpProxy.connectWss "+this.wsUrl,v("#0000E3"),this.stream.id),localStorage._setWssUrl?this.link.connect(localStorage._setWssUrl):this.link.connect(this.wsUrl)}},{key:"send",value:function(e){if(!e)return!1;if(!this.connected)return this.delaySendList.push(e),!1;var t=e.constructor.name;this.printProtocol&&!g[t]&&r.default.logger.debug("%c>>>>> "+t,v("#009100"),e);var n=e.marshall();return this.BwStat.signal_up_bw+=n.length,this.link.send(n),!0}},{key:"onCheckTimer",value:function(e,t){this.started&&(this.onConnectTimer(e,t),this.onPingTimer(e,t))}},{key:"onConnectTimer",value:function(e,t){this.connected||t%3==0&&this.reconnect()}},{key:"onPingTimer",value:function(e,t){if(this.sInfo.isLogin&&(this.stat.cdnpRtts.push(this.sInfo.cdnpRtt),this.link.connected&&t%3==0)){if(this.pingCnt>=4)return r.default.logger.warn("CdnpProxy.onPingTimer ping time out",this.stream.id),this.pingCnt=0,void this.reconnect();this.pingCnt++;var n=this.pingPkg;n.appid=r.default.userInfo.appid,n.uid=r.default.userInfo.uuid,n.sid=this.sInfo.subSid,n.stampc=e,n.loginStamp=0,n.cdnLineType=this.sInfo.lineType,n.cdnGroupId=this.streamId,n.uplinkBw=this.bwCalc.getUpBw(),n.availPeers=this.stream.punchMgr.getPunchedCnt(),n.bPunched=this.stream.punchMgr.bPunched,n.isUsingFullSubStream=this.sInfo.isFullStream,this.send(n)}}},{key:"onPingRes",value:function(e){this.pingCnt=0,this.sInfo.csMinBw=e.csMinBw,this.sInfo.remainP2pStreamNum=e.remainP2pStreamNum,this.sInfo.SNBw=e.SNBw;var t=r.default.TimeUtil.now(),n=t-e.stampc>>1;this.sInfo.cdnpRtt=a.default.smoothVal(this.sInfo.cdnpRtt,n),this.sInfo.stampcSvr=e.stampcSvr+n,this.sInfo.stampcNow=t,this.sInfo.useCdnpFixed&&(0===this.sInfo.isFullStream&&1===e.isNeedUseFullSubStream?(this.sInfo.isFullStream=1,this.stream.turnStreamMode()):1===this.sInfo.isFullStream&&0===e.isNeedUseFullSubStream&&(this.sInfo.isFullStream=0,this.stream.turnStreamMode()))}},{key:"sendLogin",value:function(){var e=new d.default;e.cdnGroupId=this.streamId,e.uid=r.default.userInfo.uuid,e.clientType=1,e.tcpId=0,e.localIps=[],e.localPort=0,e.token=this.token,e.tokenVersion=this.tokenVersion,e.version=r.default.userInfo.version+"",e.desc=r.default.Browser.name,e.clientUA="web",e.p2pVersion=Number(r.default.userInfo.version),e.cdnLineType=this.sInfo.lineType,e.fixedCdnStreamCount=0,e.sourceCodecRate=1e3*this.sInfo.curBitrate,e.maxCdnStreamCount=this.sInfo.baseSubs,e.clearSubscribeInfo=Number(this.sInfo.isFirstLogin),e.appid=r.default.userInfo.appid,a.default.isOpen(r.default.config.crossClientPer,this.sInfo.presenterUid,this.sInfo.lineType,!1)?e.nodeType=f.default.WEB_CLIENT_V2:e.nodeType=f.default.OLD_CLIENT,r.default.logger.log("CdnpProxy.sendLogin uid="+e.uid+" line="+e.cdnLineType+" nodeType="+e.nodeType),this.send(e)}},{key:"onLoginRes",value:function(e){if(e.ret>0)return this.reconnect(),void r.default.logger.warn("VideoLink.onLoginVideoProxy login failed. ret="+e.ret);this.wanIp=a.default.inet_ntoa(e.wanIp),this.wanPort=e.wanPort,this.stat.core.user_wan_ip=this.wanIp,this.stat.core.video_login_fail=0,r.default.logger.log("CdnpProxy.onLoginRes uid="+e.uid+this.wanIp+":"+this.wanPort,this.stream.id,"fixed="+e.fixedCdnStream.join(",")),this.stream.punchMgr.setStunConfig(this.sslUrl,this.sInfo.cdnpIpInt,e.stunProts.slice()),this.stunProxy.update(this.sInfo.cdnpIpInt,this.sslUrl,e.stunProts.slice()),this.stream.stunProbe.startProbe(this.sInfo.cdnpIpInt,this.sslUrl,e.stunProts.slice()),this.sInfo.isLogin=+(0===e.ret),this.sInfo.useCdnpFixed&&(this.sInfo.cdnpFixedNum=e.fixedCdnStream.length,this.sInfo.isFullStream=+(this.sInfo.cdnpFixedNum===this.sInfo.baseSubs));var t=this.delaySendList.length;if(t>0){for(var n=0;n<t;n++)this.send(this.delaySendList[n]);this.delaySendList=[],r.default.logger.log("VideoLink delay send data "+t)}this.sInfo.useCdnpFixed&&this.sInfo.cdnpFixedNum>0&&this.stream.subStreamMgr._checkFixed(),this.sInfo.isFirstLogin||this.stream.subStreamMgr.cdnpReconnect(),this.sInfo.isFirstLogin=!1,this.sInfo.isCanUseP2P&&this.stream.nodeProxy.sendGetNode()}},{key:"onopen",value:function(){r.default.logger.log("CdnpProxy.onopen",this.wsUrl,this.stream.id),this.stat.core.cdnp_connected=1,this.sendLogin()}},{key:"onerror",value:function(e){r.default.logger.warn("CdnpProxy.onerror",e,this.stream.id),this.stream.tsdbUtil.sendMetrics([this.stream.tsdbStat.createAct("cdnp_error",{str:[this.wsUrl,this.sInfo.streamId.text()],value:[this.sInfo.type]})]),this.link.reset(),this.reconnect()}},{key:"onclose",value:function(e){r.default.logger.log("%cCdnpProxy.onclose",this.wsUrl,"color:white;background:black;",this.stream.id);var t={str:[this.wsUrl,this.sInfo.streamId.text()],value:[this.sInfo.type]};e.code&&t.value.push(e.code),this.stream.tsdbUtil.sendMetrics([this.stream.tsdbStat.createAct("cdnp_close",t)]),this.link.reset(),this.reconnect()}},{key:"onData",value:function(e){this.BwStat.signal_down_bw+=e.byteLength;for(var t=new DataView(e),n=0,i=0,s=0;n+10<e.byteLength;){if(n+(i=t.getUint32(n,!0))>e.byteLength||i<10)return void r.default.logger.error("CdnpProxy.onData length error pktLen="+i+" bufferLen="+e.byteLength,this.stream.id);s=t.getUint32(n+4,!0);var a=new DataView(e,n,i);this.protoHandler.onData(s,a),n+=i}}},{key:"connected",get:function(){return this.link&&this.link.connected}}]),e}();function v(e){return"color:"+e+";font-weight:900"}var g={PStreamData3:1,PPullStreamData:1,PVideoProxyPing3:1,PVideoProxyPingRes4:1,PNotifyCurrentStream4:1,PReSendStreamData4:1,PP2pVideoPing3:1,PNotifyUplinkRecvCount3:1,PVideoSyncSpeakerTime3:1};t.default=_},function(e,t,n){n(183),e.exports=n(5).Object.getPrototypeOf},function(e,t,n){var i=n(28),s=n(93);n(103)("getPrototypeOf",function(){return function(e){return s(i(e))}})},function(e,t,n){e.exports={default:n(185),__esModule:!0}},function(e,t,n){n(27),n(39),e.exports=n(59).f("iterator")},function(e,t,n){e.exports={default:n(187),__esModule:!0}},function(e,t,n){n(188),n(89),n(191),n(192),e.exports=n(5).Symbol},function(e,t,n){var i=n(10),s=n(19),r=n(11),a=n(8),o=n(90),u=n(53).KEY,l=n(23),d=n(49),h=n(38),c=n(37),f=n(6),p=n(59),m=n(60),_=n(189),v=n(100),g=n(15),y=n(12),b=n(28),P=n(20),k=n(42),I=n(26),w=n(35),T=n(190),C=n(62),x=n(105),R=n(9),M=n(46),U=C.f,N=R.f,E=T.f,L=i.Symbol,O=i.JSON,D=O&&O.stringify,A=f("_hidden"),q=f("toPrimitive"),B={}.propertyIsEnumerable,F=d("symbol-registry"),j=d("symbols"),H=d("op-symbols"),G=Object.prototype,z="function"==typeof L&&!!x.f,V=i.QObject,W=!V||!V.prototype||!V.prototype.findChild,K=r&&l(function(){return 7!=w(N({},"a",{get:function(){return N(this,"a",{value:7}).a}})).a})?function(e,t,n){var i=U(G,t);i&&delete G[t],N(e,t,n),i&&e!==G&&N(G,t,i)}:N,Y=function(e){var t=j[e]=w(L.prototype);return t._k=e,t},X=z&&"symbol"==(0,S.default)(L.iterator)?function(e){return"symbol"==(void 0===e?"undefined":(0,S.default)(e))}:function(e){return e instanceof L},Z=function e(t,n,i){return t===G&&e(H,n,i),g(t),n=k(n,!0),g(i),s(j,n)?(i.enumerable?(s(t,A)&&t[A][n]&&(t[A][n]=!1),i=w(i,{enumerable:I(0,!1)})):(s(t,A)||N(t,A,I(1,{})),t[A][n]=!0),K(t,n,i)):N(t,n,i)},J=function(e,t){g(e);for(var n,i=_(t=P(t)),s=0,r=i.length;r>s;)Z(e,n=i[s++],t[n]);return e},Q=function(e){var t=B.call(this,e=k(e,!0));return!(this===G&&s(j,e)&&!s(H,e))&&(!(t||!s(this,e)||!s(j,e)||s(this,A)&&this[A][e])||t)},$=function(e,t){if(e=P(e),t=k(t,!0),e!==G||!s(j,t)||s(H,t)){var n=U(e,t);return!n||!s(j,t)||s(e,A)&&e[A][t]||(n.enumerable=!0),n}},ee=function(e){for(var t,n=E(P(e)),i=[],r=0;n.length>r;)s(j,t=n[r++])||t==A||t==u||i.push(t);return i},et=function(e){for(var t,n=e===G,i=E(n?H:P(e)),r=[],a=0;i.length>a;)s(j,t=i[a++])&&(!n||s(G,t))&&r.push(j[t]);return r};z||(o((L=function(){if(this instanceof L)throw TypeError("Symbol is not a constructor!");var e=c(arguments.length>0?arguments[0]:void 0);return r&&W&&K(G,e,{configurable:!0,set:function t(n){this===G&&t.call(H,n),s(this,A)&&s(this[A],e)&&(this[A][e]=!1),K(this,e,I(1,n))}}),Y(e)}).prototype,"toString",function(){return this._k}),C.f=$,R.f=Z,n(106).f=T.f=ee,n(61).f=Q,x.f=et,r&&!n(34)&&o(G,"propertyIsEnumerable",Q,!0),p.f=function(e){return Y(f(e))}),a(a.G+a.W+!z*a.F,{Symbol:L});for(var en="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ei=0;en.length>ei;)f(en[ei++]);for(var es=M(f.store),er=0;es.length>er;)m(es[er++]);a(a.S+!z*a.F,"Symbol",{for:function(e){return s(F,e+="")?F[e]:F[e]=L(e)},keyFor:function(e){if(!X(e))throw TypeError(e+" is not a symbol!");for(var t in F)if(F[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),a(a.S+!z*a.F,"Object",{create:function(e,t){return void 0===t?w(e):J(w(e),t)},defineProperty:Z,defineProperties:J,getOwnPropertyDescriptor:$,getOwnPropertyNames:ee,getOwnPropertySymbols:et});var ea=l(function(){x.f(1)});a(a.S+a.F*ea,"Object",{getOwnPropertySymbols:function(e){return x.f(b(e))}}),O&&a(a.S+a.F*(!z||l(function(){var e=L();return"[null]"!=D([e])||"{}"!=D({a:e})||"{}"!=D(Object(e))})),"JSON",{stringify:function(e){for(var t,n,i=[e],s=1;arguments.length>s;)i.push(arguments[s++]);if(n=t=i[1],(y(t)||void 0!==e)&&!X(e))return v(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!X(t))return t}),i[1]=t,D.apply(O,i)}}),L.prototype[q]||n(14)(L.prototype,q,L.prototype.valueOf),h(L,"Symbol"),h(Math,"Math",!0),h(i.JSON,"JSON",!0)},function(e,t,n){var i=n(46),s=n(105),r=n(61);e.exports=function(e){var t=i(e),n=s.f;if(n)for(var a,o=n(e),u=r.f,l=0;o.length>l;)u.call(e,a=o[l++])&&t.push(a);return t}},function(e,t,n){var i=n(20),s=n(106).f,r={}.toString,a="object"==("undefined"==typeof window?"undefined":(0,S.default)(window))&&window&&l.default?(0,l.default)(window):[];e.exports.f=function(e){return a&&"[object Window]"==r.call(e)?function(e){try{return s(e)}catch(e){return a.slice()}}(e):s(i(e))}},function(e,t,n){n(60)("asyncIterator")},function(e,t,n){n(60)("observable")},function(e,t,n){e.exports={default:n(194),__esModule:!0}},function(e,t,n){n(195);var i=n(5).Object;e.exports=function(e,t){return i.getOwnPropertyDescriptor(e,t)}},function(e,t,n){var i=n(20),s=n(62).f;n(103)("getOwnPropertyDescriptor",function(){return function(e,t){return s(i(e),t)}})},function(e,t,n){e.exports={default:n(197),__esModule:!0}},function(e,t,n){n(198),e.exports=n(5).Object.setPrototypeOf},function(e,t,n){var i=n(8);i(i.S,"Object",{setPrototypeOf:n(199).set})},function(e,t,n){var i=n(12),s=n(15),r=function(e,t){if(s(e),!i(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:o.default||("__proto__"in{}?function(e,t,i){try{(i=n(18)(Function.call,n(62).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return r(e,n),t?e.__proto__=n:i(e,n),e}}({},!1):void 0),check:r}},function(e,t,n){e.exports={default:n(201),__esModule:!0}},function(e,t,n){n(202);var i=n(5).Object;e.exports=function(e,t){return i.create(e,t)}},function(e,t,n){var i=n(8);i(i.S,"Object",{create:n(35)})},function(e,t,n){e.exports={default:n(204),__esModule:!0}},function(e,t,n){n(27),n(205),e.exports=n(5).Array.from},function(e,t,n){var i=n(18),s=n(8),r=n(28),o=n(97),u=n(98),l=n(36),d=n(206),h=n(51);s(s.S+!n(207)(function(e){(0,a.default)(e)})*s.F,"Array",{from:function(e){var t,n,s,a,c=r(e),f="function"==typeof this?this:Array,p=arguments.length,m=p>1?arguments[1]:void 0,_=void 0!==m,v=0,g=h(c);if(_&&(m=i(m,p>2?arguments[2]:void 0,2)),null==g||f==Array&&u(g))for(n=new f(t=l(c.length));t>v;v++)d(n,v,_?m(c[v],v):c[v]);else for(a=g.call(c),n=new f;!(s=a.next()).done;v++)d(n,v,_?o(a,m,[s.value,v],!0):s.value);return n.length=v,n}})},function(e,t,n){var i=n(9),s=n(26);e.exports=function(e,t,n){t in e?i.f(e,t,s(0,n)):e[t]=n}},function(e,t,n){var i=n(6)("iterator"),s=!1;try{var r=[7][i]();r.return=function(){s=!0},(0,a.default)(r,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!s)return!1;var n=!1;try{var r=[7],a=r[i]();a.next=function(){return{done:n=!0}},r[i]=function(){return a},e(r)}catch(e){}return n}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i,s=(i=n(0))&&i.__esModule?i:{default:i};t.default=function e(t,n){(0,s.default)(this,e),this.parent=t,this.child=n,this.streamIndex=-1,this.isFromPeer=!!t.uid,this.isRepeat=!1,this.isSliceJumpFromPeer=!1,this.isRange=!1,this.nodeType=0}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(84)),s=o(n(0)),r=o(n(1)),a=o(n(7));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,s.default)(this,e),this._ipInt=0,this._sslUrl="",this._ports=[],this.init()}return(0,r.default)(e,[{key:"init",value:function(){if(a.default.config.hasOwnProperty("pcdnStun")){var e=a.default.config.pcdnStun;this._ipInt=e[0],this._sslUrl=e[1],this._ports=[Number(e[2])],a.default.logger.log("StunProxy.init:config "+this._ipInt+this._sslUrl+":"+this._ports)}else if(localStorage.hasOwnProperty("_lsinfo"))try{var t=JSON.parse(localStorage._lsinfo),n=t.ipInt,i=t.sslUrl,s=t.ports;n&&i&&s&&(this._ipInt=n,this._sslUrl=i,this._ports=s),a.default.logger.log("StunProxy.init:local "+this._ipInt+this._sslUrl+":"+this._ports)}catch(e){}}},{key:"reset",value:function(){this._ipInt=0,this._sslUrl="",this._ports=[]}},{key:"isReady",value:function(){return 1!=localStorage._noStun&&this._ipInt>0}},{key:"update",value:function(e,t,n){this._ipInt=e,this._sslUrl=t,this._ports=n,localStorage.setItem("_lsinfo",(0,i.default)({ipInt:e,sslUrl:t,ports:n}))}},{key:"getStunUrl",value:function(){var e=this._ports.length;if(e>0){var t=this._ports[Math.random()*e|0];return"stun:"+this._ipInt+this._sslUrl+":"+t}return""}}]),e}()},function(e,t,n){var i=n(5),s=i.JSON||(i.JSON={stringify:r.default});e.exports=function(e){return s.stringify.apply(s,arguments)}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=d(n(84)),s=d(n(0)),r=d(n(1)),a=d(n(7)),o=d(n(140)),u=d(n(101)),l=d(n(58));function d(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,s.default)(this,e),this.stream=t,this.started=!1,this.baseSubs=8,this._rspProxyBind=this._rspProxy.bind(this),this.subsArray=[],this.pcdnSubsUrlMap={},this.pcdnName="",this.phase=1,this.callbacks=null,this.subs=null}return(0,r.default)(e,[{key:"start",value:function(){this.getProxy()}},{key:"stop",value:function(){a.default.logger.log("PcdnProxyList stop"),a.default.Timer.remove(this.onTimeout,this),this.phase=1,this.reqId=0,this.callbacks=null}},{key:"getProxy",value:function(){this.baseSubs=this.stream.sInfo.baseSubs,this.subsArray=this.getSubsArray()}},{key:"getSubsArray",value:function(){for(var e=[],t=0,n=this.baseSubs;t<n;t++)e.push(t),this.pcdnSubsUrlMap[t]=[];return e}},{key:"getPcdnReq",value:function(e,t){if(0!==e.length&&2!==this.phase){for(var n in this.subs=e,this.callbacks=t,this.sendTime=Date.now(),this.reqId=a.default.TafLink.getRequestId(),this.pcdnSubsUrlMap)this.pcdnSubsUrlMap[n]=[];var i=this.stream.sInfo,s=new a.default.HUYA.ClientGetStunAndPcdnProxyReq;if(s.lReqTs=this.sendTime,s.lUid=a.default.userInfo.uid,s.sStreamname=i.streamId.text()+"_"+a.default.userInfo.appid,s.iBaseSubs=i.baseSubs,s.vSub.value=e,s.sGuid=a.default.userInfo.sGuid,s.lAnchorUid=i.presenterUid,s.iCdnLine=i.pInfo.lineType,s.iCliType=a.default.HUYA.EM_CLINET_TYPE.E_CLIENT_WEB,s.lBucketPara=Number(localStorage.randomPcdnPercent)||a.default.config.randomPcdnPercent,s.iBusiType=a.default.HUYA.EM_BUSI_TYPE.E_BusiType_Live,s.curPcdnName=this.pcdnName,a.default.TafLink.connected){this.stream.stat.pcdn_data.get_subs_url_cnt++;var r=a.default.config.pcdnProTimoutTs||3e3;a.default.logger.log("GetPcdnProxyList req, subs="+e+", reqId="+this.reqId+", timeoutTs="+r),this.phase=2,a.default.Timer.once(this.onTimeout,this,r),a.default.TafLink.sendWup("hypcdngw","onClientGetStunAndPcdnProxyReq",s,this._rspProxyBind,!0,this.reqId)}}}},{key:"onTimeout",value:function(){a.default.logger.log("GetPcdnProxyList res timout,subs="+this.subs+" reqId="+this.reqId),2===this.phase&&(this.phase=3,this.reqId=0,this.callbacks&&this.callbacks.onTimeout&&this.callbacks.onTimeout(),this.stream.subStreamMgr.getPcdnProxyTimeout&&this.stream.subStreamMgr.getPcdnProxyTimeout(this.subs))}},{key:"_rspProxy",value:function(e){if(l.default.isWapPlatForm()||this.reqId===e.iRequestId){a.default.Timer.remove(this.onTimeout,this),this.phase=3,a.default.logger.log("GetPcdnProxyList res, subs="+this.subs+", reqId="+this.reqId,e),this.stream.stat.pcdn_data.send_req_to_res_time_cnt++,this.stream.stat.pcdn_data.send_req_to_res_time+=Date.now()-this.sendTime;var t=!1;if(e){e.pcdnName&&(this.pcdnName=e.pcdnName),this.stream.stat.pcdn_data_state.pcdn_origin=this.pcdnName,this.stream.stat.pcdn_rsp.pcdn_svr_isp=e.sPcdnIsp,this.stream.stat.pcdn_rsp.pcdn_svr_area=e.sPcdnArea,this.stream.streamHandler&&this.stream.streamHandler.setPcdnName&&this.stream.streamHandler.setPcdnName(this.pcdnName);var n=e.iErrCode;1==n?(t=!0,a.default.logger.error("Pcdn Proxylink","E_HYGW_ERR",e)):2==n?(t=!0,a.default.logger.error("Pcdn Proxylink","E_PCDNGW_40X",e)):3==n?(t=!0,a.default.logger.error("Pcdn Proxylink","E_PCDNGW_50X",e)):4==n?(t=!0,a.default.logger.error("Pcdn Proxylink","E_PCDNGW_TIO",e)):5==n?(t=!0,a.default.logger.error("Pcdn Proxylink","E_PCDNGW_RSPERR",e)):6==n?(t=!0,a.default.logger.error("Pcdn Proxylink","E_CLIREQ_ERR",e)):7==n?(t=!0,a.default.logger.error("Pcdn Proxylink","E_PCDN_OFF pcdn",e)):0==n&&(t=!1);var s=[],r=0;if(!t&&e.mSubToPullStreamUrl&&e.mSubToPullStreamUrl.value){var d=e.mSubToPullStreamUrl.value,h=[];for(var c in d){var f=d[c],p=f.value.wss.iStatusPcdn;if(this.stream.stat.pcdn_data.get_pcdn_url_total_cnt++,this.recordPcdnProxyStat(c,f.value.wss,p),this.stream.stat.psub_proxy_info[c].total_cnt++,this.pcdnSubsUrlMap[c]="",s.push(p),100==p){this.stream.stat.pcdn_data.get_pcdn_url_success++,this.stream.stat.psub_proxy_info[c].suc_cnt++;var m=[];e.pcdnName===u.default.XD?(this.stream.subStreamMgr.isTryurls()||r<this.stream.sInfo.baseSubs-1)&&(r++,m=f.value.webrtc.vUrl.value):m=Number(c)<4?f.value.https.vUrl.value:f.value.wss.vUrl.value,this.stream.loaderMgr.filterPcdnDomain(c,m),m.length>0?(this.pcdnSubsUrlMap[c]=m,this.stream.subStreamMgr.setSubStreamState(c,o.default.TAF_SUC)):(h.push(c),this.stream.subStreamMgr.setSubStreamState(c,o.default.TAF_REPEAT_DOMAIN))}else 101==p?(this.stream.subStreamMgr.setSubStreamState(c,o.default.TAF_GATHER),this.stream.stat.pcdn_data.get_pcdn_err_not_reached++,this.stream.stat.notReachedPcdnSubs.push(c)):102==p?(this.stream.subStreamMgr.setSubStreamState(c,o.default.TAF_LOAD),this.stream.stat.pcdn_data.get_pcdn_err_over_run++):103==p?(this.stream.subStreamMgr.setSubStreamState(c,o.default.TAF_COVER),this.stream.stat.pcdn_data.get_pcdn_err_not_coverd++):(this.stream.subStreamMgr.setSubStreamState(c,o.default.TAF_UNKNOW),this.stream.stat.pcdn_data.get_pcdn_err_other++)}h.length>0&&a.default.logger.log("GetPcdnProxyList._rspProxy repeatDomainIndex="+h.join(","))}a.default.logger.log("GetPcdnProxyList._rspProxy.pcdnSubsUrlMap = "+(0,i.default)(this.pcdnSubsUrlMap)+", iStatusList="+s),this.callbacks&&this.callbacks.getPcdnRsp(),e.cliIsp&&(this.stream.stat.pcdn_data_state.cli_isp=e.cliIsp),e.cliProv&&(this.stream.stat.pcdn_data_state.cli_prov=e.cliProv)}else t=!0,a.default.logger.log("PcdnProxyList _rspProxy noData");t&&this.stream.stat.pcdn_data.get_subs_url_error_cnt++}}},{key:"recordPcdnProxyStat",value:function(e,t,n){this.stream.stat.pcdn_rsp.get_pcdn_url_result[e]=n,-1!==t.iPcdnThresholdHotDegreeIn&&(this.stream.stat.pcdn_rsp.pcdn_hot_degree_in[e]=t.iPcdnThresholdHotDegreeIn),-1!==t.iPcdnThresholdHotDegreeKick&&(this.stream.stat.pcdn_rsp.pcdn_hot_degree_kick[e]=t.iPcdnThresholdHotDegreeKick),-1!==t.iPcdnNowHotDegree&&(this.stream.stat.pcdn_rsp.pcdn_hot_degree[e]=t.iPcdnNowHotDegree),-1!==t.iPcdnNowPullstreamUcnt&&(this.stream.stat.pcdn_rsp.pcdn_pull_stream_user_cnt[e]=t.iPcdnNowPullstreamUcnt),-1!==t.iPcdnNowGetpcdnUcnt&&(this.stream.stat.pcdn_rsp.pcdn_get_proxy_user_cnt[e]=t.iPcdnNowGetpcdnUcnt)}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=f(n(25)),s=f(n(213)),r=f(n(16)),a=f(n(0)),o=f(n(1)),u=f(n(21)),l=f(n(29)),d=f(n(22)),h=f(n(7)),c=f(n(30));function f(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e){(0,a.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return n.type=c.default.TYPE_FETCH,n.controller=null,n.reader=null,n.requestAbort=!1,n}return(0,d.default)(t,e),(0,o.default)(t,[{key:"destroy",value:function(){this.abort(),(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"destroy",this).call(this)}},{key:"pump",value:function(e){var t=this;e.read().then((function(n){if(n.done)t.onclose();else{if(!window.AbortController&&!0===t.requestAbort)return t.requestAbort=!1,e.cancel();var i=n.value.buffer;t.bytesLoaded=i.byteLength,t.linkHandler&&t.linkHandler.onData(i),t.pump(e)}}).bind(this))}},{key:"connect",value:function(e){var n=this;(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"connect",this).call(this,e);var i=null,s=null;window.AbortController&&(s=(i=new AbortController).signal,this.controller=i),fetch(e,{signal:s}).then(function(e){Number(localStorage._printFetchUrl)&&h.default.logger.log("FetchUrl("+n._id+")",e.url);var t=e.body.getReader();n.reader=t,n.linkHandler&&(n.linkHandler.onstatus(e.status),n.linkHandler.onRes&&n.linkHandler.onRes(e)),e.ok&&e.status>=200&&e.status<300?(n.onheader(e),e.redirected&&n.on302(e),n.onopen(),n.pump.call(n,t)):(h.default.logger.log("ProtoLinkFetch("+n._id+") http code invalid status:"+e.status),n.onerror(e.statusText,e.status))}).catch(function(e){e&&"The user aborted a request."==e.message||n.onerror(e.message)})}},{key:"onheader",value:function(e){var t={},n=[],r=!0,a=!1,o=void 0;try{for(var u,l=(0,i.default)(e.headers);!(r=(u=l.next()).done);r=!0){var d=u.value,c=(0,s.default)(d,2),f=c[0],p=c[1];t[f]=p,n.push(f+":"+p)}}catch(e){a=!0,o=e}finally{try{!r&&l.return&&l.return()}finally{if(a)throw o}}h.default.logger.log("ProtoLinkFetch("+this._id+").onheader",n.join(" | ")),this.linkHandler.onheader&&this.linkHandler.onheader(t)}},{key:"on302",value:function(e){this.linkHandler.on302&&this.linkHandler.on302(e.url),h.default.logger.log("ProtoLinkFetch("+this._id+").on302 url="+e.url)}},{key:"abort",value:function(){if(this.reader&&this.reader.cancel&&(this.reader.cancel(),this.reader=null),this.controller&&this.controller.abort)return this.controller.abort(),void(this.controller=null);this.requestAbort=!0}}]),t}(c.default)},function(e,t,n){t.__esModule=!0;var i=r(n(214)),s=r(n(25));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(Array.isArray(e))return e;if((0,i.default)(Object(e)))return function(e,t){var n=[],i=!0,r=!1,a=void 0;try{for(var o,u=(0,s.default)(e);!(i=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(r)throw a}}return n}(e,t);throw TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){e.exports={default:n(215),__esModule:!0}},function(e,t,n){n(39),n(27),e.exports=n(216)},function(e,t,n){var i=n(52),s=n(6)("iterator"),r=n(24);e.exports=n(5).isIterable=function(e){var t=Object(e);return void 0!==t[s]||"@@iterator"in t||r.hasOwnProperty(i(t))}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=c(n(16)),s=c(n(0)),r=c(n(1)),a=c(n(21)),o=c(n(29)),u=c(n(22)),l=c(n(7)),d=c(n(218)),h=c(n(30));function c(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e){(0,s.default)(this,t);var n=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return n.type=h.default.TYPE_XHR,n.loader=null,n.lastLoaded=0,n}return(0,u.default)(t,e),(0,r.default)(t,[{key:"destroy",value:function(){this.abort(),(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"destroy",this).call(this)}},{key:"abort",value:function(){this.loader&&this.loader.abort()}},{key:"reset",value:function(){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"reset",this).call(this),this.lastLoaded=0,this.loader&&(this.loader.destroy(),this.loader=null),this.loader=new d.default}},{key:"connect",value:function(e){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"connect",this).call(this,e);var n=l.default.Browser.firefox?"moz-chunked-arraybuffer":"arraybuffer";this.loader.load(e,n,this.loadSuccess.bind(this),this.onerror.bind(this),this.onclose.bind(this),2e3,1,0,this.onProgress.bind(this))}},{key:"loadSuccess",value:function(e,t){var n=e.currentTarget.response;this.linkHandler&&this.linkHandler.onData(n),this.onclose()}},{key:"onProgress",value:function(e,t){this.connected||this.onopen();var n=t.loaded-this.lastLoaded;this.bytesLoaded+=n,this.lastLoaded=t.loaded}}]),t}(h.default)},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(0)),s=a(n(1)),r=a(n(7));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,i.default)(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return(0,s.default)(e,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){this.loader&&(this.stats.aborted=!0,this.loader.abort()),this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}},{key:"load",value:function(e,t,n,i,s,r,a,o){var u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.url=e,this.responseType=t,this.onSuccess=n,this.onError=i,this.onTimeout=s,this.onProgress=u,this.stats={trequest:performance.now(),retry:0},this.timeout=r,this.maxRetry=a,this.retryDelay=o,this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),r),this.loadInternal()}},{key:"loadInternal",value:function(){var e=this.loader=new XMLHttpRequest;e.onload=this.loadsuccess.bind(this),e.onerror=this.loaderror.bind(this),e.onprogress=this.loadprogress.bind(this),e.onloadend=this.loadend.bind(this),e.responseType=this.responseType,e.open("GET",this.url,!0),null!=this.fromByte&&null!=this.toByte&&e.setRequestHeader("Range","bytes="+this.fromByte+"-"+this.toByte),this.stats.tstart=null,this.stats.loaded=0,this.xhrSetup&&this.xhrSetup(e),this.stats.tstart=performance.now(),e.send()}},{key:"loadsuccess",value:function(e){window.clearTimeout(this.timeoutHandle),this.stats.tload=performance.now(),e.requestURL=this.url,this.onSuccess(e,this.stats)}},{key:"loaderror",value:function(e){404!==e.currentTarget.status&&0!==e.currentTarget.status?this.stats.retry<this.maxRetry?(r.default.logger.warn("XhrLoader.loaderror url="+this.url+" retryDelay="+this.retryDelay),this.destroy(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++):(window.clearTimeout(this.timeoutHandle),r.default.logger.warn("XhrLoader.loaderror reach max retry url="+this.url),this.onError(e)):this.onError(e)}},{key:"loadtimeout",value:function(){this.stats.retry<this.maxRetry?(r.default.logger.warn("XhrLoader.loadtimeout url="+this.url+" retryDelay="+this.retryDelay),this.destroy(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++):(window.clearTimeout(this.timeoutHandle),r.default.logger.warn("XhrLoader.loadtimeout max retry url="+this.url),this.onTimeout())}},{key:"loadprogress",value:function(e){var t=this.stats;null===t.tfirst&&(t.tfirst=performance.now()),t.loaded=e.loaded,this.onProgress&&this.onProgress(e,t)}},{key:"loadend",value:function(e){404===e.currentTarget.status&&this.loaderror(e)}}]),e}()},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=h(n(16)),s=h(n(0)),r=h(n(21)),a=h(n(29)),o=h(n(1)),u=h(n(22)),l=h(n(7)),d=h(n(30));function h(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e){(0,s.default)(this,t);var n=(0,r.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return n.type=d.default.TYPE_XHRFF,n.xhr=null,n}return(0,u.default)(t,e),(0,o.default)(t,null,[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(e){return l.default.logger.warn("MozChunkedLoader",e.message),!1}}}]),(0,o.default)(t,[{key:"reset",value:function(){(0,a.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"reset",this).call(this),this.abort(),this.xhr=null}},{key:"abort",value:function(){this.xhr&&this.xhr.abort()}},{key:"connect",value:function(e){(0,a.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"connect",this).call(this,e);var n=this.xhr=new XMLHttpRequest;n.responseType="moz-chunked-arraybuffer",n.open("GET",this.url,!0),n.onerror=this.onerror.bind(this),n.onprogress=this.onprogress.bind(this),n.onloadend=this.loadend.bind(this),n.onload=this.onclose.bind(this),n.send()}},{key:"onprogress",value:function(e){this.connected||this.onopen();var t=e.target.response;this.bytesLoaded+=t.byteLength,this.linkHandler&&this.linkHandler.onData(t)}},{key:"onreadystatechange",value:function(e){}},{key:"loadend",value:function(e){404===e.currentTarget.status&&this.onerror(e,e.currentTarget.status)}}]),t}(d.default)},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=v(n(84)),s=v(n(16)),r=v(n(0)),a=v(n(1)),o=v(n(21)),u=v(n(29)),l=v(n(22)),d=v(n(7)),h=v(n(30)),c=v(n(144)),f=v(n(221)),p=v(n(142)),m=v(n(141)),_=v(n(143));function v(e){return e&&e.__esModule?e:{default:e}}var g=window.RTCPeerConnection||window.PeerConnection||window.webkitPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,y=window.RTCIceCandidate||window.mozRTCIceCandidate,S=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.mozRTCSessionDescription;t.default=function(e){function t(e){(0,r.default)(this,t);var n=(0,o.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));return n.stunUrl="",n.type=h.default.TYPE_WEBRTC,n._peer=null,n._channel=null,n._xhr=null,n._failReason=p.default.NONE,n._ices=[],n._iceComplete=!1,n._desc="",n._sendedSdp=!1,n._onIceGatheringStateChangeBind=n._onIceGatheringStateChange.bind(n),n._onIceCandidateBind=n._onIceCandidate.bind(n),n._onIceCandidateErrorBind=n._onIceCandidateError.bind(n),n._onConnectionStateChangeBind=n._onConnectionStateChange.bind(n),n._onChannelMessageBind=n._onChannelMessage.bind(n),n._onChannelOpenBind=n._onChannelOpen.bind(n),n._onChannelCloseBind=n._onChannelClose.bind(n),n._onChannelErrorBind=n._onChannelError.bind(n),n._onXhrLoadBind=n._onXhrLoad.bind(n),n._onXhrErrorBind=n._onXhrError.bind(n),n._onXhrLoadendBind=n._onXhrLoadend.bind(n),n._segTs={start:0,offer:0,anwser:0,connected:0,open:0,seq:0},n}return(0,l.default)(t,e),(0,a.default)(t,[{key:"getFailReason",value:function(){return this._failReason}},{key:"getTimeoutReason",value:function(){if(d.default.logger.log("ProtoLinkWebrtc.getTimeoutReason id="+this._id+" offer="+this._segTs.offer+" anwser="+this._segTs.anwser+" connected="+this._segTs.connected+" open="+this._segTs.open),0===this._segTs.offer);else{if(0===this._segTs.anwser)return p.default.XHR_TIMEOUT;if(0===this._segTs.connected)return p.default.XHR_404;if(0===this._segTs.open)return p.default.ANWSER_ERR}return p.default.NONE}},{key:"reset",value:function(){d.default.logger.log("ProtoLinkWebrtc.reset id="+this._id),(0,u.default)(t.prototype.__proto__||(0,s.default)(t.prototype),"reset",this).call(this),d.default.Timer.remove(this._onIceTime,this),this._peer&&(this._peer.onicecandidate=null,this._peer.onicegatheringstatechange=null,this._peer.onicecandidateerror=null,this._peer.onconnectionstatechange=null,this._peer.close(),this._peer=null),this._channel&&(this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null,this._channel.close(),this._channel=null),this._xhr&&(this._xhr.onload=null,this._xhr.onerror=null,this._xhr.onloadend=null,this._xhr.abort(),this._xhr=null),this._ices=[],this._iceComplete=!1,this._desc="",this._sendedSdp=!1,this._segTs={start:0,offer:0,anwser:0,connected:0,open:0,seq:0}}},{key:"connect",value:function(e){this._failReason=p.default.NONE,(0,u.default)(t.prototype.__proto__||(0,s.default)(t.prototype),"connect",this).call(this,e),this._connectPeer()}},{key:"_connectPeer",value:function(){var e=this;if(this._segTs.start=d.default.TimeUtil.now(),!this.stunUrl)return this._failReason=p.default.NO_STUN,void d.default.logger.log("ProtoLinkWebrtc._connectPeer id="+this._id+" no stun server");if(!this._peer){var t={iceServers:[{urls:[""+this.stunUrl]}]};try{this._peer=new g(t),this._peer.onicegatheringstatechange=this._onIceGatheringStateChangeBind,this._peer.onicecandidate=this._onIceCandidateBind,this._peer.onicecandidateerror=this._onIceCandidateErrorBind,this._peer.onconnectionstatechange=this._onConnectionStateChangeBind,this._channel=this._peer.createDataChannel("xd_"+this._id,{ordered:!0,maxRetransmits:0}),this._channel.onmessage=this._onChannelMessageBind,this._channel.onopen=this._onChannelOpenBind,this._channel.onclose=this._onChannelCloseBind,this._channel.onerror=this._onChannelErrorBind,d.default.logger.log("ProtoLinkWebrtc._connectPeer id="+this._id+" createPeer success iceServer="+(0,i.default)(t))}catch(e){return d.default.logger.log("ProtoLinkWebrtc._createPeer id="+this._id+" error: "+e.message),this._peer=null,void this.onerror(e,_.default.PEER_ERR)}this._peer&&this._peer.createOffer().then(function(t){e._peer.setLocalDescription(t),e._desc=t.sdp,e._postSdp();var n=d.default.getCfgValNum("wrIceTimeout",1e3);d.default.Timer.once(e._onIceTime,e,n)}).catch(function(t){d.default.logger.log("ProtoLinkWebrtc._createPeer id="+e._id+" error: "+t.message),e.onerror(t,_.default.OFFER_ERR)})}}},{key:"_onIceGatheringStateChange",value:function(e){"complete"===this._peer.iceGatheringState&&(d.default.Timer.remove(this._onIceTime,this),d.default.logger.log("ProtoLinkWebrtc._onIceGatheringStateChange complete id="+this._id),this._iceComplete=!0,this._postSdp())}},{key:"_onIceCandidate",value:function(e){if(e&&e.candidate&&e.candidate.candidate){var t=e.candidate.candidate;-1===t.indexOf("tcp")&&-1===t.indexOf(".local")&&this._ices.push(e.candidate.candidate)}}},{key:"_onIceCandidateError",value:function(e){1===d.default.config.printWebrtc&&d.default.logger.log("ProtoLinkWebrtc._onIceCandidateError id="+this._id+" error="+e.errorCode+" "+e.errorText+" url="+e.url+" addr="+e.address+" port="+e.port)}},{key:"_onConnectionStateChange",value:function(){d.default.logger.log("ProtoLinkWebrtc._onConnectionStateChange id="+this._id+" state="+this._peer.connectionState),"connected"===this._peer.connectionState&&(this._segTs.connected=d.default.TimeUtil.now())}},{key:"_onIceTime",value:function(){d.default.logger.log("ProtoLinkWebrtc._onIceTime id="+this._id),this._iceComplete=!0,this._postSdp()}},{key:"_onChannelMessage",value:function(e){0===this._segTs.seq&&(this._segTs.seq=d.default.TimeUtil.now(),this.linkHandler&&this._segTs.open>0&&this.linkHandler.onWebrtcCost(m.default.OPEN_SEQ,this._segTs.seq-this._segTs.open)),this.linkHandler&&this.linkHandler.onData(e.data)}},{key:"_onChannelOpen",value:function(e){d.default.logger.log("ProtoLinkWebrtc._onChannelOpen id="+this._id+" readyState="+this._channel.readyState),this._channel.readyState===c.default.OPEN&&(this._segTs.open=d.default.TimeUtil.now(),this.linkHandler&&this._segTs.anwser>0&&this.linkHandler.onWebrtcCost(m.default.ANSWER_OPEN,this._segTs.open-this._segTs.anwser),this.onopen())}},{key:"_onChannelClose",value:function(e){d.default.logger.log("ProtoLinkWebrtc._onChannelClose id="+this._id+" "+e.message),this._failReason=p.default.CHANNEL_CLOSE,this.onclose(e)}},{key:"_onChannelError",value:function(e){d.default.logger.log("ProtoLinkWebrtc._onChannelError id="+this._id+" isOpen="+(this._segTs.open>0)+" state="+this._channel.readyState+" "+e.message),this._failReason=p.default.CHANNEL_ERR,this.onerror(e,_.default.CHANNEL_ERR)}},{key:"_postSdp",value:function(){if(""!==this._desc&&this._iceComplete&&!this._sendedSdp){this._sendedSdp=!0,this._segTs.offer=d.default.TimeUtil.now(),this.linkHandler&&this._segTs.start>0&&this.linkHandler.onWebrtcCost(m.default.START_OFFER,this._segTs.offer-this._segTs.start);var e={candidates:this._ices.slice(),sdp:this._desc};e=(0,i.default)(e),1===d.default.config.printWebrtc&&d.default.logger.log("ProtoLinkWebrtc._postSdp id="+this._id+" "+e),e=f.default.gzip(e);var t=this.url.replace("webrtc://","https://"),n=new XMLHttpRequest;this._xhr=n,n.responseType="text",n.onload=this._onXhrLoadBind,n.onerror=this._onXhrErrorBind,n.onloadend=this._onXhrLoadendBind,n.open("POST",t,!0),n.send(e)}}},{key:"_onXhrLoad",value:function(e){var t=this;this._segTs.anwser=d.default.TimeUtil.now(),this.linkHandler&&this._segTs.offer>0&&this.linkHandler.onWebrtcCost(m.default.OFFER_ANSWER,this._segTs.anwser-this._segTs.offer);var n=null;try{n=e.currentTarget.responseText,n=JSON.parse(n)}catch(t){n=null,d.default.logger.log("ProtoLinkWebrtc._onXhrLoad id="+this._id+" error: "+t.message+" response="+e.currentTarget.responseText),this._failReason=p.default.RESPONSE_ERR,this.onerror(e,_.default.RESPONSE_ERR)}if(n&&n.sdp&&n.candidates){if(1===d.default.config.printWebrtc&&d.default.logger.log("ProtoLinkWebrtc._onXhrLoad id="+this._id+" rsp="+e.currentTarget.responseText),this._peer){var i=new S({type:"answer",sdp:n.sdp});this._peer.setRemoteDescription(i).then(function(){n.candidates.forEach(function(e){var n=new y({candidate:e,sdpMLineIndex:0});t._peer.addIceCandidate(n)})}).catch(function(e){d.default.logger.log("ProtoLinkWebrtc._onXhrLoad id="+t._id+" setRemoteDescription error: "+e.message),t.onerror(e,_.default.ANWSER_ERR)})}}else this._failReason=p.default.RESPONSE_ERR,this.onerror(e,_.default.RESPONSE_ERR),d.default.logger.log("ProtoLinkWebrtc._onXhrLoad id="+this._id+" rsp="+e.currentTarget.responseText)}},{key:"_onXhrError",value:function(e){d.default.logger.log("ProtoLinkWebrtc._onXhrError id="+this._id+" error: "+e.message),this._failReason=p.default.XHR_ERR,this.onerror(e,_.default.XHR_ERR)}},{key:"_onXhrLoadend",value:function(e){404===e.currentTarget.status&&(d.default.logger.log("ProtoLinkWebrtc._onXhrLoadend id="+this._id+" 404 error: "+e.message),this.onerror(e,_.default.XHR_404))}},{key:"_onXhrTime",value:function(){d.default.logger.log("ProtoLinkWebrtc._onXhrTime id="+this._id+" 408"),this._failReason=p.default.XHR_TIMEOUT,this.onerror({message:"xhr timeout"},_.default.XHR_TIMEOUT)}},{key:"_isTestErr",value:function(e){return localStorage._testWebrtcErr==e}}]),t}(h.default)},function(e,t,n){var i={};(0,n(17).assign)(i,n(222),n(225),n(149)),e.exports=i},function(e,t,n){var i=n(223),s=n(17),r=n(147),a=n(85),o=n(148),u=Object.prototype.toString;function l(e){if(!(this instanceof l))return new l(e);this.options=s.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t,n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var d=i.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(0!==d)throw Error(a[d]);if(n.header&&i.deflateSetHeader(this.strm,n.header),n.dictionary){if(t="string"==typeof n.dictionary?r.string2buf(n.dictionary):"[object ArrayBuffer]"===u.call(n.dictionary)?new Uint8Array(n.dictionary):n.dictionary,0!==(d=i.deflateSetDictionary(this.strm,t)))throw Error(a[d]);this._dict_set=!0}}function d(e,t){var n=new l(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}l.prototype.push=function(e,t){var n,a,o=this.strm,l=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:4*(!0===t),"string"==typeof e?o.input=r.string2buf(e):"[object ArrayBuffer]"===u.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new s.Buf8(l),o.next_out=0,o.avail_out=l),1!==(n=i.deflate(o,a))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(r.buf2binstring(s.shrinkBuf(o.output,o.next_out))):this.onData(s.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&1!==n);return 4===a?(n=i.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==a||(this.onEnd(0),o.avail_out=0,!0)},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=l,t.deflate=d,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,d(e,t)}},function(e,t,n){var i,s=n(17),r=n(224),a=n(145),o=n(146),u=n(85);function l(e,t){return e.msg=u[t],t}function d(e){return(e<<1)-9*(e>4)}function h(e){for(var t=e.length;--t>=0;)e[t]=0}function c(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(s.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function f(e,t){r._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,c(e.strm)}function p(e,t){e.pending_buf[e.pending++]=t}function m(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function _(e,t){var n,i,s=e.max_chain_length,r=e.strstart,a=e.prev_length,o=e.nice_match,u=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,l=e.window,d=e.w_mask,h=e.prev,c=e.strstart+258,f=l[r+a-1],p=l[r+a];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do if(l[(n=t)+a]===p&&l[n+a-1]===f&&l[n]===l[r]&&l[++n]===l[r+1]){r+=2,n++;do;while(l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&r<c);if(i=258-(c-r),r=c-258,i>a){if(e.match_start=t,a=i,i>=o)break;f=l[r+a-1],p=l[r+a]}}while((t=h[t&d])>u&&0!=--s);return a<=e.lookahead?a:e.lookahead}function v(e){var t,n,i,r,u,l,d,h,c,f,p=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-262)){s.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=n=e.hash_size;do i=e.head[--t],e.head[t]=i>=p?i-p:0;while(--n);t=n=p;do i=e.prev[--t],e.prev[t]=i>=p?i-p:0;while(--n);r+=p}if(0===e.strm.avail_in)break;if(l=e.strm,d=e.window,h=e.strstart+e.lookahead,c=r,f=void 0,(f=l.avail_in)>c&&(f=c),n=0===f?0:(l.avail_in-=f,s.arraySet(d,l.input,l.next_in,f,h),1===l.state.wrap?l.adler=a(l.adler,d,f,h):2===l.state.wrap&&(l.adler=o(l.adler,d,f,h)),l.next_in+=f,l.total_in+=f,f),e.lookahead+=n,e.lookahead+e.insert>=3)for(u=e.strstart-e.insert,e.ins_h=e.window[u],e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+3-1])&e.hash_mask,e.prev[u&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=u,u++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function g(e,t){for(var n,i;;){if(e.lookahead<262){if(v(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-262&&(e.match_length=_(e,n)),e.match_length>=3)if(i=r._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function y(e,t){for(var n,i,s;;){if(e.lookahead<262){if(v(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-262&&(e.match_length=_(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,i=r._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(f(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=r._tr_tally(e,0,e.window[e.strstart-1]))&&f(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=r._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function S(e,t,n,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=s}function b(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(1146),this.dyn_dtree=new s.Buf16(122),this.bl_tree=new s.Buf16(78),h(this.dyn_ltree),h(this.dyn_dtree),h(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(16),this.heap=new s.Buf16(573),h(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(573),h(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function P(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=+(2!==t.wrap),t.last_flush=0,r._tr_init(t),0):l(e,-2)}function k(e){var t,n=P(e);return 0===n&&((t=e.state).window_size=2*t.w_size,h(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function I(e,t,n,i,r,a){if(!e)return -2;var o=1;if(-1===t&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),r<1||r>9||8!==n||i<8||i>15||t<0||t>9||a<0||a>4)return l(e,-2);8===i&&(i=9);var u=new b;return e.state=u,u.strm=e,u.wrap=o,u.gzhead=null,u.w_bits=i,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=r+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new s.Buf8(2*u.w_size),u.head=new s.Buf16(u.hash_size),u.prev=new s.Buf16(u.w_size),u.lit_bufsize=1<<r+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new s.Buf8(u.pending_buf_size),u.d_buf=+u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=t,u.strategy=a,u.method=n,k(e)}i=[new S(0,0,0,0,function(e,t){var n=65535;for(65535>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(v(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,f(e,!1),0===e.strm.avail_out)||e.strstart-e.block_start>=e.w_size-262&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(f(e,!1),e.strm.avail_out),1)}),new S(4,4,8,4,g),new S(4,5,16,8,g),new S(4,6,32,32,g),new S(4,4,16,16,y),new S(8,16,32,32,y),new S(8,16,128,128,y),new S(8,32,128,256,y),new S(32,128,258,1024,y),new S(32,258,258,4096,y)],t.deflateInit=function(e,t){return I(e,t,8,15,8,0)},t.deflateInit2=I,t.deflateReset=k,t.deflateResetKeep=P,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},t.deflate=function(e,t){var n,s,a,u;if(!e||!e.state||t>5||t<0)return e?l(e,-2):-2;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||666===s.status&&4!==t)return l(e,0===e.avail_out?-5:-2);if(s.strm=e,n=s.last_flush,s.last_flush=t,42===s.status)if(2===s.wrap)e.adler=0,p(s,31),p(s,139),p(s,8),s.gzhead?(p(s,+!!s.gzhead.text+2*!!s.gzhead.hcrc+4*!!s.gzhead.extra+8*!!s.gzhead.name+16*!!s.gzhead.comment),p(s,255&s.gzhead.time),p(s,s.gzhead.time>>8&255),p(s,s.gzhead.time>>16&255),p(s,s.gzhead.time>>24&255),p(s,9===s.level?2:4*(s.strategy>=2||s.level<2)),p(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(p(s,255&s.gzhead.extra.length),p(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=o(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(p(s,0),p(s,0),p(s,0),p(s,0),p(s,0),p(s,9===s.level?2:4*(s.strategy>=2||s.level<2)),p(s,3),s.status=113);else{var _=8+(s.w_bits-8<<4)<<8;_|=(s.strategy>=2||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(_|=32),_+=31-_%31,s.status=113,m(s,_),0!==s.strstart&&(m(s,e.adler>>>16),m(s,65535&e.adler)),e.adler=1}if(69===s.status)if(s.gzhead.extra){for(a=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>a&&(e.adler=o(e.adler,s.pending_buf,s.pending-a,a)),c(e),a=s.pending,s.pending!==s.pending_buf_size));)p(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>a&&(e.adler=o(e.adler,s.pending_buf,s.pending-a,a)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){a=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>a&&(e.adler=o(e.adler,s.pending_buf,s.pending-a,a)),c(e),a=s.pending,s.pending===s.pending_buf_size)){u=1;break}u=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,p(s,u)}while(0!==u);s.gzhead.hcrc&&s.pending>a&&(e.adler=o(e.adler,s.pending_buf,s.pending-a,a)),0===u&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){a=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>a&&(e.adler=o(e.adler,s.pending_buf,s.pending-a,a)),c(e),a=s.pending,s.pending===s.pending_buf_size)){u=1;break}u=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,p(s,u)}while(0!==u);s.gzhead.hcrc&&s.pending>a&&(e.adler=o(e.adler,s.pending_buf,s.pending-a,a)),0===u&&(s.status=103)}else s.status=103;if(103===s.status&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&c(e),s.pending+2<=s.pending_buf_size&&(p(s,255&e.adler),p(s,e.adler>>8&255),e.adler=0,s.status=113)):s.status=113),0!==s.pending){if(c(e),0===e.avail_out)return s.last_flush=-1,0}else if(0===e.avail_in&&d(t)<=d(n)&&4!==t)return l(e,-5);if(666===s.status&&0!==e.avail_in)return l(e,-5);if(0!==e.avail_in||0!==s.lookahead||0!==t&&666!==s.status){var g=2===s.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(v(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(s,t):3===s.strategy?function(e,t){for(var n,i,s,a,o=e.window;;){if(e.lookahead<=258){if(v(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=o[s=e.strstart-1])===o[++s]&&i===o[++s]&&i===o[++s]){a=e.strstart+258;do;while(i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&s<a);e.match_length=258-(a-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=r._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(s,t):i[s.level].func(s,t);if(3!==g&&4!==g||(s.status=666),1===g||3===g)return 0===e.avail_out&&(s.last_flush=-1),0;if(2===g&&(1===t?r._tr_align(s):5!==t&&(r._tr_stored_block(s,0,0,!1),3===t&&(h(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),c(e),0===e.avail_out))return s.last_flush=-1,0}return 4!==t?0:s.wrap<=0?1:(2===s.wrap?(p(s,255&e.adler),p(s,e.adler>>8&255),p(s,e.adler>>16&255),p(s,e.adler>>24&255),p(s,255&e.total_in),p(s,e.total_in>>8&255),p(s,e.total_in>>16&255),p(s,e.total_in>>24&255)):(m(s,e.adler>>>16),m(s,65535&e.adler)),c(e),s.wrap>0&&(s.wrap=-s.wrap),+(0===s.pending))},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?l(e,-2):(e.state=null,113===t?l(e,-3):0):-2},t.deflateSetDictionary=function(e,t){var n,i,r,o,u,l,d,c,f=t.length;if(!e||!e.state||2===(o=(n=e.state).wrap)||1===o&&42!==n.status||n.lookahead)return -2;for(1===o&&(e.adler=a(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===o&&(h(n.head),n.strstart=0,n.block_start=0,n.insert=0),c=new s.Buf8(n.w_size),s.arraySet(c,t,f-n.w_size,n.w_size,0),t=c,f=n.w_size),u=e.avail_in,l=e.next_in,d=e.input,e.avail_in=f,e.next_in=0,e.input=t,v(n);n.lookahead>=3;){i=n.strstart,r=n.lookahead-2;do n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+3-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++;while(--r);n.strstart=i,n.lookahead=2,v(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=l,e.input=d,e.avail_in=u,n.wrap=o,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){var i=n(17);function s(e){for(var t=e.length;--t>=0;)e[t]=0}var r=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],a=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],u=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],l=Array(576);s(l);var d=Array(60);s(d);var h=Array(512);s(h);var c=Array(256);s(c);var f=Array(29);s(f);var p,m,_,v=Array(30);function g(e,t,n,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}function y(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function S(e){return e<256?h[e]:h[256+(e>>>7)]}function b(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function P(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,b(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function k(e,t,n){P(e,n[2*t],n[2*t+1])}function I(e,t){var n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1}function w(e,t,n){var i,s,r=Array(16),a=0;for(i=1;i<=15;i++)r[i]=a=a+n[i-1]<<1;for(s=0;s<=t;s++){var o=e[2*s+1];0!==o&&(e[2*s]=I(r[o]++,o))}}function T(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function C(e){e.bi_valid>8?b(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function x(e,t,n,i){var s=2*t,r=2*n;return e[s]<e[r]||e[s]===e[r]&&i[t]<=i[n]}function R(e,t,n){for(var i=e.heap[n],s=n<<1;s<=e.heap_len&&(s<e.heap_len&&x(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!x(t,i,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=i}function M(e,t,n){var i,s,o,u,l=0;if(0!==e.last_lit)do i=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],s=e.pending_buf[e.l_buf+l],l++,0===i?k(e,s,t):(k(e,(o=c[s])+256+1,t),0!==(u=r[o])&&P(e,s-=f[o],u),k(e,o=S(--i),n),0!==(u=a[o])&&P(e,i-=v[o],u));while(l<e.last_lit);k(e,256,t)}function U(e,t){var n,i,s,r=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,u=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<u;n++)0!==r[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):r[2*n+1]=0;for(;e.heap_len<2;)r[2*(s=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[s]=0,e.opt_len--,o&&(e.static_len-=a[2*s+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)R(e,r,n);s=u;do n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],R(e,r,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,r[2*s]=r[2*n]+r[2*i],e.depth[s]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,r[2*n+1]=r[2*i+1]=s,e.heap[1]=s++,R(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,s,r,a,o,u=t.dyn_tree,l=t.max_code,d=t.stat_desc.static_tree,h=t.stat_desc.has_stree,c=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(r=0;r<=15;r++)e.bl_count[r]=0;for(u[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(r=u[2*u[2*(i=e.heap[n])+1]+1]+1)>p&&(r=p,m++),u[2*i+1]=r,i>l||(e.bl_count[r]++,a=0,i>=f&&(a=c[i-f]),o=u[2*i],e.opt_len+=o*(r+a),h&&(e.static_len+=o*(d[2*i+1]+a)));if(0!==m){do{for(r=p-1;0===e.bl_count[r];)r--;e.bl_count[r]--,e.bl_count[r+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(r=p;0!==r;r--)for(i=e.bl_count[r];0!==i;)(s=e.heap[--n])>l||(u[2*s+1]!==r&&(e.opt_len+=(r-u[2*s+1])*u[2*s],u[2*s+1]=r),i--)}}(e,t),w(r,l,e.bl_count)}function N(e,t,n){var i,s,r=-1,a=t[1],o=0,u=7,l=4;for(0===a&&(u=138,l=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)s=a,a=t[2*(i+1)+1],++o<u&&s===a||(o<l?e.bl_tree[2*s]+=o:0!==s?(s!==r&&e.bl_tree[2*s]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,r=s,0===a?(u=138,l=3):s===a?(u=6,l=3):(u=7,l=4))}function E(e,t,n){var i,s,r=-1,a=t[1],o=0,u=7,l=4;for(0===a&&(u=138,l=3),i=0;i<=n;i++)if(s=a,a=t[2*(i+1)+1],!(++o<u&&s===a)){if(o<l)do k(e,s,e.bl_tree);while(0!=--o);else 0!==s?(s!==r&&(k(e,s,e.bl_tree),o--),k(e,16,e.bl_tree),P(e,o-3,2)):o<=10?(k(e,17,e.bl_tree),P(e,o-3,3)):(k(e,18,e.bl_tree),P(e,o-11,7));o=0,r=s,0===a?(u=138,l=3):s===a?(u=6,l=3):(u=7,l=4)}}s(v);var L=!1;function O(e,t,n,s){P(e,0+ +!!s,3),C(e),b(e,n),b(e,~n),i.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}t._tr_init=function(e){L||(function(){var e,t,n,i,s,u=Array(16);for(n=0,i=0;i<28;i++)for(f[i]=n,e=0;e<1<<r[i];e++)c[n++]=i;for(c[n-1]=i,s=0,i=0;i<16;i++)for(v[i]=s,e=0;e<1<<a[i];e++)h[s++]=i;for(s>>=7;i<30;i++)for(v[i]=s<<7,e=0;e<1<<a[i]-7;e++)h[256+s++]=i;for(t=0;t<=15;t++)u[t]=0;for(e=0;e<=143;)l[2*e+1]=8,e++,u[8]++;for(;e<=255;)l[2*e+1]=9,e++,u[9]++;for(;e<=279;)l[2*e+1]=7,e++,u[7]++;for(;e<=287;)l[2*e+1]=8,e++,u[8]++;for(w(l,287,u),e=0;e<30;e++)d[2*e+1]=5,d[2*e]=I(e,5);p=new g(l,r,257,286,15),m=new g(d,a,0,30,15),_=new g([],o,0,19,7)}(),L=!0),e.l_desc=new y(e.dyn_ltree,p),e.d_desc=new y(e.dyn_dtree,m),e.bl_desc=new y(e.bl_tree,_),e.bi_buf=0,e.bi_valid=0,T(e)},t._tr_stored_block=O,t._tr_flush_block=function(e,t,n,i){var s,r,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=0xf3ffc07f;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),U(e,e.l_desc),U(e,e.d_desc),a=function(e){var t;for(N(e,e.dyn_ltree,e.l_desc.max_code),N(e,e.dyn_dtree,e.d_desc.max_code),U(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*u[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),s=e.opt_len+3+7>>>3,(r=e.static_len+3+7>>>3)<=s&&(s=r)):s=r=n+5,n+4<=s&&-1!==t?O(e,t,n,i):4===e.strategy||r===s?(P(e,2+ +!!i,3),M(e,l,d)):(P(e,4+ +!!i,3),function(e,t,n,i){var s;for(P(e,t-257,5),P(e,n-1,5),P(e,i-4,4),s=0;s<i;s++)P(e,e.bl_tree[2*u[s]+1],3);E(e,e.dyn_ltree,t-1),E(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),M(e,e.dyn_ltree,e.dyn_dtree)),T(e),i&&C(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(c[n]+256+1)]++,e.dyn_dtree[2*S(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){P(e,2,3),k(e,256,l),16===e.bi_valid?(b(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}},function(e,t,n){var i=n(226),s=n(17),r=n(147),a=n(149),o=n(85),u=n(148),l=n(229),d=Object.prototype.toString;function h(e){if(!(this instanceof h))return new h(e);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=i.inflateInit2(this.strm,t.windowBits);if(n!==a.Z_OK||(this.header=new l,i.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=r.string2buf(t.dictionary):"[object ArrayBuffer]"===d.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=i.inflateSetDictionary(this.strm,t.dictionary))!==a.Z_OK)))throw Error(o[n])}function c(e,t){var n=new h(t);if(n.push(e,!0),n.err)throw n.msg||o[n.err];return n.result}h.prototype.push=function(e,t){var n,o,u,l,h,c=this.strm,f=this.options.chunkSize,p=this.options.dictionary,m=!1;if(this.ended)return!1;o=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?c.input=r.binstring2buf(e):"[object ArrayBuffer]"===d.call(e)?c.input=new Uint8Array(e):c.input=e,c.next_in=0,c.avail_in=c.input.length;do{if(0===c.avail_out&&(c.output=new s.Buf8(f),c.next_out=0,c.avail_out=f),(n=i.inflate(c,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&p&&(n=i.inflateSetDictionary(this.strm,p)),n===a.Z_BUF_ERROR&&!0===m&&(n=a.Z_OK,m=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;c.next_out&&(0!==c.avail_out&&n!==a.Z_STREAM_END&&(0!==c.avail_in||o!==a.Z_FINISH&&o!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(u=r.utf8border(c.output,c.next_out),l=c.next_out-u,h=r.buf2string(c.output,u),c.next_out=l,c.avail_out=f-l,l&&s.arraySet(c.output,c.output,u,l,0),this.onData(h)):this.onData(s.shrinkBuf(c.output,c.next_out)))),0===c.avail_in&&0===c.avail_out&&(m=!0)}while((c.avail_in>0||0===c.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(o=a.Z_FINISH),o===a.Z_FINISH?(n=i.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):o!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),c.avail_out=0,!0)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=h,t.inflate=c,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,c(e,t)},t.ungzip=c},function(e,t,n){var i=n(17),s=n(145),r=n(146),a=n(227),o=n(228);function u(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function l(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function d(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(852),t.distcode=t.distdyn=new i.Buf32(592),t.sane=1,t.back=-1,0):-2}function h(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,d(e)):-2}function c(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,h(e))):-2}function f(e,t){var n,i;return e?(e.state=i=new l,i.window=null,0!==(n=c(e,t))&&(e.state=null),n):-2}var p,m,_=!0;function v(e,t,n,s){var r,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new i.Buf8(a.wsize)),s>=a.wsize?(i.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((r=a.wsize-a.wnext)>s&&(r=s),i.arraySet(a.window,t,n-s,r,a.wnext),(s-=r)?(i.arraySet(a.window,t,n-s,s,0),a.wnext=s,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0}t.inflateReset=h,t.inflateReset2=c,t.inflateResetKeep=d,t.inflateInit=function(e){return f(e,15)},t.inflateInit2=f,t.inflate=function(e,t){var n,l,d,h,c,f,g,y,S,b,P,k,I,w,T,C,x,R,M,U,N,E,L,O,D=0,A=new i.Buf8(4),q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return -2;12===(n=e.state).mode&&(n.mode=13),c=e.next_out,d=e.output,g=e.avail_out,h=e.next_in,l=e.input,f=e.avail_in,y=n.hold,S=n.bits,b=f,P=g,E=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;S<16;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(2&n.wrap&&35615===y){n.check=0,A[0]=255&y,A[1]=y>>>8&255,n.check=r(n.check,A,2,0),y=0,S=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&y)){e.msg="unknown compression method",n.mode=30;break}if(S-=4,N=8+(15&(y>>>=4)),0===n.wbits)n.wbits=N;else if(N>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<N,e.adler=n.check=1,n.mode=512&y?10:12,y=0,S=0;break;case 2:for(;S<16;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(n.flags=y,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=y>>8&1),512&n.flags&&(A[0]=255&y,A[1]=y>>>8&255,n.check=r(n.check,A,2,0)),y=0,S=0,n.mode=3;case 3:for(;S<32;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}n.head&&(n.head.time=y),512&n.flags&&(A[0]=255&y,A[1]=y>>>8&255,A[2]=y>>>16&255,A[3]=y>>>24&255,n.check=r(n.check,A,4,0)),y=0,S=0,n.mode=4;case 4:for(;S<16;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}n.head&&(n.head.xflags=255&y,n.head.os=y>>8),512&n.flags&&(A[0]=255&y,A[1]=y>>>8&255,n.check=r(n.check,A,2,0)),y=0,S=0,n.mode=5;case 5:if(1024&n.flags){for(;S<16;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}n.length=y,n.head&&(n.head.extra_len=y),512&n.flags&&(A[0]=255&y,A[1]=y>>>8&255,n.check=r(n.check,A,2,0)),y=0,S=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((k=n.length)>f&&(k=f),k&&(n.head&&(N=n.head.extra_len-n.length,n.head.extra||(n.head.extra=Array(n.head.extra_len)),i.arraySet(n.head.extra,l,h,k,N)),512&n.flags&&(n.check=r(n.check,l,k,h)),f-=k,h+=k,n.length-=k),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===f)break e;k=0;do N=l[h+k++],n.head&&N&&n.length<65536&&(n.head.name+=String.fromCharCode(N));while(N&&k<f);if(512&n.flags&&(n.check=r(n.check,l,k,h)),f-=k,h+=k,N)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===f)break e;k=0;do N=l[h+k++],n.head&&N&&n.length<65536&&(n.head.comment+=String.fromCharCode(N));while(N&&k<f);if(512&n.flags&&(n.check=r(n.check,l,k,h)),f-=k,h+=k,N)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;S<16;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(y!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}y=0,S=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;S<32;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}e.adler=n.check=u(y),y=0,S=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=c,e.avail_out=g,e.next_in=h,e.avail_in=f,n.hold=y,n.bits=S,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){y>>>=7&S,S-=7&S,n.mode=27;break}for(;S<3;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}switch(n.last=1&y,S-=1,3&(y>>>=1)){case 0:n.mode=14;break;case 1:if(function(e){if(_){var t;for(p=new i.Buf32(512),m=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(1,e.lens,0,288,p,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(2,e.lens,0,32,m,0,e.work,{bits:5}),_=!1}e.lencode=p,e.lenbits=9,e.distcode=m,e.distbits=5}(n),n.mode=20,6===t){y>>>=2,S-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}y>>>=2,S-=2;break;case 14:for(y>>>=7&S,S-=7&S;S<32;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&y,y=0,S=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(k=n.length){if(k>f&&(k=f),k>g&&(k=g),0===k)break e;i.arraySet(d,l,h,k,c),f-=k,h+=k,g-=k,c+=k,n.length-=k;break}n.mode=12;break;case 17:for(;S<14;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(n.nlen=257+(31&y),S-=5,n.ndist=1+(31&(y>>>=5)),S-=5,n.ncode=4+(15&(y>>>=5)),y>>>=4,S-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;S<3;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}n.lens[q[n.have++]]=7&y,y>>>=3,S-=3}for(;n.have<19;)n.lens[q[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,L={bits:n.lenbits},E=o(0,n.lens,0,19,n.lencode,0,n.work,L),n.lenbits=L.bits,E){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;C=(D=n.lencode[y&(1<<n.lenbits)-1])>>>16&255,x=65535&D,!((T=D>>>24)<=S);){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(x<16)y>>>=T,S-=T,n.lens[n.have++]=x;else{if(16===x){for(O=T+2;S<O;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(y>>>=T,S-=T,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}N=n.lens[n.have-1],k=3+(3&y),y>>>=2,S-=2}else if(17===x){for(O=T+3;S<O;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}S-=T,N=0,k=3+(7&(y>>>=T)),y>>>=3,S-=3}else{for(O=T+7;S<O;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}S-=T,N=0,k=11+(127&(y>>>=T)),y>>>=7,S-=7}if(n.have+k>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;k--;)n.lens[n.have++]=N}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,L={bits:n.lenbits},E=o(1,n.lens,0,n.nlen,n.lencode,0,n.work,L),n.lenbits=L.bits,E){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,L={bits:n.distbits},E=o(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,L),n.distbits=L.bits,E){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(f>=6&&g>=258){e.next_out=c,e.avail_out=g,e.next_in=h,e.avail_in=f,n.hold=y,n.bits=S,a(e,P),c=e.next_out,d=e.output,g=e.avail_out,h=e.next_in,l=e.input,f=e.avail_in,y=n.hold,S=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;C=(D=n.lencode[y&(1<<n.lenbits)-1])>>>16&255,x=65535&D,!((T=D>>>24)<=S);){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(C&&0==(240&C)){for(R=T,M=C,U=x;C=(D=n.lencode[U+((y&(1<<R+M)-1)>>R)])>>>16&255,x=65535&D,!(R+(T=D>>>24)<=S);){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}y>>>=R,S-=R,n.back+=R}if(y>>>=T,S-=T,n.back+=T,n.length=x,0===C){n.mode=26;break}if(32&C){n.back=-1,n.mode=12;break}if(64&C){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&C,n.mode=22;case 22:if(n.extra){for(O=n.extra;S<O;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}n.length+=y&(1<<n.extra)-1,y>>>=n.extra,S-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;C=(D=n.distcode[y&(1<<n.distbits)-1])>>>16&255,x=65535&D,!((T=D>>>24)<=S);){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(0==(240&C)){for(R=T,M=C,U=x;C=(D=n.distcode[U+((y&(1<<R+M)-1)>>R)])>>>16&255,x=65535&D,!(R+(T=D>>>24)<=S);){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}y>>>=R,S-=R,n.back+=R}if(y>>>=T,S-=T,n.back+=T,64&C){e.msg="invalid distance code",n.mode=30;break}n.offset=x,n.extra=15&C,n.mode=24;case 24:if(n.extra){for(O=n.extra;S<O;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}n.offset+=y&(1<<n.extra)-1,y>>>=n.extra,S-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===g)break e;if(k=P-g,n.offset>k){if((k=n.offset-k)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}k>n.wnext?(k-=n.wnext,I=n.wsize-k):I=n.wnext-k,k>n.length&&(k=n.length),w=n.window}else w=d,I=c-n.offset,k=n.length;k>g&&(k=g),g-=k,n.length-=k;do d[c++]=w[I++];while(--k);0===n.length&&(n.mode=21);break;case 26:if(0===g)break e;d[c++]=n.length,g--,n.mode=21;break;case 27:if(n.wrap){for(;S<32;){if(0===f)break e;f--,y|=l[h++]<<S,S+=8}if(P-=g,e.total_out+=P,n.total+=P,P&&(e.adler=n.check=n.flags?r(n.check,d,P,c-P):s(n.check,d,P,c-P)),P=g,(n.flags?y:u(y))!==n.check){e.msg="incorrect data check",n.mode=30;break}y=0,S=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;S<32;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(y!==(0|n.total)){e.msg="incorrect length check",n.mode=30;break}y=0,S=0}n.mode=29;case 29:E=1;break e;case 30:E=-3;break e;case 31:return -4;default:return -2}return e.next_out=c,e.avail_out=g,e.next_in=h,e.avail_in=f,n.hold=y,n.bits=S,(n.wsize||P!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&v(e,e.output,e.next_out,P-e.avail_out)?(n.mode=31,-4):(b-=e.avail_in,P-=e.avail_out,e.total_in+=b,e.total_out+=P,n.total+=P,n.wrap&&P&&(e.adler=n.check=n.flags?r(n.check,d,P,e.next_out-P):s(n.check,d,P,e.next_out-P)),e.data_type=n.bits+64*!!n.last+128*(12===n.mode)+256*(20===n.mode||15===n.mode),(0===b&&0===P||4===t)&&0===E&&(E=-5),E)},t.inflateEnd=function(e){if(!e||!e.state)return -2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?-2:(n.head=t,t.done=!1,0):-2},t.inflateSetDictionary=function(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&s(1,t,i,0)!==n.check?-3:v(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,0):-2},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){e.exports=function(e,t){var n,i,s,r,a,o,u,l,d,h,c,f,p,m,_,v,g,y,S,b,P,k,I,w,T;n=e.state,i=e.next_in,w=e.input,s=i+(e.avail_in-5),r=e.next_out,T=e.output,a=r-(t-e.avail_out),o=r+(e.avail_out-257),u=n.dmax,l=n.wsize,d=n.whave,h=n.wnext,c=n.window,f=n.hold,p=n.bits,m=n.lencode,_=n.distcode,v=(1<<n.lenbits)-1,g=(1<<n.distbits)-1;e:do for(p<15&&(f+=w[i++]<<p,p+=8,f+=w[i++]<<p,p+=8),y=m[f&v];;){if(f>>>=S=y>>>24,p-=S,0==(S=y>>>16&255))T[r++]=65535&y;else{if(!(16&S)){if(0==(64&S)){y=m[(65535&y)+(f&(1<<S)-1)];continue}if(32&S){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}for(b=65535&y,(S&=15)&&(p<S&&(f+=w[i++]<<p,p+=8),b+=f&(1<<S)-1,f>>>=S,p-=S),p<15&&(f+=w[i++]<<p,p+=8,f+=w[i++]<<p,p+=8),y=_[f&g];;){if(f>>>=S=y>>>24,p-=S,!(16&(S=y>>>16&255))){if(0==(64&S)){y=_[(65535&y)+(f&(1<<S)-1)];continue}e.msg="invalid distance code",n.mode=30;break e}if(P=65535&y,p<(S&=15)&&(f+=w[i++]<<p,(p+=8)<S&&(f+=w[i++]<<p,p+=8)),(P+=f&(1<<S)-1)>u){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=S,p-=S,P>(S=r-a)){if((S=P-S)>d&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(k=0,I=c,0===h){if(k+=l-S,S<b){b-=S;do T[r++]=c[k++];while(--S);k=r-P,I=T}}else if(h<S){if(k+=l+h-S,(S-=h)<b){b-=S;do T[r++]=c[k++];while(--S);if(k=0,h<b){b-=S=h;do T[r++]=c[k++];while(--S);k=r-P,I=T}}}else if(k+=h-S,S<b){b-=S;do T[r++]=c[k++];while(--S);k=r-P,I=T}for(;b>2;)T[r++]=I[k++],T[r++]=I[k++],T[r++]=I[k++],b-=3;b&&(T[r++]=I[k++],b>1&&(T[r++]=I[k++]))}else{k=r-P;do T[r++]=T[k++],T[r++]=T[k++],T[r++]=T[k++],b-=3;while(b>2);b&&(T[r++]=T[k++],b>1&&(T[r++]=T[k++]))}break}}break}while(i<s&&r<o);i-=b=p>>3,f&=(1<<(p-=b<<3))-1,e.next_in=i,e.next_out=r,e.avail_in=i<s?s-i+5:5-(i-s),e.avail_out=r<o?o-r+257:257-(r-o),n.hold=f,n.bits=p}},function(e,t,n){var i=n(17),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,u,l,d,h,c){var f,p,m,_,v,g,y,S,b,P=c.bits,k=0,I=0,w=0,T=0,C=0,x=0,R=0,M=0,U=0,N=0,E=null,L=0,O=new i.Buf16(16),D=new i.Buf16(16),A=null,q=0;for(k=0;k<=15;k++)O[k]=0;for(I=0;I<u;I++)O[t[n+I]]++;for(C=P,T=15;T>=1&&0===O[T];T--);if(C>T&&(C=T),0===T)return l[d++]=0x1400000,l[d++]=0x1400000,c.bits=1,0;for(w=1;w<T&&0===O[w];w++);for(C<w&&(C=w),M=1,k=1;k<=15;k++)if(M<<=1,(M-=O[k])<0)return -1;if(M>0&&(0===e||1!==T))return -1;for(D[1]=0,k=1;k<15;k++)D[k+1]=D[k]+O[k];for(I=0;I<u;I++)0!==t[n+I]&&(h[D[t[n+I]]++]=I);if(0===e?(E=A=h,g=19):1===e?(E=s,L-=257,A=r,q-=257,g=256):(E=a,A=o,g=-1),N=0,I=0,k=w,v=d,x=C,R=0,m=-1,_=(U=1<<C)-1,1===e&&U>852||2===e&&U>592)return 1;for(;;){y=k-R,h[I]<g?(S=0,b=h[I]):h[I]>g?(S=A[q+h[I]],b=E[L+h[I]]):(S=96,b=0),f=1<<k-R,w=p=1<<x;do l[v+(N>>R)+(p-=f)]=y<<24|S<<16|b;while(0!==p);for(f=1<<k-1;N&f;)f>>=1;if(0!==f?(N&=f-1,N+=f):N=0,I++,0==--O[k]){if(k===T)break;k=t[n+h[I]]}if(k>C&&(N&_)!==m){for(0===R&&(R=C),v+=w,M=1<<(x=k-R);x+R<T&&!((M-=O[x+R])<=0);)x++,M<<=1;if(U+=1<<x,1===e&&U>852||2===e&&U>592)return 1;l[m=N&_]=C<<24|x<<16|v-d}}return 0!==N&&(l[v+N]=k-R<<24|4194304),c.bits=C,0}},function(e,t,n){e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=b(n(25)),s=b(n(0)),r=b(n(1)),a=b(n(7)),o=b(n(150)),u=b(n(72)),l=b(n(73)),d=b(n(69)),h=b(n(70)),c=b(n(77)),f=b(n(75)),p=b(n(76)),m=b(n(71)),_=b(n(67)),v=b(n(68)),g=b(n(66)),y=b(n(74)),S=b(n(32));function b(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,s.default)(this,e),this.subStreamMgr=t,this.cdnpProxy=t.stream.cdnpProxy,this.sInfo=t.sInfo,this.bwCalc=t.stream.bwCalc,this.subMgr=t.subMgr,this.stat=t.stream.stat}return(0,r.default)(e,[{key:"sendSubStream",value:function(e,t,n){this.stat.sub_info.total_cnt++;var i=new u.default;i.uid=a.default.userInfo.uuid,i.baseSubs=this.sInfo.baseSubs,i.streamIndex=t,i.streamSeqSN=this.sInfo.streamSeqSN,i.maxRecvSeq=n,i.uplinkBw=this.bwCalc.getUpBw(),this.subStreamMgr.stream.punchMgr.sendToNode(e,i.marshall(),o.default.SIGNALLING)}},{key:"sendSubStreamRes",value:function(e,t,n,i,s){var r=new l.default;r.uid=a.default.userInfo.uuid,r.streamSeqSN=this.sInfo.streamSeqSN,r.streamIndex=t,r.maxRecvSeq=n,r.streamDelay=s,r.subMinBw=this.subMgr.getSubMinBw(),r.ret=i,this.subStreamMgr.stream.punchMgr.sendToNode(e,r.marshall(),o.default.SIGNALLING)}},{key:"sendRemoveSub",value:function(e,t,n,i){var s=new d.default;s.uid=a.default.userInfo.uuid,s.streamSeqSN=this.sInfo.streamSeqSN,s.streamIndex=t,s.reason=n,s.cdnRtt=this.sInfo.cdnpRtt,s.nodeRtt=this.subStreamMgr.stream.peerMgr.getPeerRtt(e),s.streamDelay=i,this.subStreamMgr.stream.punchMgr.sendToNode(e,s.marshall(),o.default.SIGNALLING)}},{key:"sendRemoveSubRes",value:function(e,t,n){var i=new h.default;i.uid=a.default.userInfo.uuid,i.streamSeqSN=this.sInfo.streamSeqSN,i.streamIndex=t,i.streamDelay=n,i.cdnRtt=this.sInfo.cdnpRtt,i.nodeRtt=this.subStreamMgr.stream.peerMgr.getPeerRtt(e),this.subStreamMgr.stream.punchMgr.sendToNode(e,i.marshall(),o.default.SIGNALLING)}},{key:"sendSubReq",value:function(e,t){var n=new c.default;n.cdnGroupId=this.sInfo.streamId,n.publisher=a.default.userInfo.uuid,n.subscriber=e,n.streamIndex=t,n.streamNum=this.sInfo.baseSubs,n.version=a.default.userInfo.version+"",n.appid=a.default.userInfo.appid,this.cdnpProxy.send(n)}},{key:"sendCompeteReq",value:function(e){a.default.printSubInfo&&a.default.logger.log("StreamProxy.sendCompeteReq",e.join("-"),"remain",this.sInfo.remainP2pStreamNum,"SNBw",this.sInfo.SNBw,"csMinBw",this.sInfo.csMinBw);var t=new f.default;t.cdnGroupId=this.sInfo.streamId,t.subscriber=a.default.userInfo.uuid,t.subStreamIndex=e,t.version=a.default.userInfo.version+"",t.uplinkBw=this.bwCalc.getUpBw(),t.appid=a.default.userInfo.appid,this.cdnpProxy.send(t)}},{key:"sendForceSubscribeNotify",value:function(e){if(e&&e.length>0){var t=new p.default;t.cdnGroupId=this.sInfo.streamId,t.subscriber=a.default.userInfo.uuid,t.subStreamIndex=e,this.cdnpProxy.send(t)}}},{key:"sendStreamAlive",value:function(e,t,n){if(e.length>0){var s=new m.default;s.uid=a.default.userInfo.uuid,s.streamSeqSN=t,s.streamIndex=n;var r=s.marshall(),u=!0,l=!1,d=void 0;try{for(var h,c=(0,i.default)(e);!(u=(h=c.next()).done);u=!0){var f=h.value;this.subStreamMgr.stream.punchMgr.sendToNode(f,r,o.default.SIGNALLING)}}catch(e){l=!0,d=e}finally{try{!u&&c.return&&c.return()}finally{if(l)throw d}}}}},{key:"sendPeerRangeReq",value:function(e){var t=e.nodeUid,n=e.streamIndex,i=e.resendSeqStart,s=e.resendSeqOffsets,r=e.mode,u=new _.default;u.streamSeqSN=this.sInfo.streamSeqSN,u.uid=a.default.userInfo.uuid,u.streamIndex=void 0===n?0:n,u.mode=void 0===r?0:r,u.rangeSeqStart=i,u.rangeSeqOffsets=s,1==localStorage._printPeerRange&&a.default.logger.log("-----------\x3e>>>>>>sendPeerRangeReq toUid="+t,u),this.subStreamMgr.stream.punchMgr.sendToNode(t,u.marshall(),o.default.SIGNALLING)}},{key:"sendRangeRes",value:function(e){var t=e.nodeUid,n=e.streamIndex,i=e.noSeqStart,s=e.noSeqOffsets,r=e.mode,u=new v.default;u.streamSeqSN=this.sInfo.streamSeqSN,u.uid=a.default.userInfo.uuid,u.streamIndex=void 0===n?0:n,u.mode=void 0===r?0:r,u.noSeqStart=i,u.noSeqOffsets=s,1==localStorage._printPeerRange&&a.default.logger.log("-----------\x3e>>>>>>sendRangeRes",u),this.subStreamMgr.stream.punchMgr.sendToNode(t,u.marshall(),o.default.SIGNALLING)}},{key:"sendRangeAskRes",value:function(e){var t=e.nodeUid,n=e.streamIndex,i=e.mode,s=e.per,r=e.askId,u=new g.default;u.streamSeqSN=this.sInfo.streamSeqSN,u.uid=a.default.userInfo.uuid,u.streamIndex=n,u.mode=i,u.per=s,u.askId=r,1==localStorage._printPeerRange&&a.default.logger.log("-----------\x3e>>>>>>sendRangeAskRes",u),this.subStreamMgr.stream.punchMgr.sendToNode(t,u.marshall(),o.default.SIGNALLING)}},{key:"sendSwapSubHole",value:function(e){var t=this,n=e.nodeUids,i=e.streamIndex,s=e.seqStart,r=e.seqOffsets,u=new y.default;u.streamSeqSN=this.sInfo.streamSeqSN,u.uid=a.default.userInfo.uuid,u.streamIndex=i,u.lostSeqStart=s,u.lostSeqOffsets=r;var l=u.marshall();n.forEach(function(e){t.subStreamMgr.stream.punchMgr.sendToNode(e,l,o.default.SIGNALLING)})}},{key:"sendSeqLost",value:function(e,t,n,i,s){var r=this,a=new S.default;a.streamSeqSN=this.sInfo.streamSeqSN,a.streamIndex=e,a.seqStart=n,a.seqOffsets=i,a.from=s;var u=a.marshall();t.forEach(function(e){r.subStreamMgr.stream.punchMgr.sendToNode(e,u,o.default.SIGNALLING)})}}]),e}()}]).default},"object"==(0,S.default)(t)&&"object"==(0,S.default)(e)?e.exports=s():void 0===(i=s.apply(t,[]))||(e.exports=i)}).call(this,n(134)(e))},function(e,t,n){e.exports={default:n(188),__esModule:!0}},function(e,t,n){var i=n(18),s=n(4),r=n(23),a=n(20),o=n(25),u=function(e,t,n){var l,d,h,c=e&u.F,f=e&u.G,p=e&u.S,m=e&u.P,_=e&u.B,v=e&u.W,g=f?s:s[t]||(s[t]={}),y=g.prototype,S=f?i:p?i[t]:(i[t]||{}).prototype;for(l in f&&(n=t),n)(d=!c&&S&&void 0!==S[l])&&o(g,l)||(h=d?S[l]:n[l],g[l]=f&&"function"!=typeof S[l]?n[l]:_&&d?r(h,i):v&&S[l]==h?function(e){var t=function(t,n,i){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,i)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(h):m&&"function"==typeof h?r(Function.call,h):h,m&&((g.virtual||(g.virtual={}))[l]=h,e&u.R&&y&&!y[l]&&a(y,l,h)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t,n){"use strict";t.__esModule=!0;var i=r(n(5)),s=r(n(98));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function e(t,n,r){null===t&&(t=Function.prototype);var a=(0,s.default)(t,n);if(void 0===a){var o=(0,i.default)(t);return null===o?void 0:e(o,n,r)}if("value"in a)return a.value;var u=a.get;return void 0!==u?u.call(r):void 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n(0)),s=l(n(1)),r=n(9),a=l(n(2)),o=l(n(3)),u=l(n(114));function l(e){return e&&e.__esModule?e:{default:e}}var d=0,h=function(){function e(t,n){(0,i.default)(this,e),this.loaderHandler=t,this.sliceProtoHandler=n,this._id=d++,this.type=0,this.url="",this.connecting=!1,this.connectTs=0,this.connectedTs=0,this.firstDataTs=0,this.lastDataTs=0,this.status=0,this.lastSeq=0,this.tryConnectNum=0,this.tryFlowNum=0,this.sliceHandler=new r.SliceHandler(this),this.protoLink=null,this.isClose=!1,this.stunUrl=""}return(0,s.default)(e,[{key:"destroy",value:function(){this.reset(),this.loaderHandler=null,this.protoHandler=null,this.sliceHandler&&(this.sliceHandler.destroy(),this.sliceHandler=null)}},{key:"reset",value:function(){this.protoLink&&(this.protoLink.destroy(),this.protoLink=null),this.sliceHandler&&this.sliceHandler.reset(),this.connecting=!1,this.connectTs=0,this.connectedTs=0,this.firstDataTs=0,this.lastDataTs=0,this.status=0,this.lastSeq=0}},{key:"createProtoLink",value:function(){return null}},{key:"createProtoLinkWebrtc",value:function(){var e=new r.ProtoLinkWebrtc(this);return e.stunUrl=this.stunUrl,e}},{key:"createProtoLinkWs",value:function(){return new r.ProtoLinkWs(this)}},{key:"createProtoLinkHttp",value:function(){return u.default.firefox&&r.ProtoLinkXhrFF.isSupported()?new r.ProtoLinkXhrFF(this):new r.ProtoLinkFetch(this)}},{key:"connect",value:function(e,t){a.default.logger.log("BaseLoader("+this._id+").connect",e,t),this.reset(),this.url=e,this.connectTs=a.default.TimeUtil.now(),this.connecting=!0,this.protoLink=this.createProtoLink(),this.isClose=!1,this.protoLink.connect(e)}},{key:"close",value:function(){this.isClose=!0,this.reset()}},{key:"onSlice",value:function(e){e.from=this.type,0===this.lastSeq&&this.printFirstSeq(e.seq),this.lastSeq=e.seq,this.sliceProtoHandler.onSlice(e)}},{key:"printFirstSeq",value:function(e){a.default.logger.log("BaseLoader("+this._id+").onSlice firstSeq="+e)}},{key:"onProtoErr",value:function(e){a.default.logger.error("BaseLoader("+this._id+").onProto length error pktLen="+e+", smaller than 10 bytes. type",this.type)}},{key:"onopen",value:function(){this.tryConnectNum=0,this.connecting=!1,this.connectedTs=a.default.TimeUtil.now(),this.loaderHandler&&this.loaderHandler.onopen(this)}},{key:"onerror",value:function(e,t){this.loaderHandler&&this.loaderHandler.onerrorBefore(this),this.reset(),this.loaderHandler&&this.loaderHandler.onerror(this,e,t)}},{key:"onclose",value:function(){this.loaderHandler&&this.loaderHandler.oncloseBefore(this),this.reset(),this.loaderHandler&&this.loaderHandler.onclose(this)}},{key:"onstatus",value:function(e){this.status=e,this.loaderHandler&&this.loaderHandler.onstatus(this,e)}},{key:"onheader",value:function(e){this.loaderHandler.onheader&&this.loaderHandler.onheader(this,e)}},{key:"onData",value:function(e){var t=a.default.TimeUtil.now();if(0===this.firstDataTs){this.firstDataTs=t;var n=this.connectedTs-this.connectTs,i=t-this.connectedTs,s=o.default.formatByteSize(e.byteLength);a.default.logger.log("BaseLoader("+this._id+").onData type="+this.type+" connectTime="+n+" firstPkgTs="+i+" size="+s),this.loaderHandler.onFirstData(this)}this.lastDataTs=t,this.protoLink.isWs()?this.sliceHandler.onProto(new Uint8Array(e)):this.sliceHandler.onData(e)}},{key:"isFull",value:function(){return this.type===e.TYPE_FULL}},{key:"isSub",value:function(){return this.type===e.TYPE_SUB}},{key:"isRange",value:function(){return this.type===e.TYPE_RANGE}},{key:"isPatch",value:function(){return this.type===e.TYPE_PATCH}},{key:"isProbe",value:function(){return this.type===e.TYPE_PROBE}}]),e}();h.TYPE_FULL=1,h.TYPE_SUB=2,h.TYPE_RANGE=3,h.TYPE_PATCH=4,h.TYPE_PROBE=5,t.default=h},function(e,t,n){var i=n(65)("wks"),s=n(44),r=n(18).Symbol,a="function"==typeof r;(e.exports=function(e){return i[e]||(i[e]=a&&r[e]||(a?r:s)("Symbol."+e))}).store=i},function(e,t,n){e.exports=!n(24)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var i=n(21),s=n(85),r=n(57),a=Object.defineProperty;t.f=n(15)?Object.defineProperty:function(e,t,n){if(i(e),t=r(t,!0),i(n),s)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={VIDEO_COMPETE_UID:0xffffffff,VIDEO_FORCE_UID:0,VIDEO_FIXED_UID:1,VIDEO_DEFAULT_UID:2,isProxyUid:function(e){return this.isCompete(e)||this.isForce(e)||this.isFixed(e)||this.isDefault(e)},isCompete:function(e){return e===this.VIDEO_COMPETE_UID},isForce:function(e){return e===this.VIDEO_FORCE_UID},isFixed:function(e){return e===this.VIDEO_FIXED_UID},isDefault:function(e){return e===this.VIDEO_DEFAULT_UID}}},function(e,t,n){var i=n(16),s=n(34);e.exports=n(15)?function(e,t,n){return i.f(e,t,s(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var i=n(17);e.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw TypeError(n+"must be non-object");for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var s={arraySet:function(e,t,n,i,s){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),s);else for(var r=0;r<i;r++)e[s+r]=t[n+r]},flattenChunks:function(e){var t,n,i,s,r,a;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),s=0,t=0,n=e.length;t<n;t++)r=e[t],a.set(r,s),s+=r.length;return a}},r={arraySet:function(e,t,n,i,s){for(var r=0;r<i;r++)e[s+r]=t[n+r]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,s)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,r))},t.setTyped(i)},function(e,t,n){var i=n(84);e.exports=function(e,t,n){if(i(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,s){return e.call(t,n,i,s)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var i=n(62),s=n(60);e.exports=function(e){return i(s(e))}},function(e,t,n){var i=n(60);e.exports=function(e){return Object(i(e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(8)),s=o(n(0)),r=o(n(1)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;(0,s.default)(this,e),this.maxSize=t,this.sum=0,this.list=[],this.idx=0,this.cur=0}return(0,r.default)(e,[{key:"reset",value:function(){this.sum=0,this.list=[],this.idx=0,this.cur=0}},{key:"addCur",value:function(e){this.cur+=e}},{key:"calculate",value:function(){this.add(this.cur);var e=this.cur;return this.cur=0,e}},{key:"add",value:function(e){this.sum+=e,this.list.length<this.maxSize?this.list.push(e):(this.sum-=this.list[this.idx],this.list[this.idx]=e),this.idx++,this.idx>=this.maxSize&&(this.idx=0)}},{key:"average",value:function(){return 0===this.list.length?a.default.UintMax:Math.round(this.sum/this.list.length)}},{key:"getSamples",value:function(){return this.list}},{key:"getListSize",value:function(){return this.list.length}},{key:"max",value:function(){if(0===this.list.length)return a.default.UintMax;var e=0,t=!0,n=!1,s=void 0;try{for(var r,o=(0,i.default)(this.list);!(t=(r=o.next()).done);t=!0){var u=r.value;u>e&&(e=u)}}catch(e){n=!0,s=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw s}}return e}},{key:"min",value:function(){var e=0,t=!0,n=!1,s=void 0;try{for(var r,a=(0,i.default)(this.list);!(t=(r=a.next()).done);t=!0){var o=r.value;o<e&&(e=o)}}catch(e){n=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw s}}return e}}]),e}()},function(e,t,n){"use strict";let i={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};i.localCName=i.generateIdentifier(),i.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},i.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},i.getDescription=function(e){let t=i.splitSections(e);return t&&t[0]},i.getMediaSections=function(e){let t=i.splitSections(e);return t.shift(),t},i.matchPrefix=function(e,t){return i.splitLines(e).filter(e=>0===e.indexOf(t))},i.parseCandidate=function(e){let t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},i.writeCandidate=function(e){let t=[];t.push(e.foundation);let n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);let i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},i.parseIceOptions=function(e){return e.substr(14).split(" ")},i.parseRtpMap=function(e){let t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return n.name=(t=t[0].split("/"))[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},i.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);let n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},i.parseExtmap=function(e){let t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},i.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},i.parseFmtp=function(e){let t,n={},i=e.substr(e.indexOf(" ")+1).split(";");for(let e=0;e<i.length;e++)n[(t=i[e].trim().split("="))[0].trim()]=t[1];return n},i.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){let i=[];Object.keys(e.parameters).forEach(t=>{e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)}),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},i.parseRtcpFb=function(e){let t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},i.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},i.parseSsrcMedia=function(e){let t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substr(t+1,i-t-1),n.value=e.substr(i+1)):n.attribute=e.substr(t+1),n},i.parseSsrcGroup=function(e){let t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},i.getMid=function(e){let t=i.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},i.parseFingerprint=function(e){let t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},i.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:i.matchPrefix(e+t,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},i.parseCryptoLine=function(e){let t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},i.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?i.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},i.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;let t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},i.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},i.getCryptoParameters=function(e,t){return i.matchPrefix(e+t,"a=crypto:").map(i.parseCryptoLine)},i.getIceParameters=function(e,t){let n=i.matchPrefix(e+t,"a=ice-ufrag:")[0],s=i.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&s?{usernameFragment:n.substr(12),password:s.substr(10)}:null},i.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},i.parseRtpParameters=function(e){let t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=i.splitLines(e)[0].split(" ");for(let s=3;s<n.length;s++){let r=n[s],a=i.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(a){let n=i.parseRtpMap(a),s=i.matchPrefix(e,"a=fmtp:"+r+" ");switch(n.parameters=s.length?i.parseFmtp(s[0]):{},n.rtcpFeedback=i.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(i.parseRtcpFb),t.codecs.push(n),n.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(n.name.toUpperCase())}}}return i.matchPrefix(e,"a=extmap:").forEach(e=>{t.headerExtensions.push(i.parseExtmap(e))}),t},i.writeRtpDescription=function(e,t){let n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(e=>{n+=i.writeRtpMap(e),n+=i.writeFmtp(e),n+=i.writeRtcpFb(e)});let s=0;return t.codecs.forEach(e=>{e.maxptime>s&&(s=e.maxptime)}),s>0&&(n+="a=maxptime:"+s+"\r\n"),t.headerExtensions&&t.headerExtensions.forEach(e=>{n+=i.writeExtmap(e)}),n},i.parseRtpEncodingParameters=function(e){let t,n=[],s=i.parseRtpParameters(e),r=-1!==s.fecMechanisms.indexOf("RED"),a=-1!==s.fecMechanisms.indexOf("ULPFEC"),o=i.matchPrefix(e,"a=ssrc:").map(e=>i.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),u=o.length>0&&o[0].ssrc,l=i.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substr(17).split(" ").map(e=>parseInt(e,10)));l.length>0&&l[0].length>1&&l[0][0]===u&&(t=l[0][1]),s.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let i={ssrc:u,codecPayloadType:parseInt(e.parameters.apt,10)};u&&t&&(i.rtx={ssrc:t}),n.push(i),r&&((i=JSON.parse(JSON.stringify(i))).fec={ssrc:u,mechanism:a?"red+ulpfec":"red"},n.push(i))}}),0===n.length&&u&&n.push({ssrc:u});let d=i.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,n.forEach(e=>{e.maxBitrate=d})),n},i.parseRtcpParameters=function(e){let t={},n=i.matchPrefix(e,"a=ssrc:").map(e=>i.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);let s=i.matchPrefix(e,"a=rtcp-rsize");return t.reducedSize=s.length>0,t.compound=0===s.length,t.mux=i.matchPrefix(e,"a=rtcp-mux").length>0,t},i.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},i.parseMsid=function(e){let t,n=i.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};let s=i.matchPrefix(e,"a=ssrc:").map(e=>i.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return s.length>0?{stream:(t=s[0].value.split(" "))[0],track:t[1]}:void 0},i.parseSctpDescription=function(e){let t,n=i.parseMLine(e),s=i.matchPrefix(e,"a=max-message-size:");s.length>0&&(t=parseInt(s[0].substr(19),10)),isNaN(t)&&(t=65536);let r=i.matchPrefix(e,"a=sctp-port:");if(r.length>0)return{port:parseInt(r[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};let a=i.matchPrefix(e,"a=sctpmap:");if(a.length>0){let e=a[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:t}}},i.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},i.generateSessionId=function(){return Math.random().toString().substr(2,21)},i.writeSessionBoilerplate=function(e,t,n){return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||i.generateSessionId())+" "+(void 0!==t?t:2)+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.getDirection=function(e,t){let n=i.splitLines(e);for(let e=0;e<n.length;e++)switch(n[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[e].substr(2)}return t?i.getDirection(t):"sendrecv"},i.getKind=function(e){return i.splitLines(e)[0].split(" ")[0].substr(2)},i.isRejected=function(e){return"0"===e.split(" ",2)[1]},i.parseMLine=function(e){let t=i.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},i.parseOLine=function(e){let t=i.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},i.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;let t=i.splitLines(e);for(let e=0;e<t.length;e++)if(t[e].length<2||"="!==t[e].charAt(1))return!1;return!0},e.exports=i},function(e,t){e.exports={}},function(e,t,n){var i=n(11),s=n(4),r=n(24);e.exports=function(e,t){var n=(s.Object||{})[e]||Object[e],a={};a[e]=t(n),i(i.S+i.F*r(function(){n(1)}),"Object",a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=localStorage||{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={SLICE_SPEED:Math.ceil(125/8),MAX_PACKET_CNT:1e4}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){"use strict";var i=n(137)(!0);n(61)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=i(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){var i=n(89),s=n(66);e.exports=Object.keys||function(e){return i(e,s)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={FLV:1,P2P:2,HLS:3,HUYA:4,STREAM:5}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={MID:1,MAX:2,MIN:3}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={NONE:"NONE",START:"START",READY:"READY",WAITING_STUN:"WAITING_STUN",CONNECTING:"CONNECTING",COMPLETE:"COMPLETE",RETRY:"RETRY",STOP:"STOP"}},function(e,t,n){e.exports={default:n(136),__esModule:!0}},function(e,t){e.exports=!0},function(e,t,n){var i=n(21),s=n(88),r=n(66),a=n(64)("IE_PROTO"),o=function(){},u=function(){var e,t=n(86)("iframe"),i=r.length;for(t.style.display="none",n(141).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;i--;)delete u.prototype[r[i]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(o.prototype=i(e),n=new o,o.prototype=null,n[a]=e):n=u(),void 0===t?n:s(n,t)}},function(e,t,n){var i=n(59),s=Math.min;e.exports=function(e){return e>0?s(i(e),0x1fffffffffffff):0}},function(e,t){var n=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},function(e,t,n){var i=n(16).f,s=n(25),r=n(14)("toStringTag");e.exports=function(e,t,n){e&&!s(e=n?e:e.prototype,r)&&i(e,r,{configurable:!0,value:t})}},function(e,t){t.f=({}).propertyIsEnumerable},function(e,t,n){var i=n(44)("meta"),s=n(17),r=n(25),a=n(16).f,o=0,u=Object.isExtensible||function(){return!0},l=!n(24)(function(){return u(Object.preventExtensions({}))}),d=function(e){a(e,i,{value:{i:"O"+ ++o,w:{}}})},h=e.exports={KEY:i,NEED:!1,fastKey:function(e,t){if(!s(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!r(e,i)){if(!u(e))return"F";if(!t)return"E";d(e)}return e[i].i},getWeak:function(e,t){if(!r(e,i)){if(!u(e))return!0;if(!t)return!1;d(e)}return e[i].w},onFreeze:function(e){return l&&h.NEED&&u(e)&&!r(e,i)&&d(e),e}}},function(e,t,n){t.f=n(14)},function(e,t,n){n(179);for(var i=n(18),s=n(20),r=n(30),a=n(14)("toStringTag"),o="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<o.length;u++){var l=o[u],d=i[l],h=d&&d.prototype;h&&!h[a]&&s(h,a,l),r[l]=r.Array}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={CHANNEL_CLOSE:1,CHANNEL_ERROR:2,NODE_LEAVE:3,SERVER_REJECT:5,PEER_ERROR:6,PEER_TIMEOUT:7,PING_TIMEOUT:8,OTHER_SID:9,EMPTY_SLICE:10,SUB_TIMEOUT:11,SUB_FAIL_TIMES:12,NODE_REJECT:13,DIF_CDNP:14,PEER_HANDLER_ERR:15}},function(e,t,n){var i=n(23),s=n(91),r=n(92),a=n(21),o=n(43),u=n(67),l={},d={};(t=e.exports=function(e,t,n,h,c){var f,p,m,_,v=c?function(){return e}:u(e),g=i(n,h,t?2:1),y=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(r(v)){for(f=o(e.length);f>y;y++)if((_=t?g(a(p=e[y])[0],p[1]):g(e[y]))===l||_===d)return _}else for(m=v.call(e);!(p=m.next()).done;)if((_=s(m,g,p.value,t))===l||_===d)return _}).BREAK=l,t.RETURN=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={SAME:1,DIF:2}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(5)),s=u(n(0)),r=u(n(1)),a=u(n(6)),o=u(n(7));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e,n){(0,s.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return r.baseIndex=0,r.isWss=!1,r.isHttps=!1,r.isWebrtc=!1,r}return(0,o.default)(t,e),(0,r.default)(t,[{key:"createProtoLink",value:function(){return this.url&&this.url.startsWith("http")?(this.isHttps=!0,this.createProtoLinkHttp()):this.url&&this.url.startsWith("ws")?(this.isWss=!0,this.createProtoLinkWs()):this.url&&this.url.startsWith("webrtc")?(this.isWebrtc=!0,this.createProtoLinkWebrtc()):null}}]),t}(u(n(13)).default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={NONE:0,SUB_PEER_MOB:1,SUB_PEER_WEB:2,PCDN_SUC:3,PCDN_DISCONNECT:4,PCDN_DATA_TIMEOUT:5,PCDN_KICK:6,SUB_REJECT:7,PEER_BAD:8,PEER_DATA_TIMEOUT:9,PEER_LEAVE:10,CDN_COMPETE:11,PCDN_CONNECT_TIMEOUT:12,PEER_BETTER:13,PCDN_SEQ_SLOW:14}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={NONE:0,GLOBAL:1,SUBSTREAM:2}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={DEFAULT_DELAY:65535,SWITCH_DELAY:500,STREAM_DELAY:2e3}},function(e,t,n){var i=n(17);e.exports=function(e,t){var n,s;if(!i(e))return e;if(t&&"function"==typeof(n=e.toString)&&!i(s=n.call(e))||"function"==typeof(n=e.valueOf)&&!i(s=n.call(e))||!t&&"function"==typeof(n=e.toString)&&!i(s=n.call(e)))return s;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){e.exports={default:n(135),__esModule:!0}},function(e,t){var n=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e*=1)?0:(e>0?i:n)(e)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){"use strict";var i=n(41),s=n(11),r=n(87),a=n(20),o=n(30),u=n(138),l=n(45),d=n(90),h=n(14)("iterator"),c=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,n,p,m,_,v){u(n,t,p);var g,y,S,b=function(e){if(!c&&e in w)return w[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},P=t+" Iterator",k="values"==m,I=!1,w=e.prototype,T=w[h]||w["@@iterator"]||m&&w[m],C=T||b(m),x=m?k?b("entries"):C:void 0,R="Array"==t&&w.entries||T;if(R&&(S=d(R.call(new e)))!==Object.prototype&&S.next&&(l(S,P,!0),i||"function"==typeof S[h]||a(S,h,f)),k&&T&&"values"!==T.name&&(I=!0,C=function(){return T.call(this)}),(!i||v)&&(c||I||!w[h])&&a(w,h,C),o[t]=C,o[P]=f,m)if(g={values:k?C:b("values"),keys:_?C:b("keys"),entries:x},v)for(y in g)y in w||r(w,y,g[y]);else s(s.P+s.F*(c||I),t,g);return g}},function(e,t,n){var i=n(63);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==i(e)?e.split(""):Object(e)}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var i=n(65)("keys"),s=n(44);e.exports=function(e){return i[e]||(i[e]=s(e))}},function(e,t,n){var i=n(4),s=n(18),r=s["__core-js_shared__"]||(s["__core-js_shared__"]={});(e.exports=function(e,t){return r[e]||(r[e]=void 0!==t?t:{})})("versions",[]).push({version:i.version,mode:n(41)?"pure":"global",copyright:"\xa9 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var i=n(68),s=n(14)("iterator"),r=n(30);e.exports=n(4).getIteratorMethod=function(e){if(null!=e)return e[s]||e["@@iterator"]||r[i(e)]}},function(e,t,n){var i=n(63),s=n(14)("toStringTag"),r="Arguments"==i(function(){return arguments}());e.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),s))?n:r?i(t):"Object"==(a=i(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t,n){var i=n(46),s=n(34),r=n(26),a=n(57),o=n(25),u=n(85),l=Object.getOwnPropertyDescriptor;t.f=n(15)?l:function(e,t){if(e=r(e),t=a(t,!0),u)try{return l(e,t)}catch(e){}if(o(e,t))return s(!i.f.call(e,t),e[t])}},function(e,t,n){var i=n(18),s=n(4),r=n(41),a=n(48),o=n(16).f;e.exports=function(e){var t=s.Symbol||(s.Symbol=r?{}:i.Symbol||{});"_"==e.charAt(0)||e in t||o(t,e,{value:a.f(e)})}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t){},function(e,t,n){"use strict";t.__esModule=!0;var i=a(n(177)),s=a(n(100)),r="function"==typeof s.default&&"symbol"==typeof i.default?function(e){return typeof e}:function(e){return e&&"function"==typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":typeof e};function a(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof s.default&&"symbol"===r(i.default)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":void 0===e?"undefined":r(e)}},function(e,t,n){"use strict";t.__esModule=!0;var i=r(n(183)),s=r(n(8));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(Array.isArray(e))return e;if((0,i.default)(Object(e)))return function(e,t){var n=[],i=!0,r=!1,a=void 0;try{for(var o,u=(0,s.default)(e);!(i=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(r)throw a}}return n}(e,t);throw TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=i&&i.__esModule?i:{default:i};t.default=new function e(){(0,s.default)(this,e),this.signal_up_bw=0,this.signal_down_bw=0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={addComp:function(e,t,n){e.hasOwnProperty(t)?e["k"+t]+=n:e["k"+t]=n},setComp:function(e,t,n){e["k"+t]=n}}},function(e,t,n){e.exports={default:n(210),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={FULL_PLAY_FAIL:1,FULL_CONNECT_TIMEOUT:2,SUB_CONNECT_TIMEOUT:3,FULL_NO_DATA:4,SUB_NO_DATA:5,P2P_ARGS_ERROR:6,P2P_COOLING:7,FLV_TO_P2P_FAIL:8,FLV_TO_P2P_FULL_STREAM_COMPLETE:9,FULL_ERROR:10,FULL_CLOSE:11,SUB_ERROR:12,SUB_CLOSE:13,RESTART_TIMES:14,SIGNAL_TIMEOUT:15,PROBE_TIMEOUT:16,PROBE_ERROR:17}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(5)),s=u(n(0)),r=u(n(1)),a=u(n(6)),o=u(n(7));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e,n){return(0,s.default)(this,t),(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n))}return(0,o.default)(t,e),(0,r.default)(t,[{key:"createProtoLink",value:function(){return this.createProtoLinkHttp()}}]),t}(u(n(13)).default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),s=r(n(1));function r(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(){(0,i.default)(this,e),this.size=0,this.head=null,this.freeChainSize=0,this.freeChain=null,this.travelNode=null}return(0,s.default)(e,[{key:"resetTravel",value:function(){this.travelNode=this.head}},{key:"travel",value:function(){if(null===this.travelNode&&(this.travelNode=this.head,null===this.travelNode))return null;var e=this.travelNode.data;return this.travelNode=this.travelNode.next,this.travelNode===this.head||null===this.travelNode?null:e}},{key:"reset",value:function(){this.resetTravel();var e=null,t=null;for(e=this.head;null!=e;)t=e,e=e.next,t.data=null,t.prev=null,t.next=null,e===this.head&&(e=null);for(this.head=null,e=this.freeChain;null!=e;)t=e,e=e.next,t.data=null,t.prev=null,t.next=null;this.freeChain=null,this.size=0,this.freeChainSize=0}},{key:"put",value:function(e){var t=this.getFree(e);if(this.size++,null===this.head)t.prev=t,t.next=t,this.head=t;else if(t.data.key<this.head.data.key)t.prev=this.head.prev,t.next=this.head,t.prev.next=t,t.next.prev=t,this.head=t;else{for(var n=this.head.prev;t.data.key<n.data.key;)n=n.prev;if(t.data.key===n.data.key)return this.size--,this.putFree(t),!1;t.prev=n,t.next=n.next,t.prev.next=t,t.next.prev=t}return!0}},{key:"get",value:function(){if(null===this.head)return null;var e=this.head,t=e.data;return this.size--,0===this.size?this.head=null:(e.prev.next=e.next,e.next.prev=e.prev,this.head=this.head.next),this.putFree(e),t}},{key:"peek",value:function(){return null===this.head?null:this.head.data}},{key:"peekLast",value:function(){return null===this.head?null:this.head.prev.data}},{key:"peekByKey",value:function(e){if(null===this.head)return null;if(this.head.data.key===e)return this.head.data;for(var t=this.head.next;t!==this.head;){if(t.data.key===e)return t.data;t=t.next}return null}},{key:"peekNodeByKey",value:function(e){if(null===this.head)return null;if(this.head.data.key===e)return this.head;for(var t=this.head.next;t!==this.head;){if(t.data.key===e)return t;t=t.next}return null}},{key:"removeNode",value:function(e){if(e===this.head)this.get();else{var t=e.prev,n=e.next;t.next=n,n.prev=t,this.putFree(e),this.size--}}},{key:"removeKey",value:function(e){var t=this.peekNodeByKey(e);t&&this.removeNode(t)}},{key:"getOrNewNode",value:function(e){var t=null;if(null===this.head)this.size++,(t=this.getFree(null)).prev=t,t.next=t,this.head=t;else if(e<this.head.data.key)this.size++,(t=this.getFree(null)).prev=this.head.prev,t.next=this.head,t.prev.next=t,t.next.prev=t,this.head=t;else{for(var n=this.head.prev;e<n.data.key;)n=n.prev;n.data.key===e?t=n:(this.size++,(t=this.getFree(null)).prev=n,t.next=n.next,t.prev.next=t,t.next.prev=t)}return t}},{key:"putFree",value:function(e){e.data=null,e.next=this.freeChain,e.prev=null,this.freeChain=e,this.freeChainSize++}},{key:"getFree",value:function(e){if(null===this.freeChain)return new o(e);var t=this.freeChain;return t.data=e,this.freeChain=t.next,this.freeChainSize--,t}},{key:"getLast",value:function(){if(null==this.head)return null;var e=this.head.prev,t=e.data;return this.size--,0===this.size?this.head=null:(e.prev.next=e.next,e.next.prev=e.prev),this.putFree(e),t}}]),e}(),o=function e(t){(0,i.default)(this,e),this.next=null,this.prev=null,this.data=t};t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={CDN:1,PEER:2,PCDN:3}},function(e,t,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){e.exports={default:n(132),__esModule:!0}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){e.exports=!n(15)&&!n(24)(function(){return 7!=Object.defineProperty(n(86)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var i=n(17),s=n(18).document,r=i(s)&&i(s.createElement);e.exports=function(e){return r?s.createElement(e):{}}},function(e,t,n){e.exports=n(20)},function(e,t,n){var i=n(16),s=n(21),r=n(36);e.exports=n(15)?Object.defineProperties:function(e,t){s(e);for(var n,a=r(t),o=a.length,u=0;o>u;)i.f(e,n=a[u++],t[n]);return e}},function(e,t,n){var i=n(25),s=n(26),r=n(139)(!1),a=n(64)("IE_PROTO");e.exports=function(e,t){var n,o=s(e),u=0,l=[];for(n in o)n!=a&&i(o,n)&&l.push(n);for(;t.length>u;)i(o,n=t[u++])&&(~r(l,n)||l.push(n));return l}},function(e,t,n){var i=n(25),s=n(27),r=n(64)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return i(e=s(e),r)?e[r]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,n){var i=n(21);e.exports=function(e,t,n,s){try{return s?t(i(n)[0],n[1]):t(n)}catch(t){var r=e.return;throw void 0!==r&&i(r.call(e)),t}}},function(e,t,n){var i=n(30),s=n(14)("iterator"),r=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||r[s]===e)}},function(e,t,n){e.exports={default:n(145),__esModule:!0}},function(e,t,n){var i=n(26),s=n(95).f,r={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==r.call(e)?function(e){try{return s(e)}catch(e){return a.slice()}}(e):s(i(e))}},function(e,t,n){var i=n(89),s=n(66).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,s)}},function(e,t,n){"use strict";var i=n(18),s=n(25),r=n(15),a=n(11),o=n(87),u=n(47).KEY,l=n(24),d=n(65),h=n(45),c=n(44),f=n(14),p=n(48),m=n(70),_=n(156),v=n(97),g=n(21),y=n(17),S=n(27),b=n(26),P=n(57),k=n(34),I=n(42),w=n(94),T=n(69),C=n(71),x=n(16),R=n(36),M=T.f,U=x.f,N=w.f,E=i.Symbol,L=i.JSON,O=L&&L.stringify,D=f("_hidden"),A=f("toPrimitive"),q={}.propertyIsEnumerable,B=d("symbol-registry"),F=d("symbols"),j=d("op-symbols"),H=Object.prototype,G="function"==typeof E&&!!C.f,z=i.QObject,V=!z||!z.prototype||!z.prototype.findChild,W=r&&l(function(){return 7!=I(U({},"a",{get:function(){return U(this,"a",{value:7}).a}})).a})?function(e,t,n){var i=M(H,t);i&&delete H[t],U(e,t,n),i&&e!==H&&U(H,t,i)}:U,K=function(e){var t=F[e]=I(E.prototype);return t._k=e,t},Y=G&&"symbol"==typeof E.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof E},X=function(e,t,n){return e===H&&X(j,t,n),g(e),t=P(t,!0),g(n),s(F,t)?(n.enumerable?(s(e,D)&&e[D][t]&&(e[D][t]=!1),n=I(n,{enumerable:k(0,!1)})):(s(e,D)||U(e,D,k(1,{})),e[D][t]=!0),W(e,t,n)):U(e,t,n)},Z=function(e,t){g(e);for(var n,i=_(t=b(t)),s=0,r=i.length;r>s;)X(e,n=i[s++],t[n]);return e},J=function(e){var t=q.call(this,e=P(e,!0));return!(this===H&&s(F,e)&&!s(j,e))&&(!(t||!s(this,e)||!s(F,e)||s(this,D)&&this[D][e])||t)},Q=function(e,t){if(e=b(e),t=P(t,!0),e!==H||!s(F,t)||s(j,t)){var n=M(e,t);return!n||!s(F,t)||s(e,D)&&e[D][t]||(n.enumerable=!0),n}},$=function(e){for(var t,n=N(b(e)),i=[],r=0;n.length>r;)s(F,t=n[r++])||t==D||t==u||i.push(t);return i},ee=function(e){for(var t,n=e===H,i=N(n?j:b(e)),r=[],a=0;i.length>a;)s(F,t=i[a++])&&(!n||s(H,t))&&r.push(F[t]);return r};G||(o((E=function(){if(this instanceof E)throw TypeError("Symbol is not a constructor!");var e=c(arguments.length>0?arguments[0]:void 0),t=function(n){this===H&&t.call(j,n),s(this,D)&&s(this[D],e)&&(this[D][e]=!1),W(this,e,k(1,n))};return r&&V&&W(H,e,{configurable:!0,set:t}),K(e)}).prototype,"toString",function(){return this._k}),T.f=Q,x.f=X,n(95).f=w.f=$,n(46).f=J,C.f=ee,r&&!n(41)&&o(H,"propertyIsEnumerable",J,!0),p.f=function(e){return K(f(e))}),a(a.G+a.W+!G*a.F,{Symbol:E});for(var et="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),en=0;et.length>en;)f(et[en++]);for(var ei=R(f.store),es=0;ei.length>es;)m(ei[es++]);a(a.S+!G*a.F,"Symbol",{for:function(e){return s(B,e+="")?B[e]:B[e]=E(e)},keyFor:function(e){if(!Y(e))throw TypeError(e+" is not a symbol!");for(var t in B)if(B[t]===e)return t},useSetter:function(){V=!0},useSimple:function(){V=!1}}),a(a.S+!G*a.F,"Object",{create:function(e,t){return void 0===t?I(e):Z(I(e),t)},defineProperty:X,defineProperties:Z,getOwnPropertyDescriptor:Q,getOwnPropertyNames:$,getOwnPropertySymbols:ee});var er=l(function(){C.f(1)});a(a.S+a.F*er,"Object",{getOwnPropertySymbols:function(e){return C.f(S(e))}}),L&&a(a.S+a.F*(!G||l(function(){var e=E();return"[null]"!=O([e])||"{}"!=O({a:e})||"{}"!=O(Object(e))})),"JSON",{stringify:function(e){for(var t,n,i=[e],s=1;arguments.length>s;)i.push(arguments[s++]);if(n=t=i[1],(y(t)||void 0!==e)&&!Y(e))return v(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!Y(t))return t}),i[1]=t,O.apply(L,i)}}),E.prototype[A]||n(20)(E.prototype,A,E.prototype.valueOf),h(E,"Symbol"),h(Math,"Math",!0),h(i.JSON,"JSON",!0)},function(e,t,n){var i=n(63);e.exports=Array.isArray||function(e){return"Array"==i(e)}},function(e,t,n){e.exports={default:n(159),__esModule:!0}},function(e,t,n){e.exports={default:n(170),__esModule:!0}},function(e,t,n){e.exports={default:n(174),__esModule:!0}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=_(n(8)),s=_(n(0)),r=_(n(1)),a=n(9),o=_(n(2)),u=_(n(3)),l=_(n(50)),d=_(n(186)),h=_(n(187)),c=_(n(107)),f=_(n(103)),p=_(n(76)),m=_(n(52));function _(e){return e&&e.__esModule?e:{default:e}}var v=(0,a.requireProto)("P2PKeepAlive"),g=(0,a.requireProto)("P2PKeepAliveRes"),y=(0,a.requireProto)("P2PKeepAliveStream");t.default=function(){function e(){(0,s.default)(this,e),this.peerMgr=null,this.streamMgr=null,this.streamSeqSN=-1,this.bPunched=!1,this.started=!1,this.hasCrossClient=!1,this.protoHandler=new a.ProtoHandler,this.punch=new h.default(this),this.punch.onDataCb=this.protoHandler.onData.bind(this.protoHandler),this.punch.onOpenCb=this.onNodeOpen.bind(this),this.punch.onDelNodeCb=this.onDelNode.bind(this),this.protoHandler.on(a.ProtoUri.P2PKeepAlive,this.recvKeepAlive,this),this.protoHandler.on(a.ProtoUri.P2PKeepAliveRes,this.recvKeepAliveRes,this),this.protoHandler.on(a.ProtoUri.P2PNotifyNodeLeave,this.recvNotifyNodeLeave,this),this.initConfig(),this.rejectStat={},this.printPeer=1==localStorage._printPeer}return(0,r.default)(e,[{key:"initMgr",value:function(e,t,n){this.peerMgr=e,this.streamMgr=t,this.streamSeqSN=n}},{key:"initConfig",value:function(){this.punch.needQueue=Number(o.default.config.needQueue||0),this.punch.queueTime=Number(o.default.config.queueTime||3),this.punch.punchedCoolingTime=Number(o.default.config.punchedCoolingTime||3e4),this.punch.delayCloseNum=Number(o.default.config.delayCloseNum||200),this.punch.punchTimeout=Number(o.default.config.punchTimeout||1e4),this.punch.maxPunchedCnt=Number(o.default.config.maxPunchedCnt||35),this.punch.maxPunchedCntSdk=Number(o.default.config.maxPunchedCntSdk)||10,this.punch.maxPunchedCntMore=Number(o.default.config.maxPunchedCntMore||50),this.punch.maxNodeCnt=Number(o.default.config.maxNodeCnt||40),this.punch.punchIgnoreTime=Number(o.default.config.punchIgnoreTime||3e5)}},{key:"addStat",value:function(e,t){this.rejectStat[e]?this.rejectStat[e]+=t:this.rejectStat[e]=t}},{key:"setStunConfig",value:function(e,t,n){this.punch.sslUrl=e,this.punch.stunIp=t,this.punch.stunPorts=n}},{key:"start",value:function(){this.started||(o.default.logger.log("PunchMgr start "+this.streamSeqSN),this.started=!0,o.default.Timer.add(this.onCheckTimer,this,1e3))}},{key:"reset",value:function(){o.default.logger.log("PunchMgr reset "+this.streamSeqSN),this.started=!1,this.punch.reset(),o.default.Timer.remove(this.onCheckTimer,this)}},{key:"onCheckTimer",value:function(e,t){this.onPingTimer(e,t),this.punch.onCheckTimer(e,t)}},{key:"onPingTimer",value:function(e,t){var n=!0,s=!1,r=void 0;try{for(var a,o=(0,i.default)(this.punch.punchedMap.keys());!(n=(a=o.next()).done);n=!0){var u=a.value,d=this.getNode(u);t%3==0&&(d.isAlive?this.sendKeepAlive(d,e):this.delNode(u,l.default.PING_TIMEOUT))}}catch(e){s=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(s)throw r}}}},{key:"hasNode",value:function(e){return this.punch.hasNode(e)}},{key:"getNode",value:function(e){return this.punch.getNode(e)}},{key:"delNode",value:function(e,t){this.punch.delNode(e,t),this.onDelNode(e,t)}},{key:"getPunchedCnt",value:function(){return this.punch.punchedMap.size}},{key:"getPunchedCntWeb",value:function(){return this.punch.getPunchedCntByNodeType(a.NodeType.WEB_CLIENT_V2)}},{key:"getPunchedCntSdk",value:function(){return this.punch.getPunchedCntByNodeType(a.NodeType.SDK_CLIENT_V2)}},{key:"getPunchedCntMedia",value:function(){return this.punch.getPunchedCntByStreamType("media")}},{key:"getPunchedCntSignal",value:function(){return this.punch.getPunchedCntByStreamType("signal")}},{key:"isPunchedSignalMax",value:function(){if(o.default.p2pPunchMode===m.default.DIF)return this.punch.isPunchedMax();var e=Number(o.default.config.signalCntMax)||20;return this.getPunchedCntSignal()>=e}},{key:"isPunchedMaxMore",value:function(){return this.punch.isPunchedMax()}},{key:"sendToNode",value:function(e,t,n){this.punch.sendToNode(e,t,n)}},{key:"onNodeOpen",value:function(e,t){t?this.punch.punchStat.punch_info.back_succ_cnt++:this.punch.punchStat.punch_info.succ_cnt++,this.bPunched=!0,this.peerMgr.addPeer(e),this.streamMgr.onNodeOpen(e),this.sendKeepAlive(this.getNode(e),o.default.TimeUtil.now())}},{key:"onDelNode",value:function(e,t){this.peerMgr.delPeer(e,t,this.streamSeqSN),this.streamMgr.onDelNode(e)}},{key:"sendKeepAlive",value:function(e,t){e.isAlive=!1;var n=new v;n.fromUid=o.default.userInfo.uuid,n.curSid=0,n.timeStampc=t,n.sendCnt=e.channel.sendCnt,this.fillStreamMap(n.streamMap,e.uid),this.printPeer&&o.default.logger.log("PunchMgr.sendKeepAlive",n),e.send(n.marshall(),a.DataType.PING)}},{key:"recvKeepAlive",value:function(e){if(this.hasNode(e.fromUid)){this.printPeer&&o.default.logger.log("PunchMgr.recvKeepAlive",e);var t=this.getNode(e.fromUid);t.isAlive=!0,e.timeStampc>t.lastRecvPingStampc&&(t.lastRecvPingStampc=e.timeStampc,this.peerMgr.updateByPing(e,u.default.UintMax),this.sendKeepAliveRes(t,e.timeStampc,e.sendCnt))}}},{key:"sendKeepAliveRes",value:function(e,t,n){var i=new g;i.fromUid=o.default.userInfo.uuid,i.curSid=0,i.timeStampc=t,i.sendCnt=n-e.sendCnt,i.recvCnt=e.channel.recvCnt,this.fillStreamMap(i.streamMap,e.uid),e.sendCnt=n,e.channel.recvCnt=0,this.peerMgr.updatePeerSendRecv(e.uid,i.sendCnt,i.recvCnt),this.printPeer&&o.default.logger.log("PunchMgr.sendKeepAliveRes",i),e.send(i.marshall(),a.DataType.PING)}},{key:"recvKeepAliveRes",value:function(e){if(this.hasNode(e.fromUid)){this.printPeer&&o.default.logger.log("PunchMgr.recvKeepAliveRes",e);var t=this.getNode(e.fromUid);t.isAlive=!0;var n=o.default.TimeUtil.now()-e.timeStampc>>1,i=Number(o.default.config.coefficient);0===t.rtt?t.rtt=n:t.rtt=Math.ceil((t.rtt*i+n)/(i+1)),this.peerMgr.updateByPing(e,t.rtt),this.streamMgr.calcPeerLoss(e.fromUid,e.sendCnt,e.recvCnt)}}},{key:"fillStreamMap",value:function(e,t){var n=!0,s=!1,r=void 0;try{for(var a,o=(0,i.default)(this.streamMgr.getStreams());!(n=(a=o.next()).done);n=!0){var u=a.value;if(-1===this.streamSeqSN||this.streamSeqSN===u.sInfo.streamSeqSN){var l=new y;u.fillAliveStream(l,t),e.set(l.streamSeqSN,l)}}}catch(e){s=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(s)throw r}}}},{key:"recvNotifyNodeLeave",value:function(e){this.hasNode(e.uid)&&this.delNode(e.uid,l.default.NODE_LEAVE)}},{key:"recvGetNode",value:function(e,t){this.start();var n=this.punch.addCandidates(e,t);return n.validNumSdk>0&&(this.hasCrossClient=!0),n}},{key:"recvOffer",value:function(e,t){var n=this.punch.getOrNewNode(e.fromUid,"recvOffer");n.nodeProxy=t,n.nodeType=e.nodeType,n.peer.recvOffer(e,e.fromUid>o.default.userInfo.uuid)}},{key:"recvAnswer",value:function(e,t){if(this.hasNode(e.fromUid)){var n=this.getNode(e.fromUid);n.nodeProxy=t,n.peer.recvAnswer(e)}}},{key:"recvCandidate",value:function(e,t){if(this.hasNode(e.fromUid)){var n=this.getNode(e.fromUid);n.nodeProxy=t,n.peer.recvCandidate(e)}}},{key:"recvForwardReject",value:function(e,t){this.punch.punchStat.punch_info.aj++}},{key:"recvPunchBackReq",value:function(e,t){this.punch.recvPunchBackReq(e,t)}},{key:"recvPunchBackRsp",value:function(e,t){p.default.addComp(this.punch.punchStat.punch_back_ret,e.ret,1),this.punch.recvPunchBackRsp(e,t)}},{key:"recvAsk",value:function(e,t){var n=d.default.NONE;this.punch.isNodeMax()?n=d.default.QUOTA_EXHAUST:this.punch.isPunchedMaxMore()?n=d.default.PUNCHED_FULL:this.punch.isWaiting(e.fromUid)?n=d.default.WAITING:this.punch.isIgnoreKey(e.fromUid,e.askType===c.default.OFFER?f.default.PASS:f.default.ACT)&&(n=d.default.IGNORE),n===d.default.NONE&&(e.askType===c.default.REQUEST?this.punch.connectNode(e.fromUid,t,"request",e.nodeType):t.sendAskRes(e.fromUid))}},{key:"recvAskRes",value:function(e,t){this.punch.connectNode(e.fromUid,t,"offer",e.nodeType)}},{key:"getRttDetail",value:function(){var e=0,t=0,n=0,s=0,r=0,a=!0,o=!1,u=void 0;try{for(var l,d=(0,i.default)(this.punch.punchedMap.keys());!(a=(l=d.next()).done);a=!0){var h=l.value,c=this.punch.getNode(h);if(c){var f=c.rtt;f>1e4?f=1e4:f<0&&(f=0),e+=f,t++,(0===s||s<f)&&(s=f),(0===r||r>f)&&(r=f)}}}catch(e){o=!0,u=e}finally{try{!a&&d.return&&d.return()}finally{if(o)throw u}}return t>0&&(n=Math.floor(e/t)),{max:s,min:r,avg:n}}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=p(n(40)),s=p(n(8)),r=p(n(10)),a=p(n(0)),o=p(n(1)),u=n(9),l=p(n(203)),d=p(n(50)),h=p(n(206)),c=p(n(2)),f=p(n(207));function p(e){return e&&e.__esModule?e:{default:e}}var m=function(){function e(t){(0,a.default)(this,e),this.punchMgr=t,this.candidates=[],this.waits=[],this.punchStat=new f.default,this.nodeMap=new r.default,this.punchedMap=new r.default,this.punchedHisMap=new r.default,this.ignoreMap=new r.default,this.delayCloseMap=new r.default,this.delayPunchedMap=new r.default,this.sslUrl="",this.stunIp="",this.stunPorts=[],this.onDataCb=null,this.onOpenCb=null,this.onDelNodeCb=null,this.onStateBind=this.onState.bind(this),this.onErrorBind=this.onError.bind(this),this.onPunchStatBind=this.onPunchStat.bind(this),this.needQueue=1,this.queueTime=3e3,this.punchedCoolingTime=3e4,this.delayCloseNum=200,this.punchTimeout=1e4,this.maxPunchedCnt=35,this.maxPunchedCntSdk=10,this.maxPunchedCntMore=50,this.maxNodeCnt=40,this.punchIgnoreTime=3e5}return(0,o.default)(e,[{key:"reset",value:function(){this.closeNodes(),this.candidates=[],this.waits=[],this.nodeMap.clear(),this.punchedMap.clear()}},{key:"onState",value:function(e,t,n){e===u.ChannelState.OPEN?(this.punchedMap.set(t,0),this.punchedHisMap.set(t,0),this.onOpenCb&&this.onOpenCb(t,n)):e!==u.ChannelState.CONNECTING&&(this.delNode(t,d.default.CHANNEL_ERROR),this.onDelNodeCb&&this.onDelNodeCb(t,d.default.CHANNEL_ERROR))}},{key:"onError",value:function(e,t){this.delNode(e,t),this.onDelNodeCb&&this.onDelNodeCb(e,t)}},{key:"onPunchStat",value:function(e){this.punchStat.punch_info[e]++}},{key:"sendToNode",value:function(e,t,n){this.punchedMap.has(e)&&this.getNode(e).channel.send(t,n)}},{key:"isNodeMax",value:function(){return this.nodeMap.size>=this.maxNodeCnt||this.delayCloseMap.size>this.delayCloseNum}},{key:"isPunchedMax",value:function(){return this.getPunchedCntByNodeType(u.NodeType.WEB_CLIENT_V2)>=this.maxPunchedCnt}},{key:"isPunchedMaxMore",value:function(){return this.getPunchedCntByNodeType(u.NodeType.WEB_CLIENT_V2)>=this.maxPunchedCntMore}},{key:"getPunchedCntByStreamType",value:function(e){var t=0,n=!0,i=!1,r=void 0;try{for(var a,o=(0,s.default)(c.default.streamMgr.getStreams());!(n=(a=o.next()).done);n=!0){var u=a.value;if("signal"===e&&u.sInfo.isSignal||"media"===e&&u.sInfo.isMedia){var l=u.sInfo.streamSeqSN;t=this.getPunchedCntByStreamSeqSN(l);break}}}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}return t}},{key:"getPunchedCntByStreamSeqSN",value:function(e){var t=0,n=!0,i=!1,r=void 0;try{for(var a,o=(0,s.default)(this.punchedMap.keys());!(n=(a=o.next()).done);n=!0){var u=a.value,l=this.punchMgr.peerMgr.getPeer(u);l&&l.hasStreamSeqSN(e)&&t++}}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}return t}},{key:"getPunchedCntByNodeType",value:function(e){var t=0,n=!0,i=!1,r=void 0;try{for(var a,o=(0,s.default)(this.punchedMap.keys());!(n=(a=o.next()).done);n=!0){var u=a.value,l=this.getNode(u);l&&l.nodeType===e&&t++}}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}return t}},{key:"isIgnore",value:function(t,n){return this.isIgnoreKey(t,c.default.userInfo.uuid<t?e.ACT:e.PASS,n)}},{key:"isIgnoreKey",value:function(e,t,n){var i=t+"_"+e;return!!this.ignoreMap.has(i)&&(!(n-this.ignoreMap.get(i)>=this.punchIgnoreTime)||(this.ignoreMap.delete(i),!1))}},{key:"isWaiting",value:function(e){return this.delayCloseMap.has(e)||this.delayPunchedMap.has(e)}},{key:"isCooling",value:function(e,t){return!1}},{key:"hasNode",value:function(e){return this.nodeMap.has(e)}},{key:"getNode",value:function(e){return this.nodeMap.get(e)}},{key:"getOrNewNode",value:function(e,t){if(!this.nodeMap.has(e)){var n=new l.default(e);return n.sslUrl=this.sslUrl,n.stunIp=this.stunIp,n.stunPorts=this.stunPorts,n.onDataCb=this.onDataCb,n.onStateCb=this.onStateBind,n.onErrorCb=this.onErrorBind,n.onPunchStat=this.onPunchStatBind,this.nodeMap.set(e,n),n}return this.nodeMap.get(e)}},{key:"delNode",value:function(e,t){this.nodeMap.has(e)&&(this.closeNode(this.nodeMap.get(e),t),this.nodeMap.delete(e),this.punchedMap.delete(e))}},{key:"closeNodes",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,r=(0,s.default)(this.nodeMap.values());!(e=(i=r.next()).done);e=!0){var a=i.value;this.punchedMap.has(a.uid)&&a.sendNotifyLeaveNet(h.default.RESET),this.closeNode(a,"reset")}}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}}},{key:"closeNode",value:function(t,n){if(n===d.default.PEER_TIMEOUT){var i=c.default.TimeUtil.now();this.ignoreMap.set((t.isActive()?e.ACT:e.PASS)+"_"+t.uid,i)}t.clear(),1===this.needQueue?this.punchedHisMap.has(t.uid)?(this.delayPunchedMap.set(t.uid,t),this.startDelayClose()):t.isPunchTryed()?(this.delayCloseMap.set(t.uid,t),this.startDelayClose()):t.close():this.closeNodeNow(t)}},{key:"closeNodeNow",value:function(e){e.close()}},{key:"startDelayClose",value:function(){c.default.Timer.add(this.onDelayCloseTimer,this,this.queueTime)}},{key:"onDelayCloseTimer",value:function(e,t){this.delayCloseNode(e)||c.default.Timer.remove(this.onDelayCloseTimer,this)}},{key:"delayCloseNode",value:function(e){return this.delayClosePunched(e)||this.delayClose(e)}},{key:"delayClosePunched",value:function(e){if(this.delayPunchedMap.size>0){var t=(0,i.default)(this.delayPunchedMap.keys())[0],n=this.delayPunchedMap.get(t);return this.delayPunchedMap.delete(t),n.close(),!0}return!1}},{key:"delayClose",value:function(e){if(this.delayCloseMap.size>0){var t=(0,i.default)(this.delayCloseMap.keys())[0],n=this.delayCloseMap.get(t);return this.delayCloseMap.delete(t),n.close(),!0}return!1}},{key:"onCheckTimer",value:function(e,t){this.onPeerTimer(e),t%2==0&&this.tryConnect()}},{key:"onPeerTimer",value:function(e){var t=[],n=null,i=!0,r=!1,a=void 0;try{for(var o,l=(0,s.default)(this.nodeMap.values());!(i=(o=l.next()).done);i=!0)(n=o.value).isPeerTimeout(e)&&(n.nodeType===u.NodeType.SDK_CLIENT_V2?this.punchStat.punch_info.fail_per_cnt_sdkv2++:n.nodeType===u.NodeType.WEB_CLIENT_V2&&this.punchStat.punch_info.fail_per_cnt_webv2++,t.push(n))}catch(e){r=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(r)throw a}}for(var h=t.length,c=0;c<h;c++)n=t[c],this.delNode(n.uid,d.default.PEER_TIMEOUT)}},{key:"tryConnect",value:function(){if(!this.isPunchedMax()&&!this.isNodeMax()){var e=this.getWait()||this.getCandidate();e&&e.nodeProxy.sendAsk(e.uid,e.nodeType)}}},{key:"connectNode",value:function(e,t,n,i){if(!this.hasNode(e)){var s=this.getOrNewNode(e,n);s.nodeProxy=t,s.nodeType=i,s.peer.connect()}}},{key:"addWait",value:function(e){this.waits.push(e)}},{key:"getWait",value:function(){var e=c.default.TimeUtil.now();if(this.waits.length>0)for(var t=this.waits.length,n=this.getPunchedCntByNodeType(u.NodeType.SDK_CLIENT_V2),i=t-1;i>=0;i--){var s=this.waits[i],r=s.uid;if(this.hasNode(r)||this.isIgnore(r,e)||this.delayCloseMap.has(r))this.waits.splice(i,1);else if(n>=this.maxPunchedCntSdk&&s.nodeType===u.NodeType.SDK_CLIENT_V2)this.waits.splice(i,1);else if(!this.isCooling(r)&&!this.delayPunchedMap.has(r))return this.waits.splice(i,1),s}return null}},{key:"addCandidates",value:function(e){for(var t=0,n=0,i=0,s=e.length,r=c.default.TimeUtil.now(),a=this.getPunchedCntByNodeType(u.NodeType.SDK_CLIENT_V2),o=0;o<s;o++){var l=e[o],d=l.uid;if(!this.hasNode(d)&&!this.isIgnore(d,r)){if(t++,l.nodeType===u.NodeType.SDK_CLIENT_V2){if(n++,a>=this.maxPunchedCntSdk)continue}else l.nodeType===u.NodeType.WEB_CLIENT_V2&&i++;this.candidates.push(l)}}return this.candidates.length>20&&this.candidates.splice(0,this.candidates.length-20),{validNum:t,validNumSdk:n,validNumWeb:i}}},{key:"getCandidate",value:function(){for(var e=c.default.TimeUtil.now(),t=this.getPunchedCntByNodeType(u.NodeType.SDK_CLIENT_V2);this.candidates.length>0;){var n=this.candidates.shift(),i=n.uid;if(!(this.hasNode(i)||this.isIgnore(i,e)||this.delayCloseMap.has(i))&&!(t>=this.maxPunchedCntSdk&&n.nodeType===u.NodeType.SDK_CLIENT_V2)){if(!this.isCooling(i)&&!this.delayPunchedMap.has(i))return n;this.addWait(n)}}return null}}]),e}();m.ACT="act",m.PASS="pass",t.default=m},function(e,t,n){var i=n(20);e.exports=function(e,t,n){for(var s in t)n&&e[s]?e[s]=t[s]:i(e,s,t[s]);return e}},function(e,t){e.exports=function(e,t,n,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var i=n(17);e.exports=function(e,t){if(!i(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={OFFER:1,REQUEST:2}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n(8)),s=d(n(10)),r=d(n(0)),a=d(n(1)),o=d(n(109)),u=d(n(2)),l=d(n(3));function d(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,r.default)(this,e),this.peerMap=new s.default}return(0,a.default)(e,[{key:"reset",value:function(){this.peerMap.clear()}},{key:"resetCurSubNum",value:function(){var e=!0,t=!1,n=void 0;try{for(var s,r=(0,i.default)(this.peerMap.values());!(e=(s=r.next()).done);e=!0)s.value.resetCurSubNum()}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}}},{key:"addCurSubNum",value:function(e,t){this.peerMap.has(e)&&this.peerMap.get(e).addCurSubNum(t)}},{key:"addPeer",value:function(e){if(!this.peerMap.has(e)){var t=new o.default(e);return this.peerMap.set(e,t),!0}return!1}},{key:"delPeer",value:function(e,t,n){this.peerMap.has(e)&&u.default.logger.log("PeerMgr.delPeer",e,"reason="+t,n),this.peerMap.delete(e)}},{key:"getPeer",value:function(e){return this.peerMap.get(e)}},{key:"getPeerRtt",value:function(e){return this.peerMap.has(e)?this.peerMap.get(e).rtt:65535}},{key:"updateByPing",value:function(e,t){var n=this.peerMap.get(e.fromUid);n&&n.updateByPing(e.streamMap,t)}},{key:"updatePeerSendRecv",value:function(e,t,n){var i=this.peerMap.get(e);i&&i.addSendRecv(t,n)}},{key:"getSubStreamInfo",value:function(e,t,n){return this.peerMap.has(e)?this.peerMap.get(e).getSubStreamInfo(t,n):null}},{key:"updateStreamInfo",value:function(e,t,n){this.peerMap.has(e)&&this.peerMap.get(e).updateStreamInfo(t,n)}},{key:"getSendSum",value:function(e){return this.peerMap.has(e)?this.peerMap.get(e).sendCntCalc.sum:1}},{key:"getRecvSum",value:function(e){return this.peerMap.has(e)?this.peerMap.get(e).recvCntCalc.sum:1}},{key:"getRtt",value:function(e){return this.peerMap.has(e)?this.peerMap.get(e).rtt:l.default.UintMax}},{key:"getStreamUpBw",value:function(e,t){return this.peerMap.has(e)?this.peerMap.get(e).getStreamUpBw(t):-1}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=h(n(8)),s=h(n(10)),r=h(n(0)),a=h(n(1)),o=h(n(28)),u=h(n(2)),l=h(n(3)),d=h(n(110));function h(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,r.default)(this,e),this.uid=t,this.rtt=l.default.UintMax,this.sendCntCalc=new o.default(10),this.recvCntCalc=new o.default(10),this.streamMap=new s.default,this.hisRtts=[],this.hisRttMin=0,this.hisRttMax=0}return(0,a.default)(e,[{key:"hasStreamSeqSN",value:function(e){return this.streamMap.has(e)}},{key:"addCurSubNum",value:function(e){this.streamMap.has(e)&&this.streamMap.get(e).curSubNum++}},{key:"updateStreamInfo",value:function(e,t){if(this.streamMap.has(e)){var n=this.streamMap.get(e);n.subMinBw=t,n.remainUplinkNum=0}}},{key:"getSubStreamInfo",value:function(e,t){return this.streamMap.has(e)?this.streamMap.get(e).subStreamInfos[t]:null}},{key:"getStreamUpBw",value:function(e){return this.streamMap.has(e)?this.streamMap.get(e).upBw:-1}},{key:"resetCurSubNum",value:function(){var e=!0,t=!1,n=void 0;try{for(var s,r=(0,i.default)(this.streamMap.values());!(e=(s=r.next()).done);e=!0)s.value.curSubNum=0}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}}},{key:"updateByPing",value:function(e,t){t!==l.default.UintMax&&this.addRtt(t),this.checkStreams(e);var n=!0,s=!1,r=void 0;try{for(var a,o=(0,i.default)(e.values());!(n=(a=o.next()).done);n=!0){var u=a.value,h=this.streamMap.get(u.streamSeqSN);h||(h=new d.default,this.streamMap.set(u.streamSeqSN,h)),h.updateByPing(u)}}catch(e){s=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(s)throw r}}}},{key:"checkStreams",value:function(e){var t=!0,n=!1,s=void 0;try{for(var r,a=(0,i.default)(this.streamMap.keys());!(t=(r=a.next()).done);t=!0){var o=r.value;e.has(o)||this.streamMap.delete(o)}}catch(e){n=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw s}}}},{key:"getStream",value:function(e){return this.streamMap.has(e)?this.streamMap.get(e):null}},{key:"addRtt",value:function(e){if(this.rtt===l.default.UintMax)this.rtt=e;else{var t=Number(u.default.config.coefficient);this.rtt=Math.ceil((this.rtt*t+e)/(t+1))}if(this.hisRtts.push(e),0===this.hisRttMax&&(this.hisRttMin=e,this.hisRttMax=e),e<this.hisRttMin?this.hisRttMin=e:e>this.hisRttMax&&(this.hisRttMax=e),this.hisRtts.length>3){var n=this.hisRtts.shift();n===this.hisRttMin?this.hisRttMin=this._calcHisRttMaxMin(!1):n===this.hisRttMax&&(this.hisRttMax=this._calcHisRttMaxMin(!0))}}},{key:"_calcHisRttMaxMin",value:function(e){var t=this.hisRtts.slice();return t.sort(function(e,t){return e-t}),e?t[t.length-1]:t[0]}},{key:"getRto",value:function(){return this.rtt+(this.hisRttMax-this.hisRttMin)}},{key:"addSendRecv",value:function(e,t){e<t&&(e=t),this.sendCntCalc.add(e),this.recvCntCalc.add(t)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(111)),a=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.upBw=0,this.subMinBw=0,this.subNum=0,this.remainUplinkNum=0,this.cdnpip=0,this.subStreamInfos=[],this.curSubNum=0}return(0,s.default)(e,[{key:"hasRemainUplinkNum",value:function(){return this.remainUplinkNum>this.curSubNum}},{key:"updateByPing",value:function(e){this.upBw=e.upBw,this.subMinBw=e.subMinBw,this.subNum=e.subNum,this.remainUplinkNum=e.remainUplinkNum,this.cdnpip=e.cdnpip;for(var t=a.default.TimeUtil.now(),n=0;n<e.streamDelays.length;n++){var i=this.subStreamInfos[n];i||(i=new r.default,this.subStreamInfos[n]=i),i.addDelay(e.streamDelays[n]),i.maxRecvSeq=e.maxRecvSeqs[n],i.maxRecvTs=t}}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(0)),s=a(n(1)),r=a(n(28));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.delayCalc=new r.default(3),this.maxRecvSeq=0,this.maxRecvTs=0}return(0,s.default)(e,[{key:"addDelay",value:function(e){this.delayCalc.add(e)}},{key:"setDelay",value:function(e){this.delayCalc.reset(),this.delayCalc.add(e)}},{key:"getDelay",value:function(){return this.delayCalc.average()}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=U(n(77)),s=U(n(0)),r=U(n(1)),a=n(9),o=U(n(32)),u=U(n(214)),l=U(n(215)),d=U(n(227)),h=U(n(228)),c=U(n(229)),f=U(n(230)),p=U(n(232)),m=U(n(2)),_=U(n(233)),v=U(n(13)),g=U(n(234)),y=U(n(235)),S=U(n(33)),b=U(n(19)),P=U(n(236)),k=U(n(3)),I=U(n(38)),w=U(n(102)),T=U(n(115)),C=U(n(108)),x=U(n(237)),R=U(n(52)),M=U(n(75));function U(e){return e&&e.__esModule?e:{default:e}}var N=1;t.default=function(){function e(t){(0,s.default)(this,e),this.id=N++,this.started=!1,this.sInfo=new u.default(t),this.initStreamId(),this.stat=new _.default(this,this.sInfo.baseSubs),this.bwCalc=new c.default,this.token=this.createToken(),this.uploadCtrl=new d.default,this.streamDomain=new h.default(this.stat),this.sliceProtoHandler=new a.SliceProtoHandler,this.recevier=new f.default,this.stunProbe=new P.default(this.stat),this.resender=this.createResender(),this.peerMgr=null,this.streamMgr=null,this.punchMgr=null,this.punchProtoHelper=new x.default(this),this.getProxyList=new a.GetProxyList(this),this.getPcdnProxyList=new a.GetPcdnProxyList(this),this.cdnpProxy=new a.CdnpProxy(this,M.default),this.nodeProxy=new p.default(this,this.cdnpProxy),this.loaderMgr=new l.default(this,t.baseSubs),this.iaasMgr=new T.default(this),this.subStreamMgr=this.createSubStreamMgr(),this.streamHandler=null,this.tsdbUtil=null,this.tsdbStat=null,this.sliceProtoHandler.on(a.ProtoUri.PP2pSliceData,this.onSliceData.bind(this)),this.uploadCtrl.uploadMin=8,this.stat.core.original_bitrate=+(0===this.sInfo.originalBitrate),this.usePcdn=0,this.openLog=!1,this.initConfig()}return(0,r.default)(e,[{key:"getBufferLen",value:function(){return this.streamHandler&&this.streamHandler.getBufferLen?this.streamHandler.getBufferLen():200}},{key:"resendAudio",value:function(e){this.resender.resendAudio(e)}},{key:"initStreamId",value:function(){this.sInfo.initStreamSeqSN()}},{key:"initConfig",value:function(){this.sInfo.maxUplinkNum=parseInt(m.default.config.maxUplinkBw/(this.sInfo.curBitrate/1e3*S.default.SLICE_SPEED)),this.sInfo.curUplinkNum=Math.min(y.default.getUplinkMax(this.sInfo.curBitrate)||8,this.sInfo.maxUplinkNum),this.loaderMgr&&this.loaderMgr.setCurrentBiterate&&this.loaderMgr.setCurrentBiterate(this.sInfo.curBitrate),this.streamMgr=m.default.streamMgr,m.default.p2pPunchMode===R.default.SAME?(this.punchMgr=m.default.punchMgr,this.peerMgr=m.default.peerMgr):(this.peerMgr=new C.default,this.punchMgr=new w.default,this.punchMgr.initMgr(this.peerMgr,this.streamMgr,this.sInfo.streamSeqSN))}},{key:"initGapCfg",value:function(e,t,n){var i=k.default.getCfgValue(m.default.config[t],this.sInfo.presenterUid,this.sInfo.lineType,0),s=k.default.getCfgValue(m.default.config[n],this.sInfo.presenterUid,this.sInfo.lineType,0);if(1==m.default.config[e]){var r=Math.random();-1===this.stat.experiment.indexOf("useGapCfg")&&-1===this.stat.experiment.indexOf("noGap")&&(this.stat.experiment+=r>.5?"useGapCfg":"noGap"),r>.5&&(this.loaderMgr.rangeUrgent.rangeGap=i,this.loaderMgr.rangeNormal.rangeGap=i,this.subStreamMgr.subGap=s)}else this.loaderMgr.rangeUrgent.rangeGap=i,this.loaderMgr.rangeNormal.rangeGap=i,this.resender.rangeGap=i,this.subStreamMgr.subGap=s}},{key:"initSliceCfg",value:function(e,t){var n=k.default.getCfgValue(m.default.config[e],this.sInfo.presenterUid,this.sInfo.lineType,0),i=k.default.getCfgValue(m.default.config[t],this.sInfo.presenterUid,this.sInfo.lineType,0);this.subStreamMgr.initSliceCacheConfig(n,i)}},{key:"initBaseIndexCfg",value:function(e,t){if(1==m.default.config[e]){var n=Math.random()>.5?I.default.MID:I.default.MIN;-1===this.stat.experiment.indexOf("baseIndexMode")&&(this.stat.experiment+="baseIndexMode"+n),this.subStreamMgr.baseIndexCalc.mode=n}else m.default.config[t]&&(this.subStreamMgr.baseIndexCalc.mode=Number(m.default.config[t]))}},{key:"updateConfig",value:function(){this.initConfig(),this.punchMgr.initConfig(),this.subStreamMgr.initConfig(),this.resender.initConfig()}},{key:"restart",value:function(e){m.default.logger.log("StreamBase.restart id",this.id,e),this.streamHandler.onRestart(e)}},{key:"onRestart",value:function(){this.peerMgr.reset(),this.punchMgr.reset(),this.bwCalc.reset(),this.recevier.reset(),this.resender.reset(),this.loaderMgr.stop(),this.subStreamMgr.onRestart()}},{key:"start",value:function(e){this.addTimer(),this.started||(this.started=!0,this.punchProtoHelper.start(this.punchMgr),this.sInfo.isCanUseCdnp&&(this.getProxyList.start(),this.getPcdnProxyList.start()),this.token.start())}},{key:"stop",value:function(){this.delTimer(),this.started=!1,this.bwCalc.reset(),this.recevier.reset(),this.cdnpProxy.close(),this.loaderMgr.stop(),this.token.stop(),this.getProxyList.stop(),this.getPcdnProxyList.stop(),this.stunProbe.stop(),this.punchProtoHelper.stop()}},{key:"addTimer",value:function(){m.default.Timer.add(this.onCheckTimer,this,1e3),m.default.Timer.add(this.onCheckFastTimer,this,100),m.default.Timer.add(this.onCheckPcdnTimer,this,15e3)}},{key:"delTimer",value:function(){m.default.Timer.remove(this.onCheckTimer,this),m.default.Timer.remove(this.onCheckFastTimer,this),m.default.Timer.remove(this.onCheckPcdnTimer,this)}},{key:"destroy",value:function(){m.default.logger.log("StreamBase.destroy id",this.id),this.delTimer(),this.started=!1,this.bwCalc.reset(),this.recevier.reset(),this.resender.destroy(),this.cdnpProxy.close(),this.loaderMgr.stop(),this.token.stop(),this.getProxyList.stop(),this.subStreamMgr.destroy(),this.getPcdnProxyList.stop(),this.stunProbe.stop(),this.iaasMgr.destroy(),this.punchProtoHelper.stop(),m.default.p2pPunchMode===R.default.DIF&&(this.peerMgr&&this.peerMgr.reset(),this.punchMgr&&this.punchMgr.reset())}},{key:"clearPunch",value:function(){this.subStreamMgr.onRestart()}},{key:"fillAliveStream",value:function(e,t){e.streamSeqSN=this.sInfo.streamSeqSN,e.upBw=this.bwCalc.getUpBw(),e.cdnpip=this.sInfo.cdnpIpInt,e.maxSeqNumFromCdn=this.resender.max,this.subStreamMgr.fillAliveStream(e,t)}},{key:"recvStreamAlive",value:function(e){this.subStreamMgr.recvStreamAlive(e)}},{key:"onCheckTimer",value:function(e,t){var n=this;if(this.started&&(this.uploadCtrl.addActualUpload(this.subStreamMgr.subMgr.getUplinkNum()),this.bwCalc.onCheckTimer(e,t),this.subStreamMgr.onCheckTimer(e,t),this.token.onCheckTimer(e),this.cdnpProxy.onCheckTimer(e,t),this.iaasMgr.onCheckTimer(e,t),t%20==0&&this.sInfo.isCanUseP2P&&!this.punchMgr.isPunchedMaxMore()&&this.cdnpProxy.connected&&this.nodeProxy.sendGetNode(),1==Number(o.default._printPcdn))){var i=[];this.loaderMgr.pcdnSubLoaders.map(function(e){e.protoLink&&(e.protoLink.connected||e.protoLink.ws&&e.protoLink.ws.readyState===WebSocket.CONNECTING)&&n.sInfo.lastPcdnSubs.indexOf(e.subIndex)>=0&&i.push(e.subIndex)});var s="'%ccdn"+this.sInfo.lastSubs.join(",")+", pcdn"+i.join(",");m.default.logger.log(s,"color: #ff00ff")}}},{key:"onCheckFastTimer",value:function(e,t){this.started&&(this.loaderMgr.onCheckFastTimer(e,t),this.subStreamMgr.onCheckFastTimer(e,t),this.resender.onCheckFastTimer(e,t),this.iaasMgr.onCheckFastTimer(e,t),this.setRangeRTO())}},{key:"onCheckPcdnTimer",value:function(e,t){var n=this;if(this.started&&0!==Number(this.usePcdn)&&!this.getPcdnProxyList.isFirst){var i=this.subStreamMgr;if(i){for(var s=1===Number(m.default.config.pcdnSubsConfig[0]),r=1===Number(m.default.config.pcdnSubsConfig[1]),a=1===Number(m.default.config.pcdnSubsConfig[2]),o=i.subStreams,u=[],l=0;l<o.length;l++){var d=o[l].pubInfo.uid;(b.default.isForce(d)||s&&b.default.isCompete(d)||r&&b.default.isFixed(d)||a&&b.default.isDefault(d))&&u.push(l)}u.length>0&&this.subStreamMgr.cdnTryConnectPcdn(u,{getPcdnRsp:function(){n.subStreamMgr.getPcdnRsp()}}),m.default.logger.log("StreamBase.onCheckPcdnTimer sendReq",u)}}}},{key:"createToken",value:function(){return null}},{key:"createResender",value:function(){return null}},{key:"createSubStreamMgr",value:function(){return null}},{key:"onNoVideo",value:function(){this.streamHandler.onNoVideo()}},{key:"calcPeerLoss",value:function(e,t,n){if(!(t>100*n)){t<n&&(t=n);var i=m.default.TimeUtil.now();if(this.uploadCtrl.update(e,t,n,i),this.uploadCtrl.ready(i)){var s=this.uploadCtrl.updateUploadBandwidth(this.sInfo.curUplinkNum,i);s>this.sInfo.maxUplinkNum&&(this.sInfo.maxUplinkNum=s),y.default.setAbility(s,this.sInfo.curBitrate),this.sInfo.curUplinkNum=s,this.stat.updown_info.uplink_cnt=this.sInfo.curUplinkNum,this.stat.updown_info.uplink_limit_cnt=this.sInfo.maxUplinkNum}}}},{key:"onNodeOpen",value:function(e){this.subStreamMgr.onNodeOpen(e)}},{key:"onDelNode",value:function(e){this.subStreamMgr.onDelNode(e)}},{key:"startSubStream",value:function(){this.subStreamMgr.start()}},{key:"onFastSliceData",value:function(e){var t=e.parent;e.streamIndex=t.seq%this.sInfo.baseSubs,e.isFromPeer=!1,e.isRange=!1,e.isRepeat=!1,e.isSliceJumpFromPeer=!1,this.recevier.addSeq(t.seq),this.resender.onSlice(e),this.subStreamMgr.onSliceData(e)}},{key:"addBytes",value:function(e){this.streamHandler&&this.streamHandler.addBytes&&this.streamHandler.addBytes(e)}},{key:"onSliceData",value:function(e){var t=e.parent,n=t.payload.length+10;if(this.stat.updown_info.downlink_bw+=n,t.from===v.default.TYPE_PATCH){if(this.stat.bw.patch_bw+=n,this.stat.bw.cdn_total_bw+=n,this.addBytes(t.payload.length+10),this.loaderMgr.recvCdnSeq(t.seq),this.iaasMgr.isPcdnIaas){var i=this.iaasMgr.pcdnIaas;this.stat.iaas_total_info.hasOwnProperty(i)?this.stat.iaas_total_info[i]+=n:this.stat.iaas_total_info[i]=n,this.stat.iaas_valid_info.hasOwnProperty(i)?this.stat.iaas_valid_info[i]+=n:this.stat.iaas_valid_info[i]=n}}else{if(e.streamIndex=t.seq%this.sInfo.baseSubs,e.isFromPeer=!!t.uid,e.isFromPeer){var s=this.punchMgr.getNode(t.uid);s&&(e.nodeType=s.nodeType)}e.isRangePeer=11===t.from,e.isRange=t.from===v.default.TYPE_RANGE,e.isRepeat=this.recevier.hasSeq(t.seq),e.isSliceJumpFromPeer=g.default.isSliceJumpFromPeer(this.recevier.maxSeq,t,this.sInfo.lostSeqNum),this.resender.checkPeerResend(e),e.isRepeat||e.isSliceJumpFromPeer||(this.recevier.addSeq(t.seq),this.resender.onSlice(e)),e.isRepeat||this.streamHandler.onSliceData(e),e.isFromPeer?this.addBytes(t.payload.length+42):(e.isRange||this.loaderMgr.recvCdnSeq(t.seq),this.addBytes(n)),this.subStreamMgr.onSliceData(e)}}},{key:"onopen",value:function(){}},{key:"firstDataTimeout",value:function(e){}},{key:"onProbeSuc",value:function(){}},{key:"hasSeq",value:function(e){return this.recevier.hasSeq(e)}},{key:"urgentResend",value:function(e,t){this.resender.urgentResend(e,t)}},{key:"setLastPushedFrame",value:function(e,t,n,i){this.resender.setLastPushedFrame(e,t,n)}},{key:"setLastPlaySeq",value:function(e){this.resender.lastPlaySeq=e}},{key:"setQuickResendAudioSlice",value:function(e){this.resender.setQuickResendAudioSlice(e)}},{key:"setLastRenderSeq",value:function(e){this.resender.lastRenderSeq=e,this.recevier.setLastRenderSeq(e)}},{key:"getLastContinueSeq",value:function(){return this.recevier.lastContinuedSeq}},{key:"setDecodeDelay",value:function(e){this.resender.setDecodeDelay(e)}},{key:"setRangeRTO",value:function(){this.resender.setRangeRTO(this.loaderMgr.getRangeRTO())}},{key:"getSubChangeInfo",value:function(){return this.subStreamMgr.getSubChangeInfo()}},{key:"getRepeatSliceInfo",value:function(){return this.subStreamMgr.getRepeatSliceInfo()}},{key:"getPunchedCnt",value:function(){return this.punchMgr.getPunchedCnt()}},{key:"getPunchedCntWeb",value:function(){return this.punchMgr.getPunchedCntWeb()}},{key:"getPunchedCntSdk",value:function(){return this.punchMgr.getPunchedCntSdk()}},{key:"getPunchedCntMedia",value:function(){return this.punchMgr.getPunchedCntMedia()}},{key:"getPunchedCntSignal",value:function(){return this.punchMgr.getPunchedCntSignal()}},{key:"getRejectStat",value:function(){var e={};return(0,i.default)(e,this.punchMgr.rejectStat),this.punchMgr.rejectStat={},e}},{key:"turnStreamMode",value:function(){}},{key:"hasPub",value:function(){return this.subStreamMgr.pubMgr.hasPub()}},{key:"isSubsReady",value:function(){return this.loaderMgr.isSubsReady()}},{key:"getLastFullSubTs",value:function(){return this.subStreamMgr.lastFullSubTs}},{key:"printRange",value:function(){this.loaderMgr.printInfo()}},{key:"printInfo",value:function(){if(m.default.printSubInfo||this.openLog){var e=this.stat,t=e.bw.cdn_valid_bw,n=e.bw.cdn_total_bw,i=e.bw.pcdn_valid_bw,s=e.bw.pcdn_total_bw,r=e.bw.p2p_valid_bw,a=e.bw.p2p_total_bw,o=e.bw.range_total_bw,u=n+r+s,l="%cid"+this.id;l+=" "+this.punchMgr.getPunchedCnt()+(" "+this.subStreamMgr.subMgr.getUplinkNum()+"/"+this.sInfo.curUplinkNum+"/")+this.sInfo.maxUplinkNum+" "+this.subStreamMgr.getSubs().join(" | ")+(" "+(u>0?(r/u*100).toFixed(2):"0"))+"%"+(" p2p"+(a>0?(r/a*100).toFixed(2):"0"))+"%"+(" cdn"+(n>0?(t/n*100).toFixed(2):"0"))+"%"+(" pcdn"+(s>0?(i/s*100).toFixed(2):"0"))+"%"+(" "+(u>0?(o/u*100).toFixed(2):"0"))+"% "+e.bw.compete_bw+" "+this.subStreamMgr.getSubStreamDelays().join(",")+" "+this.bwCalc.getUpBw()+" csMinBw:"+this.sInfo.csMinBw+" SNBW:"+this.sInfo.SNBw+" remainP2pStreamNum:"+this.sInfo.remainP2pStreamNum+" alive:"+this.subStreamMgr.getAliveInfo(),m.default.logger.log(l,this.getColor())}}},{key:"getColor",value:function(){return"color:#5101AC"}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),s=r(n(1));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e)}return(0,s.default)(e,[{key:"onopen",value:function(e){}},{key:"onerrorBefore",value:function(e,t,n){}},{key:"onerror",value:function(e,t,n){}},{key:"oncloseBefore",value:function(e){}},{key:"onclose",value:function(e){}},{key:"onFirstSeq",value:function(e,t){}},{key:"onstatus",value:function(e,t){}},{key:"onFirstData",value:function(e){}},{key:"getBaseSubs",value:function(){return 0}},{key:"onDataInterval",value:function(e,t){}},{key:"onWebrtcCost",value:function(e,t){}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(77),s=i&&i.__esModule?i:{default:i},r={};!function(){var e=navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],n=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],i={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:n[0]||""},a={};if(i.browser){a[i.browser]=!0;var o=i.majorVersion.split(".");a.version={major:parseInt(i.majorVersion,10),string:i.version},o.length>1&&(a.version.minor=parseInt(o[1],10)),o.length>2&&(a.version.build=parseInt(o[2],10))}for(var u in i.platform&&(a[i.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),(a.rv||a.iemobile)&&(a.rv&&delete a.rv,i.browser="msie",a.msie=!0),a.edge&&(delete a.edge,i.browser="msedge",a.msedge=!0),a.opr&&(i.browser="opera",a.opera=!0),a.safari&&a.android&&(i.browser="android",a.android=!0),a.name=i.browser,a.platform=i.platform,r)r.hasOwnProperty(u)&&delete r[u];(0,s.default)(r,a)}(),r.version||(r.version={major:0,minor:0,build:0,string:"0.0.0"}),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n(218)),s=d(n(0)),r=d(n(1)),a=d(n(3)),o=d(n(2)),u=d(n(13)),l=d(n(219));function d(e){return e&&e.__esModule?e:{default:e}}var h={GOOD:0,BAD:1,GATHER:2},c=function(){function e(t){(0,s.default)(this,e),this.stream=t,this.stat=t.stat,this.isUseIaas=!1,this.pcdnIaas=null,this.pcdnIaasParam=null,this.domain302="",this.sendTs=0,this.checkTs=0,this.iaasLoader=new l.default(this),this.dropReqMaxCnt=o.default.config.iaasCfg[2]||10,this.dropReqCnt=0,this.dropCdTime=60*o.default.config.iaasCfg[1]*1e3,this.badBufferPer=o.default.config.iaasCfg[3]||.3,this.badBufferContinueTs=o.default.config.iaasCfg[4]||1e3,this.subDelayThreshold=o.default.config.iaasCfg[5]||2e3,this.subDelayThanThreshold=o.default.config.iaasCfg[6]||500,this.rangeContinueTs=o.default.config.iaasCfg[7]||1e4,this.rangeCntHold=o.default.config.iaasCfg[8]||5,this.rangeHold=o.default.config.iaasCfg[9]||.4,this.isUseGood=!1,this.isPcdnIaas=!1,this.checkRangeTs=0,this.lastResendCnt=0,this.lastResendTimeoutCnt=0,this.lastResendErrorCnt=0,this.useLevel=0,this.minLevel=2,this.maxLevel=0,this.startTs=0,this.subDelayMap=null,this.statGoodReqInfo={},this.statBadReqInfo={},this.statGatherReqInfo={},this.loaderIdx=-1e4}return(0,r.default)(e,[{key:"destroy",value:function(){this.pcdnIaas=null,this.pcdnIaasParam=null,this.domain302="",this.sendTs=0,this.checkTs=0,this.dropReqCnt=0,this.iaasLoader&&this.iaasLoader.destroy&&this.iaasLoader.destroy(),this.isUseGood=!1,this.isPcdnIaas=!1,this.checkRangeTs=0,this.startTs=0,this.subObj=null,this.statGoodReqInfo=null,this.statBadReqInfo=null,this.statGatherReqInfo=null,this.checkRangeTs=0,this.lastResendCnt=0,this.lastResendTimeoutCnt=0,this.lastResendErrorCnt=0,this.JITTER_BUFLEN=3e3}},{key:"initPInfo",value:function(e){this.startTs=o.default.TimeUtil.now(),e.pcdnIaas&&(e.pcdnIaas&&(this.isUseIaas=!0,this.isPcdnIaas=!0),0==o.default.config.iaasCfg[0]&&(this.isUseIaas=!1),this.domain302=e._domain302,this.JITTER_BUFLEN=e.JITTER_BUFLEN||3e3,this.pcdnIaas=e.pcdnIaas.split("-")[0],this.pcdnIaasParam=e.pcdnIaasParam,this.originPcdnIaas=e.pcdnIaas,this.parsePcdnIaasParam(this.pcdnIaasParam,this.pcdnIaas,!0),o.default.logger.log("IaasMgr.initPInfo,pcdnIaas="+this.pcdnIaas+",pcdnIaasParam="+this.pcdnIaasParam+", JITTER_BUFLEN="+this.JITTER_BUFLEN))}},{key:"parsePcdnIaasParam",value:function(e,t){var n={};if(e){var i=e.split("-");if(i)for(var s=i[0].split(","),r=0;r<s.length;r++){var a=s[r].split("_");2==a.length&&(n[a[0]]=a[1],a[0]==t&&(this.useLevel=Number(a[1])))}}o.default.logger.log("this.parsePcdnIaasParam minLevel="+this.minLevel+", useLevel="+this.useLevel)}},{key:"on302",value:function(e,t,n){if(o.default.logger.log("IaasMgr.on302,url="+e+",pIaasType="+t+",loaderIdx="+n),this.loaderIdx!=n&&(this.loaderIdx=n,null!=t)){var i=a.default.getQueryString("p_iaas",e),s=a.default.getQueryString("p_iaas_param",e);t==h.GOOD?this.resetDropReq():t==h.BAD||t==h.GATHER&&this.resetDropReq(),this.statRes(t,i,s),this.pcdnIaas=i,this.pcdnIaasParam=s,this.parsePcdnIaasParam(this.pcdnIaasParam,this.pcdnIaas);var r=e.match(/\/\/(.+?)\//i);r&&r.length>1&&(this.domain302=r[1]),this.stream.loaderMgr.streamDomain.domain302=this.domain302,this.stream.streamHandler&&this.stream.streamHandler.setPcdnIaas&&this.stream.streamHandler.setPcdnIaas(this.pcdnIaas),o.default.logger.log("IaasMgr.on302,pcdnIaas="+i+",pcdnIaasParam="+s+",")}}},{key:"statRes",value:function(e,t,n){var i=0,s=void 0;e==h.GATHER?i=1:((s=n.split("-")).length>1&&(i=s[1]),s=s[0]);var r=null;e==h.GOOD?r=this.statGoodReqInfo:e==h.BAD?r=this.statBadReqInfo:e==h.GATHER&&(r=this.statGatherReqInfo);var a={act:e,res:i,reason:r.reasonType,source:r.source,params:s,clash_sub:+!!r.isCompete};this.stat.p_iaas_info.push(a)}},{key:"onCheckTimer",value:function(e,t){this.isUseIaas&&((0==this.sendTs||e-this.sendTs>=6e4)&&(0!=this.sendTs&&this.sendGather(),this.sendTs=e),(0==this.checkRangeTs||e-this.checkRangeTs>=this.rangeContinueTs)&&(0!=this.checkRangeTs&&this.checkRangeQuality(e,t),this.checkRangeTs=e),this.dropReq())}},{key:"onCheckFastTimer",value:function(e,t){this.isUseIaas&&this.checkQuality(e,t)}},{key:"sendGather",value:function(){if(1!=localStorage._closeIaasGather&&1!=o.default.config.iaasCloseGather){var e=this.stream.loaderMgr.getUrl(u.default.TYPE_RANGE),t=e.split("?");if(!(t.length<=1)){var n=t[1],i=a.default.getQueryString("wsSecret",n),s=a.default.getQueryString("wsTime",n);e=t[0]+("?querytime="+Date.now()+"&wsSecret="+i+"&wsTime=")+s,o.default.logger.log("IaasMgr.sendGather,url=",e),this.iaasLoader.connect(e,"")}}}},{key:"checkQuality",value:function(e,t){if(0!=this.stream.loaderMgr.subList.length){var n;n=this.stream.streamHandler.getBufferLen(),0!=this.bufferBadStartTs&&e-this.bufferBadStartTs>this.badBufferContinueTs&&this.checkSubQuality(e,n),this.stream.streamHandler&&this.stream.streamHandler.getBufferLen&&(n>0&&n<=this.badBufferPer*this.JITTER_BUFLEN?this.bufferBadStartTs=e:this.bufferBadStartTs=0)}}},{key:"checkSubQuality",value:function(e,t){var n=this.getSubsDelay(),s=n.delayObj,r=n.delayList,a=this.stream.loaderMgr.subList;if(a.length==this.stream.subStreamMgr.subStreams.length)1==localStorage._printIaasInfo&&o.default.logger.log("IaasMgr.checkSubQuality useGoodReq, all subs, bufferLen="+t),this.useGoodReq(4);else{for(var u=a.length,l=[],d=[].concat((0,i.default)(r)),h=!1,c=0;c<u;c++){var f=a[c];if(s[f]>=this.subDelayThreshold){1==localStorage._printIaasInfo&&o.default.logger.log("IaasMgr.checkSubQuality useGoodReq, sub delay, bufferLen="+t+", delay="+s[f]+", "+this.subDelayThreshold),this.useGoodReq(4),h=!0;break}l.push(s[f]),d.splice(f,1)}if(h)return;for(var p=0;p<l.length;p++){for(var m=l[p],_=0;_<d.length;_++){var v=m-d[_];if(v>=this.subDelayThanThreshold){1==localStorage._printIaasInfo&&o.default.logger.log("IaasMgr.checkSubQuality useGoodReq, sub delay, bufferLen="+t+", diffDelay="+v+", "+this.subDelayThanThreshold),this.useGoodReq(4),h=!0;break}}if(h)break}}}},{key:"getSubsDelay",value:function(){for(var e=this.stream.subStreamMgr.subStreams,t=this.stream.subStreamMgr,n=[],i={},s=0,r=e.length;s<r;s++){var a=e[s],o=t.getSubStreamDelay(a.index);n.push(o),i[a.index]=o}return{delayObj:i,delayList:n}}},{key:"checkRangeQuality",value:function(e,t){var n=this.stat.resend_info.resend_cnt,i=this.stat.resend_info.timeout_cnt,s=this.stat.resend_info.error_cnt,r=n-this.lastResendCnt,a=i-this.lastResendTimeoutCnt,u=s-this.lastResendErrorCnt;if(this.lastResendCnt=n,this.lastResendTimeoutCnt=i,this.lastResendErrorCnt=s,!(r<=this.rangeCntHold)){var l=(a+u)/r;l>=this.rangeHold&&(o.default.logger.log("IaasMgr.checkRangeQuality useGoodReq, total="+r+", timeoutCnt="+a+", errorCnt="+u+", failPer="+l),this.useGoodReq(5))}}},{key:"onGatherRes",value:function(e){if(o.default.logger.log("IaasMgr.onRes,onRes=",e),200==e.status)o.default.logger.log("IaasMgr.onRes no302Req");else if(400==e.status){var t=e.statusText.split("-"),n=1;t.length>1&&(n=t[1]),o.default.logger.log("IaasMgr.onRes 302Req"),this.gatherReq(n)}}},{key:"onGatherError",value:function(){o.default.logger.log("IaasMgr.onGatherError")}},{key:"dropReq",value:function(){this.isUseGood&&(o.default.TimeUtil.now()-this.startTs<(this.dropReqCnt+1)*this.dropCdTime||this.dropReqCnt>this.dropReqMaxCnt||(this.useLevel>=this.minLevel?1==localStorage._printIaasInfo&&o.default.logger.log("IaasMgr.dropReq, useLevel="+this.useLevel+", minLevel="+this.minLevel):this.useBadReq()))}},{key:"useGoodReq",value:function(e,t){if(0!=this.stream.loaderMgr.subList.length){if(this.maxLevel==this.useLevel)return 1==localStorage._printIaasInfo&&o.default.logger.log("IaasMgr.increase best, useLevel="+this.useLevel),void(t&&(t.close(),this.stream.loaderMgr.reconnectSub(t)));this.statReq(h.GOOD,e),this.isUseGood=!0,o.default.logger.log("IaasMgr.increase useLevel=",this.useLevel),this.stream.loaderMgr.useGoodReq(this.pcdnIaas,0,e||3)}}},{key:"useBadReq",value:function(){0!=this.stream.loaderMgr.subList.length&&this.minLevel!=this.useLevel&&(o.default.logger.log("IaasMgr.decrease useLevel=",this.useLevel),this.statReq(h.BAD,6),this.stream.loaderMgr.useBadReq(this.pcdnIaas,1,6),this.dropReqCnt++)}},{key:"gatherReq",value:function(e){0!=this.stream.loaderMgr.subList.length&&(o.default.logger.log("IaasMgr.gatherReq, reason="+e),this.statReq(h.GATHER,e),this.stream.loaderMgr.useGatherReq(this.pcdnIaas,2,e))}},{key:"statReq",value:function(e,t){var n=this,i=this.pcdnIaas+"_"+this.useLevel,s=this.stream.loaderMgr.subList,r=!1;this.stream.subStreamMgr&&this.stream.subStreamMgr.subStreams&&this.stream.subStreamMgr.subStreams.map(function(e){if(-1!=s.indexOf(e.index)){var t=e.pubInfo.uid;n.stream.subStreamMgr.getIsCompete(t)&&(r=!0)}}),e==h.GOOD?(this.statGoodReqInfo.reasonType=t,this.statGoodReqInfo.source=i,this.statGoodReqInfo.isCompete=r):e==h.BAD?(this.statBadReqInfo.reasonType=t,this.statBadReqInfo.source=i,this.statBadReqInfo.isCompete=r):e==h.GATHER&&(this.statGatherReqInfo.reasonType=t,this.statGatherReqInfo.source=i,this.statGatherReqInfo.isCompete=r)}},{key:"resetDropReq",value:function(){this.startTs=o.default.TimeUtil.now(),this.dropCdTime=12e4,this.dropReqCnt=0}},{key:"subNoData",value:function(e,t){o.default.logger.log("IaasMgr.subNoData, type="+e),this.useGoodReq(3,t)}}]),e}();c.ReqType=h,t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(0)),s=a(n(1)),r=a(n(2));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,i.default)(this,e),this.stream=t,this.streamName=t.sInfo.streamId.streamName,this.token="",this.nextTime=0,this.interval=24e4}return(0,s.default)(e,[{key:"start",value:function(){this.getToken()}},{key:"stop",value:function(){r.default.logger.log("TokenBase.stop",this.stream.id),this.nextTime=0}},{key:"onCheckTimer",value:function(e){this.nextTime>0&&this.nextTime<e&&this.getToken()}},{key:"getToken",value:function(){}},{key:"sendWup",value:function(e,t,n){r.default.TafLink.sendWup(e,t,n,this.onGetToken.bind(this),!0,r.default.TafLink.getRequestId())}},{key:"onGetToken",value:function(e){this.nextTime=r.default.TimeUtil.now()+this.interval,this.stream.streamHandler&&this.stream.streamHandler.onGetToken(this.token),this.printToken()}},{key:"printToken",value:function(){var e="TokenBase.onGetToken id="+this.stream.id,t=this.token.match(/wsTime=(.+?)($|\&)/);if(t){var n=1e3*parseInt(t[1],16),i=r.default.TimeUtil.getDateTimeStr(n,!1);e+="\nwsTime"+t[1]+" => "+i}e+="\n"+this.token,r.default.logger.log(e)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=v(n(8)),s=v(n(74)),r=v(n(10)),a=v(n(0)),o=v(n(1)),u=v(n(32)),l=v(n(2)),d=v(n(240)),h=v(n(33)),c=v(n(3)),f=v(n(55)),p=v(n(241)),m=v(n(81)),_=v(n(19));function v(e){return e&&e.__esModule?e:{default:e}}v(n(118)),v(n(80)),t.default=function(){function e(t){(0,a.default)(this,e),this.stream=t,this.sInfo=t.sInfo,this.stat=t.stat,this.seqLostMap=new r.default,this.srcSeqLostMap=new r.default,this.peerMarkMap=new r.default,this.firstSeqHoleMap=new r.default,this.hisSeqMap=new r.default,this.seqHelper=new p.default(this),this.lostSeqsMap=new r.default,this.lastRenderSeq=0,this.packetSeqGap=1e4,this.maxRecvSeq=0,this.cdnMaxSeq=0,this.frameIntervalArr=[],this.lastPushBufferFrameId=0,this.lastPushBufferFrameDts=0,this.playbufferLen=0,this.checkStarted=!1,this.frameInterval=0,this.rangeRTO=200,this.ResendWaitLimit=0,this.sliceListLengthMax=25e3,this.maxVideoContinuesSeq=0,this.sliceQuantityPerSecond=0,this.PrintResender=Number(u.default.printResender),this.rtPeerTimeout=400,this.checkNumMax=5e3,this.resendNumMax=512,this.lostSeqNumMax=1e4,this.printSeqNumMax=512,this.rtPeerMax=0,this.rtPeerPer=0,this.rtPeerRTONum=0,this.remuxDuration=0,this.decodeDelay=0,this.decodeDelayDefault=100,this.rangeGap=0,this.initConfig(),this._lastPrintTs=0}return(0,o.default)(e,[{key:"printResendInfo",value:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var a,o=(0,i.default)(this.lostSeqsMap.entries());!(t=(a=o.next()).done);t=!0){var u=a.value,d=(0,s.default)(u,2),h=d[0],c=d[1];if(e.push(h+",sst="+c.seqState+",rst="+c.resendState),e.length>=this.printSeqNumMax)break}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}e.length>0&&l.default.logger.log("ResenderBaseV2.printResenerInfo: "+e.join(" | "))}},{key:"setDecodeDelay",value:function(e){0===this.decodeDelay?this.decodeDelay=e:this.decodeDelay=(7*this.decodeDelay+e)/8}},{key:"initConfig",value:function(){this.MaxResendTimes=Number(l.default.config.maxResendTimes)||3,this.ResendDelayTs=Number(l.default.config.resendDelayTs)||400,this.rtPeerTimeout=l.default.getCfgValNum("rtPeerTimeout",400),this.rtPeerMax=l.default.getCfgValNum("rtPeerMax",1),this.rtPeerPer=l.default.getCfgValNum("rtPeerPer",0),this.rtPeerRTONum=l.default.getCfgValNum("rtPeerRTONum",2),this.remuxDuration=l.default.getCfgValNum("popDuration",200),this.decodeDelayDefault=l.default.getCfgValNum("decodeDelay",100),this.rtPeerUgMin=l.default.getCfgValNum("rtPeerUgMin",400);var e=c.default.getCfgRateValue(l.default.config.rtPeerUgMinCfg,this.sInfo.presenterUid,this.sInfo.curBitrate,0);e>0&&(this.rtPeerUgMin=e),this.kPlayThreshold=c.default.getCfgRateValue(l.default.config.resendUrgentCfg,this.sInfo.presenterUid,this.sInfo.curBitrate,1e3),l.default.logger.log("ResenderBase.initConfig rtPeerTimeout="+this.rtPeerTimeout+" rtPeerMax="+this.rtPeerMax+" rtPeerPer="+this.rtPeerPer+" rtPeerUgMin="+this.rtPeerUgMin)}},{key:"destroy",value:function(){l.default.logger.log("ResenderBase.destroy",this.stream.id),this.reset()}},{key:"setCurBitrate",value:function(e){var t=l.default.config.resendWaitLimitList;this.ResendWaitLimit=t&&t[e]?t[e]:null;var n=l.default.config.sliceListLengthMaxList;this.sliceListLengthMax=n&&n[e]?n[e]:2e4,this.sliceQuantityPerSecond=e/1e3*h.default.SLICE_SPEED*this.sInfo.baseSubs,this.lateSeqLimit=5*this.sliceQuantityPerSecond}},{key:"reset",value:function(){this.lastRenderSeq=0,this.maxRecvSeq=0,this.peerMarkMap.clear(),this.firstSeqHoleMap.clear(),this.srcSeqLostMap.clear(),this.hisSeqMap.clear(),this.seqLostMap.clear(),this.lostSeqsMap.clear()}},{key:"checkPeerResend",value:function(e){this.seqHelper.onSlice(e);var t=e.parent;e.isRangePeer&&(this.stat.pResend_info.prsucnt++,this.peerMarkMap.has(t.seq)&&(1===this.peerMarkMap.get(t.seq).resendTimesPeer&&this.stat.pResend_info.prfscnt++,this.peerMarkMap.delete(t.seq)))}},{key:"onSlice",value:function(e){var t=e.parent.seq;this.lostSeqsMap.delete(t);var n=l.default.TimeUtil.now();if(0===this.maxRecvSeq)this.maxRecvSeq=t;else if(this.maxRecvSeq<t){var i=t-this.maxRecvSeq;i>this.packetSeqGap?l.default.logger.log("ResenderBaseV3.checkLostSeq curSeq="+t+" maxRecvSeq="+this.maxRecvSeq+" gap="+i+", is too larger"):i>1&&(this.checkLost(e,this.maxRecvSeq,n,1),this.lostSeqsMap.size>=this.lostSeqNumMax&&(c.default.setLsFlag(this.stream.sInfo.presenterUid,this.stream.sInfo.sessionId),l.default.logger.log("ResenderBaseV3.checkLostSeq clear lostSeqsMap, size="+this.lostSeqsMap.size),this.lostSeqsMap.clear())),this.maxRecvSeq=t}}},{key:"setPacketSeqGap",value:function(e){this.packetSeqGap=e}},{key:"checkLost",value:function(e,t,n,i){for(var s=t+i,r=0,a=0;s<e.parent.seq;)this.stream.recevier.hasSeq(s)||(this.addResendInfo(s,n),r++,0===a&&(a=s)),s+=i;this.PrintResender&&r>0&&l.default.logger.log("ResnderBase.checkLost add resend from="+e.parent.from+" count="+r+" from="+a)}},{key:"fillCdnHole",value:function(e,t,n,i){var s=this.addResendInfo(e,t);s.isSeqCdnResending()||(s.resendState=d.default.ResendState.HOLE,this.addResendItem(t,s,n,i))}},{key:"addResendInfo",value:function(e,t){var n=this.lostSeqsMap.get(e);if(!n){var i=new d.default(d.default.NORMAL);i.key=e,i.seq=e,i.streamIndex=e%this.sInfo.baseSubs,i.createStampc=t,this.lostSeqsMap.set(e,i)}return n}},{key:"getRto",value:function(e){return 200}},{key:"getRangeRto",value:function(){return this.rangeRTO}},{key:"setRangeRTO",value:function(e){this.rangeRTO=e}},{key:"urgentResend",value:function(e){}},{key:"reduceSeqs",value:function(e){for(var t=e.length,n=(l.default.TimeUtil.now(),t-1);n>=0;n--){var i=e[n];if(this.stream.recevier.hasSeq(i)||i<this.lastRenderSeq)e.splice(n,1),this.lostSeqsMap.delete(i);else if(this.cdnMaxSeq>0&&i>this.cdnMaxSeq){var s=this.lostSeqsMap.get(i);s&&(s.resendTimes=0,s.createStampc+=this.ResendDelayTs),e.splice(n,1)}}}},{key:"onResendRetry",value:function(e,t){var n=e.length;if(e&&n){t||(t=this.ResendDelayTs);for(var i=0,s=l.default.TimeUtil.now(),r=0;r<n;r++){var a=e[r];if(this.stream.recevier.hasSeq(a))this.lostSeqsMap.delete(a);else if(a<this.lastRenderSeq)this.stat.resend_info.miss_cnt++,this.stat.range_miss_ts=s,this.lostSeqsMap.delete(a);else{var o=this.lostSeqsMap.get(a);o&&(o.setWaiting(),o.resendTimes<this.MaxResendTimes?(o.createStampc+=t,i++):(this.stream.recevier.addSeq(a),this.stat.resend_info.miss_cnt++,this.stat.range_miss_ts=s,this.lostSeqsMap.delete(a)))}}i&&this.stat.resend_info.repeat_cnt++}}},{key:"resendAudio",value:function(e){var t=l.default.TimeUtil.now(),n=[],a=new r.default,o=0,u=0,h=!0,c=!1,f=void 0;try{for(var p,m=(0,i.default)(this.lostSeqsMap.entries());!(h=(p=m.next()).done);h=!0){var _=p.value,v=(0,s.default)(_,2),g=v[0],y=v[1];if(o++,g>e||!y.isSeqCdnResending()&&(u++,y.resendState=d.default.ResendState.NORMAL,this.addResendItem(t,y,n,a),u>=this.resendNumMax||o>this.checkNumMax))break}}catch(e){c=!0,f=e}finally{try{!h&&m.return&&m.return()}finally{if(c)throw f}}this._resend(t,n,a),n.length>0&&l.default.logger.log("ResenderBase.resendAudio videoFullSeqMax="+e,n.toString())}},{key:"onCheckFastTimer",value:function(e,t){this.seqHelper.checkTimeout(e),c.default.removeTimeoutByKey(e,this.peerMarkMap,"resendPeerMarkTs",1e4),c.default.removeTimeoutByKey(e,this.srcSeqLostMap,"time",1e4),c.default.removeTimeout(e,this.firstSeqHoleMap,1e4),c.default.removeTimeout(e,this.hisSeqMap,1e4),this.checkResendItem(e)}},{key:"checkResendItem",value:function(e){if(!(this.stream.loaderMgr.getRangeWaitNum()>=2560)){var t=[],n=new r.default,a=0,o=0,u=this.stream.getBufferLen(),l=!0,h=!1,c=void 0;try{for(var f,p=(0,i.default)(this.lostSeqsMap.entries());!(l=(f=p.next()).done);l=!0){var m=f.value,_=(0,s.default)(m,2),v=_[0],g=_[1];if(a++,g.seq<this.lastRenderSeq||g.resendTimes>=this.MaxResendTimes)this.lostSeqsMap.delete(v);else if(g.isSeqCdnResending()||(g.isSeqPeerResending()&&g.isResendPeerTimeout(e,this.rtPeerTimeout)&&this.setPeerResendFail(g,d.default.PeerFailReason.TIMEOUT),this.isTooEarlyToResend(g,e,u),g.isReady()&&(this.addResendItem(e,g,t,n),o++)),o>=this.resendNumMax||a>=this.checkNumMax)break}}catch(e){h=!0,c=e}finally{try{!l&&p.return&&p.return()}finally{if(h)throw c}}this._resend(e,t,n)}}},{key:"isTooEarlyToResend",value:function(e,t,n){var i=this.getRangeRto(),s=Math.min(2500,this.sInfo.JITTER_BUFLEN/2);if(this.checkStarted){var r=i*this.rtPeerRTONum+(this.decodeDelay||this.decodeDelayDefault);if(1===l.default.config.rtPeerUrgentOpt&&(r+=this.remuxDuration+.5*this.rangeGap),n<(r=Math.max(r,this.rtPeerUgMin)))return void(e.resendState=d.default.ResendState.URGENT)}t-e.createStampc>s-i?e.resendState=d.default.ResendState.NORMAL:e.resendState=d.default.ResendState.NOT_REACH}},{key:"setLastPushedFrame",value:function(e,t,n){var i,s;if(this.playbufferLen=n,this.checkStarted=!0,!((s=t-this.lastPushBufferFrameId)<=0)){i=(e-this.lastPushBufferFrameDts)/s,this.frameIntervalArr.push(i),this.frameIntervalArr.length>30&&this.frameIntervalArr.shift();for(var r=0,a=0;a<this.frameIntervalArr.length;a++)r+=this.frameIntervalArr[a];this.frameInterval=r/this.frameIntervalArr.length,this.lastPushBufferFrameId=t,this.lastPushBufferFrameDts=e}}},{key:"addResendItem",value:function(e,t,n,i){var s=t.seq,r=!1;if(t.resendPeerTs=0,t.isNormal()&&t.isCanResendFromPeer(this.rtPeerMax,this.rtPeerPer)){var a=this.sInfo.baseSubs,o=t.streamIndex,u=i.get(o);u||(u={min:0,max:0,list:[]},i.set(o,u)),u.list.length<255&&(0===u.min&&(u.min=s,u.max=s),u.min>s&&(u.max-s)/a<255&&(u.min=s),u.max<s&&(s-u.min)/a<255&&(u.max=s),u.min<=s&&s<=u.max&&(r=!0,t.setPeerResending(),u.list.push(t)))}r||(t.setCdnResending(),this.addCdnSeqStat(t,e),n.push(s))}},{key:"_resend",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(n.size>0){var o=!0,u=!1,h=void 0;try{for(var c,p=(0,i.default)(n.entries());!(o=(c=p.next()).done);o=!0){for(var m=c.value,_=(0,s.default)(m,2),v=_[0],g=_[1],y=g.min,S=g.max,b=[],P=0;P<g.list.length;P++){var k=(g.list[P].seq-y)/this.sInfo.baseSubs;b.push(k)}this.stream.subStreamMgr.sendPeerRangeReq({index:v,startSeq:y,endSeq:S,offsets:b,mode:f.default.GLOBAL,randomPeer:a})?g.list.forEach(function(t){t.resendPeerTs=e,t.resendPeerMarkTs=e,r.stat.pResend_info.prttcnt++,1===t.resendTimesPeer&&r.stat.pResend_info.prftcnt++,r.peerMarkMap.set(t.seq,t)}):g.list.forEach(function(n){n.resendPeerFailReason=d.default.PeerFailReason.NO_PEER,n.setCdnResending(),r.addCdnSeqStat(n,e),t.push(n.seq)})}}catch(e){u=!0,h=e}finally{try{!o&&p.return&&p.return()}finally{if(u)throw h}}n.clear()}t.length>0&&(1==localStorage._printPeerRange&&l.default.logger.log("ResenderBase._resendQueue",t),this.sendRangeCdn(t))}},{key:"sendRangeCdn",value:function(e){this.sendSeqLost(),this.stream.loaderMgr.loadRangeNormal(e,this.lastRenderSeq)}},{key:"sendSeqLost",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=(0,i.default)(this.seqLostMap);!(e=(r=a.next()).done);e=!0){var o=r.value,u=(0,s.default)(o,2),l=u[0],d=u[1];d.sort(function(e,t){return e-t});for(var h=[],c=d[0],f=0;f<d.length;f++){var p=d[f];h.push(p-c)}this.stream.subStreamMgr.sendSeqLost(l,c,h)}}catch(e){t=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw n}}this.seqLostMap.clear()}},{key:"recvPeerRangeRsp",value:function(e){var t=this;e&&e.length>0&&e.forEach(function(e){var n=t.lostSeqsMap.get(e);n&&t.setPeerResendFail(n,d.default.PeerFailReason.NO_PEER_CACHE)})}},{key:"setPeerResendFail",value:function(e,t){e.resendPeerTs=0,e.createStampc+=this.ResendDelayTs,e.resendPeerFailReason=t}},{key:"setQuickResendAudioSlice",value:function(e){if(this.maxVideoContinuesSeq!=e){for(var t=this.sInfo.JITTER_BUFLEN/2,n=this.lostSeqs.head,i=!1;!i&&n;){if(this.maxVideoContinuesSeq<n.data.seq&&e>n.data.seq&&(n.data.createStampc-=t),n.data.seq>e){i=!0;break}n=n.next}this.maxVideoContinuesSeq=e}}},{key:"checkHisSeqHole",value:function(e){var t=l.default.TimeUtil.now(),n=e%this.sInfo.baseSubs,r=0,a=!0,o=!1,u=void 0;try{for(var d,h=(0,i.default)(this.lostSeqsMap.entries());!(a=(d=h.next()).done);a=!0){var c=d.value,f=(0,s.default)(c,2),p=f[0],m=f[1];if(r++,p>e||(m.streamIndex===n&&this.firstSeqHoleMap.set(m.seq,t),r>=this.checkNumMax))break}}catch(e){o=!0,u=e}finally{try{!a&&h.return&&h.return()}finally{if(o)throw u}}}},{key:"addFirstSeqHoleSeq",value:function(e){this.firstSeqHoleMap.set(e,l.default.TimeUtil.now())}},{key:"addSrcSeqLost",value:function(e,t,n){this.hisSeqMap.has(e)?(this.recordSrcFrom(n,1),this.hisSeqMap.delete(e)):this.srcSeqLostMap.set(e,{time:t,from:n})}},{key:"recordSrcFrom",value:function(e,t){}},{key:"checkSrcSeqLostTimeout",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,o=(0,i.default)(this.srcSeqLostMap);!(t=(a=o.next()).done);t=!0){var u=a.value,l=(0,s.default)(u,2),d=l[0];e-l[1].time>2e4&&this.srcSeqLostMap.delete(d)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"addCdnSeqStat",value:function(e,t){this.stat.pResend_info.sstt++;var n=this.stream.subStreamMgr.subStreams[e.streamIndex],i=this.stat.subStreamStat.substream_type[e.streamIndex],s=e.seq<n.pubInfo.firstSeq;if(i===m.default.PEER?s?this.stat.pResend_info.sshpeer++:this.stat.pResend_info.sspeer++:i===m.default.PCDN?(s?this.stat.pResend_info.sshpcdn++:this.stat.pResend_info.sspcdn++,_.default.isCompete(n.pubInfo.uid)&&(s?this.stat.peer_range_nonode.prnpub++:this.stat.peer_range_nonode.prnsub++)):i===m.default.CDN&&(_.default.isCompete(n.pubInfo.uid)?s?this.stat.pResend_info.sshcdnc++:this.stat.pResend_info.sscdnc++:(_.default.isForce(n.pubInfo.uid)||_.default.isDefault(n.pubInfo.uid))&&(s?this.stat.pResend_info.sshcdnf++:this.stat.pResend_info.sscdnf++)),1===l.default.config.rtPeerSrc)if(i!==m.default.PEER){var r=this.seqLostMap.get(e.streamIndex);r||(r=[],this.seqLostMap.set(e.streamIndex,r)),r.push(e.seq)}else if(this.srcSeqLostMap.has(e.seq)){var a=this.srcSeqLostMap.get(e.seq);this.recordSrcFrom(a.from,1),this.srcSeqLostMap.delete(e.seq)}else this.hisSeqMap.set(e.seq,t);e.isUrgent()&&0===e.resendTimesPeer?this.stat.pResend_info.prugcnt++:e.resendPeerFailReason===d.default.PeerFailReason.NO_PEER?this.stat.pResend_info.prndcnt++:e.resendPeerFailReason===d.default.PeerFailReason.NO_PEER_CACHE?this.stat.pResend_info.prnncnt++:e.resendPeerFailReason===d.default.PeerFailReason.TIMEOUT&&this.stat.pResend_info.prtocnt++}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={COMPETE_CDN:1,COMPETE_PCDN:2,FORCE_CDN:3,FORCE_PCDN:4,PEER:5,OTHER:6}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=k(n(10)),s=k(n(8)),r=k(n(120)),a=k(n(0)),o=k(n(1)),u=n(9),l=k(n(244)),d=k(n(246)),h=k(n(247)),c=k(n(19)),f=k(n(2)),p=k(n(121)),m=k(n(13)),_=k(n(56)),v=k(n(81)),g=k(n(54)),y=k(n(122)),S=k(n(248)),b=k(n(39)),P=k(n(249));function k(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t,n){(0,a.default)(this,e),this.stream=t,this.sInfo=t.sInfo,this.stat=t.stat,this.SubStreamCla=n,this.pcdnSwitcher=new P.default(this),this.baseIndexCalc=new h.default(this.sInfo),this.subMgr=new l.default(this),this.pubMgr=new d.default(this,t.sInfo.baseSubs),this.proxy=new u.StreamProxy(this),this.pcdnSucRate=new S.default(t.sInfo.isMedia),this.checkTimes=0,this.subStreams=[],this.lastFullSubTs=0,this.subGap=0,this.lastSubTs=0,this.initSubStreams(),t.cdnpProxy.protoHandler.on(u.ProtoUri.PCDNSubscribeRes,this.recvSubRes,this),t.cdnpProxy.protoHandler.on(u.ProtoUri.PCDNCompeteSubscribeRes,this.recvCompeteRes,this),this.subsBwState={},this.lastSubStreamStat=u.SubStreamState.INIT}return(0,o.default)(e,[{key:"destroy",value:function(){f.default.logger.log("SubStreamMgr.destroy",this.stream.id);for(var e=0;e<this.subStreams.length;e++)this.subStreams[e].reset();this.sInfo.lastSubs=[],this.sInfo.subChange=!1,this.lastFullSubTs=0,this.lastSubTs=0,this.subMgr.reset(),this.pubMgr.reset(),this.subsBwState={}}},{key:"onRestart",value:function(){for(var e=0;e<this.subStreams.length;e++)this.subStreams[e].restart();this.sInfo.lastSubs=[],this.sInfo.subChange=!1,this.lastFullSubTs=0,this.lastSubTs=0,this.subMgr.reset(),this.pubMgr.reset()}},{key:"initSubStreams",value:function(){for(var e=0;e<this.stream.sInfo.baseSubs;e++){var t=new this.SubStreamCla(e,this);this.subStreams.push(t)}this._checkFixed()}},{key:"initConfig",value:function(){this._checkFixed()}},{key:"initSliceCacheConfig",value:function(e,t){f.default.logger.log("SubStreamMgr.initSliceCacheConfig, cache="+e+" dispatch="+t);for(var n=0;n<this.subStreams.length;n++){var i=this.subStreams[n];i.sliceCacheNum=e,i.dispatchCacheNum=t}}},{key:"_checkFixed",value:function(){var e=this._getCoderateFixedNum();e=this._getSeaFixedNum(e),this.sInfo.useCdnpFixed&&this.sInfo.cdnpFixedNum>0&&(e=this.sInfo.cdnpFixedNum);for(var t=0;t<this.subStreams.length;t++)this.subStreams[t].isFixed=t<e}},{key:"_getCoderateFixedNum",value:function(){for(var e=f.default.config.coderates,t=null,n=0,i=0;i<e.length;i++)if(t=e[i],this.sInfo.curBitrate>Number(t[0])){n=Number(t[1]);break}return n}},{key:"_getSeaFixedNum",value:function(e){if(f.default.config.seaSubNums&&f.default.config.seaSubNums.length>0)for(var t=f.default.config.seaSubNums.length,n=0;n<t;n++){var i=f.default.config.seaSubNums[n],s=Number(i[0]),r=Number(i[1]);1!==s&&s!=this.sInfo.roomId||(e=r)}return e}},{key:"getSubStreamDelay",value:function(e){var t=this.subStreams[e];return t?t.getStreamDelay():0}},{key:"getSubs",value:function(){for(var e=[],t=0;t<this.subStreams.length;t++){var n=t+":",i=this.subStreams[t].pubInfo.uid;c.default.isDefault(i)?n+="d":c.default.isCompete(i)?n+="c":c.default.isForce(i)?n+="f":c.default.isFixed(i)?n+="fi":n+=i,e.push(n)}return e}},{key:"getSubsStat",value:function(){for(var e=[],t=0;t<this.subStreams.length;t++){var n=t+":",i=this.subStreams[t].pubInfo.uid;c.default.isDefault(i)?n+="f":c.default.isCompete(i)?n+="c":c.default.isForce(i)?n+="f":c.default.isFixed(i)?n+="fi":n+="p:3";var s=this.stat.subStreamStat.substream_type[t];c.default.isProxyUid(i)&&(s===v.default.CDN?n+=":1":n+=":2"),e.push(n)}return e}},{key:"hasPcdnSubs",value:function(){for(var e=0;e<this.subStreams.length;e++){var t=this.subStreams[e].pubInfo.uid,n=this.stat.subStreamStat.substream_type[e];if(c.default.isProxyUid(t)&&n===v.default.PCDN)return!0}return!1}},{key:"getSubStreamDelays",value:function(){for(var e=[],t=0;t<this.subStreams.length;t++)e.push(this.subStreams[t].getStreamDelay());return e}},{key:"getSubStreamDleayDelta",value:function(){for(var e=r.default,t=0,n=0;n<this.subStreams.length;n++){var i=this.subStreams[n].getStreamDelay();i<_.default.DEFAULT_DELAY&&(e>i&&(e=i),t<i&&(t=i))}return 0!==t&&e!==r.default?t-e:0}},{key:"fillAliveStream",value:function(e,t){e.subMinBw=this.subMgr.getSubMinBw(),e.subNum=this.subMgr.getSubNum(t),e.remainUplinkNum=Math.max(this.sInfo.curUplinkNum-this.subMgr.getUplinkNum(),0);for(var n=0;n<this.subStreams.length;n++){var i=this.subStreams[n];e.streamDelays.push(i.getStreamDelay()),e.maxRecvSeqs.push(i.pubInfo.maxRecvSeq)}}},{key:"onNodeOpen",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,a=(0,s.default)(this.subStreams);!(t=(r=a.next()).done);t=!0)r.value.addPubCandidate(e)}catch(e){n=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw i}}}},{key:"onDelNode",value:function(e){this.subMgr.delNode(e),this.pubMgr.delNode(e);var t=!0,n=!1,i=void 0;try{for(var r,a=(0,s.default)(this.subStreams);!(t=(r=a.next()).done);t=!0)r.value.delPubCandidate(e)}catch(e){n=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw i}}}},{key:"cdnpReconnect",value:function(){for(var e=[],t=[],n=0;n<this.subStreams.length;n++){var i=this.subStreams[n];c.default.isCompete(i.pubInfo.uid)?e.push(n):c.default.isForce(i.pubInfo.uid)&&t.push(n)}e.length>0&&this.proxy.sendCompeteReq(e),t.length>0&&this.proxy.sendForceSubscribeNotify(t)}},{key:"getAliveInfo",value:function(){for(var e=[],t=0;t<this.subStreams.length;t++){var n=this.subStreams[t];e.push(n.sliceNum+","+n.sendAliveNum+","+n.recvAliveNum),n.sliceNum=n.sendAliveNum=n.recvAliveNum=0}return e.join("|")}},{key:"onSliceData",value:function(e){var t=e.parent,n=t.payload.length+10,i=this.subStreams[e.streamIndex],s=t.prop;if(e.isRange=t.from===m.default.TYPE_RANGE,t.seq>this.maxRecvSeq&&(this.maxRecvSeq=t.seq),e.isFromPeer)this.stat.bw.p2p_total_bw+=n,e.isRepeat?this.stat.bw.p2p_repeat_bw+=n:this.stat.bw.p2p_valid_bw+=n,e.nodeType===u.NodeType.SDK_CLIENT_V2?(this.stat.bw.p2p_total_bw_sdkv2+=n,e.isRepeat?this.stat.bw.p2p_repeat_bw_sdkv2+=n:this.stat.bw.p2p_valid_bw_sdkv2+=n):e.nodeType===u.NodeType.WEB_CLIENT_V2&&(this.stat.bw.p2p_total_bw_webv2+=n,e.isRepeat?this.stat.bw.p2p_repeat_bw_webv2+=n:this.stat.bw.p2p_valid_bw_webv2+=n),e.isRangePeer&&(this.stat.bw.peer_range_total_bw+=n,e.isRepeat?this.stat.bw.peer_range_repeat_bw+=n:this.stat.bw.peer_range_valid_bw+=n),12===t.from&&(this.stat.bw.prptbw+=n,e.isRepeat||(this.stat.bw.prpvbw+=n)),e.isRange&&(this.stat.bw.crptbw+=n,e.isRepeat||(this.stat.bw.crpvbw+=n));else{if(s&&s.isPcdn)this.stat.bw.pcdn_total_bw+=n,e.isRepeat?this.stat.bw.pcdn_repeat_bw+=n:this.stat.bw.pcdn_valid_bw+=n;else if(this.stat.bw.cdn_total_bw+=n,this.statCPBw(e,t,n,s),e.isRepeat?this.stat.bw.cdn_repeat_bw+=n:this.stat.bw.cdn_valid_bw+=n,this.stream&&this.stream.iaasMgr&&this.stream.iaasMgr.isPcdnIaas){var r=this.stream.iaasMgr.pcdnIaas;this.stat.iaas_total_info.hasOwnProperty(r)?this.stat.iaas_total_info[r]+=n:this.stat.iaas_total_info[r]=n,e.isRepeat?this.stat.iaas_repeat_info.hasOwnProperty(r)?this.stat.iaas_repeat_info[r]+=n:this.stat.iaas_repeat_info[r]=n:this.stat.iaas_valid_info.hasOwnProperty(r)?this.stat.iaas_valid_info[r]+=n:this.stat.iaas_valid_info[r]=n}e.isRange&&(this.stat.bw.range_total_bw+=n,e.isRepeat||(this.stat.bw.range_valid_bw+=n))}i&&(e.isFromPeer||e.isRange||(t.from===m.default.TYPE_FULL?this.stat.bw.fast_bw+=n:c.default.isDefault(i.pubInfo.uid)?(this.stat.bw.default_bw+=n,s&&s.isPcdn?(this.stat.bw.default_pcdn_bw+=n,this.pcdnStatReport(s,n)):this.stat.bw.default_cdn_bw+=n):c.default.isCompete(i.pubInfo.uid)?(this.stat.bw.compete_bw+=n,s&&s.isPcdn?(this.stat.bw.compete_pcdn_bw+=n,this.pcdnStatReport(s,n)):this.stat.bw.compete_cdn_bw+=n):c.default.isForce(i.pubInfo.uid)?(this.stat.bw.force_bw+=n,s&&s.isPcdn?(this.stat.bw.force_pcdn_bw+=n,this.pcdnStatReport(s,n)):this.stat.bw.force_cdn_bw+=n):c.default.isFixed(i.pubInfo.uid)&&(this.stat.bw.fixed_bw+=n,s&&s.isPcdn?(this.stat.bw.fixed_pcdn_bw+=n,this.pcdnStatReport(s,n)):this.stat.bw.fixed_cdn_bw+=n)),i.onSliceData(e))}},{key:"pcdnStatReport",value:function(e,t){e.pcdnName&&(this.stat.pcdn_bw_data[e.pcdnName]?this.stat.pcdn_bw_data[e.pcdnName]+=t:this.stat.pcdn_bw_data[e.pcdnName]=t)}},{key:"start",value:function(){this._checkFixed();var e=f.default.TimeUtil.now(),t=[],n=!0,i=!1,r=void 0;try{for(var a,o=(0,s.default)(this.subStreams);!(n=(a=o.next()).done);n=!0){var u=a.value;t.push(u.index),u.isFixed?u.subFixed(e):u.subDefault(e)}}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}this.sInfo.subChange=!1,this.changeSubs(t)}},{key:"changeSubs",value:function(e){var t=this;1===Number(f.default.config.pcdnFirst)&&1===Number(this.stream.usePcdn)?(f.default.logger.log("SubStreamMgr.changeSubs pcdnFirst",e.toString()),0===e.length?(this.sInfo.lastSubs=[],this.stream.loaderMgr.stopSub()):this.cdnTryConnectPcdn(e,{getPcdnRsp:function(){t.getPcdnRsp()},onTimeout:function(){f.default.logger.log("SubStreamMgr.changeSubs pcdnFirst timeout",e.toString()),t.loadCdnSubs(e)}})):(f.default.logger.log("SubStreamMgr.changeSubs cdnFirst, subs="+e.toString()+", usePcdn="+this.stream.usePcdn),this.loadCdnSubs(e,1),1===Number(this.stream.usePcdn)&&this.cdnTryConnectPcdn(e,{getPcdnRsp:function(){t.getPcdnRsp()}}))}},{key:"loadCdnSubStream",value:function(){if(this.sInfo.forceArr.toString()!==this.sInfo.lastForceArr.toString()&&(this.sInfo.lastForceArr=this.sInfo.forceArr.slice(),this.proxy.sendForceSubscribeNotify(this.sInfo.forceArr),this.sInfo.forceArr=[]),this.sInfo.subChange){this.sInfo.subChange=!1;var e=this.getCdnSubs();this.changeSubs(e)}}},{key:"getCdnSubs",value:function(){var e=this.isTryurls(),t=[];this.baseIndexCalc.reset();for(var n=[],i=0;i<this.sInfo.baseSubs;i++){var s=this.subStreams[i];n.push(i+":"+s.getDetails()),s.isForced=!1;var r=this.stat.subStreamStat.substream_type[i],a=this.stat.subStreamStat.substream_state[i];c.default.isProxyUid(s.pubInfo.uid)&&(e?s.getPcdnState()!==b.default.COMPLETE&&(t.push(i),s.lastDifStamp=0):r===v.default.CDN&&a!==u.SubStreamState.PULL_START&&(t.push(i),s.lastDifStamp=0)),this.baseIndexCalc.checkSeq(s.pubInfo)}return this.stream.openLog&&f.default.logger.log("SubStreamMgr.getCdnSubs subs="+t.toString()+" \n "+n.join(" \n ")),t}},{key:"setStateTafReq",value:function(e){var t=this;e&&e.length>0&&e.forEach(function(e){t.setSubStreamState(e,u.SubStreamState.TAF_REQ)})}},{key:"setSubStreamState",value:function(e,t){var n=[];if(n.push("state:"+this.stat.subStreamStat.substream_state[e]+" -> "+t),t===u.SubStreamState.PULL_SUC)n.push("type:"+this.stat.subStreamStat.substream_type[e]+" -> "+v.default.PCDN),this.stat.subStreamStat.substream_type[e]=v.default.PCDN;else{var i=this.subStreams[e];c.default.isProxyUid(i.pubInfo.uid)&&(n.push("type:"+this.stat.subStreamStat.substream_type[e]+" -> "+v.default.CDN),this.stat.subStreamStat.substream_type[e]=v.default.CDN)}this.stat.subStreamStat.substream_state[e]=t,(this.stream.openLog||f.default.printSubInfo)&&f.default.logger.log("[SubStreamMgr] index="+e+" setSubStreamState "+n.join(", "))}},{key:"loadPcdnSubStream",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Number(this.stream.usePcdn),s=1===Number(f.default.config.pcdnSubsConfig[0]),r=1===Number(f.default.config.pcdnSubsConfig[1]),a=1===Number(f.default.config.pcdnSubsConfig[2]),o=this.subStreams[e];return!!o&&!(1!==i||!(c.default.isForce(o.pubInfo.uid)||s&&c.default.isCompete(o.pubInfo.uid)||r&&c.default.isFixed(o.pubInfo.uid)||a&&c.default.isDefault(o.pubInfo.uid)))&&(this.setSubStreamState(e,u.SubStreamState.PULL_START),this.stream.loaderMgr.loadPcdnSub(e,t,this.stream.getPcdnProxyList.pcdnName,n),!0)}},{key:"switchCdn",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this,n=arguments[1],i=arguments[2];if(0!==e.length){this.stat.pcdn_data.switch_cdn_cnt++;var s=this.sInfo.lastSubs.slice();e.forEach(function(e){t.subStreams[e].setPcdnState(b.default.STOP),t.setSubStreamState(e,n),t.stat.addSubChangeState(y.default.PCDN,y.default.CDN,i),-1===s.indexOf(e)&&s.push(e)}),s.sort(function(e,t){return e-t});var r=n===u.SubStreamState.PULL_GATHER?4:3;this.loadCdnSubs(s,r)}}},{key:"stopPcdnSub",value:function(e){this.stream.loaderMgr.stopPcdnSub(e)}},{key:"cdnTryConnectPcdn",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments[1],i=[].slice.call(t);i.length>0&&(i=i.filter(function(t){var n=e.stat.subStreamStat.substream_state[t];return e.stat.subStreamStat.substream_type[t]!==v.default.PCDN&&n!==u.SubStreamState.TAF_REQ&&n!==u.SubStreamState.PULL_START}),f.default.logger.log("SubStreamMgr.cdnTryConnectPcdn pcdnSubs, localPcdnSubs="+i),this.setStateTafReq(i),this.stream.getPcdnProxyList.getPcdnReq(i,n))}},{key:"isTryurls",value:function(){var e=f.default.config.pcdnSwitchUrls||[],t=this.stat.pcdn_data_state.pcdn_origin,n=!1;return""!==t&&-1!==e.indexOf(t)&&(n=!0),n}},{key:"getPcdnRsp",value:function(){var e=this,t=this.isTryurls();this.pcdnSwitcher.setTryUrls(t);var n=[],i=this.getCdnSubs(),s=this.stream.getPcdnProxyList.subs||[];for(var r in this.stream.getPcdnProxyList.pcdnSubsUrlMap){var a=this.stream.getPcdnProxyList.pcdnSubsUrlMap[r],o=this.subStreams[r],u=Number(r);if(o.pubInfo.isReady()&&c.default.isProxyUid(o.pubInfo.uid))if(a.length>0){this.subsBwState[u]=6;var l=i.indexOf(u);l>-1&&i.splice(l,1),o.getPcdnState()!==b.default.COMPLETE&&(o.setPcdnState(b.default.READY),this.loadPcdnSubStream(u,a,t)&&(this.stat.addSubChangeState(y.default.CDN,y.default.PCDN,g.default.PCDN_SUC),n.push(u),o.setPcdnState(b.default.CONNECTING)),this.pcdnSwitcher.setSwitching())}else -1!==s.indexOf(u)&&o.setPcdnState(b.default.START)}t?i.forEach(function(t){e.subsBwState[t]=2}):this.loadCdnSubs(i,2)}},{key:"loadCdnSubs",value:function(e,t){var n=this;f.default.logger.log("SubStreamMgr.loadCdnSubs",e.toString(),"lastSubs",this.sInfo.lastSubs.toString());var i=f.default.TimeUtil.now();if(t&&e.map(function(e){n.subsBwState[e]=t}),0===e.length)this.lastSubTs=i,this.lastFullSubTs=0,this.stream.loaderMgr.stopSub();else if(this.sInfo.lastSubs.toString()!==e.toString()){this.lastSubTs=i,e.length===this.sInfo.baseSubs?this.lastFullSubTs=i:this.lastFullSubTs=0;var s=this.baseIndexCalc.getBaseIndex(this.stream.recevier.maxSeq,this.sInfo.lostSeqNum);this.stream.loaderMgr.loadSub(s,e,this.subStreams)}this.sInfo.lastSubs=e.slice()}},{key:"checkAndFillSubHole",value:function(e,t,n,s){if(2===f.default.config.rtPeerBeforeHand&&c.default.isCompete(t.pubInfo.uid)&&0!==t.pubInfo.maxRecvSeq&&!(n-t.pubInfo.maxRecvSeq>1e5)&&t.pubInfo.maxRecvSeq+this.sInfo.baseSubs<n){for(var r=[],a=[],o=new i.default,u=t.info.hasSub(),l=t.pubInfo.maxRecvSeq;l<n;l+=this.sInfo.baseSubs)this.stream.recevier.hasSeq(l)||(r.push(l),this.stream.resender.fillCdnHole(l,e,a,o,u));u&&(f.default.logger.log("SubStreamMgr.checkAndFillSubHole from="+s+" num="+r.length+" lostSeqs="+r),this.stream.resender._resend(a,o,!1))}}},{key:"onCheckTimer",value:function(e,t){if(this.stream.peerMgr){this.stream.peerMgr.resetCurSubNum(),this.baseIndexCalc.reset(),this.sInfo.competeArr=[];for(var n=0;n<this.subStreams.length;n++){var i=this.subStreams[n];this.baseIndexCalc.checkSeq(i.pubInfo),i.isFixed||i.isForced||i.onCheckTimer(e,t)}this.sInfo.competeArr.length>0&&this.proxy.sendCompeteReq(this.sInfo.competeArr);var s=this.getSubStreamDleayDelta();this.stat.peer_range_nonode.prnlate<s&&(this.stat.peer_range_nonode.prnlate=s)}}},{key:"onCheckFastTimer",value:function(e,t){if(this.stream.peerMgr){this.pcdnSwitcher.onCheckFastTimer(e),this.pcdnSucRate.checkSucRate(e,this.stat,this.subStreams,this.stream.openLog),this.stream.peerMgr.resetCurSubNum();for(var n=!0,i=0;i<this.subStreams.length;i++){var s=this.subStreams[i];s.isFixed||s.isForced||s.onCheckFastTimer(e,t),2!==s.pubInfo.status&&(n=!1)}n&&(this.subGap>0?e-this.lastSubTs>this.subGap&&this.loadCdnSubStream():this.loadCdnSubStream())}}},{key:"getDelayDetail",value:function(){if(0===this.subStreams.length)return{max:0,min:0,avg:0};for(var e=0,t=0,n=0,i=0;i<this.subStreams.length;i++){var s=this.subStreams[i].getStreamDelay();s>_.default.DEFAULT_DELAY?s=_.default.DEFAULT_DELAY:s<0&&(s=0),e+=s,(0===t||t<s)&&(t=s),(0===n||n>s)&&(n=s)}return{max:t,min:n,avg:Math.floor(e/this.subStreams.length)}}},{key:"onSubStream",value:function(e){e.baseSubs===this.sInfo.baseSubs?this.subStreams[e.streamIndex].recvSubStream(e):this.proxy.sendSubStreamRes(e.uid,e.streamIndex,0,p.default.DIF_BASE_SUBS,0)}},{key:"recvSubStreamRes",value:function(e){this.subStreams[e.streamIndex]&&this.subStreams[e.streamIndex].recvSubStreamRes(e)}},{key:"recvStreamAlive",value:function(e){this.subStreams[e.streamIndex]&&this.subStreams[e.streamIndex].recvStreamAlive(e)}},{key:"recvRemoveSub",value:function(e){this.subStreams[e.streamIndex]&&this.subStreams[e.streamIndex].recvRemoveSub(e)}},{key:"recvRemoveSubRes",value:function(e){this.subStreams[e.streamIndex]&&this.subStreams[e.streamIndex].recvRemoveSubRes(e)}},{key:"recvSubRes",value:function(e){this.subStreams[e.streamIndex]&&this.subStreams[e.streamIndex].recvSubRes(e)}},{key:"recvCompeteRes",value:function(e){f.default.printSubInfo&&f.default.logger.log("SubStreamMgr.recvCompeteRes",this.stream.id,"ret",e.ret,"csMinBw",e.csMinBw,"remain",e.remainP2pStreamNum,"SNBw",e.SNBw,"subs",e.subStreamIndex.join("-")),this.sInfo.csMinBw=e.csMinBw,this.sInfo.remainP2pStreamNum=e.remainP2pStreamNum,this.sInfo.SNBw=e.SNBw;var t=!0,n=!1,i=void 0;try{for(var r,a=(0,s.default)(this.subStreams);!(t=(r=a.next()).done);t=!0)r.value.recvCompeteRes(e)}catch(e){n=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw i}}}},{key:"autoReport",value:function(){this.stream.streamHandler&&this.stream.streamHandler.autoReport()}},{key:"getIsCompete",value:function(e){return!!c.default.isCompete(e)}},{key:"sendSeqLost",value:function(e,t,n){var i=this.subStreams[e];i&&i.sendSeqLost(t,n)}},{key:"sendPeerRangeReq",value:function(e){var t=this.subStreams[e.index];return!!t&&t.sendPeerRangeReq(e)}},{key:"recvPeerRangeReq",value:function(e){var t=this.subStreams[e.streamIndex];t&&t.recvPeerRangeReq(e)}},{key:"recvPeerRangeRsp",value:function(e){var t=this.subStreams[e.streamIndex];t&&t.recvPeerRangeRsp(e)}},{key:"recvSwapSubHole",value:function(e){var t=this.subStreams[e.streamIndex];t&&t.recvSwapSubHole(e)}},{key:"recvSeqLost",value:function(e){var t=this.subStreams[e.streamIndex];t&&t.recvSeqLost(e)}},{key:"getPcdnProxyTimeout",value:function(e){var t=this;f.default.logger.log("SubStreamMgr.getPcdnProxyTimeout",e.toString()),e.map(function(e){t.subsBwState[e]=5})}},{key:"statCPBw",value:function(e,t,n,i){if(!(t.from!==m.default.TYPE_SUB||i&&i.isPcdn))if(1==localStorage._printStatCPBw&&f.default.logger.log("SubStreamMgr.statCPBw",t.subs,this.subsBwState),this.stream.usePcdn){var s=t.subs[0],r=this.subsBwState[s];if(1==r||5==r)5==r?this.stat.bw.noreq_tout_cp_bw+=n:this.stat.bw.noreq_wait_cp_bw+=n,this.stat.bw.noreq_cp_bw+=n;else if(2==r){this.stat.bw.noreturn_cp_bw+=n;var a=this.stat.subStreamStat.substream_state[s];a!=u.SubStreamState.TAF_GATHER&&a!=u.SubStreamState.TAF_COVER&&a!=u.SubStreamState.TAF_LOAD&&a!=u.SubStreamState.TAF_UNKNOW&&(a=this.lastSubStreamStat),a==u.SubStreamState.TAF_GATHER?this.stat.bw.taf_gather_bw+=n:a==u.SubStreamState.TAF_COVER?this.stat.bw.taf_cover_bw+=n:a==u.SubStreamState.TAF_LOAD?this.stat.bw.taf_load_bw+=n:a==u.SubStreamState.TAF_UNKNOW&&(this.stat.bw.taf_unknown_bw+=n),this.lastSubStreamStat=a}else 3==r?this.stat.bw.error_cp_bw+=n:4==r?this.stat.bw.kicked_cp_bw+=n:this.stat.bw.other_cpflv_bw+=n}else this.stat.bw.unopend_cp_bw+=n}}]),e}()},function(e,t,n){e.exports={default:n(242),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={ACCEPT_SUBSCRIBE:0,EMPTY_UPLOAD_NUM:1,DETECT_SUBSCRIBE_CYCLE:2,EMPTY_PEER_INFO:3,SUBSCRIBE_UPLINK_NOT_ENOUGH:4,PUBLISHER_KICK_OFF:5,NOT_SUBSCRIBER:6,INVALID_SUB_STREAM:7,ACCEPT_BY_SUBSCRIBER_UPLINK:9,INVALID_STREAMID:10,SERVER_EMPTY_BW:11,PUBLISHER_LEAVE:12,DIFFERENT_VIDEO_PROXY:13,OLD_VERSION_REQ:14,INVALID_TREE_DEPTH:15,INVALID_MAX_SUBSTREAM_NUM:16,STREAM_LATE:17,DEPTH_LARGE:18,STREAM_LIMIT:19,SLICE_LARGE:20,NOT_FOUND_PKG:21,KICK_OUT:22,SELF_WORST:23,SLICE_LATE:24,SLICE_FAST:25,RESTART:26,RESET:27,DIF_BASE_SUBS:28,WAP:29}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={CDN:1,PEER:2,PCDN:3}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=k(n(8)),s=k(n(10)),r=k(n(0)),a=k(n(1)),o=n(9),u=k(n(251)),l=k(n(252)),d=k(n(253)),h=k(n(19)),c=k(n(2)),f=k(n(121)),p=k(n(76)),m=k(n(81)),_=k(n(122)),v=k(n(54)),g=k(n(80)),y=k(n(254)),S=k(n(55)),b=k(n(118)),P=k(n(39));function k(e){return e&&e.__esModule?e:{default:e}}k(n(3)),t.default=function(){function e(t,n){(0,r.default)(this,e),this.index=t,this.subStreamMgr=n,this.stream=n.stream,this.sInfo=n.stream.sInfo,this.bwCalc=n.stream.bwCalc,this.stat=n.stream.stat,this.subMgr=n.subMgr,this.pubMgr=n.pubMgr,this.proxy=n.proxy,this.compete=!1,this.isForced=!1,this.isFixed=!1,this.switching=!1,this.trySubNum=0,this.trySubStamp=0,this.defaultReason=0,this.lastForceTs=0,this.lastPubUid=0,this.lastSliceTs=0,this.difPeerSliceNum=0,this.sliceNum=0,this.sendAliveNum=0,this.recvAliveNum=0,this.changeReason=v.default.NONE,this.lastSubUid=-1,this.stat.subStreamStat.substream_type[this.index]=m.default.CDN,this.stat.subStreamStat.substream_state[this.index]=o.SubStreamState.INIT,this.waitMap=new s.default,this.info=new u.default,this.delay=new l.default,this.pubInfo=new d.default,this.pubSelector=null,this.resenderPeer=new y.default(this),this.forceDelay=700,this.sliceCache=new g.default,this.sliceCacheNum=0,this.dispatchCacheNum=0,this.pcdnState=P.default.START,this.pcdnFailReason=o.ProtoLinkWebrtcFailReasons.NONE}return(0,a.default)(e,[{key:"setPcdnState",value:function(e){(this.stream.openLog||c.default.printSubInfo)&&c.default.logger.log("[SubStreamBase] setPcdnState "+this.index+" "+this.pcdnState+" -> "+e),this.pcdnState=e}},{key:"getPcdnState",value:function(){return this.pcdnState}},{key:"setPcdnFailReason",value:function(e){(this.stream.openLog||c.default.printSubInfo)&&c.default.logger.log("[SubStreamBase] setPcdnFailReason "+this.index+" "+this.pcdnFailReason+" -> "+e),this.pcdnFailReason=e}},{key:"getPcdnFailReason",value:function(){return this.pcdnFailReason}},{key:"getDetails",value:function(){return"pcdnState="+this.pcdnState+"|failReason="+this.pcdnFailReason+"|uid="+this.pubInfo.uid+"|type="+this.stat.subStreamStat.substream_type[this.index]+"|state="+this.stat.subStreamStat.substream_state[this.index]}},{key:"addPubCandidate",value:function(e){this.pubSelector.addCandidate(e)}},{key:"delPubCandidate",value:function(e){this.pubSelector.delCandidate(e),this.info.delSub(e),this.pubInfo.uid===e&&2===this.pubInfo.status&&(this.changeReason=v.default.PEER_LEAVE,this.lastSubUid=this.pubInfo.uid,this.trySubPeer(c.default.TimeUtil.now()))}},{key:"restart",value:function(){this.removePub("restart",65),this.notifyReset(f.default.RESTART),this.resetOther()}},{key:"reset",value:function(){this.removePub("reset",66),this.notifyReset(f.default.RESET),this.resetOther(),this.pubSelector.reset()}},{key:"notifyReset",value:function(e){for(var t=this.info.subs.length,n=0;n<t;n++){var i=this.info.subs[n];this.proxy.sendSubStreamRes(i,this.index,this.pubInfo.maxRecvSeq,e,this.getStreamDelay())}}},{key:"resetOther",value:function(){this.info.reset(),this.delay.reset(),this.pubInfo.reset(!0),this.sliceCache.reset(),this.compete=!1,this.isForced=!1,this.difPeerSliceNum=0,this.lastSliceTs=0,this.changeReason=v.default.NONE,this.lastSubUid=-1,c.default.logger.log("[SubStreamBase] resetOther "+this.index+" state:"+this.stat.subStreamStat.substream_state[this.index]+" -> "+o.SubStreamState.RESET+" type:"+this.stat.subStreamStat.substream_type[this.index]+" -> "+m.default.CDN),this.stat.subStreamStat.substream_type[this.index]=m.default.CDN,this.stat.subStreamStat.substream_state[this.index]=o.SubStreamState.RESET}},{key:"removePub",value:function(e,t){this.removePubByUid(this.pubInfo.uid,e,t)}},{key:"removePubByUid",value:function(e,t,n){if(!h.default.isProxyUid(e)){this.pubMgr.delPub(this.index);var i=c.default.TimeUtil.now();(this.stream.openLog||c.default.printSubInfo)&&c.default.logger.log(this.sInfo.streamId.streamName,this.index,"",e,"no slice time",i-this.lastSliceTs,"streamDelay",this.getStreamDelay(),"from",t,"reason",n),this.proxy.sendRemoveSub(e,this.index,n,this.getStreamDelay()),0!==n&&16!==n&&this.pubSelector.setFailedStamp(e,i)}}},{key:"onCheckFastTimer",value:function(e,t){if(c.default.config.p2pRangePeerMode===S.default.SUBSTREAM&&this.resenderPeer.onCheckFastTimer(e),1===this.pubInfo.status)this.pubInfo.isTimeout(e)&&(this.stat.sub_info.timeout_cnt++,this.pubSelector.setFailedStamp(this.pubInfo.uid,e),this.trySubPeer(e));else if(2===this.pubInfo.status)if(h.default.isProxyUid(this.pubInfo.uid))this.checkSendAlive(e);else{var n=this.getBadReason(e);if(n>0)this.changeReason=1==(1&n)?v.default.PEER_DATA_TIMEOUT:v.default.PEER_BAD,this.lastSubUid=this.pubInfo.uid,this.removePub("bad peer",n),this.trySubPeer(e);else if(this.switchPubAble()){var i=this.pubSelector.getBestPub();!h.default.isProxyUid(i.bestUid)&&i.bestUid!==this.pubInfo.uid&&this.pubSelector.isMuchBetter(i.bestUid,this.pubInfo.uid)&&(this.changeReason=v.default.PEER_BETTER,this.lastSubUid=this.pubInfo.uid,this.switchPub(i,e))}}}},{key:"checkSendAlive",value:function(e){e-this.lastSliceTs>300&&(this.sendAliveNum++,this.proxy.sendStreamAlive(this.info.subs,this.sInfo.streamSeqSN,this.index))}},{key:"getBadReason",value:function(e){return 0}},{key:"switchPubAble",value:function(){return!this.sInfo.switchingBetter}},{key:"switchPub",value:function(e,t){this.sInfo.switchingBetter=!0,this.switching=!0,this.lastPubUid=this.pubInfo.uid,this.removePub("much better",0),this._subStream(e,t)}},{key:"onCheckTimer",value:function(e,t){if(this.compete=!1,2===this.pubInfo.status){if(this.competeAble())this.compete=!0,this.pubInfo.status=1,this.sInfo.competeArr.push(this.index);else if(h.default.isProxyUid(this.pubInfo.uid))if(this.subPeerAble()){var n=this.pubSelector.getBestPub();this.pubSelector.hasCandidate()&&h.default.isProxyUid(n.bestUid)?this.defaultReason=1:this.pubSelector.hasCandidate()||(this.defaultReason=2),h.default.isProxyUid(n.bestUid)?h.default.isCompete(this.pubInfo.uid)&&this.subForce(e):(this.changeReason=v.default.SUB_PEER_WEB,this.lastSubUid=this.pubInfo.uid,this._subStream(n,e))}else h.default.isForce(this.pubInfo.uid)}}},{key:"competeAble",value:function(){if(h.default.isCompete(this.pubInfo.uid))return!1;if(this.sInfo.remainP2pStreamNum>0&&this.sInfo.competeArr.length<this.sInfo.remainP2pStreamNum)return this.stat.compete_reason[this.index]=1,!0;var e=this.bwCalc.getUpBw();return e>this.sInfo.SNBw?(this.stat.compete_reason[this.index]=2,!0):e>1.2*this.sInfo.csMinBw?(this.stat.compete_reason[this.index]=3,!0):e>this.sInfo.csMinBw&&Math.random()<.2&&(this.stat.compete_reason[this.index]=4,!0)}},{key:"subPeerAble",value:function(){var e=h.default.isCompete(this.pubInfo.uid);return 0===this.sInfo.csMinBw?!e:!e||this.bwCalc.getUpBw()<.8*this.sInfo.csMinBw}},{key:"trySubPeer",value:function(e){var t=this.trySubNum>Number(c.default.config.trySubNum),n=this.trySubStamp>0&&e-this.trySubStamp>Number(c.default.config.trySubTime);t||n?(t&&this.stat.forcesub_reason.subend_cnt++,n&&this.stat.forcesub_reason.timeout_cnt++,this.subForce(e)):this.subPeer(e)}},{key:"subFixed",value:function(e){var t={bestUid:h.default.VIDEO_FIXED_UID,streamDelay:0};this._subStream(t,e)}},{key:"subDefault",value:function(e){var t={bestUid:h.default.VIDEO_DEFAULT_UID,streamDelay:0};this._subStream(t,e)}},{key:"subCompete",value:function(e){var t={bestUid:h.default.VIDEO_COMPETE_UID,streamDelay:0};h.default.isProxyUid(this.pubInfo.uid)||this.stat.addSubChangeState(_.default.PEER,_.default.CDN,v.default.CDN_COMPETE),this._subStream(t,e)}},{key:"subForce",value:function(e){this._subForce();var t={bestUid:h.default.VIDEO_FORCE_UID,streamDelay:0};this._subStream(t,e)}},{key:"subPeer",value:function(e){var t=this.pubSelector.getBestPub();this.pubInfo.uid!==t.bestUid&&(c.default.logger.log("SubStreamBase.subPeer index="+this.index+" media="+this.sInfo.isMedia+" uid="+t.bestUid),h.default.isForce(t.uid)&&(this.stat.forcesub_reason.nopeer_cnt++,this._subForce()),this._subStream(t,e))}},{key:"_subForce",value:function(){this.isForced=!0,this.compete=!1,this.stat.sub_info.force_cnt++,-1===this.sInfo.forceArr.indexOf(this.index)&&this.sInfo.forceArr.push(this.index)}},{key:"_subStream",value:function(e,t){if(this.sInfo.subChange=!0,this.pubInfo.reset(!1),this.pubInfo.uid=e.bestUid,this.pubInfo.status=1,this.pubInfo.subStamp=t,h.default.isProxyUid(e.bestUid))(this.stream.openLog||c.default.printSubInfo)&&c.default.logger.log("media="+this.sInfo.isMedia+" id",this.stream.id,"index",this.index,"cdn",e.bestUid,"upBw",this.bwCalc.getUpBw(),"csMinBw",this.sInfo.csMinBw,"SNBw",this.sInfo.SNBw,"remain",this.sInfo.remainP2pStreamNum),this.changeReason>0&&this.lastSubUid>-1&&!h.default.isProxyUid(this.lastSubUid)&&this.stat.addSubChangeState(_.default.PEER,_.default.CDN,this.changeReason),this.changeReason=v.default.NONE,this.lastSubUid=-1,this.setPub(e.bestUid,t,200);else{0===this.trySubStamp&&(this.trySubStamp=t),this.trySubNum++;var n=this.pubSelector.getNextSeq(this.pubInfo.maxRecvSeq,this.pubInfo.maxRecvSeqTs);(this.stream.openLog||c.default.printSubInfo)&&c.default.logger.log("media="+this.sInfo.isMedia+" id",this.stream.id,"index",this.index,"",e.bestUid,"nextRecvSeq",n,"streamDelay",e.streamDelay,"upBw",this.bwCalc.getUpBw(),"csMinBw",this.sInfo.csMinBw),this.proxy.sendSubStream(e.bestUid,this.index,n)}}},{key:"setPub",value:function(e,t,n){h.default.isDefault(e)?this.defaultReason=0:this.defaultReason=100,this.delay.setDelay(n),this.switching&&(this.sInfo.switchingBetter=!1),this.switching=!1;var i=this.lastPubUid;this.lastPubUid=0,this.difPeerSliceNum=0,this.trySubNum=0,this.trySubStamp=0,this.lastSliceTs=t,this.pubInfo.uid===e?(h.default.isCompete(e)||(this.stat.compete_reason[this.index]=0),this.pubSelector.setFailedStamp(e,0),this.pubSelector.setResponseTime(e,t-this.pubInfo.subStamp),this.pubInfo.status=2,this.pubInfo.subStamp=0,this.pubMgr.setPub(this.index,e,i),h.default.isProxyUid(e)?this.stat.subStreamStat.substream_type[this.index]!==m.default.PCDN&&this.subStreamMgr.setSubStreamState(this.index,o.SubStreamState.TO_CDN):(this.setPcdnState(P.default.NONE),this.stat.subStreamStat.substream_type[this.index]=m.default.PEER),0!==Number(this.stream.usePcdn)&&(h.default.isProxyUid(e)||(c.default.logger.log("SubStreamBase.setPub media="+this.sInfo.isMedia+", stopSub",this.index),this.subStreamMgr.stopPcdnSub(this.index)))):this.proxy.sendRemoveSub(e,this.index,8,this.getStreamDelay())}},{key:"recvSubStream",value:function(e){if(1!=localStorage._testNoSub)return 1==c.default.config.forbidWapShare&&(0,o.isWapPlatForm)(c.default.config.platform)?(c.default.printSubInfo&&c.default.logger.log("subStreamBase.recvSubStream wap"),void this.proxy.sendSubStreamRes(e.uid,this.index,0,f.default.WAP,0)):void(this.info.isSubed(e.uid)?this.proxy.sendSubStreamRes(e.uid,this.index,this.pubInfo.maxRecvSeq,f.default.ACCEPT_SUBSCRIBE,this.getStreamDelay()):(this.waitMap.has(e.uid)?this.waitMap.get(e.uid).push(e):this.waitMap.set(e.uid,[e]),this.stat.sub_info.cmp_total_cnt++,this.proxy.sendSubReq(e.uid,this.index)))}},{key:"recvSubRes",value:function(e){var t=-1,n=null;if(this.waitMap.has(e.subscriber)){var i=this.waitMap.get(e.subscriber);n=i.shift(),0===i.length&&this.waitMap.delete(e.subscriber)}n&&(0!==e.ret?(this.stat.sub_info.cmp_fail_cnt++,t=f.default.DETECT_SUBSCRIBE_CYCLE):(this.stat.sub_info.cmp_succ_cnt++,t=this._emulate(n)),t===f.default.ACCEPT_SUBSCRIBE?this.info.addSub(n.uid)&&((this.stream.openLog||c.default.printSubInfo)&&c.default.logger.log("media="+this.sInfo.isMedia+" id",this.stream.id,"index",this.index,"",n.uid,"streamDelay",this.getStreamDelay()),this.subMgr.addSub(n.uid,this.index),this.proxy.sendSubStreamRes(n.uid,this.index,this.pubInfo.maxRecvSeq,t,this.getStreamDelay()),this.dispatchCacheSlice(n.uid,n.maxRecvSeq,this.pubInfo.maxRecvSeq)):((this.stream.openLog||c.default.printSubInfo)&&c.default.logger.log("media="+this.sInfo.isMedia+" id",this.stream.id,"index",this.index,"",n.uid,"resCode",t,"streamDelay",this.getStreamDelay()),this._delSub(n.uid),this.proxy.sendSubStreamRes(n.uid,this.index,this.pubInfo.maxRecvSeq,t,this.getStreamDelay())))}},{key:"_delSub",value:function(e){return this.info.delSub(e)&&this.subMgr.delSub(e,this.index)}},{key:"_emulate",value:function(e){var t=this.stream.punchMgr.getNode(e.uid);if(!t)return f.default.EMPTY_PEER_INFO;if(this.subMgr.getSubNum(e.uid)>=Number(c.default.config.maxPeerStreamNum))return f.default.STREAM_LIMIT;if(this.pubInfo.maxRecvSeq<e.maxRecvSeq&&e.maxRecvSeq-this.pubInfo.maxRecvSeq>this.sInfo.sliceLate)return f.default.SLICE_LATE;if(this.pubInfo.maxRecvSeq>e.maxRecvSeq&&this.pubInfo.maxRecvSeq-e.maxRecvSeq>this.sInfo.sliceFast)return f.default.SLICE_FAST;if(this.isDelayBad(t))return f.default.STREAM_LATE;if(this.subMgr.getUplinkNum()>=this.sInfo.curUplinkNum){if(this.subMgr.getSubMinBw()>e.uplinkBw||0===e.uplinkBw)return f.default.SUBSCRIBE_UPLINK_NOT_ENOUGH;var n=this.subMgr.getWorstSubByBw();if(n===e.uid)return f.default.SELF_WORST;this.stream.punchMgr.hasNode(n)?this.proxy.sendSubStreamRes(n,this.index,this.pubInfo.maxRecvSeq,f.default.KICK_OUT,this.getStreamDelay()):this.delPubCandidate(n)}return f.default.ACCEPT_SUBSCRIBE}},{key:"isDelayBad",value:function(e){return this.delay.getDelay()+e.rtt>Number(c.default.config.emuteDelay)}},{key:"recvSubStreamRes",value:function(e){p.default.addComp(this.stat.sub_return,e.ret,1),e.uid===this.lastPubUid?p.default.addComp(this.stat.last_return,e.ret,1):this.switching&&p.default.addComp(this.stat.switch_return,e.ret,1),e.ret===f.default.ACCEPT_SUBSCRIBE?this.stat.sub_info.succ_cnt++:e.ret===f.default.KICK_OUT?this.stat.sub_info.kick_cnt++:this.stat.sub_info.fail_cnt++;var t=c.default.TimeUtil.now();e.ret===f.default.ACCEPT_SUBSCRIBE?this.pubInfo.uid!==e.uid?this.proxy.sendRemoveSub(e.uid,this.index,32,this.getStreamDelay()):this.subSuc(e,t):1===this.pubInfo.status?this.subFail(e,t):e.ret!==f.default.RESTART&&e.ret!==f.default.RESET||((this.stream.openLog||c.default.printSubInfo)&&c.default.logger.log("media="+this.sInfo.isMedia+" id",this.stream.id,"index",this.index,"",e.uid,"newMaxSeq",e.maxRecvSeq,"streamDelay",e.streamDelay,"resCode",e.ret,"oldMaxSeq",this.pubInfo.maxRecvSeq),this.changeReason=v.default.PEER_LEAVE,this.lastSubUid=this.pubInfo.uid,this.pubSelector.setFailedStamp(e.uid,t),this.trySubPeer(t))}},{key:"subSuc",value:function(e,t){(this.stream.openLog||c.default.printSubInfo)&&c.default.logger.log("media="+this.sInfo.isMedia+" id",this.stream.id,"index",this.index,"",e.uid,"newMaxSeq",e.maxRecvSeq,"streamDelay",e.streamDelay,"oldMaxSeq",this.pubInfo.maxRecvSeq),this.checkFirstSeqHole(t,e.maxRecvSeq,"peer"),this.changeReason>0&&this.lastSubUid>-1&&(this.stat.subStreamStat.substream_type[this.index]===m.default.PCDN?this.stat.addSubChangeState(_.default.PCDN,_.default.PEER,this.changeReason):h.default.isProxyUid(this.lastSubUid)?this.stat.addSubChangeState(_.default.CDN,_.default.PEER,this.changeReason):this.stat.addSubChangeState(_.default.PEER,_.default.PEER,this.changeReason)),this.changeReason=v.default.NONE,this.lastSubUid=-1,this.setPub(e.uid,t,e.streamDelay)}},{key:"subFail",value:function(e,t){(this.stream.openLog||c.default.printSubInfo)&&c.default.logger.log("media="+this.sInfo.isMedia+" id",this.stream.id,"index",this.index,"",e.uid,"newMaxSeq",e.maxRecvSeq,"streamDelay",e.streamDelay,"resCode",e.ret,"oldMaxSeq",this.pubInfo.maxRecvSeq),e.ret===f.default.SUBSCRIBE_UPLINK_NOT_ENOUGH||e.ret===f.default.SELF_WORST||e.ret===f.default.KICK_OUT?this.stream.peerMgr.updateStreamInfo(e.uid,e.subMinBw):this.pubSelector.setFailedStamp(e.uid,t),this.trySubPeer(t)}},{key:"recvCompeteRes",value:function(e){if(-1!==e.subStreamIndex.indexOf(this.index)){var t=c.default.TimeUtil.now();5!==e.ret&&(this.pubInfo.status=2),0===e.ret?(this.removePub("compete suc",16),this.subCompete(t)):5===e.ret&&2===this.pubInfo.status&&this.trySubPeer(t)}}},{key:"recvRemoveSub",value:function(e){(this.stream.openLog||c.default.printSubInfo)&&c.default.logger.log("media="+this.sInfo.isMedia+" id",this.stream.id,"index",this.index,"",e.uid,"reason",e.reason,"cdnRtt",e.cdnRtt,"nodeRtt",e.nodeRtt,"streamDelay",e.streamDelay,"hostDelay",this.getStreamDelay()),this.subMgr.delSub(e.uid,this.index),this.info.delSub(e.uid),this.proxy.sendRemoveSubRes(e.uid,this.index,this.getStreamDelay())}},{key:"recvRemoveSubRes",value:function(e){(this.stream.openLog||c.default.printSubInfo)&&c.default.logger.log("media="+this.sInfo.isMedia+" id",this.stream.id,"index",this.index,"",e.uid,"cdnRtt",e.cdnRtt,"nodeRtt",e.nodeRtt,"streamDelay",e.streamDelay,"hostDelay",this.getStreamDelay())}},{key:"recvStreamAlive",value:function(e){if(e.uid===this.pubInfo.uid&&(this.recvAliveNum++,this.lastSliceTs=c.default.TimeUtil.now(),this.info.subs.length>0)){e.uid=c.default.userInfo.uuid;var t=e.marshall(),n=!0,s=!1,r=void 0;try{for(var a,u=(0,i.default)(this.info.subs);!(n=(a=u.next()).done);n=!0){var l=a.value;this.stream.punchMgr.sendToNode(l,t,o.DataType.SIGNALLING)}}catch(e){s=!0,r=e}finally{try{!n&&u.return&&u.return()}finally{if(s)throw r}}}}},{key:"sendSeqLost",value:function(e,t){if(h.default.isProxyUid(this.pubInfo.uid)){var n=b.default.OTHER,i=this.stat.subStreamStat.substream_type[this.index];h.default.isCompete(this.pubInfo.uid)?i===m.default.PCDN?n=b.default.COMPETE_PCDN:i===m.default.CDN&&(n=b.default.COMPETE_CDN):(h.default.isForce(this.pubInfo.uid)||h.default.isDefault(this.pubInfo.uid))&&(n=i===m.default.PCDN?b.default.FORCE_PCDN:b.default.FORCE_CDN),this.stream.resender.recordSrcFrom(n,t.length),this.info.hasSub()&&this.proxy.sendSeqLost(this.index,this.info.subs,e,t,n)}}},{key:"sendPeerRangeReq",value:function(e){var t=e.startSeq,n=e.endSeq,i=e.offsets,s=e.mode,r=e.randomPeer,a=this.pubSelector.getBestRangePeer(n,r);return a>0&&(this.sendPeerRangeReqRightNow(a,t,i,s),!0)}},{key:"sendPeerRangeReqRightNow",value:function(e,t,n,i){this.proxy.sendPeerRangeReq({nodeUid:e,streamIndex:this.index,resendSeqStart:t,resendSeqOffsets:n,mode:i})}},{key:"recvPeerRangeReq",value:function(e){1==localStorage._printPeerRange&&c.default.logger.log("media="+this.sInfo.isMedia+" -----<<<<<<<recvPeerRangeReq",e);for(var t=e.rangeSeqOffsets.length,n=0,i=[],s=0;s<t;s++){var r=e.rangeSeqStart+this.sInfo.baseSubs*e.rangeSeqOffsets[s],a=this.sliceCache.peekByKey(r);if(a){var o=a.slice;o.from=11,o.uid=c.default.userInfo.uuid,o.streamSeqSN=this.sInfo.streamSeqSN;var u=o.marshall();1==localStorage._printPeerRange&&c.default.logger.log("SubStreamBase.sendResendSeq media="+this.sInfo.isMedia+" seq="+r+" toUid="+e.uid),this._dispatchToUid(e.uid,u,u.length,!1)}else 0===n?(n=r,i.push(0)):i.push((r-n)/this.sInfo.baseSubs)}i.length>0&&this.proxy.sendRangeRes({nodeUid:e.uid,streamIndex:this.index,noSeqStart:n,noSeqOffsets:i,mode:e.mode})}},{key:"recvPeerRangeRsp",value:function(e){1==localStorage._printPeerRange&&c.default.logger.log("media="+this.sInfo.isMedia+"-----<<<<<<<recvPeerRangeRsp",e);for(var t=e.noSeqStart,n=[],i=0;i<e.noSeqOffsets.length;i++){var s=t+this.sInfo.baseSubs*e.noSeqOffsets[i];e.mode===S.default.GLOBAL?n.push(s):e.mode===S.default.SUBSTREAM&&this.resenderPeer.addPeerNoSeq(s)}e.mode===S.default.GLOBAL&&n.length>0&&(this.pubSelector.addIgnorePeerRangeUid(e.uid),this.stream.resender.recvPeerRangeRsp(n))}},{key:"onSliceData",value:function(e){c.default.config.p2pRangePeerMode===S.default.SUBSTREAM&&this.resenderPeer.onSliceData(e),this.addDelay(e);var t=c.default.TimeUtil.now(),n=e.parent;this.sliceCacheNum>0&&(this.sliceCache.put({key:n.seq,slice:n}),this.sliceCache.size>this.sliceCacheNum&&this.sliceCache.get()),this.lastSliceTs=t,e.isSliceJumpFromPeer?(this.removePub("slice jump from peer",65),this.trySubPeer(t)):(this.sliceNum++,!e.isRepeat&&this.pubInfo.updateMaxRecvSeq(n.seq,t)&&(this.pubInfo.isFromPeer=e.isFromPeer),e.isFromPeer&&n.uid!==this.pubInfo.uid&&(this.difPeerSliceNum++,this.difPeerSliceNum>=200&&(this.difPeerSliceNum=0,this.removePubByUid(n.uid,"dif peer slice",64))),e.isRepeat||this.dispatchSlice(n))}},{key:"dispatchSlice",value:function(e){var t=this,n=this.info.subs;if(n.length>0){e.uid=c.default.userInfo.uuid,e.streamSeqSN=this.sInfo.streamSeqSN,11===e.from&&(e.from=12);var i=e.marshall(),s=i.length;n.forEach(function(e){t._dispatchToUid(e,i,s)})}}},{key:"_dispatchToUid",value:function(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];i&&this.bwCalc.addUpBw(n),this.stat.updown_info.uplink_bw+=n,this.stream.punchMgr.punch.sendToNode(e,t,o.DataType.SLICE)}},{key:"dispatchCacheSlice",value:function(e,t,n){if(this.dispatchCacheNum>0&&t<n){for(var i=0,s=this.sliceCache.head,r=s,a=0,o=0;i<this.dispatchCacheNum;){var u=r.next;if(u===s)break;var l=u.data,d=l.key,h=l.slice;h.from=10;var f=h.marshall();d>t&&(0===a&&(a=d),o<d&&(o=d),this._dispatchToUid(e,f,f.length),i++),r=u}c.default.logger.log("SubStreamBase.dispatchCacheSlice media="+this.sInfo.isMedia+" index="+this.index+" subMaxSeq="+t+" sendNum="+i+" from="+a+" to="+o)}else this.dispatchCacheNum>0&&c.default.logger.log("SubStreamBase.dispatchCacheSlice media="+this.sInfo.isMedia+" fail subMaxSeq="+t+" mineMaxSeq="+n)}},{key:"getSendSliceDelay",value:function(){var e=this.maxSendDelay;return this.maxSendDelay=0,e}},{key:"getNtpDelay",value:function(e){var t=c.default.TimeUtil.now()-this.sInfo.stampcNow,n=Math.max(0,this.sInfo.stampcSvr+t-e);c.default.logger.log("cdn delay",n)}},{key:"addDelay",value:function(e){if(!(e.isRange||e.parent.uri!==o.ProtoUri.PP2pSliceVideoData&&e.parent.uri!==o.ProtoUri.PP2pSliceSignalData)&&e.child.config&&e.child.config.has(3)){var t=e.child.config.get(3),n=c.default.TimeUtil.now(),i=0;if(e.parent.uid){if(this.sInfo.stampcSvr){var s=n-this.sInfo.stampcNow;i=Math.max(0,this.sInfo.stampcSvr+s-t),this.delay.addDelay(i)}}else if(this.sInfo.stampcSvr){var r=n-this.sInfo.stampcNow;i=Math.max(0,this.sInfo.stampcSvr+r-t),h.default.isForce(this.pubInfo.uid)&&(i+=this.forceDelay),this.delay.addDelay(i)}this.stat.stream_delay["k"+this.index]=this.getStreamDelay()}}},{key:"getStreamDelay",value:function(){return this.delay.getDelay()}},{key:"getRealStreamDelay",value:function(){return h.default.isForce(this.pubInfo.uid)&&h.default.isForce(this.pubInfo.uid)?this.getStreamDelay()-this.forceDelay:this.getStreamDelay()}},{key:"getSubPeerDelay",value:function(){var e=this.streamDelayAverageCalculator.average();return this.streamDelayAverageCalculator.reset(),e}},{key:"checkFirstSeqHole",value:function(e,t,n){if(this.pubInfo.firstSeq=t,0!==this.pubInfo.maxRecvSeq){var i=this.pubInfo.maxRecvSeq+this.sInfo.baseSubs;if(this.stream.resender.checkHisSeqHole(i),i<t){if(t-i>1e4)return void c.default.logger.log("SubStreamBase.checkFirstSeqHole media="+this.sInfo.isMedia+" outline gap="+(i-t)+" index="+this.index+" firstSeq="+t+" nextSeq="+i+" from="+n);for(var s=[],r=0,a=[],o=i;o<t;o+=this.sInfo.baseSubs)s.push(o),0===r&&(r=o),a.push(o-r),this.stream.resender.addFirstSeqHoleSeq(o);c.default.logger.log("SubStreamBase.checkFirstSeqHole media="+this.sInfo.isMedia+" index="+this.index+" from="+n+" lostNum="+s.length+" maxRecvSeq="+this.pubInfo.maxRecvSeq+" firstSeq="+t),this.info.hasSub()&&this.proxy.sendSwapSubHole({nodeUids:this.info.subs,streamIndex:this.index,seqStart:r,seqOffsets:a})}else c.default.logger.log("SubStreamBase.checkFirstSeqHole media="+this.sInfo.isMedia+" index="+this.index+" from="+n+" mineRecvSeq="+i+" firstSeq="+t)}else c.default.logger.log("SubStreamBase.checkFirstSeqHole media="+this.sInfo.isMedia+" maxRecvSeq=0 firstSeq="+t+" from="+n)}},{key:"recvSwapSubHole",value:function(e){for(var t=0;t<e.lostSeqOffsets.length;t++){var n=e.lostSeqStart+e.lostSeqOffsets[t];this.stream.resender.addFirstSeqHoleSeq(n)}}},{key:"recvSeqLost",value:function(e){for(var t=c.default.TimeUtil.now(),n=0;n<e.seqOffsets.length;n++){var i=e.seqStart+e.seqOffsets[n];this.stream.resender.addSrcSeqLost(i,t,e.from)}this.info.hasSub()&&this.proxy.sendSeqLost(this.index,this.info.subs,e.seqStart,e.seqOffsets,e.from)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=m(n(8)),s=m(n(10)),r=m(n(0)),a=m(n(1)),o=n(9),u=m(n(109)),l=m(n(125)),d=m(n(19)),h=m(n(2)),c=m(n(3)),f=m(n(110)),p=m(n(111));function m(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,r.default)(this,e),this.subStream=t,this.stat=t.subStreamMgr.stream.stat,this.sInfo=t.subStreamMgr.stream.sInfo,this.pubInfo=t.pubInfo,this.pubMgr=t.subStreamMgr.pubMgr,this.bwCalc=t.subStreamMgr.stream.bwCalc;var n=new u.default(434201);n.addSendRecv(10,9),n.addRtt(1e3);var i=new f.default;i.subStreamInfos[t.index]=new p.default,n.streamMap.set(this.sInfo.streamSeqSN,i),this.badCandidate=new l.default(434201,t),this.badCandidate.peerInfo=n,this.candidateMap=new s.default,this.ignorePeerRangeMap=new s.default}return(0,a.default)(e,[{key:"reset",value:function(){this.candidateMap.clear(),this.ignorePeerRangeMap.clear()}},{key:"addCandidate",value:function(e){if(!this.candidateMap.has(e)){var t=new l.default(e,this.subStream);this.candidateMap.set(e,t)}}},{key:"delCandidate",value:function(e){this.candidateMap.delete(e)}},{key:"hasCandidate",value:function(){return this.candidateMap.size>0}},{key:"getCandidate",value:function(e){return this.candidateMap.get(e)}},{key:"setFailedStamp",value:function(e,t){this.candidateMap.has(e)&&this.candidateMap.get(e).setFailedStamp(t)}},{key:"setResponseTime",value:function(e,t){this.candidateMap.has(e)&&this.candidateMap.get(e).setResponseTime(t)}},{key:"getBestPub",value:function(){var e={bestUid:d.default.VIDEO_FORCE_UID,streamDelay:0},t=this.bwCalc.getUpBw(),n=this.sInfo.cdnpRtt+600,s=Number(h.default.config.maxPeerStreamNum),r=this.getNextSeq(this.pubInfo.maxRecvSeq,this.pubInfo.maxRecvSeqTs),a=[],o=!0,u=!1,l=void 0;try{for(var c,f=(0,i.default)(this.candidateMap.values());!(o=(c=f.next()).done);o=!0){var p=c.value;this.isValid(p,t,n,r,s)&&a.push(p)}}catch(e){u=!0,l=e}finally{try{!o&&f.return&&f.return()}finally{if(u)throw l}}var m=this.findBest(a);return m?(e.bestUid=m.uid,e.streamDelay=m.getStreamDelay()):(e.bestUid=d.default.VIDEO_FORCE_UID,0===this.candidateMap.size&&this.stat.nonode_return.none_cnt++),e}},{key:"getNextSeq",value:function(e,t){var n=e;if(t>0){var i=h.default.TimeUtil.now()-t;i>100&&(n+=parseInt(this.getSeqSpeed()*(i/1e3)))}return n}},{key:"getSeqSpeed",value:function(){return 0}},{key:"isValid",value:function(e,t,n,i,s){if(!this.sInfo.isCanUseP2P)return this.stat.nonode_return.presenter_cnt++,!1;var r=this.subStream.stream.punchMgr.getNode(e.uid);if(r&&r.nodeType===o.NodeType.SDK_CLIENT_V2&&1!=h.default.config.p2pSubSdkV2)return this.stat.nonode_return.sdk_v2++,!1;var a=this.subStream.stream.peerMgr.getPeer(e.uid);if(!a)return this.stat.nonode_return.no_peer_cnt++,!1;var u=a.getStream(this.sInfo.streamSeqSN);if(!u)return this.stat.nonode_return.no_stream_cnt++,!1;if(u.cdnpip!==this.sInfo.cdnpIpInt)return this.stat.nonode_return.cdnp_dif_cnt++,!1;if(this.pubMgr.getPubCnt(e.uid)>=s)return this.stat.nonode_return.pub_same_cnt++,!1;if(u.subNum+u.curSubNum>=s)return this.stat.nonode_return.sub_same_cnt++,!1;if(this.subStream.info.isSubed(e.uid))return this.stat.nonode_return.subed_cnt++,!1;if(!e.canResub())return this.stat.nonode_return.cool_cnt++,!1;var l=this.subStream.stream.peerMgr.getRtt(e.uid),d=u.subStreamInfos[this.subStream.index],f=d.getDelay();if(f===c.default.UintMax||f+l>=Number(h.default.config.emuteDelay))return this.stat.nonode_return.delay_cnt++,!1;if(l>n)return this.stat.nonode_return.rtt_cnt++,!1;var p=this.getNextSeq(d.maxRecvSeq,d.maxRecvTs);return p<i&&i-p>this.sInfo.sliceLate?(this.stat.nonode_return.late_cnt++,!1):p>i&&p-i>this.sInfo.sliceFast?(this.stat.nonode_return.fast_cnt++,!1):!!u.hasRemainUplinkNum()||u.subMinBw>0&&t>u.subMinBw||(this.stat.nonode_return.uplink_less_cnt++,!1)}},{key:"isDelayBad",value:function(e){return!1}},{key:"findBest",value:function(e){for(var t=null,n=0;n<e.length;n++){var i=e[n];null!==t&&-1!==l.default.cmpCandidate(i,t)||(t=i)}return null===t||this.isCandidateTooBad(t,e)?null:(this.subStream.stream.peerMgr.addCurSubNum(t.uid,this.sInfo.streamSeqSN),t)}},{key:"isCandidateTooBad",value:function(e,t){return!1}},{key:"isMuchBetter",value:function(e,t){return!1}},{key:"getRangePeerNodes",value:function(e){var t=[],n=[],s=[],r=this.bwCalc.getUpBw(),a=this.sInfo.cdnpRtt+600,o=!0,u=!1,l=void 0;try{for(var d,c=(0,i.default)(this.candidateMap.values());!(o=(d=c.next()).done);o=!0){var f=d.value,p=this.isValidRange(f,e,r,a),m={nodeUid:f.uid,rtt:this.subStream.stream.peerMgr.getRtt(f.uid)};p>0?1===p?t.push(m):2===p&&n.push(m):s.push(m)}}catch(e){u=!0,l=e}finally{try{!o&&c.return&&c.return()}finally{if(u)throw l}}var _=t.concat(n);return h.default.config.rtPeerSelector&&0===_.length&&(_=s),{total:_,candidates:t,candidates1:n}}},{key:"getBestRangePeer",value:function(e,t){var n=this.getRangePeerNodes(e),i=n.candidates,s=n.candidates1;if(0===i.length&&(i=s),i.length>0){if(i.sort(function(e,t){return e.rtt-t.rtt}),0===h.default.config.rtPeerRandom)return t?i[Math.floor(Math.random()*i.length)].nodeUid:i[0].nodeUid;var r=Math.min(Number(h.default.config.rtPeerTopN)||3,i.length);return i[Math.floor(Math.random()*r)].nodeUid}return 0}},{key:"isValidRange",value:function(e,t,n,i){var s=this.subStream.stream.punchMgr.getNode(e.uid);if(s&&s.nodeType===o.NodeType.SDK_CLIENT_V2||this.pubInfo.uid===e.uid||this.subStream.info.isSubed(e.uid))return 0;var r=this.subStream.stream.peerMgr.getPeer(e.uid);if(!r)return 0;var a=r.getStream(this.sInfo.streamSeqSN);if(!a)return 0;if(a.upBw<n)return 2;var u=a.subStreamInfos[this.subStream.index];return this.getNextSeq(u.maxRecvSeq,u.maxRecvTs)<t||this.subStream.stream.peerMgr.getRtt(e.uid)>i?0:1}},{key:"addIgnorePeerRangeUid",value:function(e){this.ignorePeerRangeMap.has(e),this.ignorePeerRangeMap.set(e,1)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(256)),a=u(n(2)),o=u(n(3));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t,n){(0,i.default)(this,e),this.uid=t,this.subStream=n,this.sInfo=n.sInfo,this.failedStamp=0,this.failedTimes=0,this.responseTime=1e3,this.peerInfo=null}return(0,s.default)(e,[{key:"setFailedStamp",value:function(e){e>0&&this.failedTimes++,this.failedStamp=e}},{key:"setResponseTime",value:function(e){this.responseTime=this.responseTime+e>>1}},{key:"canResub",value:function(){return 0===this.failedStamp||a.default.TimeUtil.now()-this.failedStamp>=Number(a.default.config.resubTime)}},{key:"getStreamDelay",value:function(){var e=this.getSubStreamInfo();return e?e.getDelay():o.default.UintMax}},{key:"setStreamDelay",value:function(e){var t=this.getSubStreamInfo();if(t)return t.setDelay(e)}},{key:"getSubStreamInfo",value:function(){return this.peerInfo?this.peerInfo.getStream(this.sInfo.streamSeqSN).subStreamInfos[this.subStream.index]:this.subStream.stream.peerMgr.getSubStreamInfo(this.uid,this.sInfo.streamSeqSN,this.subStream.index)}},{key:"getSendSum",value:function(){return this.peerInfo?this.peerInfo.sendCntCalc.sum:this.subStream.stream.peerMgr.getSendSum(this.uid)}},{key:"getRecvSum",value:function(){return this.peerInfo?this.peerInfo.recvCntCalc.sum:this.subStream.stream.peerMgr.getRecvSum(this.uid)}}],[{key:"cmpLatency",value:function(e,t){if(!e||!t)return!1;var n=e.getStreamDelay(),i=t.getStreamDelay(),s=r.default.calcDelayScore(n),a=r.default.calcDelayScore(i);return r.default.cmpScore(s,a)}},{key:"cmpCandidate",value:function(e,t){if(!e||!t)return!1;var n=e.getStreamDelay(),i=e.getSendSum(),s=e.getRecvSum(),a=t.getStreamDelay(),o=t.getSendSum(),u=t.getRecvSum(),l=r.default.calcScore(n,i,s),d=r.default.calcScore(a,o,u);return r.default.cmpScore(l,d)}}]),e}()},function(e,t,n){"use strict";e.exports=function(e,t,n,i){for(var s=65535&e,r=e>>>16&65535,a=0;0!==n;){n-=a=n>2e3?2e3:n;do r=r+(s=s+t[i++]|0)|0;while(--a);s%=65521,r%=65521}return s|r<<16}},function(e,t,n){"use strict";var i=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?0xedb88320^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,s){var r=s+n;e^=-1;for(var a=s;a<r;a++)e=e>>>8^i[255&(e^t[a])];return -1^e}},function(e,t,n){"use strict";var i=n(22),s=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(e){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){r=!1}for(var a=new i.Buf8(256),o=0;o<256;o++)a[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;function u(e,t){if(t<65534&&(e.subarray&&r||!e.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}a[254]=a[254]=1,t.string2buf=function(e){var t,n,s,r,a,o=e.length,u=0;for(r=0;r<o;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<o&&56320==(64512&(s=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(s-56320),r++),u+=n<128?1:n<2048?2:n<65536?3:4;for(t=new i.Buf8(u),a=0,r=0;a<u;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<o&&56320==(64512&(s=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(s-56320),r++),n<128?t[a++]=n:(n<2048?t[a++]=192|n>>>6:(n<65536?t[a++]=224|n>>>12:(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63),t[a++]=128|n>>>6&63),t[a++]=128|63&n);return t},t.buf2binstring=function(e){return u(e,e.length)},t.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,s=t.length;n<s;n++)t[n]=e.charCodeAt(n);return t},t.buf2string=function(e,t){var n,i,s,r,o=t||e.length,l=Array(2*o);for(i=0,n=0;n<o;)if((s=e[n++])<128)l[i++]=s;else if((r=a[s])>4)l[i++]=65533,n+=r-1;else{for(s&=2===r?31:3===r?15:7;r>1&&n<o;)s=s<<6|63&e[n++],r--;r>1?l[i++]=65533:s<65536?l[i++]=s:(s-=65536,l[i++]=55296|s>>10&1023,l[i++]=56320|1023&s)}return u(l,i)},t.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+a[e[n]]>t?n:t}},function(e,t,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=f(n(0)),s=f(n(1)),r=n(9),a=f(n(2)),o=f(n(56)),u=f(n(265)),l=(f(n(274)),f(n(3))),d=f(n(37)),h=f(n(52)),c=f(n(114));function f(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t){(0,i.default)(this,e),t.userInfo.version=5310,localStorage._testP2PVersion&&(t.userInfo.version=Number(localStorage._testP2PVersion)),a.default.userInfo=t.userInfo,a.default.roomInfo=t.roomInfo,a.default.config=t.config,a.default.TafLink=t.TafLink,a.default.Timer=t.Timer,a.default.TimeUtil=t.TimeUtil,a.default.logger=t.logger,a.default.HUYA=t.HUYA,a.default.Taf=t.Taf,t.Browser=c.default,(0,r.initPrivate)(t),o.default.STREAM_DELAY=Number(t.config.badDelay)||o.default.STREAM_DELAY,o.default.SWITCH_DELAY=Number(t.config.switchDelay)||o.default.SWITCH_DELAY,a.default.init(),a.default.logger.log("P2PLib.constructor 2405151658 | 2024-05-15 16:58:29 | RELEASE"),a.default.logger.log("P2PLib.constructor Main.userInfo.version = "+a.default.userInfo.version),this.lastVideoBitrate=0,this.p2pStream=null}return(0,s.default)(e,[{key:"playStream",value:function(e){var t=a.default.streamMgr.playStream(e);return t&&(t.sInfo.type===d.default.P2P&&(l.default.isOpen(a.default.config.usePullPunch,t.sInfo.presenterUid,t.sInfo.lineType,!1)&&0!==this.lastVideoBitrate&&this.lastVideoBitrate!==t.sInfo.curBitrate&&t.streamMgr.pullClearPunch(),a.default.logger.log("P2PLib.playStream usePullPunch lastBitrate="+this.lastVideoBitrate+" curBitrate="+t.sInfo.curBitrate),this.lastVideoBitrate=t.sInfo.curBitrate),t.punchMgr.start(),this.p2pStream=t),t}},{key:"removeStream",value:function(e){if(e){var t=l.default.isOpen(a.default.config.usePullPunch,e.sInfo.presenterUid,e.sInfo.lineType,!1);a.default.streamMgr.removeStream(e),e.destroy(),t||a.default.streamMgr.checkClear()}this.p2pStream&&(this.p2pStream=null)}},{key:"clearPunch",value:function(){a.default.p2pPunchMode===h.default.SAME&&(a.default.logger.log("P2PLib.clearPunch"),a.default.punchMgr.reset(),a.default.streamMgr.clearPunch())}},{key:"clearVideo",value:function(){a.default.p2pPunchMode===h.default.SAME&&(a.default.logger.log("P2PLib.clearVideo"),a.default.streamMgr.clearVideo(),a.default.punchMgr.reset(),a.default.peerMgr.reset())}},{key:"inflate",value:function(e,t){return u.default.inflate(e,t)}},{key:"hasPcdnSubs",value:function(){return!!(this.p2pStream&&this.p2pStream.subStreamMgr&&this.p2pStream.subStreamMgr.hasPcdnSubs)&&this.p2pStream.subStreamMgr.hasPcdnSubs()}}]),e}();t.default=p,window.P2PLib=p},function(e,t,n){n(133);var i=n(4).Object;e.exports=function(e,t,n){return i.defineProperty(e,t,n)}},function(e,t,n){var i=n(11);i(i.S+!n(15)*i.F,"Object",{defineProperty:n(16).f})},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var i=n(4),s=i.JSON||(i.JSON={stringify:JSON.stringify});e.exports=function(e){return s.stringify.apply(s,arguments)}},function(e,t,n){n(35),n(142),e.exports=n(4).Array.from},function(e,t,n){var i=n(59),s=n(60);e.exports=function(e){return function(t,n){var r,a,o=String(s(t)),u=i(n),l=o.length;return u<0||u>=l?e?"":void 0:(r=o.charCodeAt(u))<55296||r>56319||u+1===l||(a=o.charCodeAt(u+1))<56320||a>57343?e?o.charAt(u):r:e?o.slice(u,u+2):a-56320+(r-55296<<10)+65536}}},function(e,t,n){"use strict";var i=n(42),s=n(34),r=n(45),a={};n(20)(a,n(14)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=i(a,{next:s(1,n)}),r(e,t+" Iterator")}},function(e,t,n){var i=n(26),s=n(43),r=n(140);e.exports=function(e){return function(t,n,a){var o,u=i(t),l=s(u.length),d=r(a,l);if(e&&n!=n){for(;l>d;)if((o=u[d++])!=o)return!0}else for(;l>d;d++)if((e||d in u)&&u[d]===n)return e||d||0;return!e&&-1}}},function(e,t,n){var i=n(59),s=Math.max,r=Math.min;e.exports=function(e,t){return(e=i(e))<0?s(e+t,0):r(e,t)}},function(e,t,n){var i=n(18).document;e.exports=i&&i.documentElement},function(e,t,n){"use strict";var i=n(23),s=n(11),r=n(27),a=n(91),o=n(92),u=n(43),l=n(143),d=n(67);s(s.S+!n(144)(function(e){Array.from(e)})*s.F,"Array",{from:function(e){var t,n,s,h,c=r(e),f="function"==typeof this?this:Array,p=arguments.length,m=p>1?arguments[1]:void 0,_=void 0!==m,v=0,g=d(c);if(_&&(m=i(m,p>2?arguments[2]:void 0,2)),null==g||f==Array&&o(g))for(n=new f(t=u(c.length));t>v;v++)l(n,v,_?m(c[v],v):c[v]);else for(h=g.call(c),n=new f;!(s=h.next()).done;v++)l(n,v,_?a(h,m,[s.value,v],!0):s.value);return n.length=v,n}})},function(e,t,n){"use strict";var i=n(16),s=n(34);e.exports=function(e,t,n){t in e?i.f(e,t,s(0,n)):e[t]=n}},function(e,t,n){var i=n(14)("iterator"),s=!1;try{var r=[7][i]();r.return=function(){s=!0},Array.from(r,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!s)return!1;var n=!1;try{var r=[7],a=r[i]();a.next=function(){return{done:n=!0}},r[i]=function(){return a},e(r)}catch(e){}return n}},function(e,t,n){n(146),e.exports=n(4).Object.setPrototypeOf},function(e,t,n){var i=n(11);i(i.S,"Object",{setPrototypeOf:n(147).set})},function(e,t,n){var i=n(17),s=n(21),r=function(e,t){if(s(e),!i(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,i){try{(i=n(23)(Function.call,n(69).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return r(e,n),t?e.__proto__=n:i(e,n),e}}({},!1):void 0),check:r}},function(e,t,n){e.exports={default:n(149),__esModule:!0}},function(e,t,n){n(150);var i=n(4).Object;e.exports=function(e,t){return i.defineProperties(e,t)}},function(e,t,n){var i=n(11);i(i.S+!n(15)*i.F,"Object",{defineProperties:n(88)})},function(e,t,n){e.exports={default:n(152),__esModule:!0}},function(e,t,n){n(153);var i=n(4).Object;e.exports=function(e){return i.getOwnPropertyNames(e)}},function(e,t,n){n(31)("getOwnPropertyNames",function(){return n(94).f})},function(e,t,n){e.exports={default:n(155),__esModule:!0}},function(e,t,n){n(96),e.exports=n(4).Object.getOwnPropertySymbols},function(e,t,n){var i=n(36),s=n(71),r=n(46);e.exports=function(e){var t=i(e),n=s.f;if(n)for(var a,o=n(e),u=r.f,l=0;o.length>l;)u.call(e,a=o[l++])&&t.push(a);return t}},function(e,t,n){n(158),e.exports=n(4).Object.getPrototypeOf},function(e,t,n){var i=n(27),s=n(90);n(31)("getPrototypeOf",function(){return function(e){return s(i(e))}})},function(e,t,n){n(160);var i=n(4).Object;e.exports=function(e,t){return i.getOwnPropertyDescriptor(e,t)}},function(e,t,n){var i=n(26),s=n(69).f;n(31)("getOwnPropertyDescriptor",function(){return function(e,t){return s(i(e),t)}})},function(e,t,n){e.exports={default:n(162),__esModule:!0}},function(e,t,n){n(163),e.exports=n(4).Object.preventExtensions},function(e,t,n){var i=n(17),s=n(47).onFreeze;n(31)("preventExtensions",function(e){return function(t){return e&&i(t)?e(s(t)):t}})},function(e,t,n){e.exports={default:n(165),__esModule:!0}},function(e,t,n){n(166),e.exports=n(4).Object.isExtensible},function(e,t,n){var i=n(17);n(31)("isExtensible",function(e){return function(t){return!!i(t)&&(!e||e(t))}})},function(e,t,n){e.exports={default:n(168),__esModule:!0}},function(e,t,n){n(169),e.exports=n(4).Object.keys},function(e,t,n){var i=n(27),s=n(36);n(31)("keys",function(){return function(e){return s(i(e))}})},function(e,t,n){n(171);var i=n(4).Object;e.exports=function(e,t){return i.create(e,t)}},function(e,t,n){var i=n(11);i(i.S,"Object",{create:n(42)})},function(e,t,n){e.exports={default:n(173),__esModule:!0}},function(e,t,n){n(72),e.exports=n(48).f("toStringTag")},function(e,t,n){n(96),n(72),n(175),n(176),e.exports=n(4).Symbol},function(e,t,n){n(70)("asyncIterator")},function(e,t,n){n(70)("observable")},function(e,t,n){e.exports={default:n(178),__esModule:!0}},function(e,t,n){n(35),n(49),e.exports=n(48).f("iterator")},function(e,t,n){"use strict";var i=n(180),s=n(101),r=n(30),a=n(26);e.exports=n(61)(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,s(1)):s(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),r.Arguments=r.Array,i("keys"),i("values"),i("entries")},function(e,t){e.exports=function(){}},function(e,t,n){n(49),n(35),e.exports=n(182)},function(e,t,n){var i=n(21),s=n(67);e.exports=n(4).getIterator=function(e){var t=s(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return i(t.call(e))}},function(e,t,n){e.exports={default:n(184),__esModule:!0}},function(e,t,n){n(49),n(35),e.exports=n(185)},function(e,t,n){var i=n(68),s=n(14)("iterator"),r=n(30);e.exports=n(4).isIterable=function(e){var t=Object(e);return void 0!==t[s]||"@@iterator"in t||r.hasOwnProperty(i(t))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={NONE:0,NOTSTART:1,PUNCHFAILED_CD:2,PUNCHED_FULL:3,QUOTA_EXHAUST:4,VERSION:5,DIF_LINE:6,FAIL:7,IGNORE:8,HAS_NODE:9,WAITING:10,NO_STREAM:11,OTHER:100}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=m(n(8)),s=m(n(40)),r=m(n(5)),a=m(n(0)),o=m(n(1)),u=m(n(6)),l=m(n(12)),d=m(n(7)),h=n(9),c=m(n(103)),f=m(n(208)),p=m(n(2));function m(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e){(0,a.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return n.punchBackCloseList=[],n.punchBackList=[],n}return(0,d.default)(t,e),(0,o.default)(t,[{key:"onCheckTimer",value:function(e,n){(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"onCheckTimer",this).call(this,e,n),n%4==1&&this.tryPunchBack(e)}},{key:"tryPunchBack",value:function(e){if(this.punchBackList.length>0){var t=this.punchBackList.shift();t.nodeProxy.sendPunchBackReq(t.uid)}}},{key:"delayCloseNode",value:function(e){return this.delayClosePunched(e)||this.delayCloseBack(e)||this.delayClose(e)}},{key:"delayCloseBack",value:function(e){if(this.punchBackCloseList.length>0){var t=this.punchBackCloseList.shift();return this.delayCloseMap.delete(t.uid),t.close(),t.nodeProxy.sendPunchBackRsp(t.uid,f.default.REQUEST),!0}return!1}},{key:"delayClose",value:function(e){if(this.delayCloseMap.size>0){var t=(0,s.default)(this.delayCloseMap.keys())[0],n=this.delayCloseMap.get(t);return this.delayCloseMap.delete(t),(n.nodeType!==h.NodeType.SDK_CLIENT_V2||1!==p.default.config.crossPunchPloy)&&p.default.userInfo.uuid>n.uid&&!this.isIgnoreKey(t,c.default.ACT,e)&&this.punchBackList.push({uid:n.uid,nodeType:n.nodeType,nodeProxy:n.nodeProxy}),n.close(),!0}return!1}},{key:"closeNodeNow",value:function(e){this.punchBackList.push({uid:e.uid,nodeType:e.nodeType,nodeProxy:e.nodeProxy}),(0,l.default)(t.prototype.__proto__||(0,r.default)(t.prototype),"closeNodeNow",this).call(this,e)}},{key:"recvPunchBackReq",value:function(e,t){if(this.delayCloseMap.has(e.fromUid)){var n=!0,s=!1,r=void 0;try{for(var a,o=(0,i.default)(this.delayCloseMap.values());!(n=(a=o.next()).done);n=!0){var u=a.value;if(u.uid===e.fromUid){this.punchBackCloseList.push(u),this.delayCloseMap.delete(u.uid);break}}}catch(e){s=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(s)throw r}}t.sendPunchBackRsp(e.fromUid,f.default.CLOSING)}else t.sendPunchBackRsp(e.fromUid,f.default.SUC)}},{key:"recvPunchBackRsp",value:function(e,t){if(e.ret===f.default.SUC||e.ret===f.default.REQUEST){var n=this.getOrNewNode(e.fromUid,e.ret===f.default.SUC?"punch back":"punch back request");n.nodeProxy=t,n.nodeType=e.nodeType,n.peer.connectBack()}}}]),t}(c.default)},function(e,t,n){n(72),n(35),n(49),n(189),n(196),n(199),n(201),e.exports=n(4).Map},function(e,t,n){"use strict";var i=n(190),s=n(106);e.exports=n(192)("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=i.getEntry(s(this,"Map"),e);return t&&t.v},set:function(e,t){return i.def(s(this,"Map"),0===e?0:e,t)}},i,!0)},function(e,t,n){"use strict";var i=n(16).f,s=n(42),r=n(104),a=n(23),o=n(105),u=n(51),l=n(61),d=n(101),h=n(191),c=n(15),f=n(47).fastKey,p=n(106),m=c?"_s":"size",_=function(e,t){var n,i=f(t);if("F"!==i)return e._i[i];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,l){var d=e(function(e,i){o(e,d,t,"_i"),e._t=t,e._i=s(null),e._f=void 0,e._l=void 0,e[m]=0,null!=i&&u(i,n,e[l],e)});return r(d.prototype,{clear:function(){for(var e=p(this,t),n=e._i,i=e._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete n[i.i];e._f=e._l=void 0,e[m]=0},delete:function(e){var n=p(this,t),i=_(n,e);if(i){var s=i.n,r=i.p;delete n._i[i.i],i.r=!0,r&&(r.n=s),s&&(s.p=r),n._f==i&&(n._f=s),n._l==i&&(n._l=r),n[m]--}return!!i},forEach:function(e){p(this,t);for(var n,i=a(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(i(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!_(p(this,t),e)}}),c&&i(d.prototype,"size",{get:function(){return p(this,t)[m]}}),d},def:function(e,t,n){var i,s,r=_(e,t);return r?r.v=n:(e._l=r={i:s=f(t,!0),k:t,v:n,p:i=e._l,n:void 0,r:!1},e._f||(e._f=r),i&&(i.n=r),e[m]++,"F"!==s&&(e._i[s]=r)),e},getEntry:_,setStrong:function(e,t,n){l(e,t,function(e,n){this._t=p(e,t),this._k=n,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?d(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,d(1))},n?"entries":"values",!n,!0),h(t)}}},function(e,t,n){"use strict";var i=n(18),s=n(4),r=n(16),a=n(15),o=n(14)("species");e.exports=function(e){var t="function"==typeof s[e]?s[e]:i[e];a&&t&&!t[o]&&r.f(t,o,{configurable:!0,get:function(){return this}})}},function(e,t,n){"use strict";var i=n(18),s=n(11),r=n(47),a=n(24),o=n(20),u=n(104),l=n(51),d=n(105),h=n(17),c=n(45),f=n(16).f,p=n(193)(0),m=n(15);e.exports=function(e,t,n,_,v,g){var y=i[e],S=y,b=v?"set":"add",P=S&&S.prototype,k={};return m&&"function"==typeof S&&(g||P.forEach&&!a(function(){(new S).entries().next()}))?(S=t(function(t,n){d(t,S,e,"_c"),t._c=new y,null!=n&&l(n,v,t[b],t)}),p("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in P&&(!g||"clear"!=e)&&o(S.prototype,e,function(n,i){if(d(this,S,e),!t&&g&&!h(n))return"get"==e&&void 0;var s=this._c[e](0===n?0:n,i);return t?this:s})}),g||f(S.prototype,"size",{get:function(){return this._c.size}})):(u((S=_.getConstructor(t,e,v,b)).prototype,n),r.NEED=!0),c(S,e),k[e]=S,s(s.G+s.W+s.F,k),g||_.setStrong(S,e,v),S}},function(e,t,n){var i=n(23),s=n(62),r=n(27),a=n(43),o=n(194);e.exports=function(e,t){var n=1==e,u=2==e,l=3==e,d=4==e,h=6==e,c=5==e||h,f=t||o;return function(t,o,p){for(var m,_,v=r(t),g=s(v),y=i(o,p,3),S=a(g.length),b=0,P=n?f(t,S):u?f(t,0):void 0;S>b;b++)if((c||b in g)&&(_=y(m=g[b],b,v),e)){if(n)P[b]=_;else if(_)switch(e){case 3:return!0;case 5:return m;case 6:return b;case 2:P.push(m)}else if(d)return!1}return h?-1:l||d?d:P}}},function(e,t,n){var i=n(195);e.exports=function(e,t){return new(i(e))(t)}},function(e,t,n){var i=n(17),s=n(97),r=n(14)("species");e.exports=function(e){var t;return s(e)&&("function"==typeof(t=e.constructor)&&(t===Array||s(t.prototype))&&(t=void 0),i(t)&&null===(t=t[r])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){var i=n(11);i(i.P+i.R,"Map",{toJSON:n(197)("Map")})},function(e,t,n){var i=n(68),s=n(198);e.exports=function(e){return function(){if(i(this)!=e)throw TypeError(e+"#toJSON isn't generic");return s(this)}}},function(e,t,n){var i=n(51);e.exports=function(e,t){var n=[];return i(e,!1,n.push,n,t),n}},function(e,t,n){n(200)("Map")},function(e,t,n){"use strict";var i=n(11);e.exports=function(e){i(i.S,e,{of:function(){for(var e=arguments.length,t=Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,n){n(202)("Map")},function(e,t,n){"use strict";var i=n(11),s=n(84),r=n(23),a=n(51);e.exports=function(e){i(i.S,e,{from:function(e){var t,n,i,o,u=arguments[1];return s(this),(t=void 0!==u)&&s(u),null==e?new this:(n=[],t?(i=0,o=r(u,arguments[2],2),a(e,!1,function(e){n.push(o(e,i++))})):a(e,!1,n.push,n),new this(n))}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n(0)),s=l(n(1)),r=n(9),a=l(n(2)),o=l(n(204)),u=l(n(205));function l(e){return e&&e.__esModule?e:{default:e}}var d=(0,r.requireProto)("P2PNotifyNodeLeave");t.default=function(){function e(t){(0,i.default)(this,e),this.uid=t,this.nodeType=-1,this.nodeProxy=null,this.peer=new o.default(this),this.channel=new u.default(this),this.sendCnt=0,this.rtt=0,this.pingCnt=0,this.isAlive=!0,this.lastRecvPingStampc=0,this.onDataCb=null,this.onStateCb=null,this.onErrorCb=null,this.onPunchStat=null,this.sslUrl="",this.stunIp="",this.stunPorts=[]}return(0,s.default)(e,[{key:"clear",value:function(){this.peer.clear(),this.channel.clear(),this.onDataCb=null,this.onStateCb=null,this.onErrorCb=null}},{key:"close",value:function(){this.peer.close(),this.channel.close()}},{key:"onError",value:function(e){this.onErrorCb&&this.onErrorCb(this.uid,e)}},{key:"sendNotifyLeaveNet",value:function(e){var t=new d;t.uid=a.default.userInfo.uuid,t.reason=e,this.channel.send(t.marshall(),r.DataType.SIGNALLING)}},{key:"send",value:function(e,t){this.channel.send(e,t)}},{key:"isPeerTimeout",value:function(e){return!this.channel.connected&&this.peer.isTimeout(e)}},{key:"isActive",value:function(){return this.peer.offerSended}},{key:"punched",value:function(){return this.channel.connected}},{key:"isPunchTryed",value:function(){return this.peer.offerSended||this.peer.answerSended}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=n(9),a=u(n(2)),o=u(n(50));function u(e){return e&&e.__esModule?e:{default:e}}var l=window.RTCPeerConnection||window.PeerConnection||window.webkitPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,d=window.RTCIceCandidate||window.mozRTCIceCandidate,h=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.mozRTCSessionDescription;t.default=function(){function e(t){(0,i.default)(this,e),this.node=t,this.offerSended=!1,this.answerSended=!1,this.isBack=!1,this.connectTime=0,this.peer=null}return(0,s.default)(e,[{key:"clear",value:function(){this.peer&&(this.peer.onicecandidate=null,this.peer.ondatachannel=null)}},{key:"close",value:function(){this.peer&&(this.peer.close(),this.peer=null),this.offerSended=!1,this.answerSended=!1,this.connectTime=0}},{key:"createPeer",value:function(){if(!this.peer){var e=null,t=null;""!==this.node.stunIp&&this.node.stunPorts.length>0?(e=this.node.stunPorts,t={iceServers:[{urls:["stun:"+(this.node.stunIp+this.node.sslUrl)+":"+e[Math.random()*e.length|0]]}]}):t={iceServers:[{urls:["stun:stun.huya.com:"+(e=[3478,3578,3678,3778,3878,3978])[Math.round(1e3*Math.random())%e.length],"stun:stun2.huya.com:"+e[Math.round(1e3*Math.random())%e.length]]}]};try{this.peer=new l(t),this.peer.onicecandidate=this.onIceCandidate.bind(this)}catch(e){return a.default.logger.log("Peer.createPeer error",e.message),!1}}return!0}},{key:"onIceCandidate",value:function(e){e.candidate&&e.candidate.candidate&&-1===e.candidate.candidate.indexOf(" tcp ")&&this.node.nodeProxy.sendCandidate(this.node.uid,e.candidate)}},{key:"recvCandidate",value:function(e){if(e.candidate&&-1===e.candidate.indexOf(" tcp ")&&this.peer){var t=new d({candidate:e.candidate,sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid});this.peer.addIceCandidate(t).catch(function(e){})}}},{key:"connectBack",value:function(){this.offerSended||this.answerSended||(this.isBack=!0,this.node.onPunchStat&&this.node.onPunchStat("back_cnt"),this.connectTime=a.default.TimeUtil.now(),this.realConnect())}},{key:"connect",value:function(){this.offerSended||this.answerSended||(this.isBack=!1,this.node.onPunchStat&&this.node.onPunchStat("try_cnt"),this.node.nodeType===r.NodeType.SDK_CLIENT_V2?this.node.onPunchStat&&this.node.onPunchStat("try_per_cnt_sdkv2"):this.node.nodeType===r.NodeType.WEB_CLIENT_V2&&this.node.onPunchStat&&this.node.onPunchStat("try_per_cnt_webv2"),this.connectTime=a.default.TimeUtil.now(),this.realConnect())}},{key:"realConnect",value:function(){this.createPeer()&&this.peer.createDataChannel?(this.node.channel.setChannel(this.peer.createDataChannel("sendDataChannel",{ordered:!1,maxRetransmits:0}),!1),this.createOffer()):this.node.onError(o.default.PEER_HANDLER_ERR)}},{key:"createOffer",value:function(){this.offerSended=!0,this.peer.createOffer(this.onCreateOffer.bind(this),this.onCreateError.bind(this))}},{key:"onCreateOffer",value:function(e){this.peer.setLocalDescription(e),this.node.nodeProxy.sendOffer(this.node.uid,e)}},{key:"onCreateError",value:function(){this.node.onError(o.default.PEER_ERROR)}},{key:"recvOffer",value:function(e,t){var n=this;this.isBack=t,this.node.onPunchStat&&this.node.onPunchStat("try_cnt"),0===this.connectTime&&(this.connectTime=a.default.TimeUtil.now()),this.createPeer()?(this.setRemoteDescription(e),this.peer.createAnswer().then(function(e){n.onCreateAnswer(e)}).catch(function(e){n.onCreateError()})):this.node.onError(o.default.PEER_HANDLER_ERR)}},{key:"onCreateAnswer",value:function(e){this.peer&&(this.peer.ondatachannel=this.onDataChannel.bind(this),this.peer.setLocalDescription(e).catch(function(e){a.default.logger.log("Peer.onCreateAnswer setLocalDescription error="+e.message)}),this.answerSended=!0,this.node.nodeProxy.sendAnswer(this.node.uid,e))}},{key:"recvAnswer",value:function(e){this.offerSended?this.setRemoteDescription(e):a.default.logger.warn("Peer.recvAnswer offerSended=false from="+e.fromUid+" to="+e.toUid)}},{key:"setRemoteDescription",value:function(e){if(this.peer){var t=new h({sdp:e.sdp,type:e.sdpType});this.peer.setRemoteDescription(t).catch(function(e){a.default.logger.log("Peer.setRemoteDescription error="+e.message)})}}},{key:"onDataChannel",value:function(e){this.node.channel.setChannel(e.channel,!0)}},{key:"isTimeout",value:function(e){return e-this.connectTime>Number(a.default.config.punchTimeout)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n(0)),s=l(n(1)),r=n(9),a=l(n(2)),o=l(n(50)),u=l(n(75));function l(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,i.default)(this,e),this.node=t,this.isPassive=!1,this.connected=!1,this.sendCnt=0,this.recvCnt=0,this.uplinkBw=0,this.downlinkBw=0,this.signalUpBw=0,this.sendAble=!0}return(0,s.default)(e,[{key:"clear",value:function(){this._channel&&(this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null,this._channel.onbufferedamountlow=null),this.connected=!1}},{key:"close",value:function(){this._channel&&this._channel.close(),this._channel=null,this.connected=!1}},{key:"setChannel",value:function(e,t){this._channel=e,this.isPassive=t,e.binaryType="arraybuffer",e.onmessage=this.onMessage.bind(this),e.onopen=this.onState.bind(this),e.onclose=this.onState.bind(this),e.onerror=this.onError.bind(this)}},{key:"onError",value:function(){this.node.onError(o.default.CHANNEL_ERROR)}},{key:"onMessage",value:function(e){if(this.recvCnt++,this.downlinkBw+=e.data.byteLength,this.node.onDataCb){var t=new DataView(e.data),n=t.getInt32(4,!0);n!==r.ProtoUri.PP2pSliceData&&(u.default.signal_down_bw+=e.data.byteLength),this.node.onDataCb(n,t)}}},{key:"onBufferedAmountLow",value:function(){this.sendAble=!0}},{key:"onState",value:function(){if(this._channel){var e=this._channel.readyState;this.connected=e===r.ChannelState.OPEN,this.connected&&a.default.logger.log("Channel.onopen",this.node.uid),this.node.onStateCb&&this.node.onStateCb(e,this.node.uid,this.node.peer.isBack)}}},{key:"send",value:function(e,t){this._channel&&this.connected&&this.sendAble&&(this.sendCnt++,this.uplinkBw+=e.length,t===r.DataType.SIGNALLING&&(this.signalUpBw+=e.length,u.default.signal_up_bw+=e.length),this._channel.readyState===r.ChannelState.OPEN?this._channel.send(e):(this.connected=!1,this.node.onError(o.default.CHANNEL_ERROR)))}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={PING_DIF:1,RESET:2}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=i&&i.__esModule?i:{default:i};t.default=function e(){(0,s.default)(this,e),this.punch_info={total_cnt:0,valid_cnt:0,try_cnt:0,succ_cnt:0,back_cnt:0,back_succ_cnt:0,arqs:0,arps:0,arqr:0,arpr:0,aj:0,try_per_cnt_sdkv2:0,try_per_cnt_webv2:0,fail_per_cnt_sdkv2:0,fail_per_cnt_webv2:0,valid_cnt_sdkv2:0,valid_cnt_webv2:0},this.punch_back_ret={}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={SUC:0,DIF_STREAM:1,CLOSING:2,COOLING:3,REQUEST:4,REJECT:5}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=p(n(77)),s=p(n(8)),r=p(n(10)),a=p(n(0)),o=p(n(1)),u=p(n(213)),l=p(n(257)),d=p(n(37)),h=p(n(263)),c=p(n(264)),f=p(n(2));function p(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,a.default)(this,e),this.streamMap=new r.default,this.streamSeqSNMap=new r.default}return(0,o.default)(e,[{key:"containStream",value:function(e,t){var n=!0,i=!1,r=void 0;try{for(var a,o=(0,s.default)(this.streamSeqSNMap.values());!(n=(a=o.next()).done);n=!0)if(a.value.sInfo.streamId.equal(e))return!0}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}return!1}},{key:"hasStreams",value:function(){return this.streamMap.size>0}},{key:"getStreams",value:function(){return this.streamSeqSNMap.values()}},{key:"getStreamNum",value:function(){return this.streamMap.size}},{key:"removeStream",value:function(e){this.streamMap.delete(e.sInfo.pInfo.sStreamName),this.streamSeqSNMap.delete(e.sInfo.streamSeqSN)}},{key:"clearPunch",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,r=(0,s.default)(this.streamMap.values());!(e=(i=r.next()).done);e=!0)i.value.clearPunch()}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}}},{key:"clearVideo",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,r=(0,s.default)(this.streamMap.values());!(e=(i=r.next()).done);e=!0){var a=i.value;a.sInfo.pInfo.type===d.default.P2P?(a.destroy(),this.removeStream(a)):a.started&&a.onRestart()}}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}}},{key:"checkClear",value:function(){var e=!1,t=!0,n=!1,i=void 0;try{for(var r,a=(0,s.default)(this.streamMap.values());!(t=(r=a.next()).done);t=!0)if(r.value.sInfo.pInfo.type===d.default.P2P){e=!0;break}}catch(e){n=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw i}}if(f.default.logger.log("StreamMgr.checkClear hasVideo="+e),!e){var o=!0,u=!1,l=void 0;try{for(var h,c=(0,s.default)(this.streamMap.values());!(o=(h=c.next()).done);o=!0){var p=h.value;p.started&&p.onRestart()}}catch(e){u=!0,l=e}finally{try{!o&&c.return&&c.return()}finally{if(u)throw l}}}}},{key:"pullClearPunch",value:function(){f.default.logger.log("StreamMgr.pullClearPunch");var e=!0,t=!1,n=void 0;try{for(var i,r=(0,s.default)(this.streamMap.values());!(e=(i=r.next()).done);e=!0){var a=i.value;a.started&&a.onRestart()}}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}}},{key:"playStream",value:function(e){var t=null,n=null;if(e.type===d.default.P2P?(n=new h.default,(0,i.default)(n,e),t=new u.default(n)):e.type===d.default.STREAM&&(n=new c.default,(0,i.default)(n,e),t=new l.default(n)),t&&this.streamMap.has(t.sInfo.pInfo.sStreamName)){var s=this.streamMap.get(t.sInfo.pInfo.sStreamName);this.streamMap.delete(t.sInfo.pInfo.sStreamName),this.streamSeqSNMap.delete(t.sInfo.streamSeqSN),s.destroy()}return t?(this.streamMap.set(t.sInfo.pInfo.sStreamName,t),this.streamSeqSNMap.set(t.sInfo.streamSeqSN,t)):f.default.logger.log("StreamMgr.createStream not support type",e.type),t}},{key:"calcPeerLoss",value:function(e,t,n){var i=!0,r=!1,a=void 0;try{for(var o,u=(0,s.default)(this.streamSeqSNMap.values());!(i=(o=u.next()).done);i=!0)o.value.calcPeerLoss(e,t,n)}catch(e){r=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(r)throw a}}}},{key:"onNodeOpen",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,a=(0,s.default)(this.streamSeqSNMap.values());!(t=(r=a.next()).done);t=!0)r.value.onNodeOpen(e)}catch(e){n=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw i}}}},{key:"onDelNode",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,a=(0,s.default)(this.streamSeqSNMap.values());!(t=(r=a.next()).done);t=!0)r.value.onDelNode(e)}catch(e){n=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw i}}}}]),e}()},function(e,t,n){n(211),e.exports=n(4).Object.assign},function(e,t,n){var i=n(11);i(i.S+i.F,"Object",{assign:n(212)})},function(e,t,n){"use strict";var i=n(15),s=n(36),r=n(71),a=n(46),o=n(27),u=n(62),l=Object.assign;e.exports=!l||n(24)(function(){var e={},t={},n=Symbol(),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach(function(e){t[e]=e}),7!=l({},e)[n]||Object.keys(l({},t)).join("")!=i})?function(e,t){for(var n=o(e),l=arguments.length,d=1,h=r.f,c=a.f;l>d;)for(var f,p=u(arguments[d++]),m=h?s(p).concat(h(p)):s(p),_=m.length,v=0;_>v;)f=m[v++],i&&!c.call(p,f)||(n[f]=p[f]);return n}:l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=y(n(5)),s=y(n(0)),r=y(n(1)),a=y(n(6)),o=y(n(12)),u=y(n(7)),l=y(n(2)),d=y(n(112)),h=y(n(238)),c=y(n(33)),f=y(n(239)),p=y(n(119)),m=y(n(250)),_=y(n(78)),v=y(n(38)),g=y(n(3));function y(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e){(0,s.default)(this,t);var n=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return n.streamDomain.initDomain(e.sP2pUrl,e.p2pDomainList?e.p2pDomainList.slice():null,e._domain302),n.loaderMgr.connectTimeout=Number(l.default.config.connectTimeout),n}return(0,u.default)(t,e),(0,r.default)(t,[{key:"initStreamId",value:function(){var e=Number(this.sInfo.pInfo.iIsP2PSupport);this.sInfo.streamId.cdnBrand=e>1?e:0;var n=Number(this.sInfo.pInfo.iBitRate);-1!==l.default.config.useChangeRate.indexOf(Number(this.sInfo.pInfo.presenterUid))&&(n=this.sInfo.pInfo.curBitrate);var s=void 0;s=this.sInfo.pInfo.isAv1?this._getCodec(1,n):this.sInfo.pInfo.isH265?this._getCodec(2,n):this._getCodec(3,n),this.sInfo.streamId.codecType=s,(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"initStreamId",this).call(this),l.default.logger.log("VideoStream.initStreamId",this.id,this.sInfo.streamSeqSN,this.sInfo.streamId.text())}},{key:"_getCodec",value:function(e,t){var n=t;return 0===t?3===e?n=0:2===e?n=2:1===e&&(n=4):t%100==0?3===e?n=t>8e3?1e3+(t/100|0):400+(t/100|0):2===e?n=t>8e3?4e3+(t/100|0):500+(t/100|0):1===e&&(n=9e3+(t/100|0)):t%10==0&&(3===e?t>0&&(n=2e4+(t/10|0)):2===e?t>0&&(n=3e4+(t/10|0)):1===e&&(n=4e4+(t/10|0))),n}},{key:"initConfig",value:function(){var e=c.default.SLICE_SPEED*this.sInfo.baseSubs*(this.sInfo.curBitrate/1e3),n=Number(l.default.config.sliceLate)||1e3,s=Number(l.default.config.sliceFast)||2e3;this.sInfo.sliceLate=parseInt(e*n/1e3),this.sInfo.sliceFast=parseInt(e*s/1e3),this.sInfo.lostSeqNum=10*e,this.recevier.seqMap.setSize(20*e);var r=parseInt(e*(Number(l.default.config.patchSubTs)/1e3));this.patchBaseSubs=Math.min(r,1e3),1===Number(l.default.config.useMinSeq)&&(this.subStreamMgr.baseIndexCalc.mode=v.default.MIN),this.openLog=g.default.isOpen(l.default.config.p2pMediaLogCfg,this.sInfo.presenterUid,this.sInfo.lineType,!1),this.initGapCfg("mediaExperiment","mediaRangeGap","mediaSubGap"),this.initBaseIndexCfg("mediaBaseIndexExp","mediaBaseIndexMode"),this.initSliceCfg("mediaSliceCache","mediaSliceDispatch"),(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"initConfig",this).call(this)}},{key:"createToken",value:function(){var e=new h.default(this);return e.token=this.sInfo.pInfo.sFlvAntiCode,e.flvUrl=this.sInfo.pInfo.sFlvUrl,e}},{key:"createResender",value:function(){return new f.default(this)}},{key:"createSubStreamMgr",value:function(){return new p.default(this,m.default)}},{key:"startSubStream",value:function(){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"startSubStream",this).call(this),this.loaderMgr.loadPatch(this.patchBaseSubs,this.recevier.maxSeq,[0])}},{key:"getColor",value:function(){return"color:#F101AC"}},{key:"firstDataTimeout",value:function(e){this.streamHandler.turnToFlv(e?_.default.FULL_NO_DATA:_.default.SUB_NO_DATA)}},{key:"start",value:function(e){this.iaasMgr&&this.iaasMgr.initPInfo(e),(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"start",this).call(this,e),this.stat.core.lsflag=g.default.getLsFlag(this.sInfo.presenterUid,this.sInfo.sessionId)}}]),t}(d.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n(8)),s=l(n(0)),r=l(n(1)),a=n(9),o=l(n(2)),u=l(n(37));function l(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,s.default)(this,e),this.pInfo=t,this.isCanUseP2P=t.presenterUid!==t.uid&&!this.isCloseP2P(),this.isCanUseCdnp=!this.isCloseCdnp(),this.baseSubs=8,this.cdnpFixedNum=0,this.exip=0,this.quickTime=2e3,this.streamSeqSN=0;var n=(0,a.requireProto)("CdnGroupID");this.streamId=new n,this.streamId.streamName=t.sStreamName,this.sliceLate=1e3,this.sliceFast=1e3,this.lostSeqNum=4e3,this.subChange=!1,this.switchingBetter=!1,this.curUplinkNum=10,this.maxUplinkNum=40,this.lastSubs=[],this.lastCdnSubs=[],this.lastPcdnSubs=[],this.competeArr=[],this.forceArr=[],this.lastForceArr=[],this.remainP2pStreamNum=0,this.SNBw=0,this.csMinBw=0,this.hasGetVp=0,this.isLogin=0,this.isFullStream=0,this.useCdnpFixed=!1,this.isFirstLogin=!0,this.cdnpIpStr="",this.cdnpIpInt=0,this.cdnpPort=0,this.stampcNow=0,this.stampcSvr=0,this.cdnpRtt=0}return(0,r.default)(e,[{key:"isCloseP2P",value:function(){var e=!0,t=!1,n=void 0;try{for(var s,r=(0,i.default)(o.default.config.closeUids);!(e=(s=r.next()).done);e=!0){var a=s.value;if(Number(a)===Number(this.pInfo.uid))return!0}}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}return!1}},{key:"isCloseCdnp",value:function(){if(2===this.pInfo.type)return!1;var e=!0,t=!1,n=void 0;try{for(var s,r=(0,i.default)(o.default.config.signalNoCdnp);!(e=(s=r.next()).done);e=!0){var a=s.value;if(Number(a)===Number(this.presenterUid))return!0}}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}return!1}},{key:"initStreamSeqSN",value:function(){for(var e=this.streamId.text(),t=e.length,n=0,i=0;i<t;i+=4){for(var s=0,r=Math.min(i+4,t),a=i;a<r;a++)s=s<<8|e.charCodeAt(a);n+=s}var u=o.default.config.crossLineSub+"";"all"===u||-1!==u.indexOf(this.roomId+"")?this.streamSeqSN=n:this.streamSeqSN=n+this.lineType}},{key:"isClosePunchUser",get:function(){var e=o.default.config.closePunchUsers;if(e){var t=!0,n=!1,s=void 0;try{for(var r,a=(0,i.default)(e);!(t=(r=a.next()).done);t=!0){var u=r.value;if(Number(u)===Number(this.pInfo.uid))return!0}}catch(e){n=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw s}}}return!1}},{key:"subSid",get:function(){return this.pInfo.subSid||0}},{key:"lineType",get:function(){return Number(this.pInfo.lineType)||0}},{key:"curBitrate",get:function(){return this.pInfo.curBitrate&&!isNaN(this.pInfo.curBitrate)?Math.max(Number(this.pInfo.curBitrate),500):500}},{key:"originalBitrate",get:function(){return this.pInfo.originalBitrate||0}},{key:"presenterUid",get:function(){return this.pInfo.presenterUid||0}},{key:"sessionId",get:function(){return this.pInfo._sessionId||0}},{key:"adBlock",get:function(){return+(1===Number(this.pInfo.adBlock))}},{key:"roomId",get:function(){return this.pInfo.roomId}},{key:"JITTER_BUFLEN",get:function(){return this.pInfo.JITTER_BUFLEN||3e3}},{key:"type",get:function(){return this.pInfo.type||0}},{key:"isSignal",get:function(){return this.type===u.default.STREAM}},{key:"isMedia",get:function(){return this.type!==u.default.STREAM}},{key:"dMod",get:function(){var e=this.pInfo._dMod;"mseh"!==e&&"wcs"!==e&&"wasm"!==e&&"mses"!==e&&(e="unknow");var t=Number(this.pInfo._sMod);return isNaN(t)&&(t=0),e+"-"+t}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=N(n(58)),s=N(n(8)),r=N(n(10)),a=N(n(5)),o=N(n(0)),u=N(n(1)),l=N(n(6)),d=N(n(7)),h=n(9),c=N(n(32)),f=N(n(2)),p=N(n(78)),m=N(n(113)),_=N(n(13)),v=N(n(216)),g=N(n(217)),y=N(n(220)),S=N(n(221)),b=N(n(222)),P=N(n(76)),k=N(n(223)),I=N(n(225)),w=N(n(54)),T=N(n(33)),C=N(n(37)),x=N(n(39)),R=N(n(226)),M=N(n(19)),U=N(n(3));function N(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e){(0,o.default)(this,t);var n=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return n.stream=e,n.token=e.token,n.sInfo=e.sInfo,n.stat=e.stat,n.streamDomain=e.streamDomain,n.recevier=e.recevier,n.tryConnectNum=2,n.connectTimeout=2e3,n.openWss=!0,n.fullLoader=new v.default(n,e.sliceProtoHandler),n.subLoader=new g.default(n,e.sliceProtoHandler),n.pcdnSubLoaders=[],n.pcdnIndexArray=[],n.pcdnSubCtrlsMap=new r.default,n.patchLoader=new S.default(n,e.sliceProtoHandler),n.probeLoader=new b.default(n,e.sliceProtoHandler),n.rangeNormal=new k.default(n,!1),n.rangeUrgent=new k.default(n,!0),n.subProtocol="",n.loaderInfoList=[],n.linkSubStreamNums=4,n.subLoaderMap=new r.default,n.subMutilLink=!1,n.subList=[],n.subStreams=null,n.mutilLinkConfig=[[0,4e3],[8,4]],n.subMutilLink=!0,n.linkSubStreamNums=4,n.init(),n.cdnSubsReconnctCnt=0,n.cdnsip_sub="",n.cdnsip_patch="",n.maxCdnSeq=0,n.pcdnSlowMap=new r.default,n.iaasIdx=0,n.iaasGoodObj={},n.iaasBadObj={},n.iaasGatherObj={},n.keepPcdn=1==localStorage._keepPcdn,localStorage._keepPcdn=0,n}return(0,d.default)(t,e),(0,u.default)(t,[{key:"getBaseSubs",value:function(){return this.sInfo.baseSubs}},{key:"addPcdnSlow",value:function(e,t){e=Number(e);var n=this.pcdnSlowMap.get(e);n||(n=new r.default,this.pcdnSlowMap.set(e,n)),n.set(t,f.default.TimeUtil.now()+f.default.config.pcdnSlowCoolTime)}},{key:"filterPcdnDomain",value:function(e,t){e=Number(e);for(var n=[],i=t.length-1;i>0;i--){var s=this.getPcdnDomain(t[i]);this.isPcdnDomainSlow(e,s)&&(n.push(s),t.splice(i,1))}n.length>0&&f.default.logger.log("LoaderMgr.filterPcdnDomain subIndex="+e+" ignoreArr="+n.toString())}},{key:"isPcdnDomainSlow",value:function(e,t){var n=this.pcdnSlowMap.get(e);if(n){var i=n.get(t);if(i>0&&i>f.default.TimeUtil.now())return!0}return!1}},{key:"checkPcdnSlow",value:function(e){this.pcdnSlowMap.forEach(function(t){var n=!0,i=!1,r=void 0;try{for(var a,o=(0,s.default)(t.keys());!(n=(a=o.next()).done);n=!0){var u=a.value;t.get(u)<e&&t.delete(u)}}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}})}},{key:"getPcdnDomain",value:function(e){if(-1!==e.indexOf("webrtc://")){for(var t=e.split("&"),n=t.length,i=0;i<n;i++)if(-1!==t[i].indexOf("nids"))return t[i].split("=")[1]}return e.split("//")[1].split("/")[0]}},{key:"recvCdnSeq",value:function(e){this.maxCdnSeq<e&&(this.maxCdnSeq=e)}},{key:"printInfo",value:function(){f.default.logger.log("LoaderMgr.printInfo lastContinueSeq="+this.stream.recevier.lastContinuedSeq),this.rangeUrgent.printInfo(),this.rangeNormal.printInfo()}},{key:"setMutilLinkConfig",value:function(e){this.mutilLinkConfig=e}},{key:"setCurrentBiterate",value:function(e){if(null!=this.mutilLinkConfig&&this.mutilLinkConfig[0].length==this.mutilLinkConfig[1].length){for(var t=this.mutilLinkConfig[0].length-1;t>=0;t--)if(e>=this.mutilLinkConfig[0][t]){this.linkSubStreamNums=this.mutilLinkConfig[1][t];break}}}},{key:"init",value:function(){var e=!0;if(-1===self.location.protocol.indexOf("https")){var t=f.default.config.p2pWssLines;"string"==typeof t&&(e="all"===(t=t.toLowerCase())||-1!==t.split(",").indexOf(this.sInfo.pInfo.lineType.toString()))}void 0===c.default._testSSL?this.openWss=e:this.openWss=Number(c.default._testSSL)>0,this.setMutilLinkConfig(f.default.config.mutilLinkConfig)}},{key:"initBaseSub",value:function(e){for(var t=-1,n=0,i=0;i<e;i++){if(i>t){var s=new g.default(this,this.stream.sliceProtoHandler),r=new I.default(n*this.linkSubStreamNums,(n+1)*this.linkSubStreamNums-1);r.setLoader(s),this.loaderInfoList.push(r),t=(n+1)*this.linkSubStreamNums-1,n++}this.loaderInfoList[this.loaderInfoList.length-1].bAscription(i)&&this.subLoaderMap.set(i,this.loaderInfoList[this.loaderInfoList.length-1])}}},{key:"stop",value:function(){f.default.logger.log("LoaderMgr.stop",this.stream.id),this.stopLong(),this.patchLoader.close(),this.stopRange(),this.rangeNormal.reset(),this.rangeUrgent.reset(),this.stopSub(),this.deleteSubLoaders(),this.pcdnSubLoaders.forEach(function(e){e.destroy(),e=null}),this.pcdnSubLoaders=[],this.pcdnIndexArray=[],this.maxCdnSeq=0}},{key:"onopen",value:function(e){if(e.isSub()&&this.stream.onopen(),e instanceof y.default){var t=this.stream.subStreamMgr.subStreams[e.subIndex];t.setPcdnState(x.default.COMPLETE),t.setPcdnFailReason(h.ProtoLinkWebrtcFailReasons.NONE)}}},{key:"onerrorBefore",value:function(e,t,n){if(!e.isProbe()&&e.isPcdn&&e.isWebrtc){var i=e.getFailReason();this.stat.wr_info.hasOwnProperty(i)&&this.stat.wr_info[i]++,this.stream.subStreamMgr.subStreams[e.subIndex].setPcdnFailReason(i)}}},{key:"onerror",value:function(e,t,n){this.reconnectSub(e)||(e.isProbe()?this.onProbeError():(e.isPcdn?this.reportState(2,!0,e.subIndex):this.reportState(2),404!==n&&403!==n||this.stream.tsdbUtil.sendMetrics([{sMetricName:"web.p2p.http_code_"+n,vDimension:{success:e.type}},this.stream.tsdbStat.createAct("http_code_"+n,{value:[e.type]})])))}},{key:"onPcdnSwitchToCdn",value:function(e,t,n){var i=this.stream.subStreamMgr.subStreams[e.subIndex];if(i&&M.default.isProxyUid(i.pubInfo.uid)){var s=this.pcdnSubCtrlsMap.get(e.subIndex),r=!0;if(s.isWebrtc()&&(n!==h.ProtoLinkWebrtcErrorCode.XHR_404&&n!==h.ProtoLinkWebrtcErrorCode.XHR_ERR&&s.retry(),s.hasUrl())){r=!1,e.close();var a=f.default.TimeUtil.now();e.retryTime=f.default.getCfgValNum("pcdnRetryTime",500)+a,localStorage._testPcdnRetryTime>0&&(e.retryTime+=Number(localStorage._testPcdnRetryTime)),f.default.logger.log("LoaderMgr.onPcdnSwitchToCdn, subIndex="+e.subIndex+",now="+a+" retryTime="+e.retryTime+" wait="+(e.retryTime-a))}r&&this.stream.subStreamMgr.switchCdn([e.subIndex],t)}}},{key:"onheader",value:function(e,t){if(t&&t.hasOwnProperty("cdnsip")){var n=t.cdnsip;e.isSub()?(this.cdnsip_sub=n,this.stat.cdn_sip=n):e.isPatch()?this.cdnsip_patch=n:e.isRange()&&(this.stat.range_sip_suc_cnt++,""!==n&&n!==this.cdnsip_patch&&n!==this.cdnsip_sub&&this.stat.range_sip_dif_cnt++)}}},{key:"onclose",value:function(e){f.default.logger.log("LoaderMgr.onclose"),this.reconnectSub(e)||e.isProbe()&&this.onProbeLoaded()}},{key:"reconnectSub",value:function(e){if(!(this.cdnSubsReconnctCnt>=3)){if(e.isSub()&&this.subMutilLink&&e.getSubs&&e.getSubs().length>0){var t=this.subLoaderMap.get(e.getSubs()[0]);t.resetLoader();var n=new g.default(this,this.stream.sliceProtoHandler);return t.setLoader(n),this.loadSub(0,this.subList,this.subStreams),this.cdnSubsReconnctCnt++,!0}return!1}}},{key:"stopLong",value:function(){this.longLoader&&(this.longLoader.close(),this.longLoader=null)}},{key:"stopSubLoaders",value:function(){for(var e=0;e<this.loaderInfoList.length;e++)this.loaderInfoList[e].closeLoader()}},{key:"deleteSubLoaders",value:function(){for(;this.loaderInfoList.length>0;)this.loaderInfoList[this.loaderInfoList.length-1].closeLoader(),this.loaderInfoList[this.loaderInfoList.length-1].resetLoader(),this.loaderInfoList.pop()}},{key:"stopFull",value:function(){this.fullLoader.close()}},{key:"loadFull",value:function(e){this.stopLong();var t="";isNaN(e)?(f.default.logger.error("LoaderMgr.loadFull baseIndex isNaN ["+e+"] change to 0.",this.stream.id),e=0):0===e&&this.sInfo.quickTime>0&&(t="&quickTime="+this.sInfo.quickTime),this.stat.qps_info.full_cdn_cnt++;var n=this.getUrl(_.default.TYPE_FULL)+e+t;n+="&timeStamp"+f.default.TimeUtil.getDateTimeStr().replace(" ","_"),n+=this.getUrlEnd(),this.stat.core.stream_url=n,this.fullLoader.baseIndex=e,this.fullLoader.connect(n,this.getBufferLen()),this.longLoader=this.fullLoader}},{key:"stopSub",value:function(){this.subList.length=0,this.subMutilLink?this.stopSubLoaders():this.subLoader.close()}},{key:"stopPcdnSubs",value:function(e){this.pcdnSubLoaders.forEach(function(t){var n=t.subIndex;e.indexOf(n)>-1&&(f.default.logger.log("LoaderMgr.stopPcdnSubs",t.subIndex),t.isClose||t.close())})}},{key:"stopPcdnSub",value:function(e){for(var t=this.pcdnSubLoaders.length-1;t>=0;t--){var n=this.pcdnSubLoaders[t];n&&n.subIndex===e&&(f.default.logger.log("LoaderMgr.stopPcdnSub",n.subIndex),n.close())}}},{key:"loadSub",value:function(e,t,n,i){if(t.sort(function(e,t){return e-t}),this.subList=t,this.subStreams=n,this.loaderInfoList.length<1&&this.initBaseSub(n.length),this.stopLong(),isNaN(e)&&(f.default.logger.error("LoaderMgr.loadSub baseIndex isNaN ["+e+"] change to 0.",this.stream.id),e=0),this.subMutilLink){var r=!0,a=!1,o=void 0;try{for(var u,l=(0,s.default)(this.subLoaderMap.values());!(r=(u=l.next()).done);r=!0){var d=u.value;d.baseIndexMode=this.stream.subStreamMgr.baseIndexCalc.mode,d.resetBaseIndex()}}catch(e){a=!0,o=e}finally{try{!r&&l.return&&l.return()}finally{if(a)throw o}}for(var h=0;h<t.length;h++)this.subLoaderMap.get(t[h]).addLoadingSub(t[h],n[h].pubInfo.maxRecvSeq);for(var c=0;c<this.loaderInfoList.length;c++){if(this.loaderInfoList[c].bSubChange()){this.loaderInfoList[c].getLoader().close();var p=this.loaderInfoList[c].getBaseIndex();this.loadSubSeparate(this.loaderInfoList[c].getLoader(),p,this.loaderInfoList[c].getLoaderSub(),i)}this.loaderInfoList[c].loadStarted()}}else if(t.length>0){this.stopPcdnSubs(t);var m=t.join(","),v=this.getUrl(_.default.TYPE_SUB)+e+"&baseSubs="+this.sInfo.baseSubs+"&sub="+m;v+=this.getUrlSub()+this.getUrlEnd(),this.stat.core.stream_url=v,this.subLoader.baseIndex=e,v.indexOf("https")>0?this.subProtocol="https":v.indexOf("wss")&&(this.subProtocol="wss"),this.subProtocol="https",this.stat.qps_info.sub_cdn_cnt++,this.subLoader.connect(v,this.getBufferLen()),this.subLoader.subsArray=t,this.longLoader=this.subLoader}}},{key:"isSubsReady",value:function(){if(this.sInfo.lastSubs&&this.sInfo.lastSubs.length>0){if(this.subMutilLink){for(var e=this.loaderInfoList.length,t=!0,n=0;n<e;n++){var i=this.loaderInfoList[n];i.hasSubs()&&t&&(t=i.isConnected())}return t}return this.subLoader.connectedTs>0}return!0}},{key:"loadPcdnSub",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=this.pcdnIndexArray.indexOf(e),r=void 0,a=void 0;-1===s?((r=new y.default(this,this.stream.sliceProtoHandler)).subIndex=e,this.pcdnIndexArray.push(e),this.pcdnSubLoaders.push(r),a=new R.default(e,this),this.pcdnSubCtrlsMap.set(e,a)):(r=this.pcdnSubLoaders[s],a=this.pcdnSubCtrlsMap.get(e)),a.setUrls(t,i),r.urls=t,r.pcdnName=n,r.connecting?f.default.logger.log("[LoaderMgr] loadPcdnSub index="+r.subIndex+" connecting, return"):r.protoLink&&(r.protoLink.connected||r.protoLink.ws&&r.protoLink.ws.readyState===WebSocket.CONNECTING)?f.default.logger.log("[LoaderMgr] loadPcdnSub index="+r.subIndex+" protoLink connected, return, details="+this.stream.subStreamMgr.subStreams[e].getDetails()):(r.close(),a.hasUrl()?this._tryConnectPcdn(r,a):f.default.logger.log("[LoaderMgr] loadPcdnSub index="+r.subIndex+" no url, return"))}},{key:"_tryConnectPcdn",value:function(e,t){if(t.isWebrtc()&&!this.stream.cdnpProxy.stunProxy.isReady())return f.default.logger.log("[LoaderMgr] _tryConnectPcdn index="+e.subIndex+" stun not ready, waiting..."),void(e.waitingStun=!0);var n=t.getUrl(),i=this.stream.subStreamMgr.baseIndexCalc.getSubBaseIndex(this.stream.recevier.maxSeq),s=this.stream.subStreamMgr.subStreams[e.subIndex].pubInfo.maxRecvSeq,r=[];this.token&&this.token.token&&((r=this.token.token.split("&")).filter(function(e,t){return!(e.indexOf("wsSecret")>-1)&&!(e.indexOf("wsTime")>-1)}),r.splice(0,1),r.splice(0,1)),n+="&"+r.join("&"),n+="&ex1="+this.sInfo.exip,n+="&dMod="+this.sInfo.dMod,n+="&baseIndex="+s,n+=this.getUrlSub()+this.getUrlEnd(),e.stunUrl=this.stream.cdnpProxy.stunProxy.getStunUrl(),e.pcdnDomain=this.getPcdnDomain(n),e.connect(n,this.getBufferLen()),e.maxRecvSeq=s,e.baseIndex=i}},{key:"onFirstSeq",value:function(e,t){var n=e%this.sInfo.baseSubs,i=this.stream.subStreamMgr.subStreams[n];if(i){var s=f.default.TimeUtil.now();this.stream.subStreamMgr.checkAndFillSubHole(s,i,e,t),i.checkFirstSeqHole(s,e,t)}}},{key:"onDataInterval",value:function(e,t){"cdn"===e?this.stat.pResend_info.intcd<t&&(this.stat.pResend_info.intcd=t):this.stat.pResend_info.intpd<t&&(this.stat.pResend_info.intpd=t)}},{key:"loadSubSeparate",value:function(e,t,n){var s=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(e.state!=g.default.IAAS_STATE.INIT&&null==r.curSource||null==r.curSource)&&(e.state==g.default.IAAS_STATE.PIAAS_GOOD?r=this.iaasGoodObj:e.state==g.default.IAAS_STATE.PIAAS_BAD?r=this.iaasBadObj:e.state==g.default.IAAS_STATE.PIAAS_GATHER&&(r=this.iaasGatherObj),1==localStorage._printIaasInfo&&f.default.logger.log("LoderMgr.loadSubSeparate: "+e.state+", "+(0,i.default)(r)));var a=r,o=a.curSource,u=a.type,l=a.reason;if(n.length>0){var d=n.join(","),h=this.streamDomain.domain302,p=this.getUrl(_.default.TYPE_SUB,u)+t+"&baseSubs="+this.sInfo.baseSubs+"&sub="+d;p+=this.getUrlSub()+this.getUrlEnd(),this.stat.core.stream_url=p,e.baseIndex=t,1!==Number(c.default.closeHttps)&&(p.indexOf("https")>0?this.subProtocol="https":p.indexOf("wss")&&(this.subProtocol="wss"),this.subProtocol="https");var m=!1;this.stream.subStreamMgr&&this.stream.subStreamMgr.subStreams&&this.stream.subStreamMgr.subStreams.map(function(e,t){if(-1!=n.indexOf(e.index)){var i=e.pubInfo.uid;s.stream.subStreamMgr.getIsCompete(i)&&(m=!0)}}),this.stream.iaasMgr.isUseIaas&&(0!=u&&1!=u||(p+="&baseadr="+h,p+="&clash_sub="+ +!!m)),null!=o&&null!=o&&(p+="&p_iaas="+o),null!=u&&(p+="&p_iaas_param="+u+"-"+(l||0)),o&&u&&f.default.logger.log("LoaderMgr.loadSubSeparate url="+p+", isCompete="+m+", curSource="+o+", type="+u+", reason="+l+"}"),e.setSubs(n,t),e.pIaasType=u,e.loaderIdx=this.iaasIdx,e.connect(p,this.getBufferLen(),u),this.stat.qps_info.sub_cdn_cnt++}}},{key:"getUrl",value:function(e,t){var n=e===_.default.TYPE_RANGE||e===_.default.TYPE_FULL?"http":"ws";f.default.config.isSubUseHttps&&(e===_.default.TYPE_SUB||e===_.default.TYPE_PATCH)&&(n="http"),this.openWss&&1!==Number(c.default.closeHttps)&&(n+="s");var i=!1,s=!1,r=!1,a=f.default.config.p2p302Config,o=this.sInfo.pInfo.lineType,u=a[0];return u.length>0&&u.map(function(e){Number(e[0])===Number(o)&&(i=1==e[1],s=1==e[2],r=1==e[3])}),(e!=_.default.TYPE_RANGE||i)&&(e!=_.default.TYPE_SUB||s)&&(e!=_.default.TYPE_PATCH||r)||(this.streamDomain.domain302=""),this.stream.iaasMgr.isUseIaas&&(e==_.default.TYPE_RANGE||e==_.default.TYPE_SUB)&&(this.streamDomain.domain302=this.stream.iaasMgr.domain302),this.stream.iaasMgr.isUseIaas&&e==_.default.TYPE_SUB&&(0!=t&&1!=t&&2!=t||(this.streamDomain.domain302="")),""!==this.streamDomain.domain302?n+="://"+this.streamDomain.domain302+this.streamDomain.streamUrl.replace("//","/"):n+=":"+this.streamDomain.streamUrl,this.streamDomain.streamUrl.match(/al\.p2p\.huya\.com/)&&e!==_.default.TYPE_RANGE&&e!==_.default.TYPE_FULL&&(n+="/websocket"),n+="/"+this.sInfo.streamId.text()+"_"+f.default.userInfo.appid+".slice"+("?"+this.token.token+"&ex1="+this.sInfo.exip+"&dMod="+this.sInfo.dMod)+"&hxtype=0&baseIndex="}},{key:"getUrlSub",value:function(){return"&maxSeq="+this.recevier.maxSeq+"&timeStamp"+f.default.TimeUtil.getDateTimeStr().replace(" ","_")}},{key:"getUrlEnd",value:function(){var e="&uuid="+f.default.userInfo.uuid+"&u="+f.default.userInfo.convertUid+"&t=100&sv=2405151658&sdk_sid="+this.sInfo.sessionId+"&a_block="+this.sInfo.adBlock;return U.default.isWupFail()&&(e+="&sf=1"),e}},{key:"getBufferLen",value:function(){return this.stream.streamHandler&&this.stream.streamHandler.getBufferLen?"bufferLen="+this.stream.streamHandler.getBufferLen():""}},{key:"getRangeRTO",value:function(){return this.rangeNormal?this.rangeNormal.getRTO():200}},{key:"stopPatch",value:function(){this.patchLoader.close()}},{key:"loadPatch",value:function(e,t,n){if(e=Number(e)||0,t=Number(t)||0,n=n.slice(),e<=0||0===n.length)f.default.logger.error("LoaderMgr.loadPatchSubStream argument error, baseSubs="+e+", subs="+(0,i.default)(n));else{this.patchLoader.close(),this.stat.qps_info.patch_cdn_cnt++;var s=n.join(","),r=e,a=this.getUrl(_.default.TYPE_PATCH)+t+"&baseSubs="+(r<1600?r:1600)+"&sub="+s;a+=this.getUrlSub()+this.getUrlEnd(),this.patchLoader.connect(a,"")}}},{key:"stopRange",value:function(){this.rangeNormal.close(),this.rangeUrgent.close()}},{key:"getRangeWaitNum",value:function(){return this.rangeNormal.waitSeqs.length}},{key:"loadRangeNormal",value:function(e){this.rangeNormal.load(e,k.default.NORMAL)}},{key:"loadRangeUrgent",value:function(e){this.rangeUrgent.load(e,k.default.URGENT)}},{key:"stopProbe",value:function(){this.probeLoader.close()}},{key:"loadProbe",value:function(e){this.stopProbe(),e+=1;for(var t=[],n=0;n<5;n++)t.push(this.sInfo.baseSubs*n*10);var i=e+"&wsRange="+t.join(","),s=this.getUrl(_.default.TYPE_RANGE)+i+this.getUrlSub()+this.getUrlEnd()+"&reqCnt=5";this.probeLoader.connect(s,this.getBufferLen()),f.default.Timer.once(this.onProbeTimeout,this,500)}},{key:"onProbeTimeout",value:function(){this.probeLoader.close()}},{key:"onProbeLoaded",value:function(){f.default.Timer.remove(this.onProbeTimeout,this),this.stream.onProbeSuc()}},{key:"onProbeError",value:function(){f.default.Timer.remove(this.onProbeTimeout,this)}},{key:"onCheckFastTimer",value:function(e,t){this.checkPcdnSlow(e),this.longLoader&&(this.longLoader.connecting?this.checkConnectTimeout(e):this.longLoader.connectedTs>0&&this.checkFirstDataTimeout(e)),this.pcdnSubLoaders&&this.pcdnSubLoaders.length>0&&this.checkPcdnConnectTimeout(e),this.checkCdnConnectTimeout(e),this.checkCdnDataTimout(e),this.rangeNormal.loadTimer(e),this.rangeUrgent.loadTimer(e)}},{key:"checkCdnConnectTimeout",value:function(e){if(this.sInfo.pInfo.type!=C.default.STREAM)for(var t=f.default.config.connectTimeout,n=0;n<this.loaderInfoList.length;n++){var i=this.loaderInfoList[n].getLoader();i.connecting&&e-i.connectTs>t&&(f.default.logger.log("LoaderMgr.checkCdnConnectTimeout subIndex="+n),i.close(),this.reconnectSub(i),this.stat.cdn_pull_data.cptcnt++)}}},{key:"checkCdnDataTimout",value:function(e){if(this.sInfo.pInfo.type!=C.default.STREAM)for(var t=0;t<this.loaderInfoList.length;t++){var n=this.loaderInfoList[t].getLoader();if(n.isClose)return;n.connectTs>0&&n.lastDataTs>0?e-n.lastDataTs>f.default.config.noDataTimeout&&(this.stat.cdn_pull_data.cpndcnt++,this.cdnSubsReconnctCnt=0,f.default.logger.log("LoaderMgr.checkCdnDataTimout index="+t),this.stream.iaasMgr.isUseIaas?this.stream.iaasMgr.subNoData(1,n):(n.close(),this.reconnectSub(n))):n.connectedTs>0&&0===n.lastDataTs&&e-n.connectedTs>f.default.config.noPcdnDataTimeout&&(this.stat.cdn_pull_data.cpfndcnt++,f.default.logger.log("LoaderMgr.checkCdnFirstDataTimout index="+t),this.cdnSubsReconnctCnt=0,this.stream.iaasMgr.isUseIaas?this.stream.iaasMgr.subNoData(0,n):(n.close(),this.reconnectSub(n)))}}},{key:"checkPcdnConnectTimeout",value:function(e){var t=[],n=this.pcdnSubLoaders.length,i=f.default.config.connectPcdnTimeout;this.stat.pcdn_data_state.pcdn_origin===h.PcdnName.XD&&(i=f.default.getCfgValNum("connectPcdnTimeoutXD",2e3));for(var s=n-1;s>=0;s--){var r=this.pcdnSubLoaders[s],a=this.pcdnSubCtrlsMap.get(r.subIndex);if(r.retryTime>0)r.retryTime<=e&&(f.default.logger.log("LoaderMgr.checkPcdnConnectTimeout retryTime="+r.retryTime+" now="+e+" is time to retry connect index="+r.subIndex),this._checkConnectPcdn(r,a,t));else if(r.waitingStun)this.stream.cdnpProxy.stunProxy.isReady()&&(f.default.logger.log("LoaderMgr.checkPcdnConnectTimeout stun ready index="+r.subIndex+", start connect"),this._checkConnectPcdn(r,a,t));else if(r.connecting){if(e-r.connectTs>i){this.reportState(1,!0,r.subIndex),f.default.logger.log("LoaderMgr.checkPcdnConnectTimeout index="+r.subIndex);var o=r.getTimeoutReason();this.stat.wr_info.hasOwnProperty(o)&&this.stat.wr_info[o]++,this.stream.subStreamMgr.subStreams[r.subIndex].setPcdnFailReason(o),this.addPcdnSlow(r.subIndex,r.pcdnDomain),this.stat.pcdn_data.get_stream_error_cnt++,this.stat.pcdn_data.switch_time_out_cnt++,this._checkConnectPcdn(r,a,t)}}else r.connectTs>0&&r.lastDataTs>0?this.checkPcdnDataTimeout(e,r):r.connectedTs>0&&this.checkPcdnFirstDataTimeout(e,r)}t.length>0&&this.stream.subStreamMgr.switchCdn(t,h.SubStreamState.PULL_CONNECT_TIMEOUT,w.default.PCDN_CONNECT_TIMEOUT)}},{key:"_checkConnectPcdn",value:function(e,t,n){(e.close(),t.hasUrl())?(this.stream.subStreamMgr.subStreams[e.subIndex].setPcdnState(x.default.RETRY),this._tryConnectPcdn(e,t)):n.push(e.subIndex)}},{key:"checkConnectTimeout",value:function(e){e-this.longLoader.connectTs>this.connectTimeout&&(this.reportState(1),this.longLoader.tryConnectNum<this.tryConnectNum?(this.longLoader.close(),this.reconnect()):this.turnToFlv(this.longLoader.isFull()?p.default.FULL_CONNECT_TIMEOUT:p.default.SUB_CONNECT_TIMEOUT))}},{key:"reconnectPcdn",value:function(e){f.default.logger.log("LoaderMgr.reconnectPcdn index="+e.subIndex),e.tryConnectNum++;var t=void 0;e.close(),e.urls&&e.urls.length>1?(t=e.urls[1]+"&baseIndex="+e.baseIndex,e.connect(t,this.getBufferLen()),this.stat.pcdn_data.pcdn_reconnect_spare_cnt++):(t=e.urls[0]+"&baseIndex="+e.baseIndex,e.connect(t,this.getBufferLen()))}},{key:"checkFirstDataTimeout",value:function(e){0===this.longLoader.lastDataTs&&e-this.longLoader.connectedTs>f.default.config.noDataTimeout&&(this.longLoader.close(),this.stream.firstDataTimeout(this.longLoader.isFull()))}},{key:"checkPcdnDataTimeout",value:function(e,t){if(!this.keepPcdn&&2===Number(f.default.config.pcdnNoDataMod)){var n=this.stream.subStreamMgr.subStreams[t.subIndex];if(e-t.lastDataTs>f.default.config.noDataTimeout)f.default.logger.log("LoaderMgr.checkPcdnDataTimeout index="+t.subIndex),t.close(),this.stat.pcdn_data.switch_no_data_cnt++,this.stat.pcdn_data.get_stream_error_cnt++,n.setPcdnFailReason(h.ProtoLinkWebrtcFailReasons.DATA_TIMEOUT),this.stream.subStreamMgr.switchCdn([t.subIndex],h.SubStreamState.PULL_NO_DATA,w.default.PCDN_DATA_TIMEOUT);else if(this.maxCdnSeq>0&&this.maxCdnSeq>t.lastSeq){var i=f.default.getCfgValNum("pcdnSlowTime",2);this.stat.pcdn_data_state.pcdn_origin===h.PcdnName.XD&&(i=f.default.getCfgValNum("pcdnSlowTimeXD",4));var s=i*this.sInfo.curBitrate/1e3*T.default.SLICE_SPEED*this.sInfo.baseSubs;this.maxCdnSeq-t.lastSeq>s?(t.slowCnt++,t.slowCnt>=f.default.config.pcdnSowCnt&&(f.default.logger.log("LoaderMgr.checkPcdnDataTimeout dataSlow index="+t.subIndex+" slowCnt="+t.slowCnt+" maxCdnSeq="+this.maxCdnSeq+" subSeq="+t.lastSeq+" dis="+(this.maxCdnSeq-t.lastSeq)+" limit="+s),this.addPcdnSlow(t.subIndex,t.pcdnDomain),t.close(),this.stat.pcdn_data.switch_no_data_cnt++,this.stat.pcdn_data.get_stream_error_cnt++,n.setPcdnFailReason(h.ProtoLinkWebrtcFailReasons.DATA_SLOW),this.stream.subStreamMgr.switchCdn([t.subIndex],h.SubStreamState.PULL_SEQ_SLOW,w.default.PCDN_SEQ_SLOW))):t.slowCnt=0}}}},{key:"checkPcdnFirstDataTimeout",value:function(e,t){this.keepPcdn||0===t.lastDataTs&&e-t.connectedTs>f.default.config.noPcdnDataTimeout&&(f.default.logger.log("LoaderMgr.checkPcdnFirstDataTimeout index="+t.subIndex),t.close(),this.stat.pcdn_data.switch_no_data_cnt++,this.stat.pcdn_data.get_stream_error_cnt++,this.stream.subStreamMgr.switchCdn([t.subIndex],h.SubStreamState.PULL_DATA_TIMEOUT,w.default.PCDN_DATA_TIMEOUT))}},{key:"reconnect",value:function(){this.longLoader.tryConnectNum++;var e=this.getUrl(this.longLoader.type)+this.longLoader.baseIndex;this.longLoader.type===_.default.TYPE_FULL?(this.sInfo.quickTime>0&&(e+="&quickTime="+this.sInfo.quickTime),e+=this.getUrlEnd()):(e+="&baseSubs="+this.sInfo.baseSubs+"&sub="+this.sInfo.lastSubs.join(","),e+=this.getUrlSub()+this.getUrlEnd()),this.longLoader.type===_.default.TYPE_SUB&&("https"===this.subProtocol?(e=e.replace("https","wss"),this.subProtocol="wss"):"wss"===this.subProtocol&&(e=e.replace("wss","https"),this.subProtocol="https")),this.stat.core.stream_url=e,this.longLoader.connect(e)}},{key:"turnToFlv",value:function(e){this.stream.streamHandler.turnToFlv(e)}},{key:"onWebrtcCost",value:function(e,t){switch(e){case h.ProtoLinkWebrtcCostType.START_OFFER:this.stat.wr_cost.wrcso+=t,this.stat.wr_cost_cnt.wrcso_cnt++;break;case h.ProtoLinkWebrtcCostType.OFFER_ANSWER:this.stat.wr_cost.wrcoa+=t,this.stat.wr_cost_cnt.wrcoa_cnt++;break;case h.ProtoLinkWebrtcCostType.ANSWER_OPEN:this.stat.wr_cost.wrcao+=t,this.stat.wr_cost_cnt.wrcao_cnt++;break;case h.ProtoLinkWebrtcCostType.OPEN_SEQ:this.stat.wr_cost.wrcos+=t,this.stat.wr_cost_cnt.wrcos_cnt++}}},{key:"reportState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?(P.default.addComp(this.stat.p2p_tcp_type,_.default.TYPE_SUB,1),P.default.addComp(this.stat.p2p_tcp_state,e,1)):this.longLoader&&(P.default.addComp(this.stat.p2p_tcp_type,this.longLoader.type,1),P.default.addComp(this.stat.p2p_tcp_state,e,1))}},{key:"subError403",value:function(){this.stream&&this.stream.streamHandler&&this.stream.streamHandler.subError403&&this.stream.streamHandler.subError403()}},{key:"useBadReq",value:function(e,t,n){this.subMutilLink&&this.stopSubLoaders(),this.iaasIdx++;var i={curSource:e,type:t,reason:n};this.iaasBadObj=i,this.loadSub(0,this.subList,this.subStreams,i)}},{key:"useGoodReq",value:function(e,t,n){this.subMutilLink&&this.stopSubLoaders(),this.iaasIdx++;var i={curSource:e,type:t,reason:n};this.iaasGoodObj=i,this.loadSub(0,this.subList,this.subStreams,i)}},{key:"useGatherReq",value:function(e,t,n){this.subMutilLink&&this.stopSubLoaders(),this.iaasIdx++;var i={curSource:e,type:t,reason:n};this.iaasGatherObj=i,this.loadSub(0,this.subList,this.subStreams,i)}}]),t}(m.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n(5)),s=l(n(0)),r=l(n(6)),a=l(n(7)),o=l(n(53)),u=l(n(13));function l(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e,n){(0,s.default)(this,t);var a=(0,r.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return a.type=u.default.TYPE_FULL,a}return(0,a.default)(t,e),t}(o.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=p(n(5)),s=p(n(0)),r=p(n(1)),a=p(n(6)),o=p(n(12)),u=p(n(7)),l=p(n(53)),d=p(n(13)),h=p(n(2)),c=p(n(37)),f=p(n(115));function p(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(e,n){(0,s.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return r.type=d.default.TYPE_SUB,r.subs=[],r.subCnt=0,r.firstSeqs=[],r.firstSeqCnt=0,r.state=t.IAAS_STATE.INIT,r}return(0,u.default)(t,e),(0,r.default)(t,[{key:"setSubs",value:function(e,t){this.subs=e,this.baseIndex=t,this.subCnt=e.length,this.firstSeqs=[],this.firstSeqCnt=0}},{key:"getSubs",value:function(){return this.subs}},{key:"onopen",value:function(){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onopen",this).call(this)}},{key:"connect",value:function(e,n,s){this.loaderHandler.stat.cdn_pull_data.cpcnt++,s==f.default.ReqType.GOOD?this.state=t.IAAS_STATE.PIAAS_GOOD:s==f.default.ReqType.BAD?this.state=t.IAAS_STATE.PIAAS_BAD:s==f.default.ReqType.GATHER&&(this.state=t.IAAS_STATE.PIAAS_GATHER),1==localStorage._printIaasInfo&&h.default.logger.log("SubLoader.connect, url="+e+", type="+s+", state="+this.state),(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"connect",this).call(this,e,n)}},{key:"on302",value:function(e){h.default.logger.log("SubLoader.on302,url="+e),this.loaderHandler&&this.loaderHandler.stream&&this.loaderHandler.stream.iaasMgr&&this.loaderHandler.stream.iaasMgr.on302(e,this.pIaasType,this.loaderIdx),this.state=t.IAAS_STATE.INIT}},{key:"onData",value:function(e){this.lastDataTs>0&&this.loaderHandler.onDataInterval&&this.loaderHandler.onDataInterval("cdn",h.default.TimeUtil.now()-this.lastDataTs),(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onData",this).call(this,e)}},{key:"onerror",value:function(e,n){if((0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onerror",this).call(this,e,n),!this.isClose){this.loaderHandler&&403==n&&this.loaderHandler.subError403&&this.loaderHandler.subError403(this),h.default.logger.warn("SubLoader("+this._id+").onerror type="+this.type,this.url),this.loaderHandler.stat.cdn_pull_data.cpecnt++;var s=this.loaderHandler.stream;s&&h.default.config.isPcdnReportErr&&this.loaderHandler.sInfo.pInfo.type==c.default.P2P&&s.tsdbUtil.sendMetrics([s.tsdbStat.createAct("load_pcdn_error",{value:[this.isWss?e.code:n,this.isHttps?e:""],str:["2"]})])}}},{key:"onSlice",value:function(e){if(this.subCnt>this.firstSeqCnt){var n=this.loaderHandler.getBaseSubs();if(n>0){var s=e.seq%n;this.firstSeqs[s]||(this.loaderHandler.onFirstSeq(e.seq,"cdn"),this.firstSeqs[s]=e.seq,this.firstSeqCnt++,this.firstSeqCnt===this.subCnt&&h.default.logger.log("SubLoader("+this._id+").onSlice baseIndex="+this.baseIndex+" recvFirstSeqs="+this.firstSeqs.toString()))}}e.subs=this.subs,(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onSlice",this).call(this,e),1==localStorage._printSlice&&h.default.logger.log("SubLoader("+this._id+").onSlice subIndex="+this.subs.toString()+" seq="+e.seq)}}]),t}(l.default);m.IAAS_STATE={INIT:0,PIAAS_GOOD:1,PIAAS_BAD:2,PIAAS_GATHER:3},t.default=m},function(e,t,n){"use strict";t.__esModule=!0;var i=n(40),s=i&&i.__esModule?i:{default:i};t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,s.default)(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=h(n(5)),s=h(n(0)),r=h(n(1)),a=h(n(6)),o=h(n(12)),u=h(n(7)),l=h(n(79)),d=h(n(13));function h(e){return e&&e.__esModule?e:{default:e}}h(n(2)),t.default=function(e){function t(e){(0,s.default)(this,t);var n=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return n.type=d.default.TYPE_RANGE,n.loaderHandler=e,n}return(0,u.default)(t,e),(0,r.default)(t,[{key:"reset",value:function(){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"reset",this).call(this)}},{key:"isConnectTimeout",value:function(e,t){return this.connecting&&e-this.connectTs>t}},{key:"isDataTimeout",value:function(e){return this.connectedTs>0&&e-this.connectedTs>2e3}},{key:"onSlice",value:function(e){}},{key:"onRes",value:function(e){this.loaderHandler.onGatherRes(e)}},{key:"onerror",value:function(){this.loaderHandler.onGatherError()}},{key:"onstatus",value:function(){}},{key:"onclose",value:function(){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onclose",this).call(this)}},{key:"onUpateRTO",value:function(e){}},{key:"onData",value:function(e){}}]),t}(l.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=m(n(5)),s=m(n(0)),r=m(n(1)),a=m(n(6)),o=m(n(12)),u=m(n(7)),l=n(9),d=m(n(53)),h=m(n(13)),c=m(n(2)),f=m(n(3)),p=(m(n(19)),m(n(54)));function m(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e,n){(0,s.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return r.type=h.default.TYPE_SUB,r.startTime=0,r.subIndex=-1,r.isPcdn=!0,r.pcdnName="",r.connecting=!1,r.baseIndex=0,r.maxRecvSeq=0,r.pcdnDomain="",r.slowCnt=0,r.isWebrtc=!1,r.waitingStun=!1,r.retryTime=0,r}return(0,u.default)(t,e),(0,r.default)(t,[{key:"onWebrtcCost",value:function(e,t){this.loaderHandler&&this.loaderHandler.onWebrtcCost(e,t)}},{key:"onSlice",value:function(e){0===this.lastSeq&&this.loaderHandler.onFirstSeq&&this.loaderHandler.onFirstSeq(e.seq,"pcdn"),1==localStorage._printPcdnSlice&&c.default.logger.log("PcdnSubLoader("+this._id+").onSlice subIndex="+this.subIndex+" seq="+e.seq),(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onSlice",this).call(this,e)}},{key:"connect",value:function(e,n){c.default.logger.log("PcdnSubLoader("+this._id+").connect subIndex",this.subIndex),this.isWebrtc=e.indexOf("webrtc")>0,(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"connect",this).call(this,e,n),this.startTime=c.default.TimeUtil.now(),this.loaderHandler.stat.pcdn_data.get_stream_cnt++,this.isWebrtc&&this.loaderHandler.stat.wr_info.wrttcnt++,this.connecting=!0}},{key:"destroy",value:function(){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"destroy",this).call(this),this.connecting=!1}},{key:"getFailReason",value:function(){return this.isWebrtc&&this.protoLink?this.protoLink.getFailReason():0}},{key:"getTimeoutReason",value:function(){return this.isWebrtc&&this.protoLink?this.protoLink.getTimeoutReason():0}},{key:"reset",value:function(){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"reset",this).call(this),this.baseIndex=0,this.maxRecvSeq=0,this.slowCnt=0,this.connecting=!1}},{key:"onopen",value:function(){this.connecting=!1,(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onopen",this).call(this),this.loaderHandler.stat.pcdn_data.get_stream_open_suc_cnt++,this.isWebrtc&&this.loaderHandler.stat.wr_info.wrcscnt++,0!=this.startTime&&(this.loaderHandler.stat.pcdn_data.pcdn_connect_data_time+=c.default.TimeUtil.now()-this.startTime,this.startTime=0)}},{key:"onstatus",value:function(e){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onstatus",this).call(this,e),c.default.logger.log("PcdnSubLoader("+this._id+").status status="+e,this.url)}},{key:"onerror",value:function(e,n){c.default.logger.log("PcdnSubLoader("+this._id+").onerror httpCode="+n),this.connecting=!1,(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onerror",this).call(this,e,n);var s=c.default.TimeUtil.now()-this.startTime,r=0;if(r=s<500?0:s<1e3?1:s<1500?2:s<2e3?3:4,this.loaderHandler&&403==n&&this.loaderHandler.subError403&&this.loaderHandler.subError403(this),this.loaderHandler){if(!this.isWss){if(402==n)return void this.loaderHandler.stat.pcdn_data.pcdn_reconnect_spare_cnt++;461==n&&this.loaderHandler.stat.pcdn_data.pcdn_reconnect_cnt++}this.isClose||(this.loaderHandler.stat.pcdn_data.switch_cdn_err_cnt++,this.loaderHandler.stat.pcdn_data.get_stream_error_cnt++,this.switchToCdn(l.SubStreamState.PULL_ERROR,p.default.PCDN_DISCONNECT,n)),c.default.logger.warn("PcdnSubLoader("+this._id+").onerror type="+this.type+", url = "+this.ur+", httpCode = "+n);var a=this.loaderHandler.stream;if(a&&c.default.config.isPcdnReportErr){var u=this.url?this.isWss?/wss\:\S+\:[0-9]+\//g.exec(this.url)[0]:/https\:\S+\:[0-9]+\//g.exec(this.url)[0]:"";a.tsdbUtil.sendMetrics([a.tsdbStat.createAct("load_pcdn_error",{value:[this.isWss?e.code:n,this.isHttps?e:""],str:[this.isWss?"0":"1",u,r]})])}}}},{key:"switchToCdn",value:function(e,t){-1!==this.subIndex&&this.loaderHandler&&this.loaderHandler.onPcdnSwitchToCdn&&this.loaderHandler.onPcdnSwitchToCdn(this,e,t)}},{key:"printFirstSeq",value:function(e){c.default.logger.log("PcdnSubLoader("+this._id+").onSlice firstSeq="+e+" subIndex="+this.subIndex+" baseIndex="+this.baseIndex+" maxRecvSeq="+this.maxRecvSeq)}},{key:"close",value:function(){""!==this.url&&(this.connecting=!1,this.waitingStun=!1,this.retryTime=0,c.default.logger.warn("PcdnSubLoader("+this._id+").close",this.subIndex,this.url),(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"close",this).call(this))}},{key:"onclose",value:function(e){this.connecting=!1,c.default.logger.warn("PcdnSubLoader("+this._id+").onclose type="+this.type,this.url),(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onclose",this).call(this),this.switchToCdn(l.SubStreamState.PULL_ONCLOSE,p.default.PCDN_DISCONNECT)}},{key:"onData",value:function(e,t){if(this.connecting=!1,t&&4100==t.data)return c.default.logger.log("PcdnSubLoader("+this._id+").onData type="+this.type+" code=4100 subIndex="+this.subIndex,"pcdn kick out"),this.loaderHandler.stat.pcdn_data.pcdn_kick_out_cnt++,this.close(),this.switchToCdn(l.SubStreamState.PULL_GATHER,p.default.PCDN_KICK),void this.loaderHandler.stat.pcdn_data.switch_kick_cnt++;var n=c.default.TimeUtil.now();if(0===this.firstDataTs){this.firstDataTs=n;var i=this.connectedTs-this.connectTs,s=n-this.connectedTs,r=f.default.formatByteSize(e.byteLength);c.default.logger.log("PcdnSubLoader("+this._id+").onData type="+this.type+" subIndex="+this.subIndex+" connectTime="+i+" firstPkgTs="+s+" size="+r),this.loaderHandler.stream.subStreamMgr.setSubStreamState(this.subIndex,l.SubStreamState.PULL_SUC),this.loaderHandler.onFirstData(this)}this.lastDataTs>0&&this.loaderHandler.onDataInterval&&this.loaderHandler.onDataInterval("pcdn",n-this.lastDataTs),this.lastDataTs=n;var a={isPcdn:!0,subIndex:this.subIndex,pcdnName:this.pcdnName};this.protoLink.isWs()?this.sliceHandler.onProto(new Uint8Array(e),t,a):this.sliceHandler.onData(e,t,a)}}]),t}(d.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n(5)),s=c(n(0)),r=c(n(1)),a=c(n(6)),o=c(n(12)),u=c(n(7)),l=c(n(53)),d=c(n(13)),h=c(n(2));function c(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e,n){(0,s.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return r.type=d.default.TYPE_PATCH,r.isPersonClose=!1,r.reconnectCnt=0,r.lastUrl="",r}return(0,u.default)(t,e),(0,r.default)(t,[{key:"connect",value:function(e,n){h.default.Timer.remove(this.reconnectOnce,this),this.isPersonClose=!1,(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"connect",this).call(this,e,n),this.lastUrl=e}},{key:"close",value:function(){h.default.Timer.remove(this.reconnectOnce,this),h.default.logger.log("PatchLoader.close"),this.isPersonClose=!0,(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"close",this).call(this)}},{key:"onclose",value:function(){h.default.logger.log("PatchLoader.onclose"),this.isPersonClose||this.reconnect()}},{key:"onerror",value:function(e,t){h.default.logger.log("PatchLoader.onerror"),this.loaderHandler&&403==t&&this.loaderHandler.subError403&&this.loaderHandler.subError403(this),this.reset(),this.loaderHandler&&this.loaderHandler.onerror(this,e,t),this.reconnect()}},{key:"reconnectOnce",value:function(){""!=this.lastUrl&&(h.default.logger.log("PatchLoader.reconnect, reconnectCnt="+this.reconnectCnt),this.reconnectCnt++,this.connect(this.lastUrl,""))}},{key:"reconnect",value:function(){h.default.Timer.remove(this.reconnectOnce,this),h.default.Timer.once(this.reconnectOnce,this,2e3)}}]),t}(l.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n(5)),s=c(n(0)),r=c(n(1)),a=c(n(6)),o=c(n(12)),u=c(n(7)),l=c(n(79)),d=c(n(13)),h=c(n(2));function c(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e,n){(0,s.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return r.type=d.default.TYPE_PROBE,r.reqCnt=0,r.rspCnt=0,r}return(0,u.default)(t,e),(0,r.default)(t,[{key:"reset",value:function(){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"reset",this).call(this),this.reqCnt=0,this.rspCnt=0}},{key:"isConnectTimeout",value:function(e){return this.connecting&&e-this.connectTs>500}},{key:"onSlice",value:function(e){e.from=this.type,0===this.lastSeq&&h.default.logger.log("ProbeLoader("+this._id+").onSlice firstSeq",e.seq),this.lastSeq=e.seq,this.rspCnt++}},{key:"onclose",value:function(){var e=this.lastDataTs-this.connectTs;h.default.logger.log("ProbeLoader("+this._id+").onclose type="+this.type+" rspCnt="+this.rspCnt+" costTime="+e),(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onclose",this).call(this)}}]),t}(l.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=m(n(74)),s=m(n(5)),r=m(n(0)),a=m(n(1)),o=m(n(6)),u=m(n(7)),l=m(n(32)),d=m(n(224)),h=m(n(113)),c=m(n(2)),f=m(n(13)),p=m(n(28));function m(e){return e&&e.__esModule?e:{default:e}}var _=function(e){function t(e,n){(0,r.default)(this,t);var i=(0,o.default)(this,(t.__proto__||(0,s.default)(t)).call(this));return i.loaderMgr=e,i.urgent=n,i.waitSeqs=[],i.lastSeqs=[],i.loading=!1,i.lastTimeoutTs=0,i.rtoAverageCalculator=new p.default(5),i.loader=new d.default(i,e.stream.sliceProtoHandler),c.default.logger.log("RangeProxy.constructor","range max nums",c.default.config.rangeNums),i.rangeGap=0,i.timerTs=0,i}return(0,u.default)(t,e),(0,a.default)(t,[{key:"getTimeoutTime",value:function(e){return 1===Number(c.default.config.useNewPloy)&&e-this.lastTimeoutTs>1e4?1e3:2e3}},{key:"printInfo",value:function(){c.default.logger.log("RangeProxy("+this.urgent+").printInfo waitSeqs",this.waitSeqs.slice().toString()),c.default.logger.log("RangeProxy(${this.urgent}).printInfo lastSeqs",this.lastSeqs.slice().toString())}},{key:"close",value:function(){this.loader.close()}},{key:"reset",value:function(){this.timerTs=0,this.waitSeqs=[],this.lastSeqs=[],this.rtoAverageCalculator=null}},{key:"loadTimer",value:function(e){this.rangeGap>0&&(0===this.timerTs?this.timerTs=e:e-this.timerTs>=this.rangeGap&&(this.timerTs=e,this._load(t.NORMAL)))}},{key:"load",value:function(e,t){e&&(e.length>0&&(this.waitSeqs=this.waitSeqs.concat(e)),this.waitSeqs.sort(function(e,t){return e>t?1:-1}),0===this.rangeGap&&this._load(t))}},{key:"_load",value:function(e){var n=c.default.TimeUtil.now(),s=this.getTimeoutTime(n);if((this.loader.isConnectTimeout(n,s)||this.loader.isDataTimeout(n))&&(c.default.logger.log("RangeProxy.load timeout",this.loader.isConnectTimeout(n,s),this.loader.isDataTimeout(n)),this.loaderMgr.stat.resend_info.timeout_cnt++,this.loader.isDataTimeout(n)&&(this.loaderMgr.stat.range_recv_timeout_ts=n),this.retryResend(),this.loader.close()),!(this.loader.connectedTs>0||this.loader.connecting)&&(this.waitSeqs.length>0&&this.loaderMgr.stream.resender.reduceSeqs(this.waitSeqs),0!==this.waitSeqs.length)){var r=this.getWsRange(),a=(0,i.default)(r,3),o=a[0],u=a[1],l=a[2];if(this.waitSeqs=l,u.length>0){this.lastSeqs=u,this.loaderMgr.stat.resend_info.resend_cnt++,this.loaderMgr.stat.resend_info.slice_cnt+=u.length;var d=this.loaderMgr.getUrl(f.default.TYPE_RANGE)+o+this.loaderMgr.getUrlSub()+this.loaderMgr.getUrlEnd()+"&reqCnt="+u.length;d+="&rangetype="+(e===t.NORMAL?1:2)+"&lastPlaySeq="+this.loaderMgr.stream.resender.lastPlaySeq,this.loaderMgr.stat.range_req_cnt+=u.length,this.loader.connect(d,this.loaderMgr.getBufferLen()),c.default.Timer.once(this.onTimeout,this,3e3)}}}},{key:"getWsRange",value:function(){var e=this.waitSeqs,t=0,n=[];if(0===e.length)return c.default.logger.warn("LoaderMgr.getWsRange seqList is empty."),["0",[],n];if(1===e.length)return[(t=e[0])+"&wsRange=0",[t],n];e.sort(function(e,t){return e-t}),t=e.shift(),1==l.default.testSliceError&&(l.default.sliceErrorSeq=t,l.default.testSliceError=0);for(var i=[t],s=1,r=0,a=!1,o=t+"&wsRange=0",u=0,d=e.length;u<d;u++){var h=e[u]-t;if(h!==r){if(s+1>(c.default.config.rangeNums||512)){n=e.slice(u);break}s++,i.push(e[u]),h-r==1?a=!0:a?(o+="-"+r+","+h,a=!1):o+=","+h,r=h}}return a&&(o+="-"+r),[o,i,n]}},{key:"getRTO",value:function(){return this.rtoAverageCalculator&&this.rtoAverageCalculator.getListSize()?this.rtoAverageCalculator.average():300}},{key:"addStat",value:function(e){e.connectedTs>0&&(this.loaderMgr.stat.range_info.connectCnt++,this.loaderMgr.stat.range_info.connectTime+=e.connectedTs-e.connectTs),e.lastDataTs>0&&(this.loaderMgr.stat.range_info.rspCnt++,this.loaderMgr.stat.range_info.rspTime+=e.lastDataTs-e.connectedTs),this.loaderMgr.stat.range_rsp_cnt+=e.rspCnt}},{key:"onerrorBefore",value:function(e,t,n){this.loaderMgr.stat.resend_info.error_cnt++,this.addStat(e)}},{key:"onerror",value:function(e,t,n){this.onclose(e)}},{key:"oncloseBefore",value:function(e){this.addStat(e)}},{key:"onclose",value:function(e){c.default.Timer.remove(this.onTimeout,this),this.loaderMgr.stream.resender.onResendRetry(this.lastSeqs),this.lastSeqs=[],this.waitSeqs.length>0&&this.load([])}},{key:"onheader",value:function(e,t){this.loaderMgr.onheader(e,t)}},{key:"onTimeout",value:function(){this.loaderMgr.stat.range_rsp_cnt+=this.loader.rspCnt,this.retryResend(),this.waitSeqs.length>0&&this.load([])}},{key:"retryResend",value:function(){for(;this.lastSeqs.length>0;){var e=this.lastSeqs.pop();-1===this.waitSeqs.indexOf(e)&&this.waitSeqs.unshift(e)}}},{key:"onUpdateRTO",value:function(e){this.rtoAverageCalculator&&this.rtoAverageCalculator.add(e)}}]),t}(h.default);_.NORMAL=1,_.URGENT=2,t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n(5)),s=c(n(0)),r=c(n(1)),a=c(n(6)),o=c(n(12)),u=c(n(7)),l=c(n(79)),d=c(n(13)),h=c(n(2));function c(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e,n){(0,s.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return r.type=d.default.TYPE_RANGE,r.reqCnt=0,r.rspCnt=0,r}return(0,u.default)(t,e),(0,r.default)(t,[{key:"reset",value:function(){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"reset",this).call(this),this.reqCnt=0,this.rspCnt=0}},{key:"isConnectTimeout",value:function(e,t){return this.connecting&&e-this.connectTs>t}},{key:"isDataTimeout",value:function(e){return this.connectedTs>0&&e-this.connectedTs>2e3}},{key:"onSlice",value:function(e){1==localStorage._printSlice&&h.default.logger.log("RangeLoader("+this._id+").onSlice seq="+e.seq),(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onSlice",this).call(this,e),this.rspCnt++}},{key:"onclose",value:function(){var e=this.lastDataTs-this.connectTs;h.default.logger.log("RangeLoader("+this._id+").onclose type="+this.type+" rspCnt="+this.rspCnt+" costTime="+e),this.onUpateRTO(e),(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onclose",this).call(this)}},{key:"onUpateRTO",value:function(e){(e<0||e>3e3)&&this.loaderHandler.onUpdateRTO(e)}}]),t}(l.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(38));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t,n){(0,i.default)(this,e),this.loader=null,this.streams=[],this.needLoadStreams=[],this.subStr="",this.baseIndex=0,this.baseIndexMin=0,this.baseIndexMode=a.default.MID,this.init(t,n)}return(0,s.default)(e,[{key:"resetBaseIndex",value:function(){this.baseIndex=0,this.baseIndexMin=0}},{key:"init",value:function(e,t){for(var n=e;n<=t;n++)this.setAscription(n)}},{key:"bAscription",value:function(e){return -1!=this.streams.indexOf(e)}},{key:"setAscription",value:function(e){this.streams.push(e)}},{key:"setLoader",value:function(e){this.loader=e}},{key:"addLoadingSub",value:function(e,t){-1==this.needLoadStreams.indexOf(e)&&this.needLoadStreams.push(e),0!==t&&(0===this.baseIndex?(this.baseIndex=t,this.baseIndexMin=t):this.baseIndex<t?this.baseIndex=t:this.baseIndexMin>t&&(this.baseIndexMin=t))}},{key:"getLoaderSub",value:function(){return this.needLoadStreams}},{key:"getBaseIndex",value:function(){return this.baseIndexMode===a.default.MIN?this.baseIndexMin:this.baseIndexMode===a.default.MAX?this.baseIndex:this.baseIndexMin+Math.floor(.6*(this.baseIndex-this.baseIndexMin))}},{key:"getSubStr",value:function(){return this.needLoadStreams.join(",")}},{key:"getLoader",value:function(){return this.loader}},{key:"closeLoader",value:function(){r.default.logger.log("SubLoaderInfo.closeLoader subStr="+this.subStr),this.loader.close(),this.loadStarted()}},{key:"resetLoader",value:function(){this.loader=null,this.needLoadStreams=[],this.subStr=""}},{key:"bSubChange",value:function(){return this.subStr!=this.getSubStr()}},{key:"loadStarted",value:function(){this.subStr=this.getSubStr(),this.needLoadStreams=[]}},{key:"onopen",value:function(){}},{key:"onerror",value:function(){}},{key:"hasSubs",value:function(){return""!==this.subStr}},{key:"isConnected",value:function(){return this.loader.connectedTs>0}},{key:"isConnectSlow",value:function(e){return this.isConnected()?this.loader.connectedTs-this.loader.connectTs>=1500:e-this.loader.connectTs>=1500}},{key:"getConnectTs",value:function(){return this.loader.connectTs}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(0)),s=a(n(1)),r=a(n(2));function a(e){return e&&e.__esModule?e:{default:e}}var o="https",u="webrtc";t.default=function(){function e(t,n){(0,i.default)(this,e),this.loaderMgr=n,this.subIndex=t,this._url="",this._urls=[],this._tryUrls=!1,this._protoType="",this._retryCnt=0}return(0,s.default)(e,[{key:"hasUrl",value:function(){return this._urls.length>0}},{key:"isHttps",value:function(){return this._protoType===o}},{key:"isWss",value:function(){return"wss"===this._protoType}},{key:"isWebrtc",value:function(){return this._protoType===u}},{key:"setUrls",value:function(e,t){var n=e[0];-1!==n.indexOf("https://")?this._protoType=o:-1!==n.indexOf("wss://")?this._protoType="wss":-1!==n.indexOf("webrtc://")&&(this._protoType=u),this._url="",this._urls=e,this._tryUrls=t}},{key:"getUrl",value:function(){if(this._urls.length>0){var e=this._urls.shift();return this._tryUrls||(this._urls=[]),this._url=e,e}return null}},{key:"retry",value:function(){this._retryCnt<r.default.getCfgValNum("pcdnRetryCnt",5)&&(this._retryCnt++,""!==this._url&&this._urls.unshift(this._url)),this._url=""}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n(8)),s=d(n(10)),r=d(n(0)),a=d(n(1)),o=d(n(3)),u=d(n(28)),l=d(n(2));function d(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(){(0,r.default)(this,e),this.sent=0,this.received=0,this.updateStamp=0}return(0,a.default)(e,[{key:"update",value:function(e,t,n){this.sent+=e,this.received+=t,this.updateStamp=n}}]),e}(),c=function(){function e(){(0,r.default)(this,e),this.uploadThrehold=o.default.UintMax,this.totalSent=0,this.totalReceived=0,this.lastTime=0,this.uploadMin=1,this.averageUpload=new u.default(e.UPLOAD_QUEUE_MAX_SIZE),this.peers=new s.default}return(0,a.default)(e,[{key:"reset",value:function(){this.uploadThrehold=o.default.UintMax,this.totalSent=0,this.totalReceived=0,this.lastTime=l.default.TimeUtil.now(),this.averageUpload.reset(),this.peers.clear()}},{key:"update",value:function(e,t,n,i){if(0!==t&&0!==n){n>t&&(n=t);var s=null;this.peers.has(e)?s=this.peers.get(e):(s=new h,this.peers.set(e,s)),s.update(t,n,i),this.totalSent+=t,this.totalReceived+=n}}},{key:"addActualUpload",value:function(e){this.averageUpload.add(e)}},{key:"ready",value:function(t){var n=t-this.lastTime;return this.totalSent>e.TOTAL_SENT_THRESHOLD&&n>e.MIN_UPDATE_INTERVAL||n>e.MAX_UPDATE_INTERVAL}},{key:"updateUploadBandwidth",value:function(t,n){var i=this.calcUplinkRecvRate(),s=t,r=this.averageUpload.average();if(r===o.default.UintMax&&(r=0),i>e.HIGH_RECV_RATE){var a=t>=this.uploadThrehold?e.LOW_ADD_RATIO:e.HIGH_ADD_RATIO;(s=Math.round(a*r)+1)<t&&(s=t),a===e.HIGH_ADD_RATIO&&s>this.uploadThrehold&&(s=this.uploadThrehold),this.uploadMin=parseInt(.8*s)}else i<e.LOW_RECV_RATE&&(this.uploadThrehold=r,s>this.uploadMin&&s--,s<1&&(s=1));return this.lastTime=n,s}},{key:"calcUplinkRecvRate",value:function(){var t=new h,n=!0,s=!1,r=void 0;try{for(var a,o=(0,i.default)(this.peers.values());!(n=(a=o.next()).done);n=!0){var u=a.value;if(0!==u.sent){(this.totalReceived-t.received)*(this.totalSent-u.sent)<(this.totalSent-t.sent)*(this.totalReceived-u.received)&&(t=u),Math.round(this.totalSent*e.HIGH_RECV_RATE)>this.totalReceived&&3*this.totalSent/4>t.sent&&(this.totalReceived-=t.received,this.totalSent-=t.sent);var l=e.DEFAULT_RECV_RATE;return 0!==this.totalSent&&(l=this.totalReceived/this.totalSent),this.totalSent=0,this.totalReceived=0,this.peers.clear(),l}}}catch(e){s=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(s)throw r}}}}]),e}();c.TOTAL_SENT_THRESHOLD=400,c.UPLOAD_QUEUE_MAX_SIZE=10,c.MIN_UPDATE_INTERVAL=3e3,c.MAX_UPDATE_INTERVAL=15e3,c.HIGH_RECV_RATE=.99,c.LOW_RECV_RATE=.96,c.DEFAULT_RECV_RATE=.98,c.HIGH_ADD_RATIO=1.5,c.LOW_ADD_RATIO=1.1,t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(0)),s=a(n(1)),r=a(n(2));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,i.default)(this,e),this.originalDomain="",this.originalUrl="",this.streamUrl="",this.domain302="",this.domainList=null,this.stat=t}return(0,s.default)(e,[{key:"initDomain",value:function(e,t,n){if(this.originalUrl=e,this.domainList=t,this.domain302=n||"",this.streamUrl=e,"/"===this.streamUrl.substr(-1)&&(this.streamUrl=this.streamUrl.substr(0,this.streamUrl.length-1)),this.streamUrl=this.streamUrl.replace(/^(http|ws)s?\:/i,""),this.domainList&&this.domainList.length&&!n){r.default.logger.log("StreamDomain.initDomain:\n	"+this.domainList.join("\n	"));var i=this.streamUrl.match(/\/\/(.+?)\//i);this.originalDomain=i?i[1]:"";var s=this.domainList.shift();s!==this.originalDomain&&(this.stat.core.cdnip=s,this.streamUrl=this.streamUrl.replace(/\/\/(.+?)\//,"//"+s+"/"+this.originalDomain+"/"))}}},{key:"changeDomain",value:function(){if(this.domainList&&""!==this.originalDomain){var e=this.domainList.shift();if(e===this.originalDomain)return this.changeDomain();var t=RegExp("//(.*?)"+this.originalDomain+"/");return e?(r.default.logger.warn("StreamDomain.changeDomain to "+e),this.stat.core.cdnip=e,this.streamUrl=this.streamUrl.replace(t,"//"+e+"/"+this.originalDomain+"/")):(r.default.logger.warn("StreamDomain.changeDomain to "+this.originalDomain),this.stat.core.cdnip="",this.streamUrl=this.streamUrl.replace(t,"//"+this.originalDomain+"/"),this.domainList=null),e}return null}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(28)),a=o(n(3));function o(e){return e&&e.__esModule?e:{default:e}}o(n(2)),t.default=function(){function e(){(0,i.default)(this,e),this.upCalc=new r.default(120),this.p2pDownCalc=new r.default(10),this.cdnDownCalc=new r.default(10)}return(0,s.default)(e,[{key:"reset",value:function(){this.upCalc.reset(),this.p2pDownCalc.reset(),this.cdnDownCalc.reset()}},{key:"onCheckTimer",value:function(e,t){this.upCalc.calculate(),this.p2pDownCalc.calculate(),this.cdnDownCalc.calculate()}},{key:"addUpBw",value:function(e){this.upCalc.addCur(e)}},{key:"getUpBw",value:function(){return this.upCalc.sum}},{key:"addP2pDownBw",value:function(e){this.p2pDownCalc.addCur(e)}},{key:"getP2pDownBw",value:function(){return this.getBw(this.p2pDownCalc)}},{key:"addCdnDownBw",value:function(e){this.cdnDownCalc.addCur(e)}},{key:"getCdnDownBw",value:function(){return this.getBw(this.cdnDownCalc)}},{key:"getDownBw",value:function(){return this.getBw(this.p2pDownCalc)+this.getBw(this.cdnDownCalc)}},{key:"getBw",value:function(e){var t=e.average();return t===a.default.UintMax&&(t=0),t}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(2)),a=u(n(231)),o=u(n(80));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.seqMap=new a.default,this.maxSeq=0,this.maxStamp=0,this.lastContinuedSeq=0,this.recvSeqs=new o.default}return(0,s.default)(e,[{key:"addSeq",value:function(e){this.seqMap.addValue(e),this.maxSeq<e&&(this.maxSeq=e,this.maxStamp=r.default.TimeUtil.now()),0===this.lastContinuedSeq?this.lastContinuedSeq=e:e>this.lastContinuedSeq&&(this.recvSeqs.put({key:e}),this.updateNextContinueSeq())}},{key:"setLastRenderSeq",value:function(e){if(this.lastContinuedSeq<e){if(this.lastContinuedSeq=e,this.recvSeqs.size>0)for(var t=this.recvSeqs.head;t&&t.data.key<=e;)this.recvSeqs.get(),t=this.recvSeqs.head;this.updateNextContinueSeq()}}},{key:"updateNextContinueSeq",value:function(){for(var e=this.recvSeqs.head;e&&e.data.key-this.lastContinuedSeq==1;)this.lastContinuedSeq=e.data.key,this.recvSeqs.get(),e=this.recvSeqs.head}},{key:"hasSeq",value:function(e){return this.seqMap.hasValue(e)}},{key:"reset",value:function(){this.seqMap.reset(),this.maxSeq=0,this.maxStamp=0}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(10)),s=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,s.default)(this,e),this.size=1e4,this.values=[],this.valueMap=new i.default,this.index=0,this.cnt=0}return(0,r.default)(e,[{key:"reset",value:function(){this.valueMap.clear(),this.values=[],this.index=0,this.cnt=0}},{key:"setSize",value:function(e){e<this.size&&this.values.length>e&&(this.values=this.values.slice(this.values.length-e)),this.size=e}},{key:"hasValue",value:function(e){return this.valueMap.has(e)}},{key:"addValue",value:function(e){var t=this.values[this.index];return this.values[this.index]=e,this.valueMap.delete(t),this.valueMap.set(e,this.index),++this.index===this.size&&(this.index=0,this.cnt++),t}},{key:"delValue",value:function(e){if(this.valueMap.has(e)){var t=this.valueMap.get(e);this.values[t]=0,this.valueMap.delete(e)}}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n(0)),s=l(n(1)),r=l(n(2)),a=n(9),o=l(n(107)),u=l(n(3));function l(e){return e&&e.__esModule?e:{default:e}}var d=(0,a.requireProto)("PCdnP2PWSForward"),h=(0,a.requireProto)("PCdnP2pGetNode"),c=(0,a.requireProto)("P2POffer"),f=(0,a.requireProto)("P2PAnswer"),p=(0,a.requireProto)("P2PCandidate"),m=(0,a.requireProto)("P2POfferReject"),_=(0,a.requireProto)("P2PPunchBackReq"),v=(0,a.requireProto)("P2PPunchBackRsp"),g=(0,a.requireProto)("P2PAsk"),y=(0,a.requireProto)("P2PAskRes"),S=(0,a.requireProto)("PCdnP2pGetNodeReq3");t.default=function(){function e(t,n){(0,i.default)(this,e),this.stream=t,this.sInfo=t.sInfo,this.stat=t.stat,this.cdnpProxy=n,this.cdnpProxy.protoHandler.on(a.ProtoUri.PCdnP2pGetNodeRes,this.recvGetNode.bind(this)),this.cdnpProxy.protoHandler.on(a.ProtoUri.PCdnP2pGetNodeRes3,this.recvGetNode3.bind(this)),this.cdnpProxy.protoHandler.on(a.ProtoUri.P2POffer,this.recvOffer.bind(this)),this.cdnpProxy.protoHandler.on(a.ProtoUri.P2PAnswer,this.recvAnswer.bind(this)),this.cdnpProxy.protoHandler.on(a.ProtoUri.P2PCandidate,this.recvCandidate.bind(this)),this.cdnpProxy.protoHandler.on(a.ProtoUri.PCdnP2PWSForwardReject,this.recvForwardReject.bind(this)),this.cdnpProxy.protoHandler.on(a.ProtoUri.P2PPunchBackReq,this.recvPunchBackReq.bind(this)),this.cdnpProxy.protoHandler.on(a.ProtoUri.P2PPunchBackRsp,this.recvPunchBackRsp.bind(this)),this.cdnpProxy.protoHandler.on(a.ProtoUri.P2PAsk,this.recvAsk.bind(this)),this.cdnpProxy.protoHandler.on(a.ProtoUri.P2PAskRes,this.recvAskRes.bind(this)),this.printPeer=1==localStorage._printPeer}return(0,s.default)(e,[{key:"sendForward",value:function(e,t,n){var i=new d;i.cdnGroupId=this.sInfo.streamId,i.fromUid=r.default.userInfo.uuid,i.toUid=e,i.subUri=t,i.payload=n,i.appid=this.sInfo.pInfo.appid,this.cdnpProxy.send(i)}},{key:"sendGetNode",value:function(){if(1!=localStorage._stopGetNode&&!this.sInfo.isClosePunchUser)if(u.default.isOpen(r.default.config.crossClientPer,this.sInfo.presenterUid,this.sInfo.lineType,!1))this.sendGetNode3();else{var e=new h;e.uid=r.default.userInfo.uuid,e.cdnGroupId=this.sInfo.streamId,e.appid=r.default.userInfo.appid,this.cdnpProxy.send(e)}}},{key:"sendGetNode3",value:function(){var e=new S;e.uid=r.default.userInfo.uuid,e.cdnGroupId=this.sInfo.streamId,e.appid=r.default.userInfo.appid,this.cdnpProxy.send(e)}},{key:"sendRequestOffer",value:function(e){}},{key:"sendOffer",value:function(e,t){var n=new c;n.cdnGroupId=this.sInfo.streamId,n.lineType=this.sInfo.lineType,n.fromUid=r.default.userInfo.uuid,n.toUid=e,n.sdp=t.sdp,n.sdpType=t.type,n.version=r.default.userInfo.version,n.nodeType=Number(localStorage._testNodeType)||a.NodeType.WEB_CLIENT_V2,this.printPeer&&r.default.logger.log("NodeProxy.sendOffer media="+this.sInfo.isMedia+" toUid="+e),this.sendForward(e,a.ProtoUri.P2POffer,n.marshall())}},{key:"sendAnswer",value:function(e,t){var n=new f;n.cdnGroupId=this.sInfo.streamId,n.lineType=this.sInfo.lineType,n.fromUid=r.default.userInfo.uuid,n.toUid=e,n.sdp=t.sdp,n.sdpType=t.type,this.printPeer&&r.default.logger.log("NodeProxy.sendAnswer media="+this.sInfo.isMedia+" toUid="+e),this.sendForward(e,a.ProtoUri.P2PAnswer,n.marshall())}},{key:"sendCandidate",value:function(e,t){var n=t.candidate;if(this._sendCandidate(e,n,t.sdpMLineIndex,t.sdpMid),this._isPunchWan()&&"srflx"===t.type){var i=n.split(" ");this.cdnpProxy.wanIp&&i[4]!==this.cdnpProxy.wanIp&&(i[4]=this.cdnpProxy.wanIp,n=i.join(" "),this.printPeer&&r.default.logger.log("NodeProxy.sendCandidate media="+this.sInfo.isMedia+" toUid="+e),this._sendCandidate(e,n,t.sdpMLineIndex,t.sdpMid))}}},{key:"_sendCandidate",value:function(e,t,n,i){var s=new p;s.cdnGroupId=this.sInfo.streamId,s.lineType=this.sInfo.lineType,s.fromUid=r.default.userInfo.uuid,s.toUid=e,s.sdpMLineIndex=n,s.sdpMid=i,s.candidate=t,this.sendForward(e,a.ProtoUri.P2PCandidate,s.marshall())}},{key:"_isPunchWan",value:function(){var e=r.default.config.punchWan+"";return"all"===e||e.indexOf(this.sInfo.roomId+"")}},{key:"sendOfferReject",value:function(e,t){var n=new m;n.cdnGroupId=this.sInfo.streamId,n.lineType=this.sInfo.lineType,n.fromUid=r.default.userInfo.uuid,n.toUid=e,n.rejectReason=t,this.sendForward(e,a.ProtoUri.P2POfferReject,n.marshall())}},{key:"sendPunchBackReq",value:function(e){var t=new _;t.cdnGroupId=this.sInfo.streamId,t.fromUid=r.default.userInfo.uuid,t.lineType=this.sInfo.lineType,t.version=r.default.userInfo.version,this.sendForward(e,a.ProtoUri.P2PPunchBackReq,t.marshall())}},{key:"sendPunchBackRsp",value:function(e,t){var n=new v;n.fromUid=r.default.userInfo.uuid,n.ret=t,n.nodeType=Number(localStorage._testNodeType)||a.NodeType.WEB_CLIENT_V2,this.sendForward(e,a.ProtoUri.P2PPunchBackRsp,n.marshall())}},{key:"sendAsk",value:function(e,t){var n=new g;n.fromUid=r.default.userInfo.uuid,n.version=r.default.userInfo.version,t===a.NodeType.SDK_CLIENT_V2&&1===r.default.config.crossPunchPloy?n.askType=o.default.REQUEST:n.askType=n.fromUid<e?o.default.OFFER:o.default.REQUEST,n.nodeType=Number(localStorage._testNodeType)||a.NodeType.WEB_CLIENT_V2,this.printPeer&&r.default.logger.log("NodeProxy.sendAsk media="+this.sInfo.isMedia+" toUid="+e+" nodeType="+t),this.stream.punchMgr.punch.punchStat.punch_info.arqs++,this.sendForward(e,a.ProtoUri.P2PAsk,n.marshall())}},{key:"sendAskRes",value:function(e){var t=new y;t.fromUid=r.default.userInfo.uuid,t.nodeType=Number(localStorage._testNodeType)||a.NodeType.WEB_CLIENT_V2,this.printPeer&&r.default.logger.log("NodeProxy.sendAskRes media="+this.sInfo.isMedia+" toUid="+e),this.stream.punchMgr.punch.punchStat.punch_info.arps++,this.sendForward(e,a.ProtoUri.P2PAskRes,t.marshall())}},{key:"recvGetNode",value:function(e){for(var t=e.peerNodes.length,n=[],i=0;i<t;i++){var s=e.peerNodes[i],r=Number(localStorage._testNodeType)||s.nodeType||a.NodeType.OLD_CLIENT;n.push({uid:s.uid,nodeType:r,nodeProxy:this})}var o=this.stream.punchMgr.recvGetNode(n,this),u=o.validNum,l=o.validNumSdk,d=o.validNumWeb,h=this.stream.punchMgr.punch.punchStat.punch_info;h.total_cnt+=t,h.valid_cnt+=u,h.valid_cnt_sdkv2+=l,h.valid_cnt_webv2+=d}},{key:"recvGetNode3",value:function(e){this.recvGetNode(e)}},{key:"recvOffer",value:function(e){this.printPeer&&r.default.logger.log("NodeProxy.recvOffer media="+this.sInfo.isMedia+" fromUid="+e.fromUid+" sdpType="+e.sdpType+" sdp="+e.sdp),this.sInfo.isClosePunchUser||this.stream.punchMgr.recvOffer(e,this)}},{key:"recvAnswer",value:function(e){this.printPeer&&r.default.logger.log("NodeProxy.recvAnswer media="+this.sInfo.isMedia+" fromUid="+e.fromUid+" sdpType="+e.sdpType+" sdp="+e.sdp),this.stream.punchMgr.recvAnswer(e,this)}},{key:"recvCandidate",value:function(e){this.printPeer&&r.default.logger.log("NodeProxy.recvCandidate media="+this.sInfo.isMedia+" fromUid="+e.fromUid+" "+e.candidate),this.stream.punchMgr.recvCandidate(e,this)}},{key:"recvForwardReject",value:function(e){this.printPeer&&r.default.logger.warn("NodeProxy.recvForwardReject media="+this.sInfo.isMedia+" fromUid="+e.fromUid),this.stream.stat.forward_reject_cnt++,this.stream.punchMgr.recvForwardReject(e,this)}},{key:"recvPunchBackReq",value:function(e){this.stream.punchMgr.recvPunchBackReq(e,this)}},{key:"recvPunchBackRsp",value:function(e){this.stream.punchMgr.recvPunchBackRsp(e,this)}},{key:"recvAsk",value:function(e){this.printPeer&&r.default.logger.log("NodeProxy.recvAsk media="+this.sInfo.isMedia+" fromUid="+e.fromUid+" nodeType="+e.nodeType),this.sInfo.isClosePunchUser||(this.stream.punchMgr.punch.punchStat.punch_info.arqr++,this.sInfo.isCanUseP2P&&this.stream.punchMgr.recvAsk(e,this))}},{key:"recvAskRes",value:function(e){this.printPeer&&r.default.logger.log("NodeProxy.recvAskRes media="+this.sInfo.isMedia+" toUid="+e.fromUid+" nodeType="+e.nodeType),this.stream.punchMgr.punch.punchStat.punch_info.arpr++,this.stream.punchMgr.recvAskRes(e,this)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(0)),s=a(n(1)),r=a(n(75));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t,n){(0,i.default)(this,e),this.stream=t,this.baseSubs=n,this.core={cdnip:"",stream_url:"",cdnp_connect_ip:"",cdnp_connected:0,cdp_id:"",user_wan_ip:"",video_login_fail:0,original_bitrate:0,lsflag:0},this.cdnpRtts=[],this.cdn_sip="",this.hasPubCandidate=0,this.hasHostCandidate=0,this.difPubCandidate=1,this.last_signal_up_bw=0,this.last_signal_down_bw=0,this.last_punch_info={},this.last_punch_back_ret={},this.experiment="",this.pcdn_data_state={pcdn_origin:"",cli_isp:"",cli_prov:""},this.subStreamStat={substream_type:[],substream_state:[]},this.range_miss_ts=0,this.range_recv_timeout_ts=0,this.p_iaas_info=[],this.sub_state_info="",this.getPcdnSubProxyInfo(n),this.reset()}return(0,s.default)(e,[{key:"record",value:function(){this.bw.signal_up_bw=r.default.signal_up_bw-this.last_signal_up_bw,this.bw.signal_down_bw=r.default.signal_down_bw-this.last_signal_down_bw,this.last_signal_up_bw=r.default.signal_up_bw,this.last_signal_down_bw=r.default.signal_down_bw;var e=this.stream.punchMgr.punch.punchStat;this.recordStat(this.last_punch_info,e.punch_info,this.punch_info),this.recordStat(this.last_punch_back_ret,e.punch_back_ret,this.punch_back_ret),this.sub_state_info=this.stream.subStreamMgr.getSubsStat().join(",")}},{key:"recordStat",value:function(e,t,n){for(var i in t)e.hasOwnProperty(i)?n[i]=t[i]-e[i]:n[i]=t[i],e[i]=t[i]}},{key:"addSubChangeState",value:function(e,t,n){var i=e+":"+t,s=this.sub_change_state[i];s||(s={},this.sub_change_state[i]=s),s.hasOwnProperty(n)?s[n]++:s[n]=1}},{key:"reset",value:function(){this.cdnpRtts=[],this.bw={cdn_total_bw:0,cdn_valid_bw:0,cdn_repeat_bw:0,p2p_total_bw:0,p2p_valid_bw:0,p2p_repeat_bw:0,range_total_bw:0,range_valid_bw:0,p2p_total_bw_sdkv2:0,p2p_repeat_bw_sdkv2:0,p2p_valid_bw_sdkv2:0,p2p_total_bw_webv2:0,p2p_repeat_bw_webv2:0,p2p_valid_bw_webv2:0,default_bw:0,fast_bw:0,patch_bw:0,compete_bw:0,fixed_bw:0,force_bw:0,signal_up_bw:0,signal_down_bw:0,pcdn_total_bw:0,pcdn_valid_bw:0,pcdn_repeat_bw:0,force_cdn_bw:0,force_pcdn_bw:0,compete_cdn_bw:0,compete_pcdn_bw:0,default_cdn_bw:0,default_pcdn_bw:0,fixed_cdn_bw:0,fixed_pcdn_bw:0,peer_range_total_bw:0,peer_range_valid_bw:0,peer_range_repeat_bw:0,crptbw:0,crpvbw:0,prptbw:0,prpvbw:0,unopend_cp_bw:0,noreq_cp_bw:0,noreq_tout_cp_bw:0,noreq_wait_cp_bw:0,noreturn_cp_bw:0,error_cp_bw:0,kicked_cp_bw:0,other_cp_bw:0,other_cpflv_bw:0,taf_gather_bw:0,taf_cover_bw:0,taf_load_bw:0,taf_unknown_bw:0},this.forward_reject_cnt=0,this.range_sip_suc_cnt=0,this.range_sip_dif_cnt=0,this.range_req_cnt=0,this.range_rsp_cnt=0,this.range_info={connectCnt:0,connectTime:0,rspCnt:0,rspTime:0},this.updown_info={uplink_bw:0,downlink_bw:0,uplink_cnt:0,uplink_limit_cnt:0},this.wr_info={wrttcnt:0,wrcscnt:0,wrpecnt:0,wroecnt:0,wrrecnt:0,wraecnt:0,wrcecnt:0,wrcccnt:0,wrxecnt:0,wrx4cnt:0,wrxtcnt:0,pcdn_can_pull_cnt:0,pcdn_real_pull_cnt:0},this.wr_cost={wrcso:0,wrcoa:0,wrcao:0,wrcos:0},this.wr_cost_cnt={wrcso_cnt:0,wrcoa_cnt:0,wrcao_cnt:0,wrcos_cnt:0},this.sub_info={total_cnt:0,succ_cnt:0,fail_cnt:0,timeout_cnt:0,kick_cnt:0,try_cnt:0,cmp_total_cnt:0,cmp_succ_cnt:0,cmp_fail_cnt:0,cmp_timeout_cnt:0,force_cnt:0},this.punch_info={total_cnt:0,valid_cnt:0,try_cnt:0,succ_cnt:0,try_per_cnt_sdkv2:0,try_per_cnt_webv2:0,fail_per_cnt_sdkv2:0,fail_per_cnt_webv2:0,valid_cnt_sdkv2:0,valid_cnt_webv2:0},this.punch_back_ret={},this.qps_info={full_cdn_cnt:0,sub_cdn_cnt:0,patch_cdn_cnt:0},this.resend_info={resend_cnt:0,timeout_cnt:0,error_cnt:0,slice_cnt:0,respond_cnt:0,late_cnt:0,miss_cnt:0,repeat_cnt:0,repeat_succ_cnt:0,repeat_fail_cnt:0,limit_cnt:0},this.pResend_info={srtt:0,srva:0,srrs:0,srrpr:0,srrcr:0,sstt:0,sspeer:0,sspcdn:0,sscdnc:0,sscdnf:0,sshpeer:0,sshpcdn:0,sshcdnc:0,sshcdnf:0,srccc:0,srccp:0,srcfc:0,srcfp:0,srcpe:0,srcot:0,intcd:0,intpd:0,prttcnt:0,prsucnt:0,prndcnt:0,prnncnt:0,prtocnt:0,prugcnt:0,prftcnt:0,prfscnt:0,prrecnt:0,crrecnt:0},this.peer_range_nonode={prnpid:0,prnsdk:0,prnpub:0,prnsub:0,prnpeer:0,prnstream:0,prnlate:0,prnrtt:0,prnnone:0},this.forcesub_reason={nopeer_cnt:0,subend_cnt:0,timeout_cnt:0},this.sub_return={},this.switch_return={},this.last_return={},this.stream_delay={},this.nonode_return={presenter_cnt:0,sdk_v2:0,cdnp_dif_cnt:0,uplink_less_cnt:0,pull_same_cnt:0,pub_same_cnt:0,sub_same_cnt:0,subed_cnt:0,cool_cnt:0,delay_cnt:0,rtt_cnt:0,late_cnt:0,fast_cnt:0,no_stream_cnt:0,no_peer_cnt:0,none_cnt:0},this.compete_reason=[0,0,0,0,0,0,0,0,0,0],this.pcdn_data={pcdn_reconnect_cnt:0,pcdn_reconnect_spare_cnt:0,switch_cdn_cnt:0,switch_cdn_err_cnt:0,switch_kick_cnt:0,switch_time_out_cnt:0,switch_no_data_cnt:0,send_req_to_res_time_cnt:0,send_req_to_res_time:0,pcdn_connect_data_time_cnt:0,pcdn_connect_data_time:0,get_subs_url_cnt:0,get_subs_url_error_cnt:0,get_stream_cnt:0,get_stream_open_suc_cnt:0,get_stream_error_cnt:0,get_pcdn_url_total_cnt:0,get_pcdn_url_success:0,get_pcdn_err_not_coverd:0,get_pcdn_err_over_run:0,get_pcdn_err_not_reached:0,get_pcdn_err_other:0,pcdn_kick_out_cnt:0},null!=this.notReachedPcdnSubs?this.notReachedPcdnSubs.length=0:this.notReachedPcdnSubs=[],this.cdn_pull_data={cpcnt:0,cpecnt:0,cptcnt:0,cpfndcnt:0,cpndcnt:0},this.pcdn_rsp={pcdn_svr_isp:"",pcdn_svr_area:"",pcdn_hot_degree_in:{},pcdn_hot_degree_kick:{},pcdn_hot_degree:{},pcdn_pull_stream_user_cnt:{},pcdn_get_proxy_user_cnt:{},get_pcdn_url_result:{}},this.sub_change_state={},this.pcdn_bw_data={},this.p2p_tcp_type={},this.p2p_tcp_state={},this.p_iaas_info.length=0,this.iaas_total_info={},this.iaas_repeat_info={},this.iaas_valid_info={},this.sub_state_info="";for(var e=0;e<this.baseSubs;e++)this.psub_proxy_info[e].total_cnt=0,this.psub_proxy_info[e].suc_cnt=0}},{key:"getPcdnSubProxyInfo",value:function(e){this.psub_proxy_info={};for(var t=0;t<e;t++)this.psub_proxy_info[t]={total_cnt:0,suc_cnt:0}}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),s=r(n(1));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e)}return(0,s.default)(e,null,[{key:"isSliceJumpFromPeer",value:function(e,t,n){return!!t.uid&&!!e&&t.seq-e>n}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(10)),s=o(n(0)),r=o(n(1)),a=o(n(32));function o(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,s.default)(this,e),this.ability=0,this.hasHisUplink=!1,this.hisIgnoreMap=new i.default,a.default.hasOwnProperty(e.HIS_ABILITY)&&(this.ability=Number(a.default[e.HIS_ABILITY])),this.hasHisUplink=a.default.hasOwnProperty(e.HIS_UPLINK)}return(0,r.default)(e,[{key:"getUplinkMax",value:function(e){return 0===e?5:parseInt(this.ability/e)}},{key:"setAbility",value:function(t,n){if(0!==n){var i=t*n;this.ability<i&&(this.ability=i,a.default[e.HIS_ABILITY]=i)}}},{key:"saveHistUplink",value:function(){a.default[e.HIS_UPLINK]="1"}},{key:"addIgnore",value:function(e){}},{key:"reset",value:function(){this.ability=0,this.hisIgnoreMap.clear()}}]),e}();u.HIS_ABILITY="his_ability",u.HIS_UPLINK="his_uplink",t.default=new u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(0)),s=a(n(1)),r=a(n(2));function a(e){return e&&e.__esModule?e:{default:e}}var o=window.RTCPeerConnection||window.PeerConnection||window.webkitPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;t.default=function(){function e(t){(0,i.default)(this,e),this.stat=t,this.peer=null}return(0,s.default)(e,[{key:"stop",value:function(){r.default.logger.log("StunProbe.stop"),this.peer&&(this.peer.onicecandidate=null,this.peer.close(),this.peer=null)}},{key:"startProbe",value:function(e,t,n){var i=this;this.stat.hasPubCandidate=0,this.stat.hasHostCandidate=0,this.stat.difPubCandidate=1,this.stop();var s=n.length;if(s>0){var a={iceServers:[{urls:["stun:"+(e+t)+":"+n[0|parseInt(Math.random()*s)]]}]};try{this.peer=new o(a),this.peer.onicecandidate=this.onIceCandidte.bind(this),this.peer.onicegatheringstatechange=this.onIceGatheringStateChange.bind(this),this.peer.createDataChannel("stunProbe",{ordered:!1}),this.peer.createOffer().then(function(e){i.peer.setLocalDescription(e)}).catch(function(e){r.default.logger.log("StunProbe.startProbe createOffer",e.message)})}catch(e){r.default.logger.log("StunProbe.startProbe",e.message)}}}},{key:"onIceCandidte",value:function(e){e.candidate&&e.candidate.candidate&&-1===e.candidate.candidate.indexOf(" tcp")&&("host"===e.candidate.type?this.stat.hasHostCandidate=1:(this.stat.hasPubCandidate=1,""!==this.stat.core.user_wan_ip&&-1!==e.candidate.candidate.indexOf(this.stat.core.user_wan_ip)&&(this.stat.difPubCandidate=0)))}},{key:"onIceGatheringStateChange",value:function(e){"complete"===this.peer.iceGatheringState&&this.stop()}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=n(9),a=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,i.default)(this,e),this.stream=t,this.punchMgr=null,this.uriBinds={},this.uriBinds[r.ProtoUri.PP2pSliceData]=this.onUri.bind(this,r.ProtoUri.PP2pSliceData),this.uriBinds[r.ProtoUri.P2PSubStream]=this.onUri.bind(this,r.ProtoUri.P2PSubStream),this.uriBinds[r.ProtoUri.P2PSubStreamRes]=this.onUri.bind(this,r.ProtoUri.P2PSubStreamRes),this.uriBinds[r.ProtoUri.P2PRemoveSub]=this.onUri.bind(this,r.ProtoUri.P2PRemoveSub),this.uriBinds[r.ProtoUri.P2PRemoveSubRes]=this.onUri.bind(this,r.ProtoUri.P2PRemoveSubRes),this.uriBinds[r.ProtoUri.P2PStreamAlive]=this.onUri.bind(this,r.ProtoUri.P2PStreamAlive),this.uriBinds[r.ProtoUri.P2PPeerRangeReq]=this.onUri.bind(this,r.ProtoUri.P2PPeerRangeReq),this.uriBinds[r.ProtoUri.P2PPeerRangeRsp]=this.onUri.bind(this,r.ProtoUri.P2PPeerRangeRsp),this.uriBinds[r.ProtoUri.P2PPeerRangeAsk]=this.onUri.bind(this,r.ProtoUri.P2PPeerRangeAsk),this.uriBinds[r.ProtoUri.P2PPeerRangeAskRsp]=this.onUri.bind(this,r.ProtoUri.P2PPeerRangeAskRsp),this.uriBinds[r.ProtoUri.P2PSwapSubHole]=this.onUri.bind(this,r.ProtoUri.P2PSwapSubHole),this.uriBinds[r.ProtoUri.P2PSeqLost]=this.onUri.bind(this,r.ProtoUri.P2PSeqLost)}return(0,s.default)(e,[{key:"start",value:function(e){for(var t in a.default.logger.log("PunchProtoHelper.start "+this.stream.sInfo.streamSeqSN+" "+this.stream.sInfo.streamId.text()),this.punchMgr=e,this.uriBinds)this.punchMgr.protoHandler.on(t,this.uriBinds[t])}},{key:"stop",value:function(){if(a.default.logger.log("PunchProtoHelper.stop "+this.stream.sInfo.streamSeqSN+" "+this.stream.sInfo.streamId.text()),this.punchMgr){for(var e in this.uriBinds)this.punchMgr.protoHandler.off(e,this.uriBinds[e]);this.punchMgr=null}}},{key:"onUri",value:function(e,t){if(t.streamSeqSN===this.stream.sInfo.streamSeqSN)switch(e){case r.ProtoUri.PP2pSliceData:this.stream.sliceProtoHandler.onSlice(t);break;case r.ProtoUri.P2PSubStream:this.stream.subStreamMgr.onSubStream(t);break;case r.ProtoUri.P2PSubStreamRes:this.stream.subStreamMgr.recvSubStreamRes(t);break;case r.ProtoUri.P2PRemoveSub:this.stream.subStreamMgr.recvRemoveSub(t);break;case r.ProtoUri.P2PRemoveSubRes:this.stream.subStreamMgr.recvRemoveSubRes(t);break;case r.ProtoUri.P2PStreamAlive:this.stream.recvStreamAlive(t);break;case r.ProtoUri.P2PPeerRangeReq:this.stream.subStreamMgr.recvPeerRangeReq(t);break;case r.ProtoUri.P2PPeerRangeRsp:this.stream.subStreamMgr.recvPeerRangeRsp(t);break;case r.ProtoUri.P2PSwapSubHole:this.stream.subStreamMgr.recvSwapSubHole(t);break;case r.ProtoUri.P2PSeqLost:this.stream.subStreamMgr.recvSeqLost(t)}}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=h(n(5)),s=h(n(0)),r=h(n(1)),a=h(n(6)),o=h(n(12)),u=h(n(7)),l=h(n(116)),d=h(n(2));function h(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e){(0,s.default)(this,t);var n=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return n.flvUrl="",n}return(0,u.default)(t,e),(0,r.default)(t,[{key:"getToken",value:function(){var e=new d.default.HUYA.GetCdnTokenExReq;e.sFlvUrl=this.flvUrl,e.sStreamName=this.streamName,this.sendWup("liveui","getCdnTokenInfoEx",e)}},{key:"onGetToken",value:function(e){this.token=e.sFlvToken,(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onGetToken",this).call(this,e)}}]),t}(l.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=h(n(5)),s=h(n(0)),r=h(n(1)),a=h(n(6)),o=h(n(7)),u=h(n(117)),l=h(n(3)),d=h(n(33));function h(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e){(0,s.default)(this,t);var n=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e)),r=Math.floor(e.sInfo.curBitrate/1e3*d.default.SLICE_SPEED*e.sInfo.baseSubs*10);return n.packetSeqGap=r,n.lostSeqNumMax=r,n.setCurBitrate(e.sInfo.curBitrate),n}return(0,o.default)(t,e),(0,r.default)(t,[{key:"getRto",value:function(e){var t=this.stream.subStreamMgr.getSubStreamDelay(e);return(t<0||t===l.default.UintMax)&&(t=0),Math.min(2e3,Math.max(200,t))}}]),t}(u.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(55)),a=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){(0,i.default)(this,e),this.type=t,this.key=0,this.seq=0,this.streamIndex=-1,this.createStampc=0,this.sendStampc=0,this.delta=0,this.resendTimes=0,this.received=!1,this.recvTs=0,this.isResend=!1,this.seqState=e.SeqState.WAITING,this.resendPeerTs=0,this.resendPeerMarkTs=0,this.resendTimesPeer=0,this.resendPeerFailReason=e.PeerFailReason.NONE,this.isResendPeerBefore=!1,this.resendState=e.ResendState.NOT_REACH}return(0,s.default)(e,[{key:"setPeerResending",value:function(){this.resendTimesPeer++,this.seqState=e.SeqState.PEER_RESENDING}},{key:"setCdnResending",value:function(){this.resendTimes++,this.seqState=e.SeqState.CDN_RESENDING}},{key:"setWaiting",value:function(){this.seqState=e.SeqState.WAITING}},{key:"isSeqWaiting",value:function(){return this.seqState===e.SeqState.WAITING}},{key:"isSeqPeerResending",value:function(){return this.seqState===e.SeqState.PEER_RESENDING}},{key:"isSeqCdnResending",value:function(){return this.seqState===e.SeqState.CDN_RESENDING}},{key:"isReady",value:function(){return this.resendState!==e.ResendState.NOT_REACH}},{key:"isNormal",value:function(){return this.resendState===e.ResendState.NORMAL}},{key:"isUrgent",value:function(){return this.resendState===e.ResendState.URGENT}},{key:"isCanResendFromPeer",value:function(e,t){return a.default.config.p2pRangePeerMode===r.default.GLOBAL&&(this.resendTimesPeer<e||this.resendTimesPeer===t&&100*Math.random()<t)}},{key:"isResendPeerTimeout",value:function(e,t){return this.resendPeerTs>0&&e-this.resendPeerTs>t}},{key:"reset",value:function(){this.seq=0,this.createStampc=0,this.sendStampc=0,this.delta=0,this.resendTimes=0,this.resendTimesPeer=0,this.received=!1,this.recvTs=0,this.isResend=!1}}]),e}();u.NORMAL=1,u.URGENT=2,u.PeerFailReason={NONE:0,NO_PEER:1,NO_PEER_CACHE:2,TIMEOUT:3},u.ResendState={NOT_REACH:0,NORMAL:1,URGENT:2,HOLE:3,AUDIO:4},u.SeqState={WAITING:0,PEER_RESENDING:1,CDN_RESENDING:2},t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(10)),s=u(n(0)),r=u(n(1)),a=u(n(2)),o=u(n(3));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,s.default)(this,e),this.resendBase=t,this.stat=t.stat,this.peerMap=new i.default,this.cdnMap=new i.default}return(0,r.default)(e,[{key:"reset",value:function(){this.peerMap.clear(),this.cdnMap.clear()}},{key:"onSlice",value:function(e){var t=e.child.seq;this.stat.pResend_info.srtt++,e.isRepeat?e.isRangePeer?this.stat.pResend_info.srrpr++:e.isRange&&!e.isFromPeer?this.stat.pResend_info.srrcr++:this.stat.pResend_info.srrs++:this.stat.pResend_info.srva++,e.isRangePeer?e.isRepeat?this.stat.pResend_info.prrecnt++:this.peerMap.set(t,a.default.TimeUtil.now()):!e.isFromPeer&&e.isRange?e.isRepeat?this.stat.pResend_info.crrecnt++:this.cdnMap.set(t,a.default.TimeUtil.now()):e.isRepeat&&(this.cdnMap.has(t)?this.stat.pResend_info.crrecnt++:this.peerMap.has(t)&&this.stat.pResend_info.prrecnt++,this.peerMap.delete(t),this.cdnMap.delete(t))}},{key:"checkTimeout",value:function(e){o.default.removeTimeout(e,this.peerMap,1e4),o.default.removeTimeout(e,this.cdnMap,1e4)}}]),e}()},function(e,t,n){n(243),e.exports=0x1fffffffffffff},function(e,t,n){var i=n(11);i(i.S,"Number",{MAX_SAFE_INTEGER:0x1fffffffffffff})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=h(n(8)),s=h(n(10)),r=h(n(0)),a=h(n(1)),o=h(n(245)),u=h(n(3)),l=h(n(2)),d=h(n(19));function h(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,r.default)(this,e),this.stream=t.stream,this.sInfo=t.sInfo,this.subMap=new s.default}return(0,a.default)(e,[{key:"delNode",value:function(e){this.subMap.has(e)&&(l.default.logger.log("PubMgr.delNode uid",e),this.subMap.delete(e))}},{key:"addSub",value:function(e,t){var n=this.subMap.get(e);n||(n=new o.default(e),this.subMap.set(e,n)),n.add(t)}},{key:"delSub",value:function(e,t){if(this.subMap.has(e)){var n=this.subMap.get(e);if(n.has(t))return n.del(t),0===n.getStreamNum()&&(n.clear(),this.subMap.delete(e)),!0}return!1}},{key:"getSubNum",value:function(e){return this.subMap.has(e)?this.subMap.get(e).getStreamNum():0}},{key:"getUplinkNum",value:function(){var e=0,t=!0,n=!1,s=void 0;try{for(var r,a=(0,i.default)(this.subMap.values());!(t=(r=a.next()).done);t=!0)e+=r.value.getStreamNum()}catch(e){n=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw s}}return e}},{key:"getWorstSubByBw",value:function(){var e=d.default.VIDEO_FORCE_UID,t=u.default.UintMax,n=!0,s=!1,r=void 0;try{for(var a,o=(0,i.default)(this.subMap.values());!(n=(a=o.next()).done);n=!0){var l=a.value,h=this.stream.peerMgr.getStreamUpBw(l.uid);-1!==h&&h<t&&(t=h,e=l.uid)}}catch(e){s=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(s)throw r}}return e}},{key:"getSubMinBw",value:function(){var e=u.default.UintMax,t=!0,n=!1,s=void 0;try{for(var r,a=(0,i.default)(this.subMap.values());!(t=(r=a.next()).done);t=!0){var o=r.value,l=this.stream.peerMgr.getStreamUpBw(o.uid);-1!==l&&l<e&&(e=l)}}catch(e){n=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw s}}return e===u.default.UintMax&&(e=0),e}},{key:"reset",value:function(){var e=!0,t=!1,n=void 0;try{for(var s,r=(0,i.default)(this.subMap.values());!(e=(s=r.next()).done);e=!0)s.value.clear()}catch(e){t=!0,n=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw n}}this.subMap.clear()}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(10)),s=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,s.default)(this,e),this.uid=t,this.streamMap=new i.default}return(0,r.default)(e,[{key:"add",value:function(e){this.streamMap.set(e,1)}},{key:"del",value:function(e){this.streamMap.delete(e)}},{key:"has",value:function(e){return this.streamMap.has(e)}},{key:"getStreamNum",value:function(){return this.streamMap.size}},{key:"clear",value:function(){this.uid=0,this.streamMap.clear()}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(8)),s=o(n(0)),r=o(n(1)),a=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t,n){(0,s.default)(this,e),this.baseSubs=n,this.subSteramMgr=t,this.pubUids=[],this.reset()}return(0,r.default)(e,[{key:"setPub",value:function(e,t,n){this.pubUids[e]=t}},{key:"delPub",value:function(e){this.pubUids[e]=-1}},{key:"getPubCnt",value:function(e){var t=0,n=!0,s=!1,r=void 0;try{for(var a,o=(0,i.default)(this.pubUids);!(n=(a=o.next()).done);n=!0){var u=a.value;Number(e)===Number(u)&&t++}}catch(e){s=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(s)throw r}}return t}},{key:"hasPub",value:function(){return this.pubUids.some(function(e){return -1!==e})}},{key:"delNode",value:function(e){for(var t=!1,n=0;n<this.pubUids.length;n++)Number(this.pubUids[n])===Number(e)&&(t=!0,this.pubUids[n]=-1);t&&a.default.logger.log("P2P PubMgr delNode ",e)}},{key:"reset",value:function(){for(var e=0;e<this.baseSubs;e++)this.pubUids[e]=-1}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(120)),s=o(n(0)),r=o(n(1)),a=o(n(38));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,s.default)(this,e),this.cdnMaxSeq=0,this.p2pMinSeq=0,this.maxRecvSeq=0,this.minSeq=i.default,this.mode=a.default.MID}return(0,r.default)(e,[{key:"reset",value:function(){this.cdnMaxSeq=0,this.p2pMinSeq=0,this.maxRecvSeq=0,this.minSeq=i.default}},{key:"checkSeq",value:function(e){e.isFromPeer?(0===this.p2pMinSeq||this.p2pMinSeq>e.maxRecvSeq)&&(this.p2pMinSeq=e.maxRecvSeq):(0===this.cdnMaxSeq||this.cdnMaxSeq<e.maxRecvSeq)&&(this.cdnMaxSeq=e.maxRecvSeq),this.maxRecvSeq=Math.max(e.maxRecvSeq,this.maxRecvSeq),e.maxRecvSeq>0&&(this.minSeq=Math.min(this.minSeq,e.maxRecvSeq))}},{key:"getBaseIndex",value:function(e,t){if(this.mode===a.default.MIN)return this.minSeq;if(this.mode===a.default.MAX)return this.maxRecvSeq;if(0===this.p2pMinSeq)return this.cdnMaxSeq||e;this.cdnMaxSeq=this.cdnMaxSeq||e;var n=this.cdnMaxSeq+parseInt(.5*(this.p2pMinSeq-this.cdnMaxSeq));return this.cdnMaxSeq>this.p2pMinSeq&&n-this.p2pMinSeq>t?n=this.p2pMinSeq+Math.floor(.6*t):this.cdnMaxSeq<this.p2pMinSeq&&n-this.cdnMaxSeq>t&&(n=this.cdnMaxSeq+Math.floor(.6*t)),n}},{key:"getSubBaseIndex",value:function(e){return this.maxRecvSeq>e?this.maxRecvSeq:e}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n(0)),s=l(n(1)),r=n(9),a=l(n(39)),o=l(n(2)),u=l(n(19));function l(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,i.default)(this,e),this.media=t,this.lastCheckTs=0}return(0,s.default)(e,[{key:"checkSucRate",value:function(e,t,n,i){if(0===this.lastCheckTs)this.lastCheckTs=e;else if(e-this.lastCheckTs>=5e3){this.lastCheckTs=e;for(var s=[],l=n.length,d=0;d<l;d++){var h=n[d],c=h.getPcdnState(),f=h.getDetails();if(u.default.isProxyUid(h.pubInfo.uid))if(c!==a.default.START&&c!==a.default.NONE)if(t.wr_info.pcdn_can_pull_cnt++,c===a.default.COMPLETE)t.wr_info.pcdn_real_pull_cnt++,s.push(d+":realPull|"+f);else switch(h.getPcdnFailReason()){case r.ProtoLinkWebrtcFailReasons.PEER_ERR:t.pResend_info.srccc++,s.push(d+":noIce|"+f);break;case r.ProtoLinkWebrtcFailReasons.OFFER_ERR:t.pResend_info.srccp++,s.push(d+":noPubIce|"+f);break;case r.ProtoLinkWebrtcFailReasons.XHR_404:t.pResend_info.srcfc++,s.push(d+":peerFail|"+f);break;case r.ProtoLinkWebrtcFailReasons.ANWSER_ERR:t.pResend_info.srcfp++,s.push(d+":channelFail|"+f);break;case r.ProtoLinkWebrtcFailReasons.XHR_TIMEOUT:t.pResend_info.srcpe++,s.push(d+":sdpTimeout|"+f);break;case r.ProtoLinkWebrtcFailReasons.DATA_TIMEOUT:t.peer_range_nonode.prnpid++,s.push(d+":dataTimeout|"+f);break;case r.ProtoLinkWebrtcFailReasons.DATA_SLOW:t.peer_range_nonode.prnsdk++,s.push(d+":dataSlow|"+f);break;case r.ProtoLinkWebrtcFailReasons.CHANNEL_ERR:t.peer_range_nonode.prnstream++,s.push(d+":channelErr|"+f);break;default:c===a.default.CONNECTING?(t.pResend_info.srcot++,s.push(d+":connecting|"+f)):c===a.default.RETRY?(t.peer_range_nonode.prnpeer++,s.push(d+":retry|"+f)):c===a.default.STOP&&(t.peer_range_nonode.prnrtt++,s.push(d+":stop|"+f))}else s.push(d+":"+f);else s.push(d+":subPeer|"+f)}s.length>0&&i&&o.default.logger.log("[PcdnSucRate] media="+this.media+" checkSucRate \n "+s.join(" \n "))}}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(39)),a=o(n(19));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,i.default)(this,e),this.subStreamMgr=t,this._lastChangeTs=0,this._tryUrls=!1,this._switching=!1}return(0,s.default)(e,[{key:"setTryUrls",value:function(e){this._tryUrls=e}},{key:"setSwitching",value:function(){this._switching=!0}},{key:"onCheckFastTimer",value:function(e){if(this._tryUrls&&this._switching&&e-this._lastChangeTs>=500){this._lastChangeTs=e;for(var t=this.subStreamMgr,n=t.subStreams,i=[],s=!1,o=0;o<n.length;o++){var u=n[o],l=u.getPcdnState();a.default.isProxyUid(u.pubInfo.uid)&&l!==r.default.COMPLETE&&i.push(o),l!==r.default.CONNECTING&&l!==r.default.RETRY||(s=!0)}t.loadCdnSubs(i),s||(this._switching=!1)}}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=p(n(5)),s=p(n(0)),r=p(n(1)),a=p(n(6)),o=p(n(12)),u=p(n(7)),l=p(n(123)),d=p(n(56)),h=p(n(255)),c=p(n(3)),f=p(n(2));function p(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e,n){(0,s.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return r.pubSelector=new h.default(r),r}return(0,u.default)(t,e),(0,r.default)(t,[{key:"getBadReason",value:function(e){var t=0;if(1===f.default.config.syncMob)e-this.lastSliceTs>2e3&&(t|=1);else{e-this.lastSliceTs>Number(f.default.config.sliceTimeout)&&(t|=1);var n=this.getStreamDelay();n!==c.default.UintMax&&n>d.default.STREAM_DELAY&&(t|=2)}return t}},{key:"switchPubAble",value:function(){return(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"switchPubAble",this).call(this)&&this.getStreamDelay()>d.default.SWITCH_DELAY}}]),t}(l.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),s=r(n(1));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.subs=[]}return(0,s.default)(e,[{key:"hasSub",value:function(){return this.subs.length>0}},{key:"reset",value:function(){this.subs=[]}},{key:"addSub",value:function(e){return -1===this.subs.indexOf(e)&&(this.subs.push(e),!0)}},{key:"delSub",value:function(e){var t=this.subs.indexOf(e);return -1!==t&&(this.subs.splice(t,1),!0)}},{key:"isSubed",value:function(e){return -1!==this.subs.indexOf(e)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n(0)),s=u(n(1)),r=u(n(28)),a=u(n(56)),o=u(n(3));function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.delayCalc=new r.default(10)}return(0,s.default)(e,[{key:"reset",value:function(){this.delayCalc.reset()}},{key:"getDelay",value:function(){var e=this.delayCalc.average();return e===o.default.UintMax&&(e=a.default.DEFAULT_DELAY),e}},{key:"addDelay",value:function(e){e>a.default.DEFAULT_DELAY||this.delayCalc.add(e)}},{key:"setDelay",value:function(e){this.delayCalc.reset(),this.delayCalc.add(e)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),s=r(n(1));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e),this.uid=0,this.status=0,this.subStamp=0,this.maxRecvSeq=0,this.maxRecvSeqTs=0,this.isFromPeer=!1,this.firstSeq=0}return(0,s.default)(e,[{key:"isReady",value:function(){return 2===this.status}},{key:"reset",value:function(e){this.uid=0,this.status=0,this.subStamp=0,this.isFromPeer=!1,this.firstSeq=0,e&&(this.maxRecvSeq=0,this.maxRecvSeqTs=0)}},{key:"isTimeout",value:function(e){return this.subStamp>0&&e-this.subStamp>1e3}},{key:"updateMaxRecvSeq",value:function(e,t){return this.maxRecvSeq<e&&(this.maxRecvSeq=e,this.maxRecvSeqTs=t,!0)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n(8)),s=l(n(10)),r=l(n(0)),a=l(n(1)),o=l(n(2)),u=l(n(55));function l(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(){(0,r.default)(this,e),this.seq=0,this.resendCnt=0,this.repeatCnt=0,this.maxCnt=0,this.createTs=0,this.rto=0,this.suc=!1}return(0,a.default)(e,[{key:"isRangeCntExceed",value:function(){return this.resendCnt>=this.maxCnt}},{key:"isTimeToResend",value:function(e){return e-this.createTs>2*this.rto*this.resendCnt}},{key:"isTooOld",value:function(e){return e-this.createTs>5e3}}]),e}();t.default=function(){function e(t){(0,r.default)(this,e),this._subStream=t,this._baseSubs=t.sInfo.baseSubs,this._waitMap=new s.default,this._lastSeq=0,this._stats={resendCnt:0,firstCnt:0,repeatCnt:0,timeoutCnt:0},this._lastTimeoutTs=0}return(0,a.default)(e,[{key:"_addStat",value:function(e){this._stats.resendCnt+=e.resendCnt,e.suc&&1===e.resendCnt&&this._stats.firstCnt++,this._stats.repeatCnt+=e.repeatCnt}},{key:"onSliceData",value:function(e){var t=e.seq;if(this._waitMap.has(t)){var n=this._waitMap.get(t);n.suc=!0,this._addStat(n),this._waitMap.delete(t)}else this._checkLost(t)}},{key:"_checkLost",value:function(e,t){if(0===this._lastSeq)this._lastSeq=e;else if(e>this._lastSeq)for(var n=o.default.TimeUtil.now(),i=e;i<this._lastSeq;i+=this._baseSubs){var s=new d;s.maxCnt=2,s.createTs=n,s.rto=t,this._waitMap.set(i,s)}}},{key:"onCheckFastTimer",value:function(e){this._checkAndDeleteTooOld(e),this._checkResend(e)}},{key:"_checkResend",value:function(e){if(this._waitMap.size>0){var t=0,n=0,s=0,r=[],a=!0,l=!1,d=void 0;try{for(var h,c=(0,i.default)(this._waitMap.values());!(a=(h=c.next()).done);a=!0){var f=h.value;if(!f.isRangeCntExceed()&&f.isTimeToResend(e)){if(0===n)n=f.seq,r.push(0);else{var p=(f.seq-n)/this._baseSubs;if(p>255)break;r.push(p)}if(s=f.seq,f.resendCnt+=1,++t>=20)break}}}catch(e){l=!0,d=e}finally{try{!a&&c.return&&c.return()}finally{if(l)throw d}}t>0&&(o.default.logger.log("ResenderPeer.checkResend index="+this._subStream.index+" startSeq="+n+" offsets="+r.toString()),this._subStream.sendPeerRangeReq(n,s,r,u.default.SUBSTREAM))}}},{key:"_checkAndDeleteTooOld",value:function(e){0===this._lastTimeoutTs?this._lastTimeoutTs=e:this._lastTimeoutTs}},{key:"addPeerNoSeq",value:function(e){}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n(5)),s=c(n(0)),r=c(n(1)),a=c(n(6)),o=c(n(7)),u=c(n(124)),l=c(n(33)),d=c(n(125)),h=c(n(3));function c(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e){return(0,s.default)(this,t),(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e))}return(0,o.default)(t,e),(0,r.default)(t,[{key:"getSeqSpeed",value:function(){return l.default.SLICE_SPEED*this.sInfo.baseSubs*(this.sInfo.curBitrate/1e3)}},{key:"isDelayBad",value:function(e){return e.isDelayBad()}},{key:"isCandidateTooBad",value:function(e,t){if(0===t.length)return!1;t.sort(d.default.cmpLatency);var n=t[0].getStreamDelay();return n!==h.default.UintMax&&(n+=800),this.badCandidate.setStreamDelay(n),-1===d.default.cmpCandidate(this.badCandidate,e)}},{key:"isMuchBetter",value:function(e,t){var n=this.getCandidate(e),i=this.getCandidate(t),s=n.getStreamDelay(),r=s,a=s;return s!==h.default.UintMax&&(r+=500,a+=800),n.setStreamDelay(a),-1!==d.default.cmpCandidate(n,i)&&(n.setStreamDelay(r),-1===d.default.cmpCandidate(n,i))}}]),t}(u.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),s=r(n(1));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(){(0,i.default)(this,e)}return(0,s.default)(e,null,[{key:"K_BONUS_TIME",value:function(){return 1e4}},{key:"calcLineScore",value:function(e,t,n){var i=-1;return(i=n<e[0]?n*t[0]:n<e[1]?(n-e[0])*t[1]+e[0]*t[0]:n<e[2]?(n-e[1])*t[2]+(e[1]-e[0])*t[1]+e[0]*t[0]:n<e[3]?(n-e[2])*t[3]+(e[2]-e[1])*t[2]+(e[1]-e[0])*t[1]+e[0]*t[0]:(n-e[3])*t[4]+(e[3]-e[2])*t[3]+(e[2]-e[1])*t[2]+(e[1]-e[0])*t[1]+e[0]*t[0])>1e6&&(i=1e6),i}},{key:"calcDelayScore",value:function(t){return e.calcLineScore([100,400,1400,5400],[1,3,9,27,81],t)}},{key:"calcLossScore",value:function(t){return e.calcLineScore([20,50,100,200],[5,30,180,1080,6480],t)}},{key:"calcRateScore",value:function(t,n){n>t&&(n=t);var i=Math.round(1e3*(t-n+1)/(t+2));return e.calcLossScore(i)}},{key:"calcScore",value:function(t,n,i){i>n&&(i=n);var s=e.calcDelayScore(t)+e.calcRateScore(n,i);return(s/=5)>65535&&(s=65535),s}},{key:"cmpScore",value:function(e,t){return e<t?-1:+(e>t)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=v(n(5)),s=v(n(0)),r=v(n(1)),a=v(n(6)),o=v(n(12)),u=v(n(7)),l=v(n(112)),d=v(n(258)),h=v(n(2)),c=v(n(259)),f=v(n(119)),p=v(n(260)),m=v(n(262)),_=v(n(3));function v(e){return e&&e.__esModule?e:{default:e}}v(n(38)),t.default=function(e){function t(e){(0,s.default)(this,t);var n=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return n.sliceTimeout=4e3,n.loaderMgr.tryConnectNum=1,n.lastSeqTs=0,n.probe=new m.default(n),n}return(0,u.default)(t,e),(0,r.default)(t,[{key:"initStreamId",value:function(){this.sInfo.streamId.codecType=this.sInfo.pInfo.codecType,this.sInfo.streamId.cdnBrand=this.sInfo.pInfo.cdnBrand,h.default.logger.log("SignalStream.initStreamId",this.id,this.sInfo.streamId.text()),(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"initStreamId",this).call(this)}},{key:"initConfig",value:function(){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"initConfig",this).call(this),this.sInfo.sliceLate=500,this.sInfo.sliceFast=500,this.sInfo.lostSeqNum=4e3,this.sInfo.curUplinkNum=this.sInfo.baseSubs,this.sInfo.maxUplinkNum=Math.floor(2*this.sInfo.baseSubs),this.initGapCfg("signalExperiment","signalRangeGap","signalSubGap"),this.initBaseIndexCfg("signalBaseIndexExp","signalBaseIndexMode"),this.initUseCdnpFixed(),this.initSliceCfg("signalSliceCache","signalSliceDispatch"),this.openLog=_.default.isOpen(h.default.config.p2pSignalLogCfg,this.sInfo.presenterUid,this.sInfo.lineType,!1)}},{key:"initUseCdnpFixed",value:function(){this.sInfo.useCdnpFixed=_.default.isOpen(h.default.config.useCdnpFixed,this.sInfo.presenterUid,this.sInfo.lineType,!1)}},{key:"createResender",value:function(){return new d.default(this)}},{key:"createToken",value:function(){var e=new c.default(this);return e.token=this.sInfo.pInfo.antiCode,e}},{key:"createSubStreamMgr",value:function(){return new f.default(this,p.default)}},{key:"calcPeerLoss",value:function(e,t,n){if(!(t>100*n)){t<n&&(t=n);var i=h.default.TimeUtil.now();if(this.uploadCtrl.update(e,t,n,i),this.uploadCtrl.ready(i)){var s=this.uploadCtrl.updateUploadBandwidth(this.sInfo.curUplinkNum,i);s>this.sInfo.maxUplinkNum&&(s=this.sInfo.maxUplinkNum),this.sInfo.curUplinkNum=s,this.stat.updown_info.uplink_cnt=this.sInfo.curUplinkNum}}}},{key:"onRestart",value:function(){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onRestart",this).call(this),h.default.Timer.remove(this.onFastOver,this),this.probe.reset(),this.lastSeqTs=0,this.loaderMgr.loadFull(0)}},{key:"start",value:function(){var e=this.sInfo.pInfo,n=e.streamUrl;-1===n.indexOf("//")&&(n="//"+n),this.streamDomain.initDomain(n,e.p2pDomainList?e.p2pDomainList.slice():null,e._domain302),(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"start",this).call(this),this.loaderMgr.loadFull(0)}},{key:"stop",value:function(){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"stop",this).call(this),this.probe.reset(),this.lastSeqTs=0,h.default.Timer.remove(this.onFastOver,this)}},{key:"recvStreamAlive",value:function(e){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"recvStreamAlive",this).call(this,e),this.probe.updateLastTs()}},{key:"onSliceData",value:function(e){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onSliceData",this).call(this,e),0===this.lastSeqTs&&this.sInfo.isCanUseCdnp&&_.default.isOpen(h.default.config.signalClose,this.sInfo.presenterUid,this.sInfo.lineType)&&h.default.Timer.once(this.onFastOver,this,Number(h.default.config.fastTime)),this.lastSeqTs=h.default.TimeUtil.now(),this.probe.updateLastTs()}},{key:"onFastOver",value:function(){this.startSubStream()}},{key:"onCheckFastTimer",value:function(e,n){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onCheckFastTimer",this).call(this,e,n),this.probe.onCheckFastTimer(e,n)}},{key:"onopen",value:function(){this.probe.updateLastTs()}},{key:"turnStreamMode",value:function(){this.subStreamMgr.onRestart(),this.stop(),this.start()}},{key:"onProbeSuc",value:function(){this.probe.onProbeSuc()}}]),t}(l.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n(5)),s=l(n(0)),r=l(n(1)),a=l(n(6)),o=l(n(12)),u=l(n(7));function l(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e){(0,s.default)(this,t);var n=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return n.ResendDelayTs=500,n}return(0,u.default)(t,e),(0,r.default)(t,[{key:"initConfig",value:function(){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"initConfig",this).call(this),this.resendMode=2}},{key:"getRto",value:function(){return 500}}]),t}(l(n(117)).default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=h(n(5)),s=h(n(0)),r=h(n(1)),a=h(n(6)),o=h(n(12)),u=h(n(7)),l=h(n(116)),d=h(n(2));function h(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e){return(0,s.default)(this,t),(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e))}return(0,u.default)(t,e),(0,r.default)(t,[{key:"getToken",value:function(){var e=new d.default.HUYA.GetP2PStreamTokenExReq;e.sStreamName=this.streamName,this.sendWup("mediaui","getP2PStreamTokenInfoEx",e)}},{key:"onGetToken",value:function(e){this.token=e.sP2PToken,(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"onGetToken",this).call(this,e)}}]),t}(l.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=p(n(5)),s=p(n(0)),r=p(n(1)),a=p(n(6)),o=p(n(12)),u=p(n(7)),l=p(n(123)),d=p(n(28)),h=p(n(261)),c=p(n(3)),f=p(n(2));function p(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e,n){(0,s.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e,n));return r.pubSelector=new h.default(r),r.sliceSpeedCalc=new d.default(10),r}return(0,u.default)(t,e),(0,r.default)(t,[{key:"getSliceSpeed",value:function(){var e=this.sliceSpeedCalc.average();return e===c.default.UintMax?0:Math.ceil(e)}},{key:"reset",value:function(){(0,o.default)(t.prototype.__proto__||(0,i.default)(t.prototype),"reset",this).call(this),this.sliceSpeedCalc.reset()}},{key:"isDelayBad",value:function(e){return!1}},{key:"getBadReason",value:function(e){var t=0;return e-this.lastSliceTs>Number(f.default.config.aliveTimeout)&&(t|=1),t}}]),t}(l.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n(5)),s=d(n(0)),r=d(n(1)),a=d(n(6)),o=d(n(7)),u=d(n(124)),l=(d(n(2)),d(n(3)));function d(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){function t(e){return(0,s.default)(this,t),(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e))}return(0,o.default)(t,e),(0,r.default)(t,[{key:"getSeqSpeed",value:function(){return this.subStream.getSliceSpeed()*this.sInfo.baseSubs}},{key:"isMuchBetter",value:function(e,t){var n=this.subStream.stream.peerMgr.getRtt(e),i=this.subStream.stream.peerMgr.getRtt(t);return n!==l.default.UintMax&&i!==l.default.UintMax&&!(i<50)&&n-i>50}}]),t}(u.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n(0)),s=o(n(1)),r=o(n(2)),a=o(n(78));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){function e(t){(0,i.default)(this,e),this.stream=t,this.reset()}return(0,s.default)(e,[{key:"reset",value:function(){this.lastSeqTs=0,this.probeTs=0,this.probeSucTs=0,this.tickCnt=0}},{key:"updateLastTs",value:function(){this.lastSeqTs=r.default.TimeUtil.now(),this.probeTs=0,this.probeSucTs=0,this.tickCnt=0}},{key:"onProbeSuc",value:function(){this.probeSucTs=r.default.TimeUtil.now()}},{key:"onCheckFastTimer",value:function(e,t){if(0!==this.lastSeqTs){var n=e-this.lastSeqTs;0===this.probeTs?n>1500&&(this.probeTs=e,this.tickCnt=0,this.probeSucTs=0):0===this.probeSucTs?n>5e3&&this.stream.streamHandler.turnToFlv(a.default.SIGNAL_TIMEOUT):n>3e3?this.stream.streamHandler.turnToFlv(a.default.SIGNAL_TIMEOUT):(this.tickCnt%4==0&&this.stream.loaderMgr.loadProbe(this.stream.recevier.maxSeq),this.tickCnt++)}}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=i&&i.__esModule?i:{default:i};t.default=function e(){(0,s.default)(this,e),this.type=0,this.uid=0,this.sid=0,this.subSid=0,this.presenterUid=0,this.lineType=0,this.sStreamName="",this.sFlvUrl="",this.sFlvAntiCode="",this.sFlvUrlSuffix="",this.sP2pUrl="",this.sP2pAntiCode="",this.sP2pUrlSuffix="",this.bitrate=0,this.curBitrate=0,this.originalBitrate=0,this.iIsP2PSupport=0,this.h5Root="",this.domainList=[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=i&&i.__esModule?i:{default:i};t.default=function e(){(0,s.default)(this,e),this.type=0,this.uid=0,this.presenterUid=0,this.curBitrate=0,this.sStreamName="",this.oStreamName="",this.codecType=0,this.cdnBrand=0,this.lineType=0,this.streamUrl="",this.antiCode="",this.h5Root=""}},function(e,t,n){"use strict";var i={};(0,n(22).assign)(i,n(266),n(269),n(130)),e.exports=i},function(e,t,n){"use strict";var i=n(267),s=n(22),r=n(128),a=n(82),o=n(129),u=Object.prototype.toString;function l(e){if(!(this instanceof l))return new l(e);this.options=s.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t,n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var d=i.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(0!==d)throw Error(a[d]);if(n.header&&i.deflateSetHeader(this.strm,n.header),n.dictionary){if(t="string"==typeof n.dictionary?r.string2buf(n.dictionary):"[object ArrayBuffer]"===u.call(n.dictionary)?new Uint8Array(n.dictionary):n.dictionary,0!==(d=i.deflateSetDictionary(this.strm,t)))throw Error(a[d]);this._dict_set=!0}}function d(e,t){var n=new l(t);if(n.push(e,!0),n.err)throw n.msg||a[n.err];return n.result}l.prototype.push=function(e,t){var n,a,o=this.strm,l=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:4*(!0===t),"string"==typeof e?o.input=r.string2buf(e):"[object ArrayBuffer]"===u.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new s.Buf8(l),o.next_out=0,o.avail_out=l),1!==(n=i.deflate(o,a))&&0!==n)return this.onEnd(n),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(r.buf2binstring(s.shrinkBuf(o.output,o.next_out))):this.onData(s.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&1!==n);return 4===a?(n=i.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):2!==a||(this.onEnd(0),o.avail_out=0,!0)},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=l,t.deflate=d,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,d(e,t)}},function(e,t,n){"use strict";var i,s=n(22),r=n(268),a=n(126),o=n(127),u=n(82);function l(e,t){return e.msg=u[t],t}function d(e){return(e<<1)-9*(e>4)}function h(e){for(var t=e.length;--t>=0;)e[t]=0}function c(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(s.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function f(e,t){r._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,c(e.strm)}function p(e,t){e.pending_buf[e.pending++]=t}function m(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function _(e,t){var n,i,s=e.max_chain_length,r=e.strstart,a=e.prev_length,o=e.nice_match,u=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,l=e.window,d=e.w_mask,h=e.prev,c=e.strstart+258,f=l[r+a-1],p=l[r+a];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do if(l[(n=t)+a]===p&&l[n+a-1]===f&&l[n]===l[r]&&l[++n]===l[r+1]){r+=2,n++;do;while(l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&l[++r]===l[++n]&&r<c);if(i=258-(c-r),r=c-258,i>a){if(e.match_start=t,a=i,i>=o)break;f=l[r+a-1],p=l[r+a]}}while((t=h[t&d])>u&&0!=--s);return a<=e.lookahead?a:e.lookahead}function v(e){var t,n,i,r,u,l,d,h,c,f,p=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-262)){s.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=n=e.hash_size;do i=e.head[--t],e.head[t]=i>=p?i-p:0;while(--n);t=n=p;do i=e.prev[--t],e.prev[t]=i>=p?i-p:0;while(--n);r+=p}if(0===e.strm.avail_in)break;if(l=e.strm,d=e.window,h=e.strstart+e.lookahead,c=r,f=void 0,(f=l.avail_in)>c&&(f=c),n=0===f?0:(l.avail_in-=f,s.arraySet(d,l.input,l.next_in,f,h),1===l.state.wrap?l.adler=a(l.adler,d,f,h):2===l.state.wrap&&(l.adler=o(l.adler,d,f,h)),l.next_in+=f,l.total_in+=f,f),e.lookahead+=n,e.lookahead+e.insert>=3)for(u=e.strstart-e.insert,e.ins_h=e.window[u],e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+3-1])&e.hash_mask,e.prev[u&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=u,u++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function g(e,t){for(var n,i;;){if(e.lookahead<262){if(v(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-262&&(e.match_length=_(e,n)),e.match_length>=3)if(i=r._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function y(e,t){for(var n,i,s;;){if(e.lookahead<262){if(v(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-262&&(e.match_length=_(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,i=r._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(f(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=r._tr_tally(e,0,e.window[e.strstart-1]))&&f(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=r._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function S(e,t,n,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=s}function b(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(1146),this.dyn_dtree=new s.Buf16(122),this.bl_tree=new s.Buf16(78),h(this.dyn_ltree),h(this.dyn_dtree),h(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(16),this.heap=new s.Buf16(573),h(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(573),h(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function P(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=+(2!==t.wrap),t.last_flush=0,r._tr_init(t),0):l(e,-2)}function k(e){var t,n=P(e);return 0===n&&((t=e.state).window_size=2*t.w_size,h(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n}function I(e,t,n,i,r,a){if(!e)return -2;var o=1;if(-1===t&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),r<1||r>9||8!==n||i<8||i>15||t<0||t>9||a<0||a>4)return l(e,-2);8===i&&(i=9);var u=new b;return e.state=u,u.strm=e,u.wrap=o,u.gzhead=null,u.w_bits=i,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=r+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new s.Buf8(2*u.w_size),u.head=new s.Buf16(u.hash_size),u.prev=new s.Buf16(u.w_size),u.lit_bufsize=1<<r+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new s.Buf8(u.pending_buf_size),u.d_buf=+u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=t,u.strategy=a,u.method=n,k(e)}i=[new S(0,0,0,0,function(e,t){var n=65535;for(65535>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(v(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,f(e,!1),0===e.strm.avail_out)||e.strstart-e.block_start>=e.w_size-262&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(f(e,!1),e.strm.avail_out),1)}),new S(4,4,8,4,g),new S(4,5,16,8,g),new S(4,6,32,32,g),new S(4,4,16,16,y),new S(8,16,32,32,y),new S(8,16,128,128,y),new S(8,32,128,256,y),new S(32,128,258,1024,y),new S(32,258,258,4096,y)],t.deflateInit=function(e,t){return I(e,t,8,15,8,0)},t.deflateInit2=I,t.deflateReset=k,t.deflateResetKeep=P,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},t.deflate=function(e,t){var n,s,a,u;if(!e||!e.state||t>5||t<0)return e?l(e,-2):-2;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||666===s.status&&4!==t)return l(e,0===e.avail_out?-5:-2);if(s.strm=e,n=s.last_flush,s.last_flush=t,42===s.status)if(2===s.wrap)e.adler=0,p(s,31),p(s,139),p(s,8),s.gzhead?(p(s,+!!s.gzhead.text+2*!!s.gzhead.hcrc+4*!!s.gzhead.extra+8*!!s.gzhead.name+16*!!s.gzhead.comment),p(s,255&s.gzhead.time),p(s,s.gzhead.time>>8&255),p(s,s.gzhead.time>>16&255),p(s,s.gzhead.time>>24&255),p(s,9===s.level?2:4*(s.strategy>=2||s.level<2)),p(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(p(s,255&s.gzhead.extra.length),p(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=o(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(p(s,0),p(s,0),p(s,0),p(s,0),p(s,0),p(s,9===s.level?2:4*(s.strategy>=2||s.level<2)),p(s,3),s.status=113);else{var _=8+(s.w_bits-8<<4)<<8;_|=(s.strategy>=2||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(_|=32),_+=31-_%31,s.status=113,m(s,_),0!==s.strstart&&(m(s,e.adler>>>16),m(s,65535&e.adler)),e.adler=1}if(69===s.status)if(s.gzhead.extra){for(a=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>a&&(e.adler=o(e.adler,s.pending_buf,s.pending-a,a)),c(e),a=s.pending,s.pending!==s.pending_buf_size));)p(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>a&&(e.adler=o(e.adler,s.pending_buf,s.pending-a,a)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){a=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>a&&(e.adler=o(e.adler,s.pending_buf,s.pending-a,a)),c(e),a=s.pending,s.pending===s.pending_buf_size)){u=1;break}u=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,p(s,u)}while(0!==u);s.gzhead.hcrc&&s.pending>a&&(e.adler=o(e.adler,s.pending_buf,s.pending-a,a)),0===u&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){a=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>a&&(e.adler=o(e.adler,s.pending_buf,s.pending-a,a)),c(e),a=s.pending,s.pending===s.pending_buf_size)){u=1;break}u=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,p(s,u)}while(0!==u);s.gzhead.hcrc&&s.pending>a&&(e.adler=o(e.adler,s.pending_buf,s.pending-a,a)),0===u&&(s.status=103)}else s.status=103;if(103===s.status&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&c(e),s.pending+2<=s.pending_buf_size&&(p(s,255&e.adler),p(s,e.adler>>8&255),e.adler=0,s.status=113)):s.status=113),0!==s.pending){if(c(e),0===e.avail_out)return s.last_flush=-1,0}else if(0===e.avail_in&&d(t)<=d(n)&&4!==t)return l(e,-5);if(666===s.status&&0!==e.avail_in)return l(e,-5);if(0!==e.avail_in||0!==s.lookahead||0!==t&&666!==s.status){var g=2===s.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(v(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(s,t):3===s.strategy?function(e,t){for(var n,i,s,a,o=e.window;;){if(e.lookahead<=258){if(v(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=o[s=e.strstart-1])===o[++s]&&i===o[++s]&&i===o[++s]){a=e.strstart+258;do;while(i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&s<a);e.match_length=258-(a-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=r._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(s,t):i[s.level].func(s,t);if(3!==g&&4!==g||(s.status=666),1===g||3===g)return 0===e.avail_out&&(s.last_flush=-1),0;if(2===g&&(1===t?r._tr_align(s):5!==t&&(r._tr_stored_block(s,0,0,!1),3===t&&(h(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),c(e),0===e.avail_out))return s.last_flush=-1,0}return 4!==t?0:s.wrap<=0?1:(2===s.wrap?(p(s,255&e.adler),p(s,e.adler>>8&255),p(s,e.adler>>16&255),p(s,e.adler>>24&255),p(s,255&e.total_in),p(s,e.total_in>>8&255),p(s,e.total_in>>16&255),p(s,e.total_in>>24&255)):(m(s,e.adler>>>16),m(s,65535&e.adler)),c(e),s.wrap>0&&(s.wrap=-s.wrap),+(0===s.pending))},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?l(e,-2):(e.state=null,113===t?l(e,-3):0):-2},t.deflateSetDictionary=function(e,t){var n,i,r,o,u,l,d,c,f=t.length;if(!e||!e.state||2===(o=(n=e.state).wrap)||1===o&&42!==n.status||n.lookahead)return -2;for(1===o&&(e.adler=a(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===o&&(h(n.head),n.strstart=0,n.block_start=0,n.insert=0),c=new s.Buf8(n.w_size),s.arraySet(c,t,f-n.w_size,n.w_size,0),t=c,f=n.w_size),u=e.avail_in,l=e.next_in,d=e.input,e.avail_in=f,e.next_in=0,e.input=t,v(n);n.lookahead>=3;){i=n.strstart,r=n.lookahead-2;do n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+3-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++;while(--r);n.strstart=i,n.lookahead=2,v(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=l,e.input=d,e.avail_in=u,n.wrap=o,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){"use strict";var i=n(22);function s(e){for(var t=e.length;--t>=0;)e[t]=0}var r=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],a=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],u=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],l=Array(576);s(l);var d=Array(60);s(d);var h=Array(512);s(h);var c=Array(256);s(c);var f=Array(29);s(f);var p,m,_,v=Array(30);function g(e,t,n,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}function y(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function S(e){return e<256?h[e]:h[256+(e>>>7)]}function b(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function P(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,b(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function k(e,t,n){P(e,n[2*t],n[2*t+1])}function I(e,t){var n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1}function w(e,t,n){var i,s,r=Array(16),a=0;for(i=1;i<=15;i++)r[i]=a=a+n[i-1]<<1;for(s=0;s<=t;s++){var o=e[2*s+1];0!==o&&(e[2*s]=I(r[o]++,o))}}function T(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function C(e){e.bi_valid>8?b(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function x(e,t,n,i){var s=2*t,r=2*n;return e[s]<e[r]||e[s]===e[r]&&i[t]<=i[n]}function R(e,t,n){for(var i=e.heap[n],s=n<<1;s<=e.heap_len&&(s<e.heap_len&&x(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!x(t,i,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=i}function M(e,t,n){var i,s,o,u,l=0;if(0!==e.last_lit)do i=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],s=e.pending_buf[e.l_buf+l],l++,0===i?k(e,s,t):(k(e,(o=c[s])+256+1,t),0!==(u=r[o])&&P(e,s-=f[o],u),k(e,o=S(--i),n),0!==(u=a[o])&&P(e,i-=v[o],u));while(l<e.last_lit);k(e,256,t)}function U(e,t){var n,i,s,r=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,u=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<u;n++)0!==r[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):r[2*n+1]=0;for(;e.heap_len<2;)r[2*(s=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[s]=0,e.opt_len--,o&&(e.static_len-=a[2*s+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)R(e,r,n);s=u;do n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],R(e,r,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,r[2*s]=r[2*n]+r[2*i],e.depth[s]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,r[2*n+1]=r[2*i+1]=s,e.heap[1]=s++,R(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,s,r,a,o,u=t.dyn_tree,l=t.max_code,d=t.stat_desc.static_tree,h=t.stat_desc.has_stree,c=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(r=0;r<=15;r++)e.bl_count[r]=0;for(u[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(r=u[2*u[2*(i=e.heap[n])+1]+1]+1)>p&&(r=p,m++),u[2*i+1]=r,i>l||(e.bl_count[r]++,a=0,i>=f&&(a=c[i-f]),o=u[2*i],e.opt_len+=o*(r+a),h&&(e.static_len+=o*(d[2*i+1]+a)));if(0!==m){do{for(r=p-1;0===e.bl_count[r];)r--;e.bl_count[r]--,e.bl_count[r+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(r=p;0!==r;r--)for(i=e.bl_count[r];0!==i;)(s=e.heap[--n])>l||(u[2*s+1]!==r&&(e.opt_len+=(r-u[2*s+1])*u[2*s],u[2*s+1]=r),i--)}}(e,t),w(r,l,e.bl_count)}function N(e,t,n){var i,s,r=-1,a=t[1],o=0,u=7,l=4;for(0===a&&(u=138,l=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)s=a,a=t[2*(i+1)+1],++o<u&&s===a||(o<l?e.bl_tree[2*s]+=o:0!==s?(s!==r&&e.bl_tree[2*s]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,r=s,0===a?(u=138,l=3):s===a?(u=6,l=3):(u=7,l=4))}function E(e,t,n){var i,s,r=-1,a=t[1],o=0,u=7,l=4;for(0===a&&(u=138,l=3),i=0;i<=n;i++)if(s=a,a=t[2*(i+1)+1],!(++o<u&&s===a)){if(o<l)do k(e,s,e.bl_tree);while(0!=--o);else 0!==s?(s!==r&&(k(e,s,e.bl_tree),o--),k(e,16,e.bl_tree),P(e,o-3,2)):o<=10?(k(e,17,e.bl_tree),P(e,o-3,3)):(k(e,18,e.bl_tree),P(e,o-11,7));o=0,r=s,0===a?(u=138,l=3):s===a?(u=6,l=3):(u=7,l=4)}}s(v);var L=!1;function O(e,t,n,s){P(e,0+ +!!s,3),C(e),b(e,n),b(e,~n),i.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}t._tr_init=function(e){L||(!function(){var e,t,n,i,s,u=Array(16);for(n=0,i=0;i<28;i++)for(f[i]=n,e=0;e<1<<r[i];e++)c[n++]=i;for(c[n-1]=i,s=0,i=0;i<16;i++)for(v[i]=s,e=0;e<1<<a[i];e++)h[s++]=i;for(s>>=7;i<30;i++)for(v[i]=s<<7,e=0;e<1<<a[i]-7;e++)h[256+s++]=i;for(t=0;t<=15;t++)u[t]=0;for(e=0;e<=143;)l[2*e+1]=8,e++,u[8]++;for(;e<=255;)l[2*e+1]=9,e++,u[9]++;for(;e<=279;)l[2*e+1]=7,e++,u[7]++;for(;e<=287;)l[2*e+1]=8,e++,u[8]++;for(w(l,287,u),e=0;e<30;e++)d[2*e+1]=5,d[2*e]=I(e,5);p=new g(l,r,257,286,15),m=new g(d,a,0,30,15),_=new g([],o,0,19,7)}(),L=!0),e.l_desc=new y(e.dyn_ltree,p),e.d_desc=new y(e.dyn_dtree,m),e.bl_desc=new y(e.bl_tree,_),e.bi_buf=0,e.bi_valid=0,T(e)},t._tr_stored_block=O,t._tr_flush_block=function(e,t,n,i){var s,r,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=0xf3ffc07f;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),U(e,e.l_desc),U(e,e.d_desc),a=function(e){var t;for(N(e,e.dyn_ltree,e.l_desc.max_code),N(e,e.dyn_dtree,e.d_desc.max_code),U(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*u[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),s=e.opt_len+3+7>>>3,(r=e.static_len+3+7>>>3)<=s&&(s=r)):s=r=n+5,n+4<=s&&-1!==t?O(e,t,n,i):4===e.strategy||r===s?(P(e,2+ +!!i,3),M(e,l,d)):(P(e,4+ +!!i,3),function(e,t,n,i){var s;for(P(e,t-257,5),P(e,n-1,5),P(e,i-4,4),s=0;s<i;s++)P(e,e.bl_tree[2*u[s]+1],3);E(e,e.dyn_ltree,t-1),E(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),M(e,e.dyn_ltree,e.dyn_dtree)),T(e),i&&C(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(c[n]+256+1)]++,e.dyn_dtree[2*S(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){P(e,2,3),k(e,256,l),16===e.bi_valid?(b(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}},function(e,t,n){"use strict";var i=n(270),s=n(22),r=n(128),a=n(130),o=n(82),u=n(129),l=n(273),d=Object.prototype.toString;function h(e){if(!(this instanceof h))return new h(e);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=i.inflateInit2(this.strm,t.windowBits);if(n!==a.Z_OK||(this.header=new l,i.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=r.string2buf(t.dictionary):"[object ArrayBuffer]"===d.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=i.inflateSetDictionary(this.strm,t.dictionary))!==a.Z_OK)))throw Error(o[n])}function c(e,t){var n=new h(t);if(n.push(e,!0),n.err)throw n.msg||o[n.err];return n.result}h.prototype.push=function(e,t){var n,o,u,l,h,c=this.strm,f=this.options.chunkSize,p=this.options.dictionary,m=!1;if(this.ended)return!1;o=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?c.input=r.binstring2buf(e):"[object ArrayBuffer]"===d.call(e)?c.input=new Uint8Array(e):c.input=e,c.next_in=0,c.avail_in=c.input.length;do{if(0===c.avail_out&&(c.output=new s.Buf8(f),c.next_out=0,c.avail_out=f),(n=i.inflate(c,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&p&&(n=i.inflateSetDictionary(this.strm,p)),n===a.Z_BUF_ERROR&&!0===m&&(n=a.Z_OK,m=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;c.next_out&&(0!==c.avail_out&&n!==a.Z_STREAM_END&&(0!==c.avail_in||o!==a.Z_FINISH&&o!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(u=r.utf8border(c.output,c.next_out),l=c.next_out-u,h=r.buf2string(c.output,u),c.next_out=l,c.avail_out=f-l,l&&s.arraySet(c.output,c.output,u,l,0),this.onData(h)):this.onData(s.shrinkBuf(c.output,c.next_out)))),0===c.avail_in&&0===c.avail_out&&(m=!0)}while((c.avail_in>0||0===c.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(o=a.Z_FINISH),o===a.Z_FINISH?(n=i.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):o!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),c.avail_out=0,!0)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=h,t.inflate=c,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,c(e,t)},t.ungzip=c},function(e,t,n){"use strict";var i=n(22),s=n(126),r=n(127),a=n(271),o=n(272);function u(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function l(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function d(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(852),t.distcode=t.distdyn=new i.Buf32(592),t.sane=1,t.back=-1,0):-2}function h(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,d(e)):-2}function c(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,h(e))):-2}function f(e,t){var n,i;return e?(e.state=i=new l,i.window=null,0!==(n=c(e,t))&&(e.state=null),n):-2}var p,m,_=!0;function v(e,t,n,s){var r,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new i.Buf8(a.wsize)),s>=a.wsize?(i.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((r=a.wsize-a.wnext)>s&&(r=s),i.arraySet(a.window,t,n-s,r,a.wnext),(s-=r)?(i.arraySet(a.window,t,n-s,s,0),a.wnext=s,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0}t.inflateReset=h,t.inflateReset2=c,t.inflateResetKeep=d,t.inflateInit=function(e){return f(e,15)},t.inflateInit2=f,t.inflate=function(e,t){var n,l,d,h,c,f,g,y,S,b,P,k,I,w,T,C,x,R,M,U,N,E,L,O,D=0,A=new i.Buf8(4),q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return -2;12===(n=e.state).mode&&(n.mode=13),c=e.next_out,d=e.output,g=e.avail_out,h=e.next_in,l=e.input,f=e.avail_in,y=n.hold,S=n.bits,b=f,P=g,E=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;S<16;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(2&n.wrap&&35615===y){n.check=0,A[0]=255&y,A[1]=y>>>8&255,n.check=r(n.check,A,2,0),y=0,S=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&y)){e.msg="unknown compression method",n.mode=30;break}if(S-=4,N=8+(15&(y>>>=4)),0===n.wbits)n.wbits=N;else if(N>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<N,e.adler=n.check=1,n.mode=512&y?10:12,y=0,S=0;break;case 2:for(;S<16;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(n.flags=y,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=y>>8&1),512&n.flags&&(A[0]=255&y,A[1]=y>>>8&255,n.check=r(n.check,A,2,0)),y=0,S=0,n.mode=3;case 3:for(;S<32;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}n.head&&(n.head.time=y),512&n.flags&&(A[0]=255&y,A[1]=y>>>8&255,A[2]=y>>>16&255,A[3]=y>>>24&255,n.check=r(n.check,A,4,0)),y=0,S=0,n.mode=4;case 4:for(;S<16;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}n.head&&(n.head.xflags=255&y,n.head.os=y>>8),512&n.flags&&(A[0]=255&y,A[1]=y>>>8&255,n.check=r(n.check,A,2,0)),y=0,S=0,n.mode=5;case 5:if(1024&n.flags){for(;S<16;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}n.length=y,n.head&&(n.head.extra_len=y),512&n.flags&&(A[0]=255&y,A[1]=y>>>8&255,n.check=r(n.check,A,2,0)),y=0,S=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((k=n.length)>f&&(k=f),k&&(n.head&&(N=n.head.extra_len-n.length,n.head.extra||(n.head.extra=Array(n.head.extra_len)),i.arraySet(n.head.extra,l,h,k,N)),512&n.flags&&(n.check=r(n.check,l,k,h)),f-=k,h+=k,n.length-=k),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===f)break e;k=0;do N=l[h+k++],n.head&&N&&n.length<65536&&(n.head.name+=String.fromCharCode(N));while(N&&k<f);if(512&n.flags&&(n.check=r(n.check,l,k,h)),f-=k,h+=k,N)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===f)break e;k=0;do N=l[h+k++],n.head&&N&&n.length<65536&&(n.head.comment+=String.fromCharCode(N));while(N&&k<f);if(512&n.flags&&(n.check=r(n.check,l,k,h)),f-=k,h+=k,N)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;S<16;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(y!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}y=0,S=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;S<32;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}e.adler=n.check=u(y),y=0,S=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=c,e.avail_out=g,e.next_in=h,e.avail_in=f,n.hold=y,n.bits=S,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){y>>>=7&S,S-=7&S,n.mode=27;break}for(;S<3;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}switch(n.last=1&y,S-=1,3&(y>>>=1)){case 0:n.mode=14;break;case 1:if(function(e){if(_){var t;for(p=new i.Buf32(512),m=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(1,e.lens,0,288,p,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(2,e.lens,0,32,m,0,e.work,{bits:5}),_=!1}e.lencode=p,e.lenbits=9,e.distcode=m,e.distbits=5}(n),n.mode=20,6===t){y>>>=2,S-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}y>>>=2,S-=2;break;case 14:for(y>>>=7&S,S-=7&S;S<32;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&y,y=0,S=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(k=n.length){if(k>f&&(k=f),k>g&&(k=g),0===k)break e;i.arraySet(d,l,h,k,c),f-=k,h+=k,g-=k,c+=k,n.length-=k;break}n.mode=12;break;case 17:for(;S<14;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(n.nlen=257+(31&y),S-=5,n.ndist=1+(31&(y>>>=5)),S-=5,n.ncode=4+(15&(y>>>=5)),y>>>=4,S-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;S<3;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}n.lens[q[n.have++]]=7&y,y>>>=3,S-=3}for(;n.have<19;)n.lens[q[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,L={bits:n.lenbits},E=o(0,n.lens,0,19,n.lencode,0,n.work,L),n.lenbits=L.bits,E){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;C=(D=n.lencode[y&(1<<n.lenbits)-1])>>>16&255,x=65535&D,!((T=D>>>24)<=S);){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(x<16)y>>>=T,S-=T,n.lens[n.have++]=x;else{if(16===x){for(O=T+2;S<O;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(y>>>=T,S-=T,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}N=n.lens[n.have-1],k=3+(3&y),y>>>=2,S-=2}else if(17===x){for(O=T+3;S<O;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}S-=T,N=0,k=3+(7&(y>>>=T)),y>>>=3,S-=3}else{for(O=T+7;S<O;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}S-=T,N=0,k=11+(127&(y>>>=T)),y>>>=7,S-=7}if(n.have+k>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;k--;)n.lens[n.have++]=N}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,L={bits:n.lenbits},E=o(1,n.lens,0,n.nlen,n.lencode,0,n.work,L),n.lenbits=L.bits,E){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,L={bits:n.distbits},E=o(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,L),n.distbits=L.bits,E){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(f>=6&&g>=258){e.next_out=c,e.avail_out=g,e.next_in=h,e.avail_in=f,n.hold=y,n.bits=S,a(e,P),c=e.next_out,d=e.output,g=e.avail_out,h=e.next_in,l=e.input,f=e.avail_in,y=n.hold,S=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;C=(D=n.lencode[y&(1<<n.lenbits)-1])>>>16&255,x=65535&D,!((T=D>>>24)<=S);){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(C&&0==(240&C)){for(R=T,M=C,U=x;C=(D=n.lencode[U+((y&(1<<R+M)-1)>>R)])>>>16&255,x=65535&D,!(R+(T=D>>>24)<=S);){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}y>>>=R,S-=R,n.back+=R}if(y>>>=T,S-=T,n.back+=T,n.length=x,0===C){n.mode=26;break}if(32&C){n.back=-1,n.mode=12;break}if(64&C){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&C,n.mode=22;case 22:if(n.extra){for(O=n.extra;S<O;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}n.length+=y&(1<<n.extra)-1,y>>>=n.extra,S-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;C=(D=n.distcode[y&(1<<n.distbits)-1])>>>16&255,x=65535&D,!((T=D>>>24)<=S);){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(0==(240&C)){for(R=T,M=C,U=x;C=(D=n.distcode[U+((y&(1<<R+M)-1)>>R)])>>>16&255,x=65535&D,!(R+(T=D>>>24)<=S);){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}y>>>=R,S-=R,n.back+=R}if(y>>>=T,S-=T,n.back+=T,64&C){e.msg="invalid distance code",n.mode=30;break}n.offset=x,n.extra=15&C,n.mode=24;case 24:if(n.extra){for(O=n.extra;S<O;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}n.offset+=y&(1<<n.extra)-1,y>>>=n.extra,S-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===g)break e;if(k=P-g,n.offset>k){if((k=n.offset-k)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}k>n.wnext?(k-=n.wnext,I=n.wsize-k):I=n.wnext-k,k>n.length&&(k=n.length),w=n.window}else w=d,I=c-n.offset,k=n.length;k>g&&(k=g),g-=k,n.length-=k;do d[c++]=w[I++];while(--k);0===n.length&&(n.mode=21);break;case 26:if(0===g)break e;d[c++]=n.length,g--,n.mode=21;break;case 27:if(n.wrap){for(;S<32;){if(0===f)break e;f--,y|=l[h++]<<S,S+=8}if(P-=g,e.total_out+=P,n.total+=P,P&&(e.adler=n.check=n.flags?r(n.check,d,P,c-P):s(n.check,d,P,c-P)),P=g,(n.flags?y:u(y))!==n.check){e.msg="incorrect data check",n.mode=30;break}y=0,S=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;S<32;){if(0===f)break e;f--,y+=l[h++]<<S,S+=8}if(y!==(0|n.total)){e.msg="incorrect length check",n.mode=30;break}y=0,S=0}n.mode=29;case 29:E=1;break e;case 30:E=-3;break e;case 31:return -4;default:return -2}return e.next_out=c,e.avail_out=g,e.next_in=h,e.avail_in=f,n.hold=y,n.bits=S,(n.wsize||P!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&v(e,e.output,e.next_out,P-e.avail_out)?(n.mode=31,-4):(b-=e.avail_in,P-=e.avail_out,e.total_in+=b,e.total_out+=P,n.total+=P,n.wrap&&P&&(e.adler=n.check=n.flags?r(n.check,d,P,e.next_out-P):s(n.check,d,P,e.next_out-P)),e.data_type=n.bits+64*!!n.last+128*(12===n.mode)+256*(20===n.mode||15===n.mode),(0===b&&0===P||4===t)&&0===E&&(E=-5),E)},t.inflateEnd=function(e){if(!e||!e.state)return -2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?-2:(n.head=t,t.done=!1,0):-2},t.inflateSetDictionary=function(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&s(1,t,i,0)!==n.check?-3:v(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,0):-2},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){"use strict";e.exports=function(e,t){var n,i,s,r,a,o,u,l,d,h,c,f,p,m,_,v,g,y,S,b,P,k,I,w,T;n=e.state,i=e.next_in,w=e.input,s=i+(e.avail_in-5),r=e.next_out,T=e.output,a=r-(t-e.avail_out),o=r+(e.avail_out-257),u=n.dmax,l=n.wsize,d=n.whave,h=n.wnext,c=n.window,f=n.hold,p=n.bits,m=n.lencode,_=n.distcode,v=(1<<n.lenbits)-1,g=(1<<n.distbits)-1;e:do for(p<15&&(f+=w[i++]<<p,p+=8,f+=w[i++]<<p,p+=8),y=m[f&v];;){if(f>>>=S=y>>>24,p-=S,0===(S=y>>>16&255))T[r++]=65535&y;else{if(!(16&S)){if(0==(64&S)){y=m[(65535&y)+(f&(1<<S)-1)];continue}if(32&S){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}for(b=65535&y,(S&=15)&&(p<S&&(f+=w[i++]<<p,p+=8),b+=f&(1<<S)-1,f>>>=S,p-=S),p<15&&(f+=w[i++]<<p,p+=8,f+=w[i++]<<p,p+=8),y=_[f&g];;){if(f>>>=S=y>>>24,p-=S,!(16&(S=y>>>16&255))){if(0==(64&S)){y=_[(65535&y)+(f&(1<<S)-1)];continue}e.msg="invalid distance code",n.mode=30;break e}if(P=65535&y,p<(S&=15)&&(f+=w[i++]<<p,(p+=8)<S&&(f+=w[i++]<<p,p+=8)),(P+=f&(1<<S)-1)>u){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=S,p-=S,P>(S=r-a)){if((S=P-S)>d&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(k=0,I=c,0===h){if(k+=l-S,S<b){b-=S;do T[r++]=c[k++];while(--S);k=r-P,I=T}}else if(h<S){if(k+=l+h-S,(S-=h)<b){b-=S;do T[r++]=c[k++];while(--S);if(k=0,h<b){b-=S=h;do T[r++]=c[k++];while(--S);k=r-P,I=T}}}else if(k+=h-S,S<b){b-=S;do T[r++]=c[k++];while(--S);k=r-P,I=T}for(;b>2;)T[r++]=I[k++],T[r++]=I[k++],T[r++]=I[k++],b-=3;b&&(T[r++]=I[k++],b>1&&(T[r++]=I[k++]))}else{k=r-P;do T[r++]=T[k++],T[r++]=T[k++],T[r++]=T[k++],b-=3;while(b>2);b&&(T[r++]=T[k++],b>1&&(T[r++]=T[k++]))}break}}break}while(i<s&&r<o);i-=b=p>>3,f&=(1<<(p-=b<<3))-1,e.next_in=i,e.next_out=r,e.avail_in=i<s?s-i+5:5-(i-s),e.avail_out=r<o?o-r+257:257-(r-o),n.hold=f,n.bits=p}},function(e,t,n){"use strict";var i=n(22),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,u,l,d,h,c){var f,p,m,_,v,g,y,S,b,P=c.bits,k=0,I=0,w=0,T=0,C=0,x=0,R=0,M=0,U=0,N=0,E=null,L=0,O=new i.Buf16(16),D=new i.Buf16(16),A=null,q=0;for(k=0;k<=15;k++)O[k]=0;for(I=0;I<u;I++)O[t[n+I]]++;for(C=P,T=15;T>=1&&0===O[T];T--);if(C>T&&(C=T),0===T)return l[d++]=0x1400000,l[d++]=0x1400000,c.bits=1,0;for(w=1;w<T&&0===O[w];w++);for(C<w&&(C=w),M=1,k=1;k<=15;k++)if(M<<=1,(M-=O[k])<0)return -1;if(M>0&&(0===e||1!==T))return -1;for(D[1]=0,k=1;k<15;k++)D[k+1]=D[k]+O[k];for(I=0;I<u;I++)0!==t[n+I]&&(h[D[t[n+I]]++]=I);if(0===e?(E=A=h,g=19):1===e?(E=s,L-=257,A=r,q-=257,g=256):(E=a,A=o,g=-1),N=0,I=0,k=w,v=d,x=C,R=0,m=-1,_=(U=1<<C)-1,1===e&&U>852||2===e&&U>592)return 1;for(;;){y=k-R,h[I]<g?(S=0,b=h[I]):h[I]>g?(S=A[q+h[I]],b=E[L+h[I]]):(S=96,b=0),f=1<<k-R,w=p=1<<x;do l[v+(N>>R)+(p-=f)]=y<<24|S<<16|b;while(0!==p);for(f=1<<k-1;N&f;)f>>=1;if(0!==f?(N&=f-1,N+=f):N=0,I++,0==--O[k]){if(k===T)break;k=t[n+h[I]]}if(k>C&&(N&_)!==m){for(0===R&&(R=C),v+=w,M=1<<(x=k-R);x+R<T&&!((M-=O[x+R])<=0);)x++,M<<=1;if(U+=1<<x,1===e&&U>852||2===e&&U>592)return 1;l[m=N&_]=C<<24|x<<16|v-d}}return 0!==N&&(l[v+N]=k-R<<24|4194304),c.bits=C,0}},function(e,t,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,n){"use strict";n.r(t);var i={};n.r(i),n.d(i,"shimGetUserMedia",function(){return v}),n.d(i,"shimGetDisplayMedia",function(){return g}),n.d(i,"shimMediaStream",function(){return y}),n.d(i,"shimOnTrack",function(){return S}),n.d(i,"shimGetSendersWithDtmf",function(){return b}),n.d(i,"shimGetStats",function(){return P}),n.d(i,"shimSenderReceiverGetStats",function(){return k}),n.d(i,"shimAddTrackRemoveTrackWithNative",function(){return I}),n.d(i,"shimAddTrackRemoveTrack",function(){return w}),n.d(i,"shimPeerConnection",function(){return T}),n.d(i,"fixNegotiationNeeded",function(){return C});var s={};n.r(s),n.d(s,"shimGetUserMedia",function(){return x}),n.d(s,"shimGetDisplayMedia",function(){return R}),n.d(s,"shimOnTrack",function(){return M}),n.d(s,"shimPeerConnection",function(){return U}),n.d(s,"shimSenderGetStats",function(){return N}),n.d(s,"shimReceiverGetStats",function(){return E}),n.d(s,"shimRemoveStream",function(){return L}),n.d(s,"shimRTCDataChannel",function(){return O}),n.d(s,"shimAddTransceiver",function(){return D}),n.d(s,"shimGetParameters",function(){return A}),n.d(s,"shimCreateOffer",function(){return q}),n.d(s,"shimCreateAnswer",function(){return B});var r={};n.r(r),n.d(r,"shimLocalStreamsAPI",function(){return F}),n.d(r,"shimRemoteStreamsAPI",function(){return j}),n.d(r,"shimCallbacksAPI",function(){return H}),n.d(r,"shimGetUserMedia",function(){return G}),n.d(r,"shimConstraints",function(){return z}),n.d(r,"shimRTCIceServerUrls",function(){return V}),n.d(r,"shimTrackEventTransceiver",function(){return W}),n.d(r,"shimCreateOfferLegacy",function(){return K}),n.d(r,"shimAudioContext",function(){return Y});var a={};n.r(a),n.d(a,"shimRTCIceCandidate",function(){return J}),n.d(a,"shimMaxMessageSize",function(){return Q}),n.d(a,"shimSendThrowTypeError",function(){return $}),n.d(a,"shimConnectionState",function(){return ee}),n.d(a,"removeExtmapAllowMixed",function(){return et}),n.d(a,"shimAddIceCandidateNullOrEmpty",function(){return en});let o=!0,u=!0;function l(e,t,n){let i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function d(e,t,n){if(!e.RTCPeerConnection)return;let i=e.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return s.apply(this,arguments);let r=e=>{let t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,r),s.apply(this,[e,r])};let r=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t]||!this._eventMap[t].has(n))return r.apply(this,arguments);let i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,r.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function h(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(o=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function c(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(u=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function f(){"object"==typeof window&&(o||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments))}function p(e,t){u&&console.warn(e+" is deprecated, please use "+t+" instead.")}function m(e){return"[object Object]"===Object.prototype.toString.call(e)}function _(e,t,n){let i=n?"outbound-rtp":"inbound-rtp",s=new Map;if(null===t)return s;let r=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&r.push(e)}),r.forEach(t=>{e.forEach(n=>{n.type===i&&n.trackId===t.id&&function e(t,n,i){n&&!i.has(n.id)&&(i.set(n.id,n),Object.keys(n).forEach(s=>{s.endsWith("Id")?e(t,t.get(n[s]),i):s.endsWith("Ids")&&n[s].forEach(n=>{e(t,t.get(n),i)})}))}(e,n,s)})}),s}function v(e,t){let n=e&&e.navigator;if(!n.mediaDevices)return;let i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;let t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;let i="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);let s=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[s("min",n)]=i.ideal,t.optional.push(e),(e={})[s("max",n)]=i.ideal):e[s("",n)]=i.ideal,t.optional.push(e)}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[s("",n)]=i.exact):["min","max"].forEach(e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[s(e,n)]=i[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},s=function(e,s){if(t.version>=61)return s(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){let t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let r=e.video.facingMode;r=r&&("object"==typeof r?r:{ideal:r});let a=t.version<66;if(r&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===r.exact||"environment"===r.ideal?t=["back","rear"]:"user"!==r.exact&&"user"!==r.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then(n=>{let a=(n=n.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!a&&n.length&&t.includes("back")&&(a=n[n.length-1]),a&&(e.video.deviceId=r.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),f("chrome: "+JSON.stringify(e)),s(e)})}e.video=i(e.video)}return f("chrome: "+JSON.stringify(e)),s(e)},r=function(e){return t.version>=64?e:{name:({PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"})[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(e,t,i){s(e,e=>{n.webkitGetUserMedia(e,t,e=>{i&&i(r(e))})})}).bind(n),n.mediaDevices.getUserMedia){let e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return s(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(r(e))))}}}function g(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(t=>{let i=n.video&&n.video.width,s=n.video&&n.video.height,r=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:r||3}},i&&(n.video.mandatory.maxWidth=i),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function y(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function S(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)d(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e));else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};let s=new Event("track");s.track=n.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[t.stream],this.dispatchEvent(s)}),t.stream.getTracks().forEach(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};let s=new Event("track");s.track=n,s.receiver=i,s.transceiver={receiver:i},s.streams=[t.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function b(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let s=n.apply(this,arguments);return s||(s=t(this,e),this._senders.push(s)),s};let i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);let t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(e=>{let t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function P(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,n,i]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);let s=function(e){let t={};return e.result().forEach(e=>{let n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{n[t]=e.stat(t)}),t[n.id]=n}),t},r=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};return arguments.length>=2?t.apply(this,[function(e){n(r(s(e)))},e]):new Promise((e,n)=>{t.apply(this,[function(t){e(r(s(t)))},n])}).then(n,i)}}function k(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>_(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),d(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>_(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let e,t,n,i=arguments[0];return this.getSenders().forEach(t=>{t.track===i&&(e?n=!0:e=t)}),this.getReceivers().forEach(e=>(e.track===i&&(t?n=!0:t=e),e.track===i)),n||e&&t?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):e?e.getStats():t?t.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function I(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});let t=this.getSenders();n.apply(this,arguments);let i=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(i)};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};let s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{let n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),s.apply(this,arguments)}}function w(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return I(e);let n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){let n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};let s=e.RTCPeerConnection.prototype.removeStream;function r(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{let i=e._reverseStreams[t],s=e._streams[i.id];n=n.replace(RegExp(s.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let s=this._streams[n.id];if(s)s.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){let n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){let e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{let n=r(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>r(this,e))}})[t]});let a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e,t;let n;return arguments.length&&arguments[0].type&&(arguments[0]=(e=this,t=arguments[0],n=t.sdp,Object.keys(e._reverseStreams||[]).forEach(t=>{let i=e._reverseStreams[t],s=e._streams[i.id];n=n.replace(RegExp(i.id,"g"),s.id)}),new RTCSessionDescription({type:t.type,sdp:n}))),a.apply(this,arguments)};let o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let e=o.get.apply(this);return""===e.type?e:r(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){let t;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function T(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}})[t]})}function C(e,t){d(e,"negotiationneeded",e=>{let n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}function x(e,t){let n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){p("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){let e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(e((n=JSON.parse(JSON.stringify(n))).audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){let t=i.prototype.getSettings;i.prototype.getSettings=function(){let n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){let t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(e(n=JSON.parse(JSON.stringify(n)),"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function R(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){let e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function M(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function U(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}})[t]});let n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,s,r]=arguments;return i.apply(this,[e||null]).then(e=>{if(t.version<53&&!s)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(s,r)}}function N(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function E(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),d(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function L(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){p("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function O(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function D(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach(e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw RangeError("max_framerate must be >= 0.0")});let i=t.apply(this,arguments);if(n){let{sender:t}=i,n=t.getParameters();"encodings"in n&&(1!==n.encodings.length||0!==Object.keys(n.encodings[0]).length)||(n.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return i})}function A(e){if("object"!=typeof e||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function q(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function B(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function F(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);let t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);let n=e.getTracks();this.getSenders().forEach(e=>{n.includes(e.track)&&this.removeTrack(e)})})}}function j(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);let t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);let n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function H(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,r=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){let i=arguments.length>=2?arguments[2]:arguments[0],s=n.apply(this,[i]);return t?(s.then(e,t),Promise.resolve()):s},t.createAnswer=function(e,t){let n=arguments.length>=2?arguments[2]:arguments[0],s=i.apply(this,[n]);return t?(s.then(e,t),Promise.resolve()):s};let o=function(e,t,n){let i=s.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=o,t.setRemoteDescription=o=function(e,t,n){let i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=o=function(e,t,n){let i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i}}function G(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(z(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}).bind(t))}function z(e){return e&&void 0!==e.video?Object.assign({},e,{video:function e(t){return m(t)?Object.keys(t).reduce(function(n,i){let s=m(t[i]),r=s?e(t[i]):t[i],a=s&&!Object.keys(r).length;return void 0===r||a?n:Object.assign(n,{[i]:r})},{}):t}(e.video)}):e}function V(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){let t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(p("RTCIceServer.url","RTCIceServer.urls"),(i=JSON.parse(JSON.stringify(i))).urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function W(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function K(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);let t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);let n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}}function Y(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var X=n(29),Z=n.n(X);function J(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){let n=Object.assign(new t(e),Z.a.parseCandidate(e.candidate));return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,d(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function Q(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});let n=function(e){if(!e||!e.sdp)return!1;let t=Z.a.splitSections(e.sdp);return t.shift(),t.some(e=>{let t=Z.a.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},i=function(e){let t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return -1;let n=parseInt(t[1],10);return n!=n?-1:n},s=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:0x7ffffff5:t.version<60?57===t.version?65535:65536:0x7ffffff5),n},r=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);let s=Z.a.matchPrefix(e.sdp,"a=max-message-size:");return s.length>0?i=parseInt(s[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(i=0x7ffffff5),i},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){let{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){let e,t=i(arguments[0]),n=s(t),a=r(arguments[0],t);e=0===n&&0===a?Number.POSITIVE_INFINITY:0===n||0===a?Math.max(n,a):Math.min(n,a);let o={};Object.defineProperty(o,"maxMessageSize",{get:()=>e}),this._sctp=o}return a.apply(this,arguments)}}function $(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){let n=e.send;e.send=function(){let i=arguments[0],s=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&s>t.sctp.maxMessageSize)throw TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}let n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let e=n.apply(this,arguments);return t(e,this),e},d(e,"datachannel",e=>(t(e.channel,e.target),e))}function ee(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return({completed:"connected",checking:"connecting"})[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{let n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{let t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;let n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function et(e,t){if(!e.RTCPeerConnection||"chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)return;let n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){let n=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function en(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}t.default=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){let n=function(e){let t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;let{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=l(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=l(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=l(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),o={browserDetails:n,commonShim:a,extractVersion:l,disableLog:h,disableWarnings:c,sdp:X};switch(n.browser){case"chrome":if(!i||!T||!t.shimChrome)return f("Chrome shim is not included in this adapter release."),o;if(null===n.version)return f("Chrome shim can not determine version, not shimming."),o;f("adapter.js shimming chrome."),o.browserShim=i,en(e,n),v(e,n),y(e),T(e,n),S(e),w(e,n),b(e),P(e),k(e),C(e,n),J(e),ee(e),Q(e,n),$(e),et(e,n);break;case"firefox":if(!s||!U||!t.shimFirefox)return f("Firefox shim is not included in this adapter release."),o;f("adapter.js shimming firefox."),o.browserShim=s,en(e,n),x(e,n),U(e,n),M(e),L(e),N(e),E(e),O(e),D(e),A(e),q(e),B(e),J(e),ee(e),Q(e,n),$(e);break;case"safari":if(!r||!t.shimSafari)return f("Safari shim is not included in this adapter release."),o;f("adapter.js shimming safari."),o.browserShim=r,en(e,n),V(e),K(e),H(e),F(e),j(e),W(e),G(e),Y(e),J(e),Q(e,n),$(e),et(e,n);break;default:f("Unsupported browser!")}return o}({window:"undefined"==typeof window?void 0:window})}]);